{"meta":{"version":1,"warehouse":"2.2.0"},"models":{"Asset":[{"_id":"source/CNAME","path":"CNAME","modified":0,"renderable":0},{"_id":"themes/next/source/css/main.styl","path":"css/main.styl","modified":0,"renderable":1},{"_id":"themes/next/source/images/algolia_logo.svg","path":"images/algolia_logo.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/avatar.gif","path":"images/avatar.gif","modified":0,"renderable":1},{"_id":"themes/next/source/images/cc-by-nc-nd.svg","path":"images/cc-by-nc-nd.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/cc-by-nd.svg","path":"images/cc-by-nd.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/cc-by-nc-sa.svg","path":"images/cc-by-nc-sa.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/cc-by-nc.svg","path":"images/cc-by-nc.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/placeholder.gif","path":"images/placeholder.gif","modified":0,"renderable":1},{"_id":"themes/next/source/images/cc-by-sa.svg","path":"images/cc-by-sa.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/loading.gif","path":"images/loading.gif","modified":0,"renderable":1},{"_id":"themes/next/source/images/cc-by.svg","path":"images/cc-by.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/cc-zero.svg","path":"images/cc-zero.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/quote-l.svg","path":"images/quote-l.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/quote-r.svg","path":"images/quote-r.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/searchicon.png","path":"images/searchicon.png","modified":0,"renderable":1},{"_id":"themes/next/source/lib/algolia-instant-search/instantsearch.min.css","path":"lib/algolia-instant-search/instantsearch.min.css","modified":0,"renderable":1},{"_id":"themes/next/source/js/src/affix.js","path":"js/src/affix.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/src/algolia-search.js","path":"js/src/algolia-search.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/src/exturl.js","path":"js/src/exturl.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/src/bootstrap.js","path":"js/src/bootstrap.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/src/js.cookie.js","path":"js/src/js.cookie.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/src/hook-duoshuo.js","path":"js/src/hook-duoshuo.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/src/motion.js","path":"js/src/motion.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/src/post-details.js","path":"js/src/post-details.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/src/scrollspy.js","path":"js/src/scrollspy.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/src/scroll-cookie.js","path":"js/src/scroll-cookie.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/canvas-nest/canvas-nest.min.js","path":"lib/canvas-nest/canvas-nest.min.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/src/utils.js","path":"js/src/utils.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/bower.json","path":"lib/font-awesome/bower.json","modified":0,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/HELP-US-OUT.txt","path":"lib/font-awesome/HELP-US-OUT.txt","modified":0,"renderable":1},{"_id":"themes/next/source/lib/canvas-ribbon/canvas-ribbon.js","path":"lib/canvas-ribbon/canvas-ribbon.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/fastclick/bower.json","path":"lib/fastclick/bower.json","modified":0,"renderable":1},{"_id":"themes/next/source/lib/fastclick/LICENSE","path":"lib/fastclick/LICENSE","modified":0,"renderable":1},{"_id":"themes/next/source/lib/fastclick/README.md","path":"lib/fastclick/README.md","modified":0,"renderable":1},{"_id":"themes/next/source/lib/velocity/bower.json","path":"lib/velocity/bower.json","modified":0,"renderable":1},{"_id":"themes/next/source/lib/velocity/velocity.min.js","path":"lib/velocity/velocity.min.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/velocity/velocity.ui.js","path":"lib/velocity/velocity.ui.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/jquery_lazyload/bower.json","path":"lib/jquery_lazyload/bower.json","modified":0,"renderable":1},{"_id":"themes/next/source/lib/velocity/velocity.ui.min.js","path":"lib/velocity/velocity.ui.min.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/jquery_lazyload/CONTRIBUTING.md","path":"lib/jquery_lazyload/CONTRIBUTING.md","modified":0,"renderable":1},{"_id":"themes/next/source/lib/jquery_lazyload/README.md","path":"lib/jquery_lazyload/README.md","modified":0,"renderable":1},{"_id":"themes/next/source/lib/jquery_lazyload/jquery.scrollstop.js","path":"lib/jquery_lazyload/jquery.scrollstop.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/jquery_lazyload/jquery.lazyload.js","path":"lib/jquery_lazyload/jquery.lazyload.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/pace/pace-theme-barber-shop.min.css","path":"lib/pace/pace-theme-barber-shop.min.css","modified":0,"renderable":1},{"_id":"themes/next/source/lib/pace/pace-theme-big-counter.min.css","path":"lib/pace/pace-theme-big-counter.min.css","modified":0,"renderable":1},{"_id":"themes/next/source/lib/pace/pace-theme-bounce.min.css","path":"lib/pace/pace-theme-bounce.min.css","modified":0,"renderable":1},{"_id":"themes/next/source/lib/pace/pace-theme-center-atom.min.css","path":"lib/pace/pace-theme-center-atom.min.css","modified":0,"renderable":1},{"_id":"themes/next/source/lib/pace/pace-theme-center-radar.min.css","path":"lib/pace/pace-theme-center-radar.min.css","modified":0,"renderable":1},{"_id":"themes/next/source/lib/pace/pace-theme-center-circle.min.css","path":"lib/pace/pace-theme-center-circle.min.css","modified":0,"renderable":1},{"_id":"themes/next/source/lib/pace/pace-theme-center-simple.min.css","path":"lib/pace/pace-theme-center-simple.min.css","modified":0,"renderable":1},{"_id":"themes/next/source/lib/pace/pace-theme-fill-left.min.css","path":"lib/pace/pace-theme-fill-left.min.css","modified":0,"renderable":1},{"_id":"themes/next/source/lib/pace/pace-theme-corner-indicator.min.css","path":"lib/pace/pace-theme-corner-indicator.min.css","modified":0,"renderable":1},{"_id":"themes/next/source/lib/pace/pace-theme-minimal.min.css","path":"lib/pace/pace-theme-minimal.min.css","modified":0,"renderable":1},{"_id":"themes/next/source/lib/pace/pace-theme-flash.min.css","path":"lib/pace/pace-theme-flash.min.css","modified":0,"renderable":1},{"_id":"themes/next/source/lib/pace/pace-theme-loading-bar.min.css","path":"lib/pace/pace-theme-loading-bar.min.css","modified":0,"renderable":1},{"_id":"themes/next/source/lib/pace/pace-theme-mac-osx.min.css","path":"lib/pace/pace-theme-mac-osx.min.css","modified":0,"renderable":1},{"_id":"themes/next/source/lib/pace/pace.min.js","path":"lib/pace/pace.min.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/three/canvas_lines.min.js","path":"lib/three/canvas_lines.min.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/three/canvas_sphere.min.js","path":"lib/three/canvas_sphere.min.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/three/three-waves.min.js","path":"lib/three/three-waves.min.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/jquery/index.js","path":"lib/jquery/index.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/Han/dist/han.css","path":"lib/Han/dist/han.css","modified":0,"renderable":1},{"_id":"themes/next/source/lib/Han/dist/han.min.css","path":"lib/Han/dist/han.min.css","modified":0,"renderable":1},{"_id":"themes/next/source/lib/Han/dist/han.min.js","path":"lib/Han/dist/han.min.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/src/schemes/pisces.js","path":"js/src/schemes/pisces.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/blank.gif","path":"lib/fancybox/source/blank.gif","modified":0,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/fancybox_loading.gif","path":"lib/fancybox/source/fancybox_loading.gif","modified":0,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/fancybox_loading@2x.gif","path":"lib/fancybox/source/fancybox_loading@2x.gif","modified":0,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/fancybox_overlay.png","path":"lib/fancybox/source/fancybox_overlay.png","modified":0,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/fancybox_sprite.png","path":"lib/fancybox/source/fancybox_sprite.png","modified":0,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/fancybox_sprite@2x.png","path":"lib/fancybox/source/fancybox_sprite@2x.png","modified":0,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/jquery.fancybox.js","path":"lib/fancybox/source/jquery.fancybox.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/jquery.fancybox.css","path":"lib/fancybox/source/jquery.fancybox.css","modified":0,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/jquery.fancybox.pack.js","path":"lib/fancybox/source/jquery.fancybox.pack.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/fastclick/lib/fastclick.js","path":"lib/fastclick/lib/fastclick.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/ua-parser-js/dist/ua-parser.min.js","path":"lib/ua-parser-js/dist/ua-parser.min.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/fastclick/lib/fastclick.min.js","path":"lib/fastclick/lib/fastclick.min.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/ua-parser-js/dist/ua-parser.pack.js","path":"lib/ua-parser-js/dist/ua-parser.pack.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/css/font-awesome.css","path":"lib/font-awesome/css/font-awesome.css","modified":0,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/css/font-awesome.css.map","path":"lib/font-awesome/css/font-awesome.css.map","modified":0,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/css/font-awesome.min.css","path":"lib/font-awesome/css/font-awesome.min.css","modified":0,"renderable":1},{"_id":"themes/next/source/lib/Han/dist/han.js","path":"lib/Han/dist/han.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/velocity/velocity.js","path":"lib/velocity/velocity.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.woff2","path":"lib/font-awesome/fonts/fontawesome-webfont.woff2","modified":0,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.woff","path":"lib/font-awesome/fonts/fontawesome-webfont.woff","modified":0,"renderable":1},{"_id":"themes/next/source/lib/Han/dist/font/han-space.otf","path":"lib/Han/dist/font/han-space.otf","modified":0,"renderable":1},{"_id":"themes/next/source/lib/Han/dist/font/han-space.woff","path":"lib/Han/dist/font/han-space.woff","modified":0,"renderable":1},{"_id":"themes/next/source/lib/Han/dist/font/han.otf","path":"lib/Han/dist/font/han.otf","modified":0,"renderable":1},{"_id":"themes/next/source/lib/Han/dist/font/han.woff","path":"lib/Han/dist/font/han.woff","modified":0,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/helpers/jquery.fancybox-buttons.css","path":"lib/fancybox/source/helpers/jquery.fancybox-buttons.css","modified":0,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/helpers/fancybox_buttons.png","path":"lib/fancybox/source/helpers/fancybox_buttons.png","modified":0,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/helpers/jquery.fancybox-buttons.js","path":"lib/fancybox/source/helpers/jquery.fancybox-buttons.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/helpers/jquery.fancybox-thumbs.css","path":"lib/fancybox/source/helpers/jquery.fancybox-thumbs.css","modified":0,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/fonts/FontAwesome.otf","path":"lib/font-awesome/fonts/FontAwesome.otf","modified":0,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.eot","path":"lib/font-awesome/fonts/fontawesome-webfont.eot","modified":0,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.ttf","path":"lib/font-awesome/fonts/fontawesome-webfont.ttf","modified":0,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/helpers/jquery.fancybox-media.js","path":"lib/fancybox/source/helpers/jquery.fancybox-media.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/helpers/jquery.fancybox-thumbs.js","path":"lib/fancybox/source/helpers/jquery.fancybox-thumbs.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/algolia-instant-search/instantsearch.min.js","path":"lib/algolia-instant-search/instantsearch.min.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/three/three.min.js","path":"lib/three/three.min.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.svg","path":"lib/font-awesome/fonts/fontawesome-webfont.svg","modified":0,"renderable":1}],"Cache":[{"_id":"source/CNAME","hash":"97d9a237954c0216b3a80750275d06038224c70c","modified":1510504904752},{"_id":"themes/next/.bowerrc","hash":"334da94ca6f024d60d012cc26ea655681e724ad8","modified":1504451374220},{"_id":"themes/next/.editorconfig","hash":"211d2c92bfdddb3e81ea946f4ca7a539f150f4da","modified":1504451374221},{"_id":"themes/next/.gitattributes","hash":"8454b9313cb1a97b63fb87e2d29daee497ce6249","modified":1504451374221},{"_id":"themes/next/.gitignore","hash":"b935cc0e5b099ebd343ca1766e02f65138c13dd0","modified":1504451374228},{"_id":"themes/next/.hound.yml","hash":"289dcf5bfe92dbd680d54d6e0668f41c9c9c0c78","modified":1504451374229},{"_id":"themes/next/.javascript_ignore","hash":"cd250ad74ca22bd2c054476456a73d9687f05f87","modified":1504451374229},{"_id":"themes/next/.jshintrc","hash":"b7d23f2ce8d99fa073f22f9960605f318acd7710","modified":1504451374230},{"_id":"themes/next/.travis.yml","hash":"6674fbdfe0d0c03b8a04527ffb8ab66a94253acd","modified":1504451374232},{"_id":"themes/next/LICENSE","hash":"ec44503d7e617144909e54533754f0147845f0c5","modified":1504451374233},{"_id":"themes/next/README.cn.md","hash":"59e323ce21535d561507c9ecc984b7c4dcb61514","modified":1504451374234},{"_id":"themes/next/README.md","hash":"52bad95ac4c88371d3ae9d9ea6e0e14b8c723edf","modified":1504451374235},{"_id":"themes/next/_config.yml","hash":"93a7ed5a2b76a4130ae3353c87d4da98f4f16c63","modified":1513961245231},{"_id":"themes/next/bower.json","hash":"63c38f50fb54b25bf5101f566189f9e5b3a6ef0e","modified":1504451374237},{"_id":"themes/next/.stylintrc","hash":"3b7f9785e9ad0dab764e1c535b40df02f4ff5fd6","modified":1504451374231},{"_id":"themes/next/gulpfile.coffee","hash":"412defab3d93d404b7c26aaa0279e2e586e97454","modified":1504451374238},{"_id":"source/_posts/js心跳请求.md","hash":"3654ea2723c040da5241a06fb9ccc33122f17fb1","modified":1516777434137},{"_id":"themes/next/package.json","hash":"85a77bafb3d1e958b82e52528b7a95fcd59efda9","modified":1504451374643},{"_id":"source/about/index.md","hash":"be502ae1fbbe7406172833be2608307b68eaad71","modified":1503813653601},{"_id":"source/tags/index.md","hash":"6d7ba436ea280a408be9a473466fec577f18daf4","modified":1503813643807},{"_id":"source/categories/index.md","hash":"460fef8ab3e31296379bc064f1aa96b875706f76","modified":1503813637640},{"_id":"themes/next/languages/de.yml","hash":"ee6262473faa1fa55e3dc7b0bb6542f4f6a275c8","modified":1504451374239},{"_id":"themes/next/languages/default.yml","hash":"2443657cf60284ecf01c60a5e20acd406f321d88","modified":1504451374240},{"_id":"themes/next/languages/en.yml","hash":"2443657cf60284ecf01c60a5e20acd406f321d88","modified":1504451374241},{"_id":"themes/next/languages/id.yml","hash":"58c9886ccd224cee3db6f9b9e1a86dcd4ff47995","modified":1504451374242},{"_id":"themes/next/languages/fr-FR.yml","hash":"c6f3a38a6c27d0815ef72d66020805408aa24019","modified":1504451374242},{"_id":"themes/next/languages/ja.yml","hash":"6ba8858255b4cae5e00f5fabd1cfaea3c98a34c2","modified":1504451374243},{"_id":"themes/next/languages/ko.yml","hash":"fbfad308103fb95c635609419bfa3420cb69d646","modified":1504451374245},{"_id":"themes/next/languages/pt-BR.yml","hash":"5e160fa8c8bd1f16b50db161d5bc8ae2ebd6a0c5","modified":1504451374245},{"_id":"themes/next/languages/pt.yml","hash":"1141a4896986de6e2383c5694c0359eaa22fb9b4","modified":1504451374246},{"_id":"themes/next/languages/ru.yml","hash":"43a8fb18dbfeaeed71268d75eb4c542061766419","modified":1504451374247},{"_id":"themes/next/languages/zh-Hans.yml","hash":"0b9ce7d62e7d55235a2770817a40e84577ce38c1","modified":1504451374248},{"_id":"themes/next/languages/zh-tw.yml","hash":"a91f6c8fa19044afac162a1c73e03836e9460bc5","modified":1504451374249},{"_id":"themes/next/languages/zh-hk.yml","hash":"13b2808d632c27748a38a752457d4538c37b8ebb","modified":1504451374248},{"_id":"source/_posts/终于有了自己的博客.md","hash":"83de08effabe88e706696050098cf307f6385fa2","modified":1504452172890},{"_id":"themes/next/layout/category.swig","hash":"3cbb3f72429647411f9e85f2544bdf0e3ad2e6b2","modified":1504451374640},{"_id":"themes/next/layout/_layout.swig","hash":"fb55ab56e2d478cadc0c3906adfbc4a13620408e","modified":1510671809544},{"_id":"themes/next/layout/archive.swig","hash":"9a2c14874a75c7085d2bada5e39201d3fc4fd2b4","modified":1504451374638},{"_id":"themes/next/layout/index.swig","hash":"555a357ecf17128db4e29346c92bb6298e66547a","modified":1504451374640},{"_id":"themes/next/layout/page.swig","hash":"dbff0302b4bfabb51556a197bf65190eb30361f0","modified":1504451374641},{"_id":"themes/next/scripts/merge-configs.js","hash":"3ce1be32bb77ee19da25e8dae7dc04e2afc46ca1","modified":1504451374645},{"_id":"themes/next/layout/post.swig","hash":"182a99b1f6db0350106c6bb480fede0bbdb7e40f","modified":1504451374641},{"_id":"themes/next/scripts/merge.js","hash":"39b84b937b2a9608b94e5872349a47200e1800ff","modified":1504451374646},{"_id":"themes/next/layout/schedule.swig","hash":"87ad6055df01fa2e63e51887d34a2d8f0fbd2f5a","modified":1504451374642},{"_id":"themes/next/layout/tag.swig","hash":"34e1c016cbdf94a31f9c5d494854ff46b2a182e9","modified":1504451374643},{"_id":"themes/next/test/.jshintrc","hash":"c9fca43ae0d99718e45a6f5ce736a18ba5fc8fb6","modified":1504451374891},{"_id":"themes/next/test/intern.js","hash":"db90b1063356727d72be0d77054fdc32fa882a66","modified":1504451374893},{"_id":"themes/next/source/fonts/.gitkeep","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1504451374749},{"_id":"themes/next/test/helpers.js","hash":"f25e7f3265eb5a6e1ccbb5e5012fa9bebf134105","modified":1504451374892},{"_id":"source/_posts/其他/北京冬天哪里好玩.md","hash":"7fe5f08f38c5bb92c49e4b38504e7b6cc7ab0496","modified":1513962081934},{"_id":"source/_posts/其他/记录有北京游玩的链接.md","hash":"51f5c0264314b7aa78afde64ffc5b3848163d9ed","modified":1513958083950},{"_id":"source/_posts/大数据/大数据02-01-1-linux本地yum库.md","hash":"e480cd4ba8c13aa96ff2a0ac6e4226b21b75bab5","modified":1510672075300},{"_id":"source/_posts/大数据/大数据01-linux安装及基本命令.md","hash":"a09d2bbd7c42768f8ef79c447046795d9b7b1456","modified":1510672430941},{"_id":"source/_posts/大数据/大数据02-01 linux命令继续学习.md","hash":"2f047b710743f5159379b55c0c11291f0f0c2996","modified":1510672502319},{"_id":"source/_posts/大数据/大数据02-02-linux命令继续学习-yum.md","hash":"e577fbce12e08d9c07a083367c461919f55bddfd","modified":1510672372333},{"_id":"source/_posts/大数据/大数据02-03 shell编程语法讲解.md","hash":"0fd2d970c2d79e82b2b416fba6e147eccae8360d","modified":1512489682799},{"_id":"source/_posts/大数据/大数据02-04-shell编程-sed命令.md","hash":"4d6c4c8ced0e24606d52ccb3878f542f3e6bb94f","modified":1509984832587},{"_id":"source/_posts/大数据/大数据03-01-自动化部署脚本.md","hash":"c0d33fff5771282db3f491513fa5a17adb356830","modified":1510672015689},{"_id":"source/_posts/大数据/大数据02-05-shell编程-awk命令.md","hash":"0de18b8b3013d72d0c738164cf206e5a77530128","modified":1510672098953},{"_id":"source/_posts/大数据/大数据03-02-zookeeper-简介.md","hash":"fbd7059bdf78feb910008babeb29af5a5f496b47","modified":1511094504848},{"_id":"source/_posts/大数据/大数据03-03-zookeeper-命令行客户端及znode数据结构类型监听等功能.md","hash":"145fb68e7ff0079ba95a83bcf246b0fcdbc9f807","modified":1511278307234},{"_id":"source/_posts/大数据/大数据03-04-zookeeper集群自动启动脚本及export变量作用域的解析.md","hash":"5e07e7a443689af34d8fc7884c05b6b2091b5f73","modified":1511629776081},{"_id":"source/_posts/大数据/大数据03-05-java-api.md","hash":"8f7644866cffb1aabb5590c2d7df582c3b730699","modified":1511692670160},{"_id":"source/_posts/大数据/大数据03-06-系统服务器上下线感知程序.md","hash":"249283144d3fd3bd3e9155b65dcd31771373d8ce","modified":1511692578352},{"_id":"source/_posts/大数据/大数据0401-java多线程并发.md","hash":"00178edd234e84994ef46d8416d0ffce004c1d8c","modified":1512289395948},{"_id":"source/_posts/大数据/大数据0402-JMS activeMQ.md","hash":"fe0db9f60514044edb04aa139b535e8c896984e0","modified":1512297008487},{"_id":"source/_posts/大数据/大数据0403-java反射.md","hash":"df1ea596f637afb3a01478713fbe0e25c2368205","modified":1512297025769},{"_id":"source/_posts/大数据/大数据0404-java动态代理.md","hash":"a40f39866336ed37edf47af28acfc299b1fbb1b2","modified":1512297022149},{"_id":"source/_posts/大数据/大数据0405-java-socket.md","hash":"eed16cfc094350b63701386104d30c20c410f113","modified":1512314244365},{"_id":"source/_posts/大数据/大数据0406-javaJVM技术.md","hash":"365acc179896bc66480006a0d6c60afa41d5dc63","modified":1512489019436},{"_id":"source/_posts/微服务/微服务框架与实战-总体概览.md","hash":"2fb2fbcd5370eee9c8cb4a77b6bd4dae3c9896d3","modified":1516551414403},{"_id":"source/_posts/大数据/大数据0501-轻量级RPC框架开发.md","hash":"5cd7ce6da94097b5a706e767779dc482971dfad2","modified":1514743829078},{"_id":"source/_posts/杂记/aws-vpn.md","hash":"da5bfa4845027a3225e7961b3e19321225c4853e","modified":1515255804547},{"_id":"source/_posts/微服务/微服务框架与实战-笔记01-概述.md","hash":"154c7a3f16c027de29677aac1c74eca4513ea1cf","modified":1515510790578},{"_id":"source/_posts/微服务/微服务框架与实战-笔记02-微服务开发框架-SpringCloud.md","hash":"2968092b1895deb2732a165193b36b2846f040f4","modified":1515511455937},{"_id":"source/_posts/微服务/微服务框架与实战-笔记03-开始使用SpringCloud实战微服务.md","hash":"f30b45116fd60fcaad3d2f1ad10a507e26099083","modified":1516551429085},{"_id":"source/_posts/杂记/centos7-安装mysql-转.md","hash":"befce77f7fdf96409e9150606f0ab9aa36c52e69","modified":1509808504097},{"_id":"source/_posts/杂记/centos7-开放端口.md","hash":"2995b4b591669235a141a8a8771835bfc46af603","modified":1509876925250},{"_id":"source/_posts/杂记/hexo-next-本地搜索.md","hash":"ae332f99a29916ec382bfbc8a3e3b0b5be64f451","modified":1511091474840},{"_id":"source/_posts/杂记/hexo-next-搜索-algolia.md","hash":"b3f3323a3e8d8731a6d69e2f0170b9d61076f73b","modified":1510676286015},{"_id":"source/_posts/杂记/idea快捷键记录.md","hash":"67c89c94a0a6eeefd44a8a554bffff803dd7d911","modified":1505060609507},{"_id":"source/_posts/杂记/linux笔记-修改语言.md","hash":"535e573dc041ac3a393097dadc5c110c4c7ca9fe","modified":1510672286099},{"_id":"source/_posts/杂记/vagrant 创建virtualBox虚拟机.md","hash":"81cddd817db2f8b9a27f46b985064c82db8028c7","modified":1511066697681},{"_id":"source/_posts/杂记/vscode快捷键记录.md","hash":"046fb7481abc333b96123b258f0e8d7e8e3b4cb8","modified":1505060896129},{"_id":"source/_posts/杂记/使用多个git账户.md","hash":"39fb5a73e3df2f6f2a7f49d9ea915cb839d1682c","modified":1515318055039},{"_id":"source/_posts/杂记/记录下hexo常用命令自己方便看.md","hash":"4c5821e952c71956ee363920b4bd356cc711f0c1","modified":1504452632771},{"_id":"themes/next/layout/_custom/sidebar.swig","hash":"ba8ab5a0280b953aa97435ff8946cbcbb2755a27","modified":1504451374252},{"_id":"themes/next/layout/_custom/header.swig","hash":"ba8ab5a0280b953aa97435ff8946cbcbb2755a27","modified":1504451374251},{"_id":"themes/next/layout/_partials/comments.swig","hash":"fc0ff72b3a8ab25029a070acee066d9eaa0b0493","modified":1504451374261},{"_id":"themes/next/layout/_partials/page-header.swig","hash":"77c61e0baea3544df361b7338c3cd13dc84dde22","modified":1504451374573},{"_id":"themes/next/layout/_partials/footer.swig","hash":"dc2a0699152da26de23cf68314d919c7f1b91b77","modified":1504451374561},{"_id":"themes/next/layout/_partials/header.swig","hash":"c54b32263bc8d75918688fb21f795103b3f57f03","modified":1504451374572},{"_id":"themes/next/layout/_partials/head.swig","hash":"71040aa738c57c24f8b703875d58ab7a262fe075","modified":1504451374564},{"_id":"themes/next/layout/_partials/pagination.swig","hash":"1634fb887842698e01ff6e632597fe03c75d2d01","modified":1504451374576},{"_id":"themes/next/layout/_partials/search.swig","hash":"b4ebe4a52a3b51efe549dd1cdee846103664f5eb","modified":1504451374579},{"_id":"themes/next/layout/_third-party/duoshuo-hot-articles.swig","hash":"ba75672183d94f1de7c8bd0eeee497a58c70e889","modified":1504451374628},{"_id":"themes/next/layout/_third-party/exturl.swig","hash":"8301c9600bb3e47f7fb98b0e0332ef3c51bb1688","modified":1504451374628},{"_id":"themes/next/layout/_third-party/scroll-cookie.swig","hash":"9a188938d46931d5f3882a140aa1c48b3a893f0c","modified":1504451374631},{"_id":"themes/next/layout/_scripts/boostrap.swig","hash":"c0f5a0955f69ca4ed9ee64a2d5f8aa75064935ad","modified":1504451374597},{"_id":"themes/next/layout/_scripts/commons.swig","hash":"931808ad9b8d8390c0dcf9bdeb0954eeb9185d68","modified":1504451374598},{"_id":"themes/next/layout/_third-party/mathjax.swig","hash":"a0bd3388587fd943baae0d84ca779a707fbcad89","modified":1504451374629},{"_id":"themes/next/layout/_third-party/rating.swig","hash":"554ec568e9d2c71e4a624a8de3cb5929050811d6","modified":1504451374629},{"_id":"themes/next/layout/_third-party/schedule.swig","hash":"db15d7e1552aa2d2386a6b8a33b3b3a40bf9e43d","modified":1504451374631},{"_id":"themes/next/scripts/tags/center-quote.js","hash":"99b66949f18398689b904907af23c013be1b978f","modified":1504451374647},{"_id":"themes/next/scripts/tags/button.js","hash":"aaf71be6b483fca7a65cd6296c2cf1c2271c26a6","modified":1504451374647},{"_id":"themes/next/scripts/tags/exturl.js","hash":"5022c0ba9f1d13192677cf1fd66005c57c3d0f53","modified":1504451374648},{"_id":"themes/next/scripts/tags/group-pictures.js","hash":"ac681b0d0d8d39ba3817336c0270c6787c2b6b70","modified":1504451374649},{"_id":"themes/next/scripts/tags/full-image.js","hash":"c9f833158c66bd72f627a0559cf96550e867aa72","modified":1504451374648},{"_id":"themes/next/scripts/tags/label.js","hash":"6f00952d70aadece844ce7fd27adc52816cc7374","modified":1504451374650},{"_id":"themes/next/scripts/tags/note.js","hash":"f7eae135f35cdab23728e9d0d88b76e00715faa0","modified":1504451374651},{"_id":"themes/next/scripts/tags/lazy-image.js","hash":"bcba2ff25cd7850ce6da322d8bd85a8dd00b5ceb","modified":1504451374650},{"_id":"themes/next/scripts/tags/tabs.js","hash":"aa7fc94a5ec27737458d9fe1a75c0db7593352fd","modified":1504451374652},{"_id":"themes/next/layout/_scripts/vendors.swig","hash":"53c894e6f3573c662dc4e4f7b5a6f1a32f1a8c94","modified":1504451374607},{"_id":"themes/next/source/css/main.styl","hash":"a91dbb7ef799f0a171b5e726c801139efe545176","modified":1504451374748},{"_id":"themes/next/source/images/algolia_logo.svg","hash":"45eeea0b5fba833e21e38ea10ed5ab385ceb4f01","modified":1504451374749},{"_id":"themes/next/source/images/avatar.gif","hash":"264082bb3a1af70d5499c7d22b0902cb454b6d12","modified":1504451374750},{"_id":"themes/next/source/images/cc-by-nc-nd.svg","hash":"bc3588c9b2d7c68830524783120ff6cf957cf668","modified":1504451374751},{"_id":"themes/next/source/images/cc-by-nd.svg","hash":"42cd73da328077ccc92f859bb8f3cf621b3484f8","modified":1504451374753},{"_id":"themes/next/source/images/cc-by-nc-sa.svg","hash":"6f55543d1fb9cbc436c101d24f802dec7b41efc3","modified":1504451374751},{"_id":"themes/next/source/images/cc-by-nc.svg","hash":"6f076713fb9bf934aa2c1046bdf2cf2e37bc1eab","modified":1504451374752},{"_id":"themes/next/source/images/placeholder.gif","hash":"5fbd472222feb8a22cf5b8aa5dc5b8e13af88e2b","modified":1504451374756},{"_id":"themes/next/source/images/cc-by-sa.svg","hash":"70c1535f43e54e5ff35ca81419e77e4c0c301398","modified":1504451374754},{"_id":"themes/next/source/images/loading.gif","hash":"5fbd472222feb8a22cf5b8aa5dc5b8e13af88e2b","modified":1504451374756},{"_id":"themes/next/source/images/cc-by.svg","hash":"e92a33c32d1dac8ed94849b2b4e6456e887efe70","modified":1504451374754},{"_id":"themes/next/source/images/cc-zero.svg","hash":"9bfb52b2f63527a7049247bf00d44e6dc1170e7d","modified":1504451374755},{"_id":"themes/next/source/images/quote-l.svg","hash":"cd108d6f44351cadf8e6742565217f88818a0458","modified":1504451374757},{"_id":"themes/next/source/images/quote-r.svg","hash":"2a2a250b32a87c69dcc1b1976c74b747bedbfb41","modified":1504451374758},{"_id":"themes/next/source/images/searchicon.png","hash":"67727a6a969be0b2659b908518fa6706eed307b8","modified":1504451374758},{"_id":"themes/next/layout/_macro/post-copyright.swig","hash":"0f59a51b5cea3e8a7c078db486626cddc2978622","modified":1504451374255},{"_id":"themes/next/layout/_macro/post-collapse.swig","hash":"8c56dd26157cbc580ae41d97ac34b90ab48ced3f","modified":1504451374254},{"_id":"themes/next/layout/_macro/wechat-subscriber.swig","hash":"e2e4eae391476da994045ed4c7faf5e05aca2cd7","modified":1504451374259},{"_id":"themes/next/layout/_macro/post.swig","hash":"9896b34a7edc112c03b393a1602a616710a66ae1","modified":1504451374256},{"_id":"themes/next/layout/_macro/sidebar.swig","hash":"4a7306f92e16c468c6ebbd75382fd24e0d5f0760","modified":1504451374258},{"_id":"themes/next/layout/_macro/reward.swig","hash":"5b1e91c2f6f88fbecd426cd0727e7b7854c6cc1d","modified":1504451374257},{"_id":"themes/next/layout/_scripts/schemes/muse.swig","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1504451374604},{"_id":"themes/next/layout/_scripts/schemes/mist.swig","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1504451374604},{"_id":"themes/next/source/css/_mixins/Muse.styl","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1504451374725},{"_id":"themes/next/source/css/_mixins/Mist.styl","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1504451374725},{"_id":"themes/next/source/css/_mixins/custom.styl","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1504451374727},{"_id":"themes/next/source/css/_variables/Muse.styl","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1504451374745},{"_id":"themes/next/source/css/_variables/custom.styl","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1504451374747},{"_id":"themes/next/layout/_partials/head/custom-head.swig","hash":"a223919d2e1bf17ca4d6abb2c86f2efca9883dc1","modified":1504451374566},{"_id":"themes/next/layout/_partials/head/external-fonts.swig","hash":"f5e487b0d213ca0bd94aa30bc23b240d65081627","modified":1504451374569},{"_id":"themes/next/layout/_partials/search/tinysou.swig","hash":"b25002a83cbd2ca0c4a5df87ad5bff26477c0457","modified":1504451374585},{"_id":"themes/next/layout/_partials/search/swiftype.swig","hash":"a8c7f9ca7c605d039a1f3bf4e4d3183700a3dd62","modified":1504451374583},{"_id":"themes/next/layout/_partials/search/localsearch.swig","hash":"b2f0d247b213e4cf8de47af6a304d98070cc7256","modified":1504451374582},{"_id":"themes/next/layout/_partials/share/add-this.swig","hash":"9e3d133ac5bcc6cb51702c83b2611a49811abad1","modified":1504451374588},{"_id":"themes/next/layout/_partials/share/duoshuo_share.swig","hash":"d4fbffd7fa8f2090eb32a871872665d90a885fac","modified":1504451374592},{"_id":"themes/next/layout/_partials/share/jiathis.swig","hash":"8ed117eeeac17d562a54ec6be556988be0ec67ba","modified":1504451374594},{"_id":"themes/next/layout/_third-party/analytics/analytics-with-widget.swig","hash":"ff947f3561b229bc528cb1837d4ca19612219411","modified":1504451374608},{"_id":"themes/next/layout/_third-party/analytics/baidu-analytics.swig","hash":"753d262911c27baf663fcaf199267133528656af","modified":1504451374610},{"_id":"themes/next/layout/_third-party/analytics/cnzz-analytics.swig","hash":"a10b7f19d7b5725527514622899df413a34a89db","modified":1504451374612},{"_id":"themes/next/layout/_partials/share/baidushare.swig","hash":"d9e2d9282f9be6e04eae105964abb81e512bffed","modified":1504451374590},{"_id":"themes/next/layout/_third-party/analytics/application-insights.swig","hash":"71397a5823e8ec8aad3b68aace13150623b3e19d","modified":1504451374609},{"_id":"themes/next/layout/_third-party/analytics/google-analytics.swig","hash":"b1e13df83fb2b1d5d513b30b7aa6158b0837daab","modified":1504451374613},{"_id":"themes/next/layout/_third-party/analytics/facebook-sdk.swig","hash":"7d94845f96197d9d84a405fa5d4ede75fb81b225","modified":1504451374613},{"_id":"themes/next/layout/_third-party/analytics/index.swig","hash":"45f3f629c2aacc381095750e1c8649041a71a84b","modified":1504451374614},{"_id":"themes/next/layout/_third-party/analytics/tencent-mta.swig","hash":"5a8027328f060f965b3014060bebec1d7cf149c1","modified":1504451374618},{"_id":"themes/next/layout/_third-party/analytics/tencent-analytics.swig","hash":"8a399df90dadba5ad4e781445b58f4765aeb701e","modified":1504451374617},{"_id":"themes/next/layout/_third-party/analytics/busuanzi-counter.swig","hash":"7b11eac3a0685fa1ab2ab6ecff60afc4f15f0d16","modified":1504451374611},{"_id":"themes/next/layout/_third-party/seo/baidu-push.swig","hash":"d8c98938719284fa06492c114d99a1904652a555","modified":1504451374637},{"_id":"themes/next/layout/_third-party/analytics/lean-analytics.swig","hash":"e6d10ee4fb70b3ae1cd37e9e36e000306734aa2e","modified":1504451374615},{"_id":"themes/next/layout/_scripts/pages/post-details.swig","hash":"9b84ab576982b2c3bb0291da49143bc77fba3cc6","modified":1504451374601},{"_id":"themes/next/layout/_third-party/analytics/vkontakte-api.swig","hash":"f9a1647a8f1866deeb94052d1f87a5df99cb1e70","modified":1504451374618},{"_id":"themes/next/layout/_third-party/comments/disqus.swig","hash":"b83a51bbe0f1e2ded9819070840b0ea145f003a6","modified":1504451374621},{"_id":"themes/next/layout/_third-party/comments/index.swig","hash":"92ea45b877b1fec2010c7b409f121c986ee5075b","modified":1504451374623},{"_id":"themes/next/layout/_third-party/comments/changyan.swig","hash":"4c501ea0b9c494181eb3c607c5526a5754e7fbd8","modified":1504451374620},{"_id":"themes/next/layout/_third-party/comments/youyan.swig","hash":"7e65ff8fe586cd655b0e9d1ad2912663ff9bd36c","modified":1504451374626},{"_id":"themes/next/layout/_third-party/comments/duoshuo.swig","hash":"1600f340e0225361580c44890568dc07dbcf2c89","modified":1504451374622},{"_id":"themes/next/layout/_third-party/comments/hypercomments.swig","hash":"af7f3e43cbdc4f88c13f101f0f341af96ace3383","modified":1504451374622},{"_id":"themes/next/layout/_third-party/comments/livere.swig","hash":"9246162d4bc7e949ce1d12d135cbbaf5dc3024ec","modified":1504451374624},{"_id":"themes/next/layout/_third-party/search/index.swig","hash":"34599633658f3b0ffb487728b7766e1c7b551f5a","modified":1504451374635},{"_id":"themes/next/layout/_scripts/schemes/gemini.swig","hash":"a9a3995b9615adfb8d6b127c78c6771627bee19a","modified":1504451374603},{"_id":"themes/next/layout/_third-party/comments/valine.swig","hash":"602104d7ac47f7888d97e810419e58593a79e8ba","modified":1504451374625},{"_id":"themes/next/layout/_scripts/schemes/pisces.swig","hash":"a9a3995b9615adfb8d6b127c78c6771627bee19a","modified":1504451374605},{"_id":"themes/next/layout/_third-party/search/tinysou.swig","hash":"fe95dd3d166634c466e19aa756e65ad6e8254d3e","modified":1504451374636},{"_id":"themes/next/layout/_third-party/search/localsearch.swig","hash":"93479642fd076a1257fecc25fcf5d20ccdefe509","modified":1504451374636},{"_id":"themes/next/source/css/_custom/custom.styl","hash":"3403fdd8efde1a0afd11ae8a5a97673f5903087f","modified":1504451374723},{"_id":"themes/next/source/css/_mixins/Gemini.styl","hash":"07f7da320689f828f6e36a6123807964a45157a0","modified":1504451374724},{"_id":"themes/next/source/css/_mixins/Pisces.styl","hash":"7896c3ee107e1a8b9108b6019f1c070600a1e8cc","modified":1504451374726},{"_id":"themes/next/source/css/_mixins/base.styl","hash":"0e55cbd93852dc3f8ccb44df74d35d9918f847e0","modified":1504451374726},{"_id":"themes/next/source/css/_variables/Gemini.styl","hash":"38a9f43973704afe7e8ca50f35a25940ea96e3cf","modified":1504451374744},{"_id":"themes/next/source/css/_variables/base.styl","hash":"a627633d3bb70b8501572b18037def478beb7017","modified":1504451374747},{"_id":"themes/next/source/lib/algolia-instant-search/instantsearch.min.css","hash":"90ef19edc982645b118b095615838d9c5eaba0de","modified":1504451374778},{"_id":"themes/next/source/css/_variables/Pisces.styl","hash":"89f88b9c9a191dd980f799fc36b83b63290d3ac9","modified":1504451374746},{"_id":"themes/next/source/js/src/affix.js","hash":"1b509c3b5b290a6f4607f0f06461a0c33acb69b1","modified":1504451374759},{"_id":"themes/next/source/js/src/algolia-search.js","hash":"cb431b54ba9c692165a1f5a12e4c564a560f8058","modified":1504451374760},{"_id":"themes/next/source/css/_variables/Mist.styl","hash":"e55265c8a8a6ae0c3c08e3509de92ee62c3cb5f6","modified":1504451374744},{"_id":"themes/next/source/js/src/exturl.js","hash":"a2a0f0de07e46211f74942a468f42ee270aa555c","modified":1504451374761},{"_id":"themes/next/source/js/src/bootstrap.js","hash":"0289031200c3d4c2bdd801ee10fff13bb2c353e4","modified":1504451374761},{"_id":"themes/next/source/js/src/js.cookie.js","hash":"1512c751d219577d338ac0780fb2bbd9075d5298","modified":1504451374763},{"_id":"themes/next/source/js/src/hook-duoshuo.js","hash":"b35a7dc47b634197b93487cea8671a40a9fdffce","modified":1504451374762},{"_id":"themes/next/source/js/src/motion.js","hash":"6d34f2a6ea6d73f7715d00f8b175854cd02baa36","modified":1504451374764},{"_id":"themes/next/source/js/src/post-details.js","hash":"50fa390554f0fb467d8eb84ac8eff2cffb13fe67","modified":1504451374764},{"_id":"themes/next/source/js/src/scrollspy.js","hash":"b7657be25fc52ec67c75ab5481bdcb483573338b","modified":1504451374766},{"_id":"themes/next/source/js/src/scroll-cookie.js","hash":"02cf91514e41200bc9df5d8bdbeb58575ec06074","modified":1504451374766},{"_id":"themes/next/source/lib/canvas-nest/canvas-nest.min.js","hash":"0387e75e23b1db108a755073fe52a0d03eb391a7","modified":1504451374783},{"_id":"themes/next/source/js/src/utils.js","hash":"f90c7611dc665b5e321cb81c0bd689445bab438a","modified":1504451374767},{"_id":"themes/next/source/lib/fancybox/.bower.json","hash":"9be892a4e14e0da18ff9cb962c9ef71f163b1b22","modified":1504451374785},{"_id":"themes/next/source/lib/fancybox/.gitattributes","hash":"672d3b5767e0eacd83bb41b188c913f2cf754793","modified":1504451374786},{"_id":"themes/next/source/lib/font-awesome/.gitignore","hash":"03ddbf76c1dd1afb93eed0b670d2eee747472ef1","modified":1504451374811},{"_id":"themes/next/source/lib/font-awesome/.npmignore","hash":"c31ff06a740955e44edd4403902e653ccabfd4db","modified":1504451374811},{"_id":"themes/next/source/lib/font-awesome/bower.json","hash":"71e7183634dc1b9449f590f15ebd7201add22ca7","modified":1504451374813},{"_id":"themes/next/source/lib/font-awesome/HELP-US-OUT.txt","hash":"ee33b2798b1e714b904d663436c6b3521011d1fa","modified":1504451374812},{"_id":"themes/next/source/lib/jquery/.bower.json","hash":"865d6c1328ab209a4376b9d2b7a7824369565f28","modified":1504451374833},{"_id":"themes/next/source/lib/fastclick/.bower.json","hash":"bf3eef9d647cd7c9b62feda3bc708c6cdd7c0877","modified":1504451374805},{"_id":"themes/next/source/lib/canvas-ribbon/canvas-ribbon.js","hash":"82fee688910efc644d3d1c3305c6ae28ba3f38f9","modified":1504451374784},{"_id":"themes/next/source/lib/font-awesome/.bower.json","hash":"b4aefc910578d76b267e86dfffdd5121c8db9aec","modified":1504451374810},{"_id":"themes/next/source/lib/fastclick/bower.json","hash":"a9b3ee1e4db71a0e4ea6d5bed292d176dd68b261","modified":1504451374807},{"_id":"themes/next/source/lib/fastclick/LICENSE","hash":"6f474ea75c42442da7bbcf2e9143ce98258efd8d","modified":1504451374806},{"_id":"themes/next/source/lib/fastclick/README.md","hash":"68a9b9d53126405b0fa5f3324f1fb96dbcc547aa","modified":1504451374807},{"_id":"themes/next/source/lib/velocity/bower.json","hash":"92d92860418c4216aa59eb4cb4a556290a7ad9c3","modified":1504451374884},{"_id":"themes/next/source/lib/velocity/.bower.json","hash":"63da5e80ebb61bb66a2794d5936315ca44231f0c","modified":1504451374872},{"_id":"themes/next/source/lib/velocity/velocity.min.js","hash":"bf172816a9c57f9040e3d19c24e181a142daf92b","modified":1504451374888},{"_id":"themes/next/source/lib/velocity/velocity.ui.js","hash":"dbbfb50f6502f6b81dcc9fee7b31f1e812da3464","modified":1504451374889},{"_id":"themes/next/source/lib/jquery_lazyload/bower.json","hash":"e0acf1db27b0cc16128a59c46db1db406b5c4c58","modified":1504451374838},{"_id":"themes/next/source/lib/velocity/velocity.ui.min.js","hash":"dde584994ac13dc601836e86f4cf490e418d9723","modified":1504451374890},{"_id":"themes/next/source/lib/jquery_lazyload/CONTRIBUTING.md","hash":"4ded6fee668544778e97e38c2b211fc56c848e77","modified":1504451374836},{"_id":"themes/next/source/lib/jquery_lazyload/.bower.json","hash":"90fa628f156d8045357ff11eaf32e61abacf10e8","modified":1504451374836},{"_id":"themes/next/source/lib/jquery_lazyload/README.md","hash":"b930297cb98b8e1dbd5abe9bc1ed9d5935d18ce8","modified":1504451374837},{"_id":"themes/next/source/lib/jquery_lazyload/jquery.scrollstop.js","hash":"bf773ad48a0b9aa77681a89d7569eefc0f7b7b18","modified":1504451374839},{"_id":"themes/next/source/lib/jquery_lazyload/jquery.lazyload.js","hash":"f4a570908f6c89c6edfb1c74959e733eaadea4f2","modified":1504451374838},{"_id":"themes/next/source/lib/pace/pace-theme-barber-shop.min.css","hash":"ee0d51446cb4ffe1bb96bd7bc8c8e046dddfcf46","modified":1504451374840},{"_id":"themes/next/source/lib/pace/pace-theme-big-counter.min.css","hash":"5b561dc328af4c4d512e20a76fe964d113a32ba8","modified":1504451374841},{"_id":"themes/next/source/lib/pace/pace-theme-bounce.min.css","hash":"f6bdb9a785b7979dd8ec5c60e278af955ef1e585","modified":1504451374841},{"_id":"themes/next/source/lib/pace/pace-theme-center-atom.min.css","hash":"dcf79c24fe5350fb73d8038573a104e73639e9d3","modified":1504451374842},{"_id":"themes/next/source/lib/pace/pace-theme-center-radar.min.css","hash":"ab7cba998bf4c03b13df342bf43647fa4f419783","modified":1504451374843},{"_id":"themes/next/source/lib/pace/pace-theme-center-circle.min.css","hash":"a4066769c78affbfbc5e30a600e2c7862cd532e0","modified":1504451374843},{"_id":"themes/next/source/lib/pace/pace-theme-center-simple.min.css","hash":"67f44c947548bd4d77e7590d3f59e236cbf9e98a","modified":1504451374844},{"_id":"themes/next/source/lib/pace/pace-theme-fill-left.min.css","hash":"0bec1e235a4a2cccda3f993b205424e1441a44ae","modified":1504451374845},{"_id":"themes/next/source/lib/pace/pace-theme-corner-indicator.min.css","hash":"b3c64c973f31884e3d8145989476707333406b9a","modified":1504451374844},{"_id":"themes/next/source/lib/pace/pace-theme-minimal.min.css","hash":"9cd783cceb8a191f3c8b5d81f7a430ecc3e489d3","modified":1504451374847},{"_id":"themes/next/source/lib/pace/pace-theme-flash.min.css","hash":"13ace22c40312d7bbd8d9c1e50eff897a7a497d8","modified":1504451374846},{"_id":"themes/next/source/lib/pace/pace-theme-loading-bar.min.css","hash":"7ee28875dfc1230d76c537f6605766e8d4011e9f","modified":1504451374846},{"_id":"themes/next/source/lib/pace/pace-theme-mac-osx.min.css","hash":"9f2e7b51b084da407863826b25265b31150b3821","modified":1504451374847},{"_id":"themes/next/source/lib/pace/pace.min.js","hash":"8aaa675f577d5501f5f22d5ccb07c2b76310b690","modified":1504451374848},{"_id":"themes/next/source/lib/three/canvas_lines.min.js","hash":"2d9a9f38c493fdf7c0b833bb9184b6a1645c11b2","modified":1504451374862},{"_id":"themes/next/source/lib/three/canvas_sphere.min.js","hash":"46a50b91c98b639c9a2b9265c5a1e66a5c656881","modified":1504451374863},{"_id":"themes/next/source/lib/three/three-waves.min.js","hash":"8148492dd49aa876d32bb7d5b728d3f5bf6f5074","modified":1504451374863},{"_id":"themes/next/source/lib/jquery/index.js","hash":"17a740d68a1c330876c198b6a4d9319f379f3af2","modified":1504451374835},{"_id":"themes/next/layout/_third-party/search/algolia-search/dom.swig","hash":"2530de0f3125a912756f6c0e9090cd012134a4c5","modified":1504451374634},{"_id":"themes/next/layout/_third-party/search/algolia-search/assets.swig","hash":"218cc936ba3518a3591b2c9eda46bc701edf7710","modified":1504451374634},{"_id":"themes/next/source/css/_common/components/comments.styl","hash":"ff4489cd582f518bba6909a301ac1292a38b4e96","modified":1504451374656},{"_id":"themes/next/source/css/_common/components/back-to-top-sidebar.styl","hash":"b0e2a0e27a32f72cb283fe4b33d010d485113379","modified":1504451374655},{"_id":"themes/next/source/css/_common/components/components.styl","hash":"7ad4081466b397e2a6204141bb7768b7c01bd93c","modified":1504451374657},{"_id":"themes/next/source/css/_common/components/back-to-top.styl","hash":"237d185ac62ec9877e300947fa0109c44fb8db19","modified":1504451374655},{"_id":"themes/next/source/css/_common/components/buttons.styl","hash":"22828f5141c0cecb9ef25a110e194cdfa3a36423","modified":1504451374656},{"_id":"themes/next/source/css/_common/components/pagination.styl","hash":"88559b13ce94311405b170a0506ded91273beceb","modified":1504451374668},{"_id":"themes/next/source/css/_common/components/tag-cloud.styl","hash":"6eb4bcc3056bd279d000607e8b4dad50d368ca69","modified":1504451374687},{"_id":"themes/next/source/css/_common/scaffolding/base.styl","hash":"24ee4b356ff55fc6e58f26a929fa07750002cf29","modified":1504451374719},{"_id":"themes/next/source/css/_common/scaffolding/helpers.styl","hash":"1da5c800d025345f212a3bf1be035060f4e5e6ed","modified":1504451374719},{"_id":"themes/next/source/css/_common/scaffolding/mobile.styl","hash":"9a45ed506274f655b11995c408cc566b16dada79","modified":1504451374720},{"_id":"themes/next/source/css/_common/scaffolding/scaffolding.styl","hash":"a17e2b871a335f290afb392a08f94fd35f59c715","modified":1504451374721},{"_id":"themes/next/source/css/_common/scaffolding/normalize.styl","hash":"3f40e8a9fe8e7bd5cfc4cf4cbbbcb9539462e973","modified":1504451374721},{"_id":"themes/next/source/css/_common/scaffolding/tables.styl","hash":"ea9069645696f86c5df64208490876fe150c8cae","modified":1504451374722},{"_id":"themes/next/source/css/_common/outline/outline.styl","hash":"c9b6e70e67a0b2c41a03181302379afdc26da5b6","modified":1504451374718},{"_id":"themes/next/source/css/_schemes/Gemini/index.styl","hash":"a509016ac0227a1903d7f0ca3a825cf9ac7fde33","modified":1504451374728},{"_id":"themes/next/source/lib/Han/dist/han.css","hash":"6c26cdb36687d4f0a11dabf5290a909c3506be5c","modified":1512486077937},{"_id":"themes/next/source/css/_schemes/Mist/_base.styl","hash":"25d5e45a355ee2093f3b8b8eeac125ebf3905026","modified":1504451374729},{"_id":"themes/next/source/css/_schemes/Mist/_logo.styl","hash":"b1025c421406d2c24cc92a02ae28c1915b01e240","modified":1504451374730},{"_id":"themes/next/source/lib/Han/dist/han.min.css","hash":"6d586bfcfb7ae48f1b12f76eec82d3ad31947501","modified":1504451374775},{"_id":"themes/next/source/lib/Han/dist/han.min.js","hash":"16b03db23a52623348f37c04544f2792032c1fb6","modified":1504451374776},{"_id":"themes/next/source/css/_schemes/Mist/_header.styl","hash":"d0bfd1bef988c76f7d7dd72d88af6f0908a8b0db","modified":1504451374729},{"_id":"themes/next/source/css/_schemes/Mist/_search.styl","hash":"09c965022c13b84ed8a661fee8ac2a6d550495ae","modified":1504451374732},{"_id":"themes/next/source/css/_schemes/Mist/_menu.styl","hash":"26666c1f472bf5f3fb9bc62081cca22b4de15ccb","modified":1504451374731},{"_id":"themes/next/source/css/_schemes/Muse/_layout.styl","hash":"31127dcbf4c7b4ada53ffbf1638b5fe325b7cbc0","modified":1504451374736},{"_id":"themes/next/source/css/_schemes/Muse/_logo.styl","hash":"748dbfbf9c08e719ddc775958003c64b00d39dab","modified":1504451374737},{"_id":"themes/next/source/css/_schemes/Muse/_search.styl","hash":"09c965022c13b84ed8a661fee8ac2a6d550495ae","modified":1504451374738},{"_id":"themes/next/source/css/_schemes/Muse/_menu.styl","hash":"f23ac53ab901c48859dd29eee6e386b60ff956ba","modified":1504451374737},{"_id":"themes/next/source/css/_schemes/Muse/index.styl","hash":"5dbc0d0c897e46760e5dbee416530d485c747bba","modified":1504451374738},{"_id":"themes/next/source/css/_schemes/Mist/_posts-expanded.styl","hash":"ce272226a1570f5f7c70243b751a5b0fe1671a88","modified":1504451374731},{"_id":"themes/next/source/css/_schemes/Pisces/_brand.styl","hash":"bce344d3a665b4c55230d2a91eac2ad16d6f32fd","modified":1504451374740},{"_id":"themes/next/source/css/_schemes/Mist/index.styl","hash":"9b913b73d31d21f057f97115ffab93cfa578b884","modified":1504451374732},{"_id":"themes/next/source/css/_schemes/Pisces/_posts.styl","hash":"1f6e2ce674735269599acc6d77b3ea18d31967fc","modified":1504451374742},{"_id":"themes/next/source/css/_schemes/Pisces/index.styl","hash":"86197902dfd3bededba10ba62b8f9f22e0420bde","modified":1504451374743},{"_id":"themes/next/source/css/_schemes/Pisces/_layout.styl","hash":"d4cf54b33e1bb8746a77ce2446d581d01be5329d","modified":1504451374741},{"_id":"themes/next/source/js/src/schemes/pisces.js","hash":"c4358416f0a116d7f4037542fa3b385947e80908","modified":1504451374765},{"_id":"themes/next/source/css/_schemes/Pisces/_menu.styl","hash":"4642e30010af8b2b037f5b43146b10a934941958","modified":1504451374741},{"_id":"themes/next/source/lib/fancybox/source/blank.gif","hash":"2daeaa8b5f19f0bc209d976c02bd6acb51b00b0a","modified":1504451374787},{"_id":"themes/next/source/css/_schemes/Pisces/_sidebar.styl","hash":"36026bc6e8d3a631f109d766fdd21857697650a0","modified":1504451374742},{"_id":"themes/next/source/lib/fancybox/source/fancybox_loading.gif","hash":"1a755fb2599f3a313cc6cfdb14df043f8c14a99c","modified":1504451374787},{"_id":"themes/next/source/lib/fancybox/source/fancybox_loading@2x.gif","hash":"273b123496a42ba45c3416adb027cd99745058b0","modified":1504451374788},{"_id":"themes/next/source/lib/fancybox/source/fancybox_overlay.png","hash":"b3a4ee645ba494f52840ef8412015ba0f465dbe0","modified":1504451374789},{"_id":"themes/next/source/lib/fancybox/source/fancybox_sprite.png","hash":"17df19f97628e77be09c352bf27425faea248251","modified":1504451374795},{"_id":"themes/next/source/lib/fancybox/source/fancybox_sprite@2x.png","hash":"30c58913f327e28f466a00f4c1ac8001b560aed8","modified":1504451374796},{"_id":"themes/next/source/lib/fancybox/source/jquery.fancybox.js","hash":"d71602cbca33b9ecdb7ab291b7f86a49530f3601","modified":1504451374803},{"_id":"themes/next/source/lib/fancybox/source/jquery.fancybox.css","hash":"82f33ad0842aa9c154d029e0dada2497d4eb1d57","modified":1504451374802},{"_id":"themes/next/source/lib/fancybox/source/jquery.fancybox.pack.js","hash":"ae6318aeb62ad4ce7a7e9a4cdacd93ffb004f0fb","modified":1504451374804},{"_id":"themes/next/source/lib/fastclick/lib/fastclick.js","hash":"1d6aeda0480d0e4cb6198edf7719d601d4ae2ccc","modified":1504451374809},{"_id":"themes/next/source/lib/ua-parser-js/dist/ua-parser.min.js","hash":"41ea797c68dbcff2f6fb3aba1d1043a22e7cc0f6","modified":1504451374871},{"_id":"themes/next/source/lib/fastclick/lib/fastclick.min.js","hash":"2cae0f5a6c5d6f3cb993015e6863f9483fc4de18","modified":1504451374809},{"_id":"themes/next/source/lib/ua-parser-js/dist/ua-parser.pack.js","hash":"a817b6c158cbc5bab3582713de9fe18a18a80552","modified":1504451374871},{"_id":"themes/next/source/lib/font-awesome/css/font-awesome.css","hash":"3655f1fdf1e584c4d8e8d39026093ca306a5a341","modified":1504451374814},{"_id":"themes/next/source/lib/font-awesome/css/font-awesome.css.map","hash":"1573904b82807abbb32c97a3632c6c6808eaac50","modified":1504451374815},{"_id":"themes/next/source/lib/font-awesome/css/font-awesome.min.css","hash":"88af80502c44cd52ca81ffe7dc7276b7eccb06cf","modified":1504451374815},{"_id":"themes/next/source/lib/Han/dist/han.js","hash":"4ac683b2bc8531c84d98f51b86957be0e6f830f3","modified":1504451374774},{"_id":"themes/next/source/lib/velocity/velocity.js","hash":"4237c6e9d59da349639de20e559e87c2c0218cfd","modified":1504451374887},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.woff2","hash":"d6f48cba7d076fb6f2fd6ba993a75b9dc1ecbf0c","modified":1504451374832},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.woff","hash":"28b782240b3e76db824e12c02754a9731a167527","modified":1504451374831},{"_id":"themes/next/source/css/_common/components/footer/footer.styl","hash":"9f73c4696f0907aa451a855444f88fc0698fa472","modified":1504451374658},{"_id":"themes/next/source/css/_common/components/header/header.styl","hash":"53cde051e0337f4bf42fb8d6d7a79fa3fa6d4ef2","modified":1510239677710},{"_id":"themes/next/source/css/_common/components/header/headerband.styl","hash":"d63e0cacc53dd375fcc113465a4328c59ff5f2c1","modified":1504451374660},{"_id":"themes/next/source/css/_common/components/header/site-nav.styl","hash":"1727702eac5d326b5c81a667944a245016668231","modified":1504451374662},{"_id":"themes/next/source/css/_common/components/highlight/diff.styl","hash":"167986d0f649516671ddf7193eebba7b421cd115","modified":1504451374663},{"_id":"themes/next/source/css/_common/components/header/menu.styl","hash":"1a0d059799a298fe17c49a44298d32cebde93785","modified":1504451374661},{"_id":"themes/next/source/css/_common/components/pages/archive.styl","hash":"b6f3a06a94a6ee5470c956663164d58eda818a64","modified":1504451374665},{"_id":"themes/next/source/css/_common/components/pages/categories.styl","hash":"7fb593f90d74a99c21840679933b9ef6fdc16a61","modified":1504451374666},{"_id":"themes/next/source/css/_common/components/header/site-meta.styl","hash":"0656e753f182c9f47fef7304c847b7587a85ef0d","modified":1504451374661},{"_id":"themes/next/source/css/_common/components/highlight/highlight.styl","hash":"25588183c7671c72d3d78d67ee8991050255bf50","modified":1513961524338},{"_id":"themes/next/source/css/_common/components/highlight/theme.styl","hash":"7fe4d4d656e86276c17cb4e48a560cb6a4def703","modified":1504451374664},{"_id":"themes/next/source/css/_common/components/pages/post-detail.styl","hash":"4e3838d7ac81d9ad133960f0f7ed58a44a015285","modified":1504451374667},{"_id":"themes/next/source/css/_common/components/pages/pages.styl","hash":"f9760ecf186954cee3ba4a149be334e9ba296b89","modified":1504451374666},{"_id":"themes/next/source/css/_common/components/post/post-button.styl","hash":"4783f85872bc7e218c1522a5c1c68cd27a5922db","modified":1504451374669},{"_id":"themes/next/source/css/_common/components/post/post-copyright.styl","hash":"caf263d1928496688c0e1419801eafd7e6919ce5","modified":1504451374671},{"_id":"themes/next/source/css/_common/components/pages/schedule.styl","hash":"8cf318644acc8b4978537c263290363e21c7f5af","modified":1504451374668},{"_id":"themes/next/source/css/_common/components/post/post-eof.styl","hash":"a200c0a1c5a895ac9dc41e0641a5dfcd766be99b","modified":1504451374672},{"_id":"themes/next/source/css/_common/components/post/post-collapse.styl","hash":"875cbe88d5c7f6248990e2beb97c9828920e7e24","modified":1504451374670},{"_id":"themes/next/source/css/_common/components/post/post-gallery.styl","hash":"cd9e214e502697f2f2db84eb721bac57a49b0fce","modified":1504451374673},{"_id":"themes/next/source/css/_common/components/post/post-expand.styl","hash":"58f9e6aba94733244a87d2ba5966c5a009486509","modified":1504451374672},{"_id":"themes/next/source/css/_common/components/post/post-meta.styl","hash":"d0d7a5c90d62b685520d2b47fea8ba6019ff5402","modified":1504451374673},{"_id":"themes/next/source/css/_common/components/post/post-rtl.styl","hash":"b2495ae5e04dcca610aacadc47881d9e716cd440","modified":1504451374676},{"_id":"themes/next/source/css/_common/components/post/post-nav.styl","hash":"27deb3d3a243d30022055dac7dad851024099a8b","modified":1504451374675},{"_id":"themes/next/source/css/_common/components/post/post-reward.styl","hash":"f363a544aa800a2a5ed97c40887fe9743f67b03b","modified":1504451374675},{"_id":"themes/next/source/css/_common/components/post/post-tags.styl","hash":"5a982d8ef3b3623ea5f59e63728990f5623c1b57","modified":1504451374676},{"_id":"themes/next/source/css/_common/components/post/post-type.styl","hash":"01567edaea6978628aa5521a122a85434c418bfd","modified":1504451374678},{"_id":"themes/next/source/css/_common/components/post/post-widgets.styl","hash":"2cb09973d29a8e34e2a3425ac6e0938296970d8e","modified":1504451374679},{"_id":"themes/next/source/css/_common/components/post/post-title.styl","hash":"350469437b20ecfd6f3ca45e400478f8e3f71cfb","modified":1504451374678},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-blogroll.styl","hash":"8dd9a1c6f4f6baa00c2cf01837e7617120cf9660","modified":1504451374682},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-dimmer.styl","hash":"11c22f0fb3f6beb13e5a425ec064a4ff974c13b7","modified":1504451374682},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-feed-link.styl","hash":"61f8cea3c01acd600e90e1bc2a07def405503748","modified":1504451374682},{"_id":"themes/next/source/css/_common/components/post/post.styl","hash":"ce884e7051764d01a74050ce6b2da52952ca1881","modified":1504451374679},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-author.styl","hash":"761eba9811b050b25d548cc0854de4824b41eb08","modified":1504451374681},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-author-links.styl","hash":"5f3510419161ec22ca88cce6a181ddad61de9e86","modified":1504451374680},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-nav.styl","hash":"1153bb71edf253765145559674390e16dd67c633","modified":1504451374683},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-toc.styl","hash":"28a8737c090fbffd188d73a00b42e90b9ee57df2","modified":1504451374684},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-toggle.styl","hash":"a1521d48bb06d8d703753f52a198baa197af7da2","modified":1504451374685},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar.styl","hash":"8e00d9a0bdf35ffc0a7fa387fa294b953c2d28fc","modified":1504451374686},{"_id":"themes/next/source/css/_common/components/tags/exturl.styl","hash":"a3bdd71237afc112b2aa255f278cab6baeb25351","modified":1504451374689},{"_id":"themes/next/source/css/_common/components/tags/full-image.styl","hash":"3159b55f35c40bd08e55b00148c523760a708c51","modified":1504451374692},{"_id":"themes/next/source/css/_common/components/sidebar/site-state.styl","hash":"e71652d3216e289c8548b1ea2357822c1476a425","modified":1504451374686},{"_id":"themes/next/source/css/_common/components/tags/label.styl","hash":"2ab1322fe52ab5aafd49e68f5bd890e8380ee927","modified":1504451374708},{"_id":"themes/next/source/css/_common/components/tags/blockquote-center.styl","hash":"2fe76476432b31993338cb45cdb3b29a518b6379","modified":1504451374688},{"_id":"themes/next/source/css/_common/components/tags/group-pictures.styl","hash":"2ad1a2a9bbf6742d1b0762c4c623b68113d1e0fe","modified":1504451374707},{"_id":"themes/next/source/css/_common/components/tags/tags.styl","hash":"b80604868e4f5cf20fccafd7ee415c20c804f700","modified":1504451374711},{"_id":"themes/next/source/css/_common/components/tags/note.styl","hash":"9a409b798decdefdaf7a23f0b11004a8c27e82f3","modified":1504451374709},{"_id":"themes/next/source/css/_common/components/tags/tabs.styl","hash":"154a87a32d2fead480d5e909c37f6c476671c5e6","modified":1504451374710},{"_id":"themes/next/source/css/_common/components/tags/note-modern.styl","hash":"962b654f8f7cbd18a298126a403d236ed4540516","modified":1504451374709},{"_id":"themes/next/source/css/_common/components/third-party/baidushare.styl","hash":"5dbeed535d63a50265d96b396a5440f9bb31e4ba","modified":1504451374712},{"_id":"themes/next/source/css/_common/components/third-party/algolia-search.styl","hash":"bba4f3bdb7517cd85376df3e1209b570c0548c69","modified":1504451374712},{"_id":"themes/next/source/css/_common/components/third-party/busuanzi-counter.styl","hash":"a6e7d698702c2e383dde3fde2abde27951679084","modified":1504451374713},{"_id":"themes/next/source/css/_common/components/third-party/han.styl","hash":"10599e16414a8b7a76c4e79e6617b5fe3d4d1adf","modified":1504451374714},{"_id":"themes/next/source/css/_common/components/third-party/jiathis.styl","hash":"15975ba7456b96916b1dbac448a1a0d2c38b8f3d","modified":1504451374716},{"_id":"themes/next/source/css/_common/components/third-party/third-party.styl","hash":"37e406ec42b7a53c72395bdbaa434270019e7179","modified":1504451374717},{"_id":"themes/next/source/css/_common/components/third-party/duoshuo.styl","hash":"717cc7f82be9cc151e23a7678601ff2fd3a7fa1d","modified":1504451374714},{"_id":"themes/next/source/css/_common/components/third-party/localsearch.styl","hash":"16087276945fa038f199692e3eabb1c52b8ea633","modified":1504451374716},{"_id":"themes/next/source/lib/Han/dist/font/han-space.otf","hash":"07436f011b44051f61b8329c99de4bec64e86f4b","modified":1504451374770},{"_id":"themes/next/source/css/_schemes/Mist/outline/outline.styl","hash":"a07aa12cc36ac5c819670c2a3c17d07ed7a08986","modified":1504451374734},{"_id":"themes/next/source/lib/Han/dist/font/han-space.woff","hash":"7a635062b10bf5662ae1d218ba0980171005d060","modified":1504451374770},{"_id":"themes/next/source/css/_schemes/Mist/sidebar/sidebar-blogroll.styl","hash":"1f09be9bb38411f0629b58c3b23873589a6dbcaa","modified":1504451374734},{"_id":"themes/next/source/css/_schemes/Muse/sidebar/sidebar-blogroll.styl","hash":"1f09be9bb38411f0629b58c3b23873589a6dbcaa","modified":1504451374739},{"_id":"themes/next/source/lib/Han/dist/font/han.otf","hash":"f1f6bb8f461f5672e000380195d3d2358a28494c","modified":1504451374771},{"_id":"themes/next/source/lib/Han/dist/font/han.woff","hash":"f38ff9b2eecaa17b50b66aa2dae87e9e7436d195","modified":1504451374772},{"_id":"themes/next/source/lib/fancybox/source/helpers/jquery.fancybox-buttons.css","hash":"6394c48092085788a8c0ef72670b0652006231a1","modified":1504451374798},{"_id":"themes/next/source/lib/fancybox/source/helpers/fancybox_buttons.png","hash":"e385b139516c6813dcd64b8fc431c364ceafe5f3","modified":1504451374797},{"_id":"themes/next/source/lib/fancybox/source/helpers/jquery.fancybox-buttons.js","hash":"ee948b4489aedeb548a77c9e45d8c7c5732fd62d","modified":1504451374799},{"_id":"themes/next/source/lib/fancybox/source/helpers/jquery.fancybox-thumbs.css","hash":"b88b589f5f1aa1b3d87cc7eef34c281ff749b1ae","modified":1504451374800},{"_id":"themes/next/source/lib/font-awesome/fonts/FontAwesome.otf","hash":"048707bc52ac4b6563aaa383bfe8660a0ddc908c","modified":1504451374819},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.eot","hash":"d980c2ce873dc43af460d4d572d441304499f400","modified":1504451374822},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.ttf","hash":"13b1eab65a983c7a73bc7997c479d66943f7c6cb","modified":1504451374830},{"_id":"themes/next/source/lib/fancybox/source/helpers/jquery.fancybox-media.js","hash":"51139a4c79573d372a347ef01a493222a1eaf10a","modified":1504451374800},{"_id":"themes/next/source/lib/fancybox/source/helpers/jquery.fancybox-thumbs.js","hash":"d22b1629cb23a6181bebb70d0cf653ffe4b835c8","modified":1504451374801},{"_id":"themes/next/source/lib/algolia-instant-search/instantsearch.min.js","hash":"90a1b22129efc172e2dfcceeeb76bff58bc3192f","modified":1504451374782},{"_id":"themes/next/source/lib/three/three.min.js","hash":"26273b1cb4914850a89529b48091dc584f2c57b8","modified":1504451374869},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.svg","hash":"b5483b11f8ba213e733b5b8af9927a04fec996f6","modified":1504451374827},{"_id":"public/atom.xml","hash":"fadb2846a2d7753eb7ae9d4897f8c82a2d25c6b7","modified":1516778237729},{"_id":"public/content.json","hash":"a6faf8927b5b8510c435edabe4d9bb8b53be1630","modified":1516778108710},{"_id":"public/search.xml","hash":"6a29d7a232dce42acb0a2d9383fe56a0179f5e92","modified":1516778237770},{"_id":"public/sitemap.xml","hash":"110c24abaaa6b0ac600e793dd9eb8f09341251b1","modified":1516778237771},{"_id":"public/about/index.html","hash":"478c8fe21b285e1b1fb23518e2097335d4d58c67","modified":1516778109243},{"_id":"public/tags/index.html","hash":"7e4ee792c1832663edd012c9b98b273eaf349814","modified":1516778109247},{"_id":"public/categories/index.html","hash":"699dd993e912f4604c839def807cd011933b94bd","modified":1516778237842},{"_id":"public/2018/01/21/微服务/微服务框架与实战-笔记03-开始使用SpringCloud实战微服务/index.html","hash":"1f394a7aef6adfeed80f402562bccd70aa9ab1b8","modified":1516778109247},{"_id":"public/2018/01/21/微服务/微服务框架与实战-总体概览/index.html","hash":"6f895d1666fad481802302c98c2466a9f93bfb1b","modified":1516778109247},{"_id":"public/2018/01/09/微服务/微服务框架与实战-笔记02-微服务开发框架-SpringCloud/index.html","hash":"53780dcdd5a71ea81da3433b2577b4bbe88a97fc","modified":1516778109248},{"_id":"public/2018/01/07/杂记/使用多个git账户/index.html","hash":"90cbb660451c0d6e371658a15172715dff9256e5","modified":1516778109248},{"_id":"public/2018/01/05/微服务/微服务框架与实战-笔记01-概述/index.html","hash":"8c9b3249cc5576744cfbe1de18fba301700a9d1f","modified":1516778109248},{"_id":"public/2018/01/03/杂记/aws-vpn/index.html","hash":"62f0f8f9c832dd8a52b15744a79d3d7211249349","modified":1516778109248},{"_id":"public/2018/01/01/大数据/大数据0501-轻量级RPC框架开发/index.html","hash":"23cb4043666714153a9283b721bbcd5a076ec0db","modified":1516778109248},{"_id":"public/2017/12/22/其他/北京冬天哪里好玩/index.html","hash":"368aab1124d8259c04d4a10b4494bcf1d04bf8d7","modified":1516778109248},{"_id":"public/2017/12/22/其他/记录有北京游玩的链接/index.html","hash":"cba26a09f71b671451c9c8f43afa531f43af167e","modified":1516778109249},{"_id":"public/2017/12/05/大数据/大数据0406-javaJVM技术/index.html","hash":"f605b435627b77313bae85806751b4fa43c6ce55","modified":1516778109249},{"_id":"public/2017/12/03/大数据/大数据0405-java-socket/index.html","hash":"8760080308a75a4b7f0b42909dfe84699cb70ae8","modified":1516778109249},{"_id":"public/2017/12/03/大数据/大数据0404-java动态代理/index.html","hash":"fd4d57a089023856ea5592e8870246d0dd321bd9","modified":1516778109249},{"_id":"public/2017/12/03/大数据/大数据0403-java反射/index.html","hash":"b3874f2686652affb0d5ab9088fd9c02c6d6058e","modified":1516778109249},{"_id":"public/2017/12/03/大数据/大数据0402-JMS activeMQ/index.html","hash":"1dc527c83ef53222fa92529573c0b6f71fcb8233","modified":1516778109249},{"_id":"public/2017/12/01/大数据/大数据0401-java多线程并发/index.html","hash":"66942aa5b745b3c39a12f859bb5ac3a84e750235","modified":1516778109249},{"_id":"public/2017/11/26/大数据/大数据03-06-系统服务器上下线感知程序/index.html","hash":"d1565ade4d3a24978c7ef45429a900e83942d4a8","modified":1516778109249},{"_id":"public/2017/11/26/大数据/大数据03-05-java-api/index.html","hash":"2131fd7ca9097f9fa85c395927c42a1c42a726ce","modified":1516778109249},{"_id":"public/2017/11/21/大数据/大数据03-04-zookeeper集群自动启动脚本及export变量作用域的解析/index.html","hash":"1bb65cd18aff123a90fed80eb99e12a77da38311","modified":1516778109250},{"_id":"public/2017/11/19/大数据/大数据03-03-zookeeper-命令行客户端及znode数据结构类型监听等功能/index.html","hash":"017b39bd209a72a49c01c314969769d1aaf3f56d","modified":1516778109250},{"_id":"public/2017/11/19/大数据/大数据03-02-zookeeper-简介/index.html","hash":"1f8438023572b1456f802a99e5bef26f22cec848","modified":1516778109250},{"_id":"public/2017/11/14/杂记/hexo-next-本地搜索/index.html","hash":"498c2b5520cee419d4757f3913e1e6ebf2d18df0","modified":1516778109250},{"_id":"public/2017/11/14/大数据/大数据03-01-自动化部署脚本/index.html","hash":"214e956369922efb6e55215acb0a940853aa6344","modified":1516778109250},{"_id":"public/2017/11/14/大数据/大数据02-01-1-linux本地yum库/index.html","hash":"d5aa4faf539e3734ae65499669d8600772f2fdec","modified":1516778109250},{"_id":"public/2017/11/06/大数据/大数据02-05-shell编程-awk命令/index.html","hash":"92bc5bc5cbdebac83198e2cce344ac557661d5dc","modified":1516778109250},{"_id":"public/2017/11/06/大数据/大数据02-04-shell编程-sed命令/index.html","hash":"088ceaedf4830466bf0ff7ba81130d6c4b0ea4da","modified":1516778109250},{"_id":"public/2017/11/06/大数据/大数据02-03 shell编程语法讲解/index.html","hash":"489541c79ab4d9a5844cbb308af3bc2d92d35a5d","modified":1516778109250},{"_id":"public/2017/11/05/杂记/linux笔记-修改语言/index.html","hash":"e236a4d5dad93803bbd54a7f282f1e4fd5ce410d","modified":1516778109250},{"_id":"public/2017/11/04/杂记/vagrant 创建virtualBox虚拟机/index.html","hash":"6b47fbbafccd9ef70aacd0fe0de3c251e520240e","modified":1516778109251},{"_id":"public/2017/11/04/杂记/centos7-安装mysql-转/index.html","hash":"27d9559dbfcc0dbd8c1ffc3613fe9453573f5a3c","modified":1516778109251},{"_id":"public/2017/11/04/杂记/centos7-开放端口/index.html","hash":"43b85bfc3ca578cf8e9f9978624e23787ec92f80","modified":1516778109251},{"_id":"public/2017/11/01/大数据/大数据02-02-linux命令继续学习-yum/index.html","hash":"2ca1d9f0f85ead65aec2ef3edbfdb1b6eff57798","modified":1516778109251},{"_id":"public/2017/10/30/杂记/hexo-next-搜索-algolia/index.html","hash":"2904ddb27cfbe8c1228106c2608e6c25b4ce016d","modified":1516778109251},{"_id":"public/2017/10/30/大数据/大数据01-linux安装及基本命令/index.html","hash":"b261deb90e5a853f877c07975b73398627bddb49","modified":1516778109251},{"_id":"public/2017/10/29/大数据/大数据02-01 linux命令继续学习/index.html","hash":"323020491d5cf3974e15c02cd33f7ec12dcae604","modified":1516778109252},{"_id":"public/2017/09/11/杂记/vscode快捷键记录/index.html","hash":"6a2de66d77f8efa0d109ac7730e932fa487d2ad6","modified":1516778109252},{"_id":"public/2017/09/03/杂记/idea快捷键记录/index.html","hash":"8115662ec2368907faab220d6e1931960fe28e35","modified":1516778109252},{"_id":"public/2017/09/03/杂记/记录下hexo常用命令自己方便看/index.html","hash":"9f1dd5750499f1a2989a8edc70b63e944d1c6bbe","modified":1516778109252},{"_id":"public/2017/08/27/终于有了自己的博客/index.html","hash":"e9b8a30382f78e4d10d7e7fa8c2c1147728bded3","modified":1516778109252},{"_id":"public/archives/index.html","hash":"9627ecf73879d747a8cc7ded2e0d1bc320a839c1","modified":1516778109252},{"_id":"public/archives/page/2/index.html","hash":"a7fdbc0ce91769ea0e7644a497561c68605f30ba","modified":1516778109252},{"_id":"public/archives/page/3/index.html","hash":"2d00185893a169986940994b28b21c647fbd531e","modified":1516778109252},{"_id":"public/archives/page/4/index.html","hash":"6cfd6f3278d2a816363311d1b362f12ceb3b0460","modified":1516778109252},{"_id":"public/archives/2017/index.html","hash":"5788cd910c20eb49a6e2daabf6e2286ad4bb43bb","modified":1516778109253},{"_id":"public/archives/2017/page/2/index.html","hash":"b81c60bb8c4bca0678473ab2f096078428868330","modified":1516778109253},{"_id":"public/archives/2017/page/3/index.html","hash":"4a5db6e87c2b7423ed68f99ac7163eb2e715a810","modified":1516778109253},{"_id":"public/archives/2017/page/4/index.html","hash":"7a9e465d0a508553aa5f079876aeaefd15819f02","modified":1516778109253},{"_id":"public/archives/2017/08/index.html","hash":"d14ff17131c3003633b44422682b2e55e08f120a","modified":1516778109253},{"_id":"public/archives/2017/09/index.html","hash":"1b47efb495df5519b2dcb81da4d190cae0e66e15","modified":1516778109254},{"_id":"public/archives/2017/10/index.html","hash":"c512ba50ba534bff575bf962f69142da9b7aa119","modified":1516778109254},{"_id":"public/archives/2017/11/index.html","hash":"04f44880007bc0513cd9efe9afcdba85ea83729d","modified":1516778109254},{"_id":"public/archives/2017/11/page/2/index.html","hash":"6a65d20f99d915c615b11ae28c93ea90b3de9052","modified":1516778109254},{"_id":"public/archives/2017/12/index.html","hash":"cf15076e4a975152dff53adfcc99c353b95d8c35","modified":1516778109254},{"_id":"public/archives/2018/index.html","hash":"e4e99d4c006f0dad1db7afb34f8d9058651b50dd","modified":1516778109254},{"_id":"public/archives/2018/01/index.html","hash":"2d860fdbbdb6eed8540877ef8f667e92da5bd9fc","modified":1516778109254},{"_id":"public/categories/essay/index.html","hash":"b6ef511d183daf4d56c6f02da73a070f912d0525","modified":1516778109254},{"_id":"public/categories/玩/index.html","hash":"c72b46fc8ec676b6ea611003d3f629e798385813","modified":1516778109255},{"_id":"public/categories/学习/index.html","hash":"d1110c3304eaae008fa974c7396c5b8c6fc016c6","modified":1516778237843},{"_id":"public/categories/学习/page/2/index.html","hash":"8833cb87193b0cb75cecbeea487e9b0950a2ede0","modified":1516778237843},{"_id":"public/categories/学习/page/3/index.html","hash":"da5a494c0d0b1bf88862e0648d7299be6a562ec2","modified":1516778237843},{"_id":"public/categories/大数据学习笔记/index.html","hash":"60de39ef587c9af377d1c55cfbfb601be15f7e59","modified":1516778109255},{"_id":"public/categories/工具/index.html","hash":"e3d170658b5a789241679618aa0dd2f65be08a23","modified":1516778109255},{"_id":"public/index.html","hash":"4bfb2c9398ea13f4336bf5cc98f15b70957507bc","modified":1516778237843},{"_id":"public/page/2/index.html","hash":"44ad3461d97d77181ac0e55ccbf161b0e3687045","modified":1516778109255},{"_id":"public/page/3/index.html","hash":"633ba7222d42403d668b60ddca0a9550b422befa","modified":1516778109255},{"_id":"public/page/4/index.html","hash":"6ce963c9edd69f6c0baa795aff095d2fa5fc2c0f","modified":1516778109255},{"_id":"public/tags/生活/index.html","hash":"c20aff046e01e271fecd65d188f2a23ffec0a0e3","modified":1516778109256},{"_id":"public/tags/北京/index.html","hash":"15dd823853aedf1ff42fd78e6301a2aa3fa546b5","modified":1516778109256},{"_id":"public/tags/游玩/index.html","hash":"f2e4cf76dd7f1aa30121c7225bf035ed6493873d","modified":1516778109256},{"_id":"public/tags/大数据/index.html","hash":"0ec3fcab03964cfe97d1efcb7cacf844cd43dc3b","modified":1516778109256},{"_id":"public/tags/大数据/page/2/index.html","hash":"e3f3c3e2fe1808c89364cead3f64e4e5ef6192a7","modified":1516778109256},{"_id":"public/tags/大数据/page/3/index.html","hash":"560cd7a51701fdc0ce3b83f999b1067d0a16086c","modified":1516778109256},{"_id":"public/tags/linux/index.html","hash":"c79270f828ae3865c9d3fa46cca1e0339ae8080d","modified":1516778109256},{"_id":"public/tags/linux/page/2/index.html","hash":"1a59d4eb8437c45f28a1840b38009e66ae11305b","modified":1516778109256},{"_id":"public/tags/centos7/index.html","hash":"66d80c7d7d443754f4a0d36ff11819cd2b8c5ed7","modified":1516778109256},{"_id":"public/tags/linux命令/index.html","hash":"88c67c8be38942241ce0ebad8254fd2c4ffa39a5","modified":1516778109256},{"_id":"public/tags/zookeeper/index.html","hash":"7b1645d28f037764ca115bab02ecea21ab6e0a49","modified":1516778109256},{"_id":"public/tags/java/index.html","hash":"e70f85acf12b089f05e53d5d0b55372038f50fab","modified":1516778109257},{"_id":"public/tags/JMS/index.html","hash":"fbbc101d136bd8e544f05e7a4ce46f466746800b","modified":1516778109257},{"_id":"public/tags/activeMQ/index.html","hash":"1c4a04e74a6ad3ecb7bca84e28383e147ccc6cef","modified":1516778109257},{"_id":"public/tags/反射/index.html","hash":"867737ccd0c3a18374cc6e39e7723de595cd4844","modified":1516778109257},{"_id":"public/tags/socket/index.html","hash":"23b1368b6ee01db004f81365d95dba3c37dc61fe","modified":1516778109257},{"_id":"public/tags/JVM/index.html","hash":"95e58085e1cf791aa5237127cac94b7ac7fed30c","modified":1516778109257},{"_id":"public/tags/微服务/index.html","hash":"62d7d840e73c4ef5a88767a7efb1178bc47aefbc","modified":1516778109257},{"_id":"public/tags/rpc/index.html","hash":"4ffcec45ccaf8ea1756326bbfc33a657a18ee585","modified":1516778109257},{"_id":"public/tags/vpn/index.html","hash":"ecf808802c496cf5e0682e960ce4ace9bbb99eee","modified":1516778109257},{"_id":"public/tags/aws/index.html","hash":"c78e7824552cae7021d03699f493d97171870a2d","modified":1516778109257},{"_id":"public/tags/动态代理/index.html","hash":"0d8e479082dd31a7882b25ebb408628a0d648b06","modified":1516778109258},{"_id":"public/tags/mysql/index.html","hash":"b9eb823c619f29cd670d04c5028d91bf1c8e803c","modified":1516778109258},{"_id":"public/tags/hexo/index.html","hash":"5f120ac645e568f88208a53c8e5c311d7a4aed63","modified":1516778109258},{"_id":"public/tags/idea/index.html","hash":"97c2a36b57418453c4aa01b97f9955712a09f80a","modified":1516778109258},{"_id":"public/tags/快捷键/index.html","hash":"bb47c718ef8c70557a155760db63f1396e90945a","modified":1516778109258},{"_id":"public/tags/vagrant/index.html","hash":"822877989c6343bb95bc709b91a9ae66c98579a4","modified":1516778109258},{"_id":"public/2018/01/24/js心跳请求/index.html","hash":"b475c3a2c453a06776dcd420226bc503090171ec","modified":1516777451710},{"_id":"public/categories/简单记录/index.html","hash":"6c780e4f685da2a3a6c77827ee0b8c33af14949f","modified":1516778109254},{"_id":"public/tags/javascript/index.html","hash":"f2aa52783c35c654c97ad303869094467dfa0a43","modified":1516778109256},{"_id":"public/tags/vscode/index.html","hash":"71777f793c6904c451792c5d0abd9dc09b290685","modified":1516778109258},{"_id":"public/tags/git/index.html","hash":"4020fbaf99ad110d4debdc695dcf0b1699141e21","modified":1516778109258},{"_id":"public/CNAME","hash":"97d9a237954c0216b3a80750275d06038224c70c","modified":1516777451731},{"_id":"public/images/algolia_logo.svg","hash":"45eeea0b5fba833e21e38ea10ed5ab385ceb4f01","modified":1516777451731},{"_id":"public/images/avatar.gif","hash":"264082bb3a1af70d5499c7d22b0902cb454b6d12","modified":1516777451731},{"_id":"public/images/cc-by-nc-nd.svg","hash":"bc3588c9b2d7c68830524783120ff6cf957cf668","modified":1516777451731},{"_id":"public/images/cc-by-nd.svg","hash":"42cd73da328077ccc92f859bb8f3cf621b3484f8","modified":1516777451732},{"_id":"public/images/cc-by-nc-sa.svg","hash":"6f55543d1fb9cbc436c101d24f802dec7b41efc3","modified":1516777451732},{"_id":"public/images/cc-by-nc.svg","hash":"6f076713fb9bf934aa2c1046bdf2cf2e37bc1eab","modified":1516777451732},{"_id":"public/images/placeholder.gif","hash":"5fbd472222feb8a22cf5b8aa5dc5b8e13af88e2b","modified":1516777451732},{"_id":"public/images/cc-by-sa.svg","hash":"70c1535f43e54e5ff35ca81419e77e4c0c301398","modified":1516777451732},{"_id":"public/images/loading.gif","hash":"5fbd472222feb8a22cf5b8aa5dc5b8e13af88e2b","modified":1516777451732},{"_id":"public/images/cc-by.svg","hash":"e92a33c32d1dac8ed94849b2b4e6456e887efe70","modified":1516777451732},{"_id":"public/images/quote-l.svg","hash":"cd108d6f44351cadf8e6742565217f88818a0458","modified":1516777451732},{"_id":"public/images/cc-zero.svg","hash":"9bfb52b2f63527a7049247bf00d44e6dc1170e7d","modified":1516777451732},{"_id":"public/images/quote-r.svg","hash":"2a2a250b32a87c69dcc1b1976c74b747bedbfb41","modified":1516777451732},{"_id":"public/images/searchicon.png","hash":"67727a6a969be0b2659b908518fa6706eed307b8","modified":1516777451732},{"_id":"public/lib/font-awesome/HELP-US-OUT.txt","hash":"ee33b2798b1e714b904d663436c6b3521011d1fa","modified":1516777451732},{"_id":"public/lib/fastclick/LICENSE","hash":"6f474ea75c42442da7bbcf2e9143ce98258efd8d","modified":1516777451732},{"_id":"public/lib/fancybox/source/blank.gif","hash":"2daeaa8b5f19f0bc209d976c02bd6acb51b00b0a","modified":1516777451733},{"_id":"public/lib/fancybox/source/fancybox_loading.gif","hash":"1a755fb2599f3a313cc6cfdb14df043f8c14a99c","modified":1516777451733},{"_id":"public/lib/fancybox/source/fancybox_overlay.png","hash":"b3a4ee645ba494f52840ef8412015ba0f465dbe0","modified":1516777451733},{"_id":"public/lib/fancybox/source/fancybox_loading@2x.gif","hash":"273b123496a42ba45c3416adb027cd99745058b0","modified":1516777451733},{"_id":"public/lib/fancybox/source/fancybox_sprite.png","hash":"17df19f97628e77be09c352bf27425faea248251","modified":1516777451733},{"_id":"public/lib/fancybox/source/fancybox_sprite@2x.png","hash":"30c58913f327e28f466a00f4c1ac8001b560aed8","modified":1516777451733},{"_id":"public/lib/font-awesome/css/font-awesome.css.map","hash":"1573904b82807abbb32c97a3632c6c6808eaac50","modified":1516777451733},{"_id":"public/lib/Han/dist/font/han-space.otf","hash":"07436f011b44051f61b8329c99de4bec64e86f4b","modified":1516777451733},{"_id":"public/lib/Han/dist/font/han-space.woff","hash":"7a635062b10bf5662ae1d218ba0980171005d060","modified":1516777451734},{"_id":"public/lib/Han/dist/font/han.otf","hash":"f1f6bb8f461f5672e000380195d3d2358a28494c","modified":1516777451734},{"_id":"public/lib/Han/dist/font/han.woff","hash":"f38ff9b2eecaa17b50b66aa2dae87e9e7436d195","modified":1516777451734},{"_id":"public/lib/fancybox/source/helpers/fancybox_buttons.png","hash":"e385b139516c6813dcd64b8fc431c364ceafe5f3","modified":1516777451734},{"_id":"public/assets/algolia/algoliasearchLite.min.js","hash":"2290f8391558fcdf90bcc3d31796a278972024d3","modified":1516777451734},{"_id":"public/assets/algolia/algoliasearch.min.js","hash":"46ec23955d31954e4e94793ffb5119c1b91dc6e7","modified":1516777451734},{"_id":"public/lib/font-awesome/fonts/fontawesome-webfont.woff","hash":"28b782240b3e76db824e12c02754a9731a167527","modified":1516777453013},{"_id":"public/lib/font-awesome/fonts/fontawesome-webfont.woff2","hash":"d6f48cba7d076fb6f2fd6ba993a75b9dc1ecbf0c","modified":1516777453025},{"_id":"public/assets/algolia/algoliasearchLite.js","hash":"6b7e65178f13563788627999e75c86038bc88091","modified":1516777453030},{"_id":"public/js/src/affix.js","hash":"978e0422b5bf1b560236d8d10ebc1adcf66392e3","modified":1516777453049},{"_id":"public/lib/algolia-instant-search/instantsearch.min.css","hash":"90ef19edc982645b118b095615838d9c5eaba0de","modified":1516777453049},{"_id":"public/js/src/algolia-search.js","hash":"b172f697ed339a24b1e80261075232978d164c35","modified":1516777453049},{"_id":"public/js/src/exturl.js","hash":"e42e2aaab7bf4c19a0c8e779140e079c6aa5c0b1","modified":1516777453049},{"_id":"public/js/src/bootstrap.js","hash":"034bc8113e0966fe2096ba5b56061bbf10ef0512","modified":1516777453049},{"_id":"public/js/src/js.cookie.js","hash":"9b37973a90fd50e71ea91682265715e45ae82c75","modified":1516777453049},{"_id":"public/js/src/hook-duoshuo.js","hash":"a6119070c0119f33e08b29da7d2cce2635eb40a0","modified":1516777453049},{"_id":"public/js/src/post-details.js","hash":"0693695a9512641daff63d99da772625a058ab18","modified":1516777453049},{"_id":"public/js/src/motion.js","hash":"da146caf488078a634d961debf2a71ce4106018c","modified":1516777453049},{"_id":"public/js/src/scrollspy.js","hash":"fe4da1b9fe73518226446f5f27d2831e4426fc35","modified":1516777453050},{"_id":"public/js/src/scroll-cookie.js","hash":"09dc828cbf5f31158ff6250d2bf7c3cde6365c67","modified":1516777453050},{"_id":"public/lib/canvas-nest/canvas-nest.min.js","hash":"0387e75e23b1db108a755073fe52a0d03eb391a7","modified":1516777453050},{"_id":"public/js/src/utils.js","hash":"2917c39c75b14b6dab7e1c46ab4d87b4df9fcd5d","modified":1516777453051},{"_id":"public/lib/font-awesome/bower.json","hash":"64394a2a9aa00f8e321d8daa5e51a420f0e96dad","modified":1516777453051},{"_id":"public/lib/canvas-ribbon/canvas-ribbon.js","hash":"7fd2f3e2773555392ef40df40cae3bedb884f17a","modified":1516777453051},{"_id":"public/lib/fastclick/bower.json","hash":"4dcecf83afddba148464d5339c93f6d0aa9f42e9","modified":1516777453051},{"_id":"public/lib/fastclick/README.html","hash":"da3c74d484c73cc7df565e8abbfa4d6a5a18d4da","modified":1516777453051},{"_id":"public/lib/velocity/bower.json","hash":"0ef14e7ccdfba5db6eb3f8fc6aa3b47282c36409","modified":1516777453051},{"_id":"public/lib/jquery_lazyload/bower.json","hash":"ae3c3b61e6e7f9e1d7e3585ad854380ecc04cf53","modified":1516777453051},{"_id":"public/lib/velocity/velocity.ui.min.js","hash":"ed5e534cd680a25d8d14429af824f38a2c7d9908","modified":1516777453051},{"_id":"public/lib/jquery_lazyload/CONTRIBUTING.html","hash":"a6358170d346af13b1452ac157b60505bec7015c","modified":1516777453051},{"_id":"public/lib/jquery_lazyload/README.html","hash":"bde24335f6bc09d8801c0dcd7274f71b466552bd","modified":1516777453051},{"_id":"public/lib/jquery_lazyload/jquery.scrollstop.js","hash":"0e9a81785a011c98be5ea821a8ed7d411818cfd1","modified":1516777453051},{"_id":"public/lib/pace/pace-theme-barber-shop.min.css","hash":"ee0d51446cb4ffe1bb96bd7bc8c8e046dddfcf46","modified":1516777453051},{"_id":"public/lib/jquery_lazyload/jquery.lazyload.js","hash":"481fd478650e12b67c201a0ea41e92743f8b45a3","modified":1516777453051},{"_id":"public/lib/pace/pace-theme-big-counter.min.css","hash":"5b561dc328af4c4d512e20a76fe964d113a32ba8","modified":1516777453051},{"_id":"public/lib/pace/pace-theme-bounce.min.css","hash":"f6bdb9a785b7979dd8ec5c60e278af955ef1e585","modified":1516777453051},{"_id":"public/lib/pace/pace-theme-center-atom.min.css","hash":"dcf79c24fe5350fb73d8038573a104e73639e9d3","modified":1516777453052},{"_id":"public/lib/pace/pace-theme-center-radar.min.css","hash":"ab7cba998bf4c03b13df342bf43647fa4f419783","modified":1516777453052},{"_id":"public/lib/pace/pace-theme-center-simple.min.css","hash":"67f44c947548bd4d77e7590d3f59e236cbf9e98a","modified":1516777453052},{"_id":"public/lib/pace/pace-theme-center-circle.min.css","hash":"a4066769c78affbfbc5e30a600e2c7862cd532e0","modified":1516777453052},{"_id":"public/lib/pace/pace-theme-minimal.min.css","hash":"9cd783cceb8a191f3c8b5d81f7a430ecc3e489d3","modified":1516777453052},{"_id":"public/lib/pace/pace-theme-fill-left.min.css","hash":"0bec1e235a4a2cccda3f993b205424e1441a44ae","modified":1516777453052},{"_id":"public/lib/pace/pace-theme-corner-indicator.min.css","hash":"b3c64c973f31884e3d8145989476707333406b9a","modified":1516777453052},{"_id":"public/lib/pace/pace-theme-loading-bar.min.css","hash":"7ee28875dfc1230d76c537f6605766e8d4011e9f","modified":1516777453052},{"_id":"public/lib/pace/pace.min.js","hash":"9944dfb7814b911090e96446cea4d36e2b487234","modified":1516777453053},{"_id":"public/lib/pace/pace-theme-mac-osx.min.css","hash":"9f2e7b51b084da407863826b25265b31150b3821","modified":1516777453053},{"_id":"public/js/src/schemes/pisces.js","hash":"79da92119bc246fe05d1626ac98426a83ec90a94","modified":1516777453053},{"_id":"public/lib/pace/pace-theme-flash.min.css","hash":"13ace22c40312d7bbd8d9c1e50eff897a7a497d8","modified":1516777453054},{"_id":"public/lib/fancybox/source/jquery.fancybox.css","hash":"5f163444617b6cf267342f06ac166a237bb62df9","modified":1516777453054},{"_id":"public/lib/fastclick/lib/fastclick.min.js","hash":"2cae0f5a6c5d6f3cb993015e6863f9483fc4de18","modified":1516777453054},{"_id":"public/lib/ua-parser-js/dist/ua-parser.min.js","hash":"38628e75e4412cc6f11074e03e1c6d257aae495b","modified":1516777453054},{"_id":"public/lib/ua-parser-js/dist/ua-parser.pack.js","hash":"214dad442a92d36af77ed0ca1d9092b16687f02f","modified":1516777453054},{"_id":"public/lib/fancybox/source/helpers/jquery.fancybox-buttons.css","hash":"1a9d8e5c22b371fcc69d4dbbb823d9c39f04c0c8","modified":1516777453054},{"_id":"public/lib/fancybox/source/helpers/jquery.fancybox-buttons.js","hash":"91e41741c2e93f732c82aaacec4cfc6e3f3ec876","modified":1516777453054},{"_id":"public/lib/fancybox/source/helpers/jquery.fancybox-thumbs.css","hash":"4ac329c16a5277592fc12a37cca3d72ca4ec292f","modified":1516777453054},{"_id":"public/lib/fancybox/source/helpers/jquery.fancybox-media.js","hash":"3bdf69ed2469e4fb57f5a95f17300eef891ff90d","modified":1516777453054},{"_id":"public/lib/fancybox/source/helpers/jquery.fancybox-thumbs.js","hash":"53e194f4a72e649c04fb586dd57762b8c022800b","modified":1516777453054},{"_id":"public/css/main.css","hash":"b712d685ccb293dc2f84a1293d86a4708b015b02","modified":1516777453055},{"_id":"public/lib/velocity/velocity.min.js","hash":"2f1afadc12e4cf59ef3b405308d21baa97e739c6","modified":1516777453055},{"_id":"public/lib/velocity/velocity.ui.js","hash":"6a1d101eab3de87527bb54fcc8c7b36b79d8f0df","modified":1516777453055},{"_id":"public/lib/three/canvas_sphere.min.js","hash":"d8ea241a53c135a650f7335d2b6982b899fd58a9","modified":1516777453055},{"_id":"public/lib/three/three-waves.min.js","hash":"d968cba6b3a50b3626a02d67b544f349d83b147c","modified":1516777453056},{"_id":"public/lib/three/canvas_lines.min.js","hash":"dce4a3b65f8bf958f973690caa7ec4952f353b0c","modified":1516777453056},{"_id":"public/lib/Han/dist/han.css","hash":"bd40da3fba8735df5850956814e312bd7b3193d7","modified":1516777453056},{"_id":"public/lib/jquery/index.js","hash":"41b4bfbaa96be6d1440db6e78004ade1c134e276","modified":1516777453056},{"_id":"public/lib/Han/dist/han.min.css","hash":"a0c9e32549a8b8cf327ab9227b037f323cdb60ee","modified":1516777453056},{"_id":"public/lib/Han/dist/han.min.js","hash":"f559c68a25065a14f47da954a7617d87263e409d","modified":1516777453056},{"_id":"public/lib/fancybox/source/jquery.fancybox.js","hash":"1cf3d47b5ccb7cb6e9019c64f2a88d03a64853e4","modified":1516777453056},{"_id":"public/lib/fancybox/source/jquery.fancybox.pack.js","hash":"53360764b429c212f424399384417ccc233bb3be","modified":1516777453056},{"_id":"public/lib/fastclick/lib/fastclick.js","hash":"06cef196733a710e77ad7e386ced6963f092dc55","modified":1516777453056},{"_id":"public/lib/font-awesome/css/font-awesome.css","hash":"0140952c64e3f2b74ef64e050f2fe86eab6624c8","modified":1516777453057},{"_id":"public/lib/font-awesome/css/font-awesome.min.css","hash":"512c7d79033e3028a9be61b540cf1a6870c896f8","modified":1516777453057},{"_id":"public/lib/Han/dist/han.js","hash":"e345397e0585c9fed1449e614ec13e0224acf2ab","modified":1516777453057},{"_id":"public/lib/velocity/velocity.js","hash":"9f08181baea0cc0e906703b7e5df9111b9ef3373","modified":1516777453057},{"_id":"public/lib/algolia-instant-search/instantsearch.min.js","hash":"9ccc6f8144f54e86df9a3fd33a18368d81cf3a4f","modified":1516777453057},{"_id":"public/lib/three/three.min.js","hash":"73f4cdc17e51a72b9bf5b9291f65386d615c483b","modified":1516777453057},{"_id":"public/lib/font-awesome/fonts/FontAwesome.otf","hash":"048707bc52ac4b6563aaa383bfe8660a0ddc908c","modified":1516777453058},{"_id":"public/lib/font-awesome/fonts/fontawesome-webfont.eot","hash":"d980c2ce873dc43af460d4d572d441304499f400","modified":1516777453059},{"_id":"public/lib/font-awesome/fonts/fontawesome-webfont.ttf","hash":"13b1eab65a983c7a73bc7997c479d66943f7c6cb","modified":1516777453059},{"_id":"public/assets/algolia/algoliasearch.js","hash":"95c1797aa497fb7f5de6ed4c89019744215203f7","modified":1516777453060},{"_id":"public/lib/font-awesome/fonts/fontawesome-webfont.svg","hash":"b5483b11f8ba213e733b5b8af9927a04fec996f6","modified":1516777453997},{"_id":"source/_posts/杂记/js心跳请求.md","hash":"af993d4f9e4aaa9132ac0c676e00a922a50450b9","modified":1516778200764},{"_id":"source/_posts/杂记/linux下安装opencv-java.md","hash":"c0a658a468da4e0dfebf07e31414f230fd0585bd","modified":1516778199236},{"_id":"source/_posts/杂记/linux修改时间.md","hash":"2d61a2c02bdb93a1062ac83f298054182b5d07a4","modified":1516778203499},{"_id":"source/_posts/杂记/tomcat+idea远程调试.md","hash":"721e4f202b97feee75ad524cadf95f3ee33968d2","modified":1516778208889},{"_id":"public/2018/01/24/杂记/linux修改时间/index.html","hash":"3c4e72ba0969932f6d31dde342136559bdf2a595","modified":1516778237842},{"_id":"public/2018/01/24/杂记/tomcat+idea远程调试/index.html","hash":"177cf63a1db013c5c13881cd8691844d88ba6628","modified":1516778237842},{"_id":"public/2018/01/24/杂记/linux下安装opencv-java/index.html","hash":"b69a59e5775cac79cf7e868d444b57d8b5aa33b9","modified":1516778237843},{"_id":"public/2018/01/24/杂记/js心跳请求/index.html","hash":"576d2051480268c3b6a9ae4921c16474f7255244","modified":1516778237843},{"_id":"public/archives/page/5/index.html","hash":"e05c5ce82e2bb0fe8885833d08b2532e76e0d430","modified":1516778109274},{"_id":"public/archives/2018/page/2/index.html","hash":"4a351142449db48ea3551b46f5013626f4f39305","modified":1516778109275},{"_id":"public/archives/2018/01/page/2/index.html","hash":"bd711f2056108361b01e5854b9a7cd4a3fc80c66","modified":1516778109275},{"_id":"public/page/5/index.html","hash":"eacee366c37ed870ce3e1f247c6ffde9d61152e1","modified":1516778109275},{"_id":"public/tags/opencv/index.html","hash":"0b7a9d36c9b80c49f69494f37c5c12692d5cb867","modified":1516778109275},{"_id":"public/categories/学习/page/4/index.html","hash":"2cecf4f7c24363380d6eb34547619aa9229e6623","modified":1516778237846}],"Category":[{"name":"简单记录","_id":"cjcsq4ldk0004x4vfkilsvctn"},{"name":"随笔","_id":"cjcsq4ldr0007x4vf0fba9buv"},{"name":"玩","_id":"cjcsq4lf6000dx4vfmt2amd67"},{"name":"学习","_id":"cjcsq4lfk000nx4vfe13bru1i"},{"name":"大数据学习笔记","_id":"cjcsq4lfo000sx4vf2wvb8zzs"},{"name":"工具","_id":"cjcsq4lk40048x4vfkdrueb5z"}],"Data":[],"Page":[{"title":"关于我","date":"2017-08-27T04:19:16.000Z","_content":"About Me","source":"about/index.md","raw":"---\ntitle: 关于我\ndate: 2017-08-27 12:19:16\n---\nAbout Me","updated":"2017-08-27T06:00:53.601Z","path":"about/index.html","comments":1,"layout":"page","_id":"cjcsq4lda0001x4vfiw42pe65","content":"<p>About Me</p>\n","site":{"data":{}},"excerpt":"","more":"<p>About Me</p>\n"},{"title":"标签","date":"2017-08-27T04:13:19.000Z","type":"tags","comments":0,"_content":"","source":"tags/index.md","raw":"---\ntitle: 标签\ndate: 2017-08-27 12:13:19\ntype: \"tags\"\ncomments: false\n---\n","updated":"2017-08-27T06:00:43.807Z","path":"tags/index.html","layout":"page","_id":"cjcsq4ldf0003x4vfxclxksu7","content":"","site":{"data":{}},"excerpt":"","more":""},{"title":"分类","date":"2017-08-27T04:15:19.000Z","type":"categories","comments":0,"_content":"","source":"categories/index.md","raw":"---\ntitle: 分类\ndate: 2017-08-27 12:15:19\ntype: \"categories\"\ncomments: false\n---\n","updated":"2017-08-27T06:00:37.640Z","path":"categories/index.html","layout":"page","_id":"cjcsq4ldn0006x4vfsuv66f6p","content":"","site":{"data":{}},"excerpt":"","more":""}],"Post":[{"title":"终于有了自己的博客","date":"2017-08-27T06:05:14.000Z","_content":"  终于有了自己的博客。感谢网络，感谢爱分享的人。  \n  搭建博客时候参考的帖子：  \n  [hexo从零开始到搭建完整](http://visugar.com/2017/05/04/20170504SetUpHexoBlog/)  \n  [Hexo安装和配置](http://www.jianshu.com/p/b7886271e21a)  \n  [Hexo搭建Github-Pages博客填坑教程](http://www.jianshu.com/p/35e197cb1273)  \n  [主题nexT使用指南](http://theme-next.iissnan.com/getting-started.html)\n\n  自己碰到的坑  \n  - 安装hexo后启动时,访问localhost:4000网页没反应 ```替换端口号后解决了```\n  - rss 链接出现问题,在[Hexo搭建Github-Pages博客填坑教程](http://www.jianshu.com/p/35e197cb1273) 中找到了解决办法\n  - hueman 主题下载后启动错误,这个没解决,替换找别的主题了。\n\n\n\n\n\n\n","source":"_posts/终于有了自己的博客.md","raw":"---\ntitle: 终于有了自己的博客\ndate: 2017-08-27 14:05:14\ncategories: 随笔\ntags: \n---\n  终于有了自己的博客。感谢网络，感谢爱分享的人。  \n  搭建博客时候参考的帖子：  \n  [hexo从零开始到搭建完整](http://visugar.com/2017/05/04/20170504SetUpHexoBlog/)  \n  [Hexo安装和配置](http://www.jianshu.com/p/b7886271e21a)  \n  [Hexo搭建Github-Pages博客填坑教程](http://www.jianshu.com/p/35e197cb1273)  \n  [主题nexT使用指南](http://theme-next.iissnan.com/getting-started.html)\n\n  自己碰到的坑  \n  - 安装hexo后启动时,访问localhost:4000网页没反应 ```替换端口号后解决了```\n  - rss 链接出现问题,在[Hexo搭建Github-Pages博客填坑教程](http://www.jianshu.com/p/35e197cb1273) 中找到了解决办法\n  - hueman 主题下载后启动错误,这个没解决,替换找别的主题了。\n\n\n\n\n\n\n","slug":"终于有了自己的博客","published":1,"updated":"2017-09-03T15:22:52.890Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjcsq4ldd0002x4vfhhquq8c9","content":"<p>  终于有了自己的博客。感谢网络，感谢爱分享的人。<br>  搭建博客时候参考的帖子：<br>  <a href=\"http://visugar.com/2017/05/04/20170504SetUpHexoBlog/\" target=\"_blank\" rel=\"external\">hexo从零开始到搭建完整</a><br>  <a href=\"http://www.jianshu.com/p/b7886271e21a\" target=\"_blank\" rel=\"external\">Hexo安装和配置</a><br>  <a href=\"http://www.jianshu.com/p/35e197cb1273\" target=\"_blank\" rel=\"external\">Hexo搭建Github-Pages博客填坑教程</a><br>  <a href=\"http://theme-next.iissnan.com/getting-started.html\" target=\"_blank\" rel=\"external\">主题nexT使用指南</a></p>\n<p>  自己碰到的坑  </p>\n<ul>\n<li>安装hexo后启动时,访问localhost:4000网页没反应 <code>替换端口号后解决了</code></li>\n<li>rss 链接出现问题,在<a href=\"http://www.jianshu.com/p/35e197cb1273\" target=\"_blank\" rel=\"external\">Hexo搭建Github-Pages博客填坑教程</a> 中找到了解决办法</li>\n<li>hueman 主题下载后启动错误,这个没解决,替换找别的主题了。</li>\n</ul>\n","site":{"data":{}},"excerpt":"","more":"<p>  终于有了自己的博客。感谢网络，感谢爱分享的人。<br>  搭建博客时候参考的帖子：<br>  <a href=\"http://visugar.com/2017/05/04/20170504SetUpHexoBlog/\" target=\"_blank\" rel=\"external\">hexo从零开始到搭建完整</a><br>  <a href=\"http://www.jianshu.com/p/b7886271e21a\" target=\"_blank\" rel=\"external\">Hexo安装和配置</a><br>  <a href=\"http://www.jianshu.com/p/35e197cb1273\" target=\"_blank\" rel=\"external\">Hexo搭建Github-Pages博客填坑教程</a><br>  <a href=\"http://theme-next.iissnan.com/getting-started.html\" target=\"_blank\" rel=\"external\">主题nexT使用指南</a></p>\n<p>  自己碰到的坑  </p>\n<ul>\n<li>安装hexo后启动时,访问localhost:4000网页没反应 <code>替换端口号后解决了</code></li>\n<li>rss 链接出现问题,在<a href=\"http://www.jianshu.com/p/35e197cb1273\" target=\"_blank\" rel=\"external\">Hexo搭建Github-Pages博客填坑教程</a> 中找到了解决办法</li>\n<li>hueman 主题下载后启动错误,这个没解决,替换找别的主题了。</li>\n</ul>\n"},{"title":"北京冬天哪里好玩","toc":true,"date":"2017-12-22T15:55:03.000Z","scaffolds":null,"_content":"[发愁冬天去哪玩？北京这10个地方好玩还不冷！周末约起~](http://www.360doc.com/content/16/1202/06/38518105_611197220.shtml)  \n转来的\n<!-- more -->\n# 古北水镇过暖冬\n冬日的水镇一改盛夏的浓艳，鳞次栉比的房屋，青石板的老街，悠长的胡同......让水镇更添几分宁静、祥和。这时候来古北逛逛古镇，看看夜景，泡泡温泉，真是从头到脚的舒心！\n## 门票信息：180.00元（体验价80.00元）\n## 自驾路线：\n上了京承高速，一直前行，路上会有古北水镇的标示牌，下了高速，基本就到停车场。从京承高速收费站到古北水镇大约有120公里的路程。    \ntips：四季皆宜。 春季碧波荡漾，水镇宛若一幅江南水墨画；夏季纳凉避暑，戏水游乐；秋季银杏落叶和古朴的建筑情景交融，摄影取材的好去处；冬季皑皑白雪的覆盖下，河面冻结，嬉雪赏冰雕……\n\n\n# 首都博物馆\n欲了解一个地方，必去当地的博物馆！首都博物馆是咱们“老北京的博物馆”，从北京的历史文化，生活民俗，风土人文，全面的介绍北京的兴衰变迁。是深度了解北京的好地方。\n## 门票：持有效证件免费参观\n- 地址：西城区复兴门外大街16号\n## 路线\n- 地铁：乘坐地铁1号线`木樨地站`下\n- 公交：26、80、45、114、308、特19、937、843、844、840、845路`白云路站`\n\n# 呀路古热带植物园\n北京呀路古热带植物园位于北京市大兴区长子营镇，是北京市最大的热带植物园，占地面积600亩。虽然外面寒风烈烈，但这里确是温暖如春！  \n景区收集了热带果树、热带饮料植物、热带观赏植物、热带药用植物、棕榈植物、热带濒危植物、热带珍奇植物和蔬菜作物等，热带亚热带物种达上千余种  \n景区内主要景点有勐巴拉娜西热带植物馆、土司堡民族展览馆和恐龙馆、孔雀馆等。景区内森林繁茂，蔓藤缠绕，不失为冬季的好去处。\n## 门票：60元\n## 乘车线路：\n- 1、市区游客可乘坐976路、826路、926路公交车。 \n- 2、大兴黄村地区的游客可以坐940路公交车`朱庄站`下车前行200米即到。\n\n# 北京天文馆\n## 简介\n北京天文馆是`中国第一座天文馆`，馆内有直径23.5米象征天穹的天象厅，中间安装精致的国产大型天象仪，`可表演日、月、星辰、流星彗星、日食以及月食等天象`。  \n北京天文馆包含`A、B两馆`，共4个科普剧场。\n### A馆\n- 门厅正中 ： 反映`地球自转的傅科摆`\n- 西侧展厅 ： 陈列天文知识展览\n- 东侧演讲厅 ： 经常举行学术交流和普及天文科学知识报告。\n- 庭院中有两座天文台，其中一座装有口径13厘米的望远镜，可通过它观看月亮、行星、星云、星团，白天观测太阳黑子。\n\n## 门票：\n###  10元/人\n###  天象厅：45元/人\n###  宇宙剧场：30元/人\n###  3D剧场、4D剧场：45元/人\n##  乘车线路：\n乘7、15、19、27、65、102、103、105、107、111、319、332、334、347、360、362、534、601、632、634、714、732、808、814、运通104、运通105、运通106、特4路`动物园站`下;地铁4号线`动物园站D`出口。\n\n# 南宫温泉水世界\n南宫温泉坐落在4A级南宫旅游景区内，这里可是“`中国地热第一村`”！也是北京最大的一块地热田！温泉水都来自2980米深得地热井，每天出水量为2700吨，温度69—72℃~  \n整座水世界呈热带雨林的风情，里面种满了热带树木、植物，还有数十种汤泉药浴；儿童戏水乐园，漂流、戏水滑道....\n## 路线\n- 地址:北京市丰台区王佐镇南宫南路9号\n- 自驾：京港澳高速'南宫王佐19A'出口出向北第二个红绿灯右转200米路北\n- 公交：乘458路,459路,951路,836路直达`王佐镇政府站`下车\n\n# 顺景温泉\n日式汤屋、溶洞、水世界…在帝都，温泉我只服这一家！顺景温泉总占地13万平米，是吉尼斯认证的“`全球最大室内温泉`”！  \n这里的温泉水非常珍贵！活性矿物质远远高于理疗热矿水浓度标准室内外温泉池相互衔接，清池湖泊、小桥流水...充满着神秘色彩，给人以原始丛林的生态之美。  \n还有千奇百怪、突兀嶙峋的溶洞。置身于顺景的溶洞景观中，仿入梦境。满眼都是数万年的各异钟乳石、石笋，一切都分外神秘与美丽！    \n## 人均：240元左右/人\n## 路线\n- 地址：朝阳区北四环东路2号\n- 电话：010-84420088 010-85696688\n- 乘车路线：847路、131路、401路、404路、641路公交在`四元桥西站`下车，步行至酒店。\n\n# X先生密室\nX先生密室是一家大型真人密室逃脱游戏场所，致力于打造最全面的融合紧张刺激，需要玩家在房间中寻找线索，通过合作找出所有线索，交流和思考解开全部谜题，一步一步的走近最终答案，最终逃出密室。  \n绝对属于高科技范儿的密室逃脱，连实景岩洞、水池皮划都能在神秘屋里体验到。解开谜题的钥匙可能藏在任何物件里，有可能你身上穿的衣服也能帮你逃出牢笼。\n\n## 人均消费：140元\n## 路线\n- 地址：朝阳区 工体北路13号世茂广场·工三 2层(工体北门对面)。\n- 营业时间：10:00—2:20(22:30之后来店需提前电话咨询)\n- 电话：4008598298。\n\n# 北京自然博物馆\n如果不知道该如何打发时间，就来位于天桥南侧的北京自然博物馆吧~ 里面有各种动、植物标本、恐龙骨架、人体知识、小小水族馆....在这里，时间仿佛是静止的，不知孩子，大人也能玩的不亦乐乎~  \n有恐龙的化石骨骼，有恐龙的仿真模型，那些模型十分逼真，甚至有的还可以发出恐龙的叫声~  \n还有小小的海洋世界，没有太平洋富国海底世界那么大，只是一个不大的走廊，但是你也可以看到很多的海洋动植物~ 如果小朋友来这里，真的能疯玩一整天！\n\n## 门票：门票免费，至少需提前一天预约，不能预约当日参观门票\n## 路线\n- 地址：北京市东城区天桥南大街126号\n- 公交7路, 17路, 20路, 35路, 36路, 69路, 71路, 72路`天桥西门`下车\n- 地铁：地铁7号线 `珠市口站`\n\n# 地质博物馆\n中国地质博物馆是`中国成立最早的地质学博物馆`，创建于1916年，以其典藏系统、成果丰硕、陈列精美称雄于亚洲同类博物馆，并且在世界范围内享有盛誉。  \n中国地质博物馆收藏地质标本20余万件，涵盖地学各个领域。其中有蜚声海内外的`巨型山东龙`、`中华龙鸟等恐龙系列化石`，`北京人`、`元谋人`、`山顶洞人`等著名古人类化石等。\n## 门票：30元\n## 乘车线路：\n市内交通：乘13、22、38、47、68、101、102、103、105、109、124、409、603、709、726、806、808、812、814、823、826、846、850路公共汽车西四站下\n\n# 世界花卉大观园\n世界花卉大观园位于北京南四环辅路北侧，京开公路东侧，全园41.8公顷，是`北京市四环以内最大的植物园`。\n世界花卉大观园景观由`七大温室`和`十五个花园广场`组成。各温室内的植物千奇百怪、花锦簇。  \n热带植物馆中有数百年的佛肚树、重阳木、古榕树等乔木1800余种；沙生植物温室有上百种仙人掌、仙人球；精品花卉厅有生动风趣的植物生肖园、精品盆景园等等。\n## 门票：60元\n## 乘车线路：\n4号线`公益西桥站`下车换乘646路到`世界花卉大观园站`下车。","source":"_posts/其他/北京冬天哪里好玩.md","raw":"---\ntitle: 北京冬天哪里好玩\ncategories: 玩\ntags:\n  - 生活\n  - 北京\n  - 游玩\ntoc: true\ndate: 2017-12-22 23:55:03\nscaffolds:\n---\n[发愁冬天去哪玩？北京这10个地方好玩还不冷！周末约起~](http://www.360doc.com/content/16/1202/06/38518105_611197220.shtml)  \n转来的\n<!-- more -->\n# 古北水镇过暖冬\n冬日的水镇一改盛夏的浓艳，鳞次栉比的房屋，青石板的老街，悠长的胡同......让水镇更添几分宁静、祥和。这时候来古北逛逛古镇，看看夜景，泡泡温泉，真是从头到脚的舒心！\n## 门票信息：180.00元（体验价80.00元）\n## 自驾路线：\n上了京承高速，一直前行，路上会有古北水镇的标示牌，下了高速，基本就到停车场。从京承高速收费站到古北水镇大约有120公里的路程。    \ntips：四季皆宜。 春季碧波荡漾，水镇宛若一幅江南水墨画；夏季纳凉避暑，戏水游乐；秋季银杏落叶和古朴的建筑情景交融，摄影取材的好去处；冬季皑皑白雪的覆盖下，河面冻结，嬉雪赏冰雕……\n\n\n# 首都博物馆\n欲了解一个地方，必去当地的博物馆！首都博物馆是咱们“老北京的博物馆”，从北京的历史文化，生活民俗，风土人文，全面的介绍北京的兴衰变迁。是深度了解北京的好地方。\n## 门票：持有效证件免费参观\n- 地址：西城区复兴门外大街16号\n## 路线\n- 地铁：乘坐地铁1号线`木樨地站`下\n- 公交：26、80、45、114、308、特19、937、843、844、840、845路`白云路站`\n\n# 呀路古热带植物园\n北京呀路古热带植物园位于北京市大兴区长子营镇，是北京市最大的热带植物园，占地面积600亩。虽然外面寒风烈烈，但这里确是温暖如春！  \n景区收集了热带果树、热带饮料植物、热带观赏植物、热带药用植物、棕榈植物、热带濒危植物、热带珍奇植物和蔬菜作物等，热带亚热带物种达上千余种  \n景区内主要景点有勐巴拉娜西热带植物馆、土司堡民族展览馆和恐龙馆、孔雀馆等。景区内森林繁茂，蔓藤缠绕，不失为冬季的好去处。\n## 门票：60元\n## 乘车线路：\n- 1、市区游客可乘坐976路、826路、926路公交车。 \n- 2、大兴黄村地区的游客可以坐940路公交车`朱庄站`下车前行200米即到。\n\n# 北京天文馆\n## 简介\n北京天文馆是`中国第一座天文馆`，馆内有直径23.5米象征天穹的天象厅，中间安装精致的国产大型天象仪，`可表演日、月、星辰、流星彗星、日食以及月食等天象`。  \n北京天文馆包含`A、B两馆`，共4个科普剧场。\n### A馆\n- 门厅正中 ： 反映`地球自转的傅科摆`\n- 西侧展厅 ： 陈列天文知识展览\n- 东侧演讲厅 ： 经常举行学术交流和普及天文科学知识报告。\n- 庭院中有两座天文台，其中一座装有口径13厘米的望远镜，可通过它观看月亮、行星、星云、星团，白天观测太阳黑子。\n\n## 门票：\n###  10元/人\n###  天象厅：45元/人\n###  宇宙剧场：30元/人\n###  3D剧场、4D剧场：45元/人\n##  乘车线路：\n乘7、15、19、27、65、102、103、105、107、111、319、332、334、347、360、362、534、601、632、634、714、732、808、814、运通104、运通105、运通106、特4路`动物园站`下;地铁4号线`动物园站D`出口。\n\n# 南宫温泉水世界\n南宫温泉坐落在4A级南宫旅游景区内，这里可是“`中国地热第一村`”！也是北京最大的一块地热田！温泉水都来自2980米深得地热井，每天出水量为2700吨，温度69—72℃~  \n整座水世界呈热带雨林的风情，里面种满了热带树木、植物，还有数十种汤泉药浴；儿童戏水乐园，漂流、戏水滑道....\n## 路线\n- 地址:北京市丰台区王佐镇南宫南路9号\n- 自驾：京港澳高速'南宫王佐19A'出口出向北第二个红绿灯右转200米路北\n- 公交：乘458路,459路,951路,836路直达`王佐镇政府站`下车\n\n# 顺景温泉\n日式汤屋、溶洞、水世界…在帝都，温泉我只服这一家！顺景温泉总占地13万平米，是吉尼斯认证的“`全球最大室内温泉`”！  \n这里的温泉水非常珍贵！活性矿物质远远高于理疗热矿水浓度标准室内外温泉池相互衔接，清池湖泊、小桥流水...充满着神秘色彩，给人以原始丛林的生态之美。  \n还有千奇百怪、突兀嶙峋的溶洞。置身于顺景的溶洞景观中，仿入梦境。满眼都是数万年的各异钟乳石、石笋，一切都分外神秘与美丽！    \n## 人均：240元左右/人\n## 路线\n- 地址：朝阳区北四环东路2号\n- 电话：010-84420088 010-85696688\n- 乘车路线：847路、131路、401路、404路、641路公交在`四元桥西站`下车，步行至酒店。\n\n# X先生密室\nX先生密室是一家大型真人密室逃脱游戏场所，致力于打造最全面的融合紧张刺激，需要玩家在房间中寻找线索，通过合作找出所有线索，交流和思考解开全部谜题，一步一步的走近最终答案，最终逃出密室。  \n绝对属于高科技范儿的密室逃脱，连实景岩洞、水池皮划都能在神秘屋里体验到。解开谜题的钥匙可能藏在任何物件里，有可能你身上穿的衣服也能帮你逃出牢笼。\n\n## 人均消费：140元\n## 路线\n- 地址：朝阳区 工体北路13号世茂广场·工三 2层(工体北门对面)。\n- 营业时间：10:00—2:20(22:30之后来店需提前电话咨询)\n- 电话：4008598298。\n\n# 北京自然博物馆\n如果不知道该如何打发时间，就来位于天桥南侧的北京自然博物馆吧~ 里面有各种动、植物标本、恐龙骨架、人体知识、小小水族馆....在这里，时间仿佛是静止的，不知孩子，大人也能玩的不亦乐乎~  \n有恐龙的化石骨骼，有恐龙的仿真模型，那些模型十分逼真，甚至有的还可以发出恐龙的叫声~  \n还有小小的海洋世界，没有太平洋富国海底世界那么大，只是一个不大的走廊，但是你也可以看到很多的海洋动植物~ 如果小朋友来这里，真的能疯玩一整天！\n\n## 门票：门票免费，至少需提前一天预约，不能预约当日参观门票\n## 路线\n- 地址：北京市东城区天桥南大街126号\n- 公交7路, 17路, 20路, 35路, 36路, 69路, 71路, 72路`天桥西门`下车\n- 地铁：地铁7号线 `珠市口站`\n\n# 地质博物馆\n中国地质博物馆是`中国成立最早的地质学博物馆`，创建于1916年，以其典藏系统、成果丰硕、陈列精美称雄于亚洲同类博物馆，并且在世界范围内享有盛誉。  \n中国地质博物馆收藏地质标本20余万件，涵盖地学各个领域。其中有蜚声海内外的`巨型山东龙`、`中华龙鸟等恐龙系列化石`，`北京人`、`元谋人`、`山顶洞人`等著名古人类化石等。\n## 门票：30元\n## 乘车线路：\n市内交通：乘13、22、38、47、68、101、102、103、105、109、124、409、603、709、726、806、808、812、814、823、826、846、850路公共汽车西四站下\n\n# 世界花卉大观园\n世界花卉大观园位于北京南四环辅路北侧，京开公路东侧，全园41.8公顷，是`北京市四环以内最大的植物园`。\n世界花卉大观园景观由`七大温室`和`十五个花园广场`组成。各温室内的植物千奇百怪、花锦簇。  \n热带植物馆中有数百年的佛肚树、重阳木、古榕树等乔木1800余种；沙生植物温室有上百种仙人掌、仙人球；精品花卉厅有生动风趣的植物生肖园、精品盆景园等等。\n## 门票：60元\n## 乘车线路：\n4号线`公益西桥站`下车换乘646路到`世界花卉大观园站`下车。","slug":"其他/北京冬天哪里好玩","published":1,"updated":"2017-12-22T17:01:21.934Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjcsq4lf4000bx4vfa2f09a5z","content":"<p><a href=\"http://www.360doc.com/content/16/1202/06/38518105_611197220.shtml\" target=\"_blank\" rel=\"external\">发愁冬天去哪玩？北京这10个地方好玩还不冷！周末约起~</a><br>转来的<br><a id=\"more\"></a></p>\n<h1 id=\"古北水镇过暖冬\"><a href=\"#古北水镇过暖冬\" class=\"headerlink\" title=\"古北水镇过暖冬\"></a>古北水镇过暖冬</h1><p>冬日的水镇一改盛夏的浓艳，鳞次栉比的房屋，青石板的老街，悠长的胡同……让水镇更添几分宁静、祥和。这时候来古北逛逛古镇，看看夜景，泡泡温泉，真是从头到脚的舒心！</p>\n<h2 id=\"门票信息：180-00元（体验价80-00元）\"><a href=\"#门票信息：180-00元（体验价80-00元）\" class=\"headerlink\" title=\"门票信息：180.00元（体验价80.00元）\"></a>门票信息：180.00元（体验价80.00元）</h2><h2 id=\"自驾路线：\"><a href=\"#自驾路线：\" class=\"headerlink\" title=\"自驾路线：\"></a>自驾路线：</h2><p>上了京承高速，一直前行，路上会有古北水镇的标示牌，下了高速，基本就到停车场。从京承高速收费站到古北水镇大约有120公里的路程。<br>tips：四季皆宜。 春季碧波荡漾，水镇宛若一幅江南水墨画；夏季纳凉避暑，戏水游乐；秋季银杏落叶和古朴的建筑情景交融，摄影取材的好去处；冬季皑皑白雪的覆盖下，河面冻结，嬉雪赏冰雕……</p>\n<h1 id=\"首都博物馆\"><a href=\"#首都博物馆\" class=\"headerlink\" title=\"首都博物馆\"></a>首都博物馆</h1><p>欲了解一个地方，必去当地的博物馆！首都博物馆是咱们“老北京的博物馆”，从北京的历史文化，生活民俗，风土人文，全面的介绍北京的兴衰变迁。是深度了解北京的好地方。</p>\n<h2 id=\"门票：持有效证件免费参观\"><a href=\"#门票：持有效证件免费参观\" class=\"headerlink\" title=\"门票：持有效证件免费参观\"></a>门票：持有效证件免费参观</h2><ul>\n<li>地址：西城区复兴门外大街16号<h2 id=\"路线\"><a href=\"#路线\" class=\"headerlink\" title=\"路线\"></a>路线</h2></li>\n<li>地铁：乘坐地铁1号线<code>木樨地站</code>下</li>\n<li>公交：26、80、45、114、308、特19、937、843、844、840、845路<code>白云路站</code></li>\n</ul>\n<h1 id=\"呀路古热带植物园\"><a href=\"#呀路古热带植物园\" class=\"headerlink\" title=\"呀路古热带植物园\"></a>呀路古热带植物园</h1><p>北京呀路古热带植物园位于北京市大兴区长子营镇，是北京市最大的热带植物园，占地面积600亩。虽然外面寒风烈烈，但这里确是温暖如春！<br>景区收集了热带果树、热带饮料植物、热带观赏植物、热带药用植物、棕榈植物、热带濒危植物、热带珍奇植物和蔬菜作物等，热带亚热带物种达上千余种<br>景区内主要景点有勐巴拉娜西热带植物馆、土司堡民族展览馆和恐龙馆、孔雀馆等。景区内森林繁茂，蔓藤缠绕，不失为冬季的好去处。</p>\n<h2 id=\"门票：60元\"><a href=\"#门票：60元\" class=\"headerlink\" title=\"门票：60元\"></a>门票：60元</h2><h2 id=\"乘车线路：\"><a href=\"#乘车线路：\" class=\"headerlink\" title=\"乘车线路：\"></a>乘车线路：</h2><ul>\n<li>1、市区游客可乘坐976路、826路、926路公交车。 </li>\n<li>2、大兴黄村地区的游客可以坐940路公交车<code>朱庄站</code>下车前行200米即到。</li>\n</ul>\n<h1 id=\"北京天文馆\"><a href=\"#北京天文馆\" class=\"headerlink\" title=\"北京天文馆\"></a>北京天文馆</h1><h2 id=\"简介\"><a href=\"#简介\" class=\"headerlink\" title=\"简介\"></a>简介</h2><p>北京天文馆是<code>中国第一座天文馆</code>，馆内有直径23.5米象征天穹的天象厅，中间安装精致的国产大型天象仪，<code>可表演日、月、星辰、流星彗星、日食以及月食等天象</code>。<br>北京天文馆包含<code>A、B两馆</code>，共4个科普剧场。</p>\n<h3 id=\"A馆\"><a href=\"#A馆\" class=\"headerlink\" title=\"A馆\"></a>A馆</h3><ul>\n<li>门厅正中 ： 反映<code>地球自转的傅科摆</code></li>\n<li>西侧展厅 ： 陈列天文知识展览</li>\n<li>东侧演讲厅 ： 经常举行学术交流和普及天文科学知识报告。</li>\n<li>庭院中有两座天文台，其中一座装有口径13厘米的望远镜，可通过它观看月亮、行星、星云、星团，白天观测太阳黑子。</li>\n</ul>\n<h2 id=\"门票：\"><a href=\"#门票：\" class=\"headerlink\" title=\"门票：\"></a>门票：</h2><h3 id=\"10元-人\"><a href=\"#10元-人\" class=\"headerlink\" title=\"10元/人\"></a>10元/人</h3><h3 id=\"天象厅：45元-人\"><a href=\"#天象厅：45元-人\" class=\"headerlink\" title=\"天象厅：45元/人\"></a>天象厅：45元/人</h3><h3 id=\"宇宙剧场：30元-人\"><a href=\"#宇宙剧场：30元-人\" class=\"headerlink\" title=\"宇宙剧场：30元/人\"></a>宇宙剧场：30元/人</h3><h3 id=\"3D剧场、4D剧场：45元-人\"><a href=\"#3D剧场、4D剧场：45元-人\" class=\"headerlink\" title=\"3D剧场、4D剧场：45元/人\"></a>3D剧场、4D剧场：45元/人</h3><h2 id=\"乘车线路：-1\"><a href=\"#乘车线路：-1\" class=\"headerlink\" title=\"乘车线路：\"></a>乘车线路：</h2><p>乘7、15、19、27、65、102、103、105、107、111、319、332、334、347、360、362、534、601、632、634、714、732、808、814、运通104、运通105、运通106、特4路<code>动物园站</code>下;地铁4号线<code>动物园站D</code>出口。</p>\n<h1 id=\"南宫温泉水世界\"><a href=\"#南宫温泉水世界\" class=\"headerlink\" title=\"南宫温泉水世界\"></a>南宫温泉水世界</h1><p>南宫温泉坐落在4A级南宫旅游景区内，这里可是“<code>中国地热第一村</code>”！也是北京最大的一块地热田！温泉水都来自2980米深得地热井，每天出水量为2700吨，温度69—72℃~<br>整座水世界呈热带雨林的风情，里面种满了热带树木、植物，还有数十种汤泉药浴；儿童戏水乐园，漂流、戏水滑道….</p>\n<h2 id=\"路线-1\"><a href=\"#路线-1\" class=\"headerlink\" title=\"路线\"></a>路线</h2><ul>\n<li>地址:北京市丰台区王佐镇南宫南路9号</li>\n<li>自驾：京港澳高速’南宫王佐19A’出口出向北第二个红绿灯右转200米路北</li>\n<li>公交：乘458路,459路,951路,836路直达<code>王佐镇政府站</code>下车</li>\n</ul>\n<h1 id=\"顺景温泉\"><a href=\"#顺景温泉\" class=\"headerlink\" title=\"顺景温泉\"></a>顺景温泉</h1><p>日式汤屋、溶洞、水世界…在帝都，温泉我只服这一家！顺景温泉总占地13万平米，是吉尼斯认证的“<code>全球最大室内温泉</code>”！<br>这里的温泉水非常珍贵！活性矿物质远远高于理疗热矿水浓度标准室内外温泉池相互衔接，清池湖泊、小桥流水…充满着神秘色彩，给人以原始丛林的生态之美。<br>还有千奇百怪、突兀嶙峋的溶洞。置身于顺景的溶洞景观中，仿入梦境。满眼都是数万年的各异钟乳石、石笋，一切都分外神秘与美丽！    </p>\n<h2 id=\"人均：240元左右-人\"><a href=\"#人均：240元左右-人\" class=\"headerlink\" title=\"人均：240元左右/人\"></a>人均：240元左右/人</h2><h2 id=\"路线-2\"><a href=\"#路线-2\" class=\"headerlink\" title=\"路线\"></a>路线</h2><ul>\n<li>地址：朝阳区北四环东路2号</li>\n<li>电话：010-84420088 010-85696688</li>\n<li>乘车路线：847路、131路、401路、404路、641路公交在<code>四元桥西站</code>下车，步行至酒店。</li>\n</ul>\n<h1 id=\"X先生密室\"><a href=\"#X先生密室\" class=\"headerlink\" title=\"X先生密室\"></a>X先生密室</h1><p>X先生密室是一家大型真人密室逃脱游戏场所，致力于打造最全面的融合紧张刺激，需要玩家在房间中寻找线索，通过合作找出所有线索，交流和思考解开全部谜题，一步一步的走近最终答案，最终逃出密室。<br>绝对属于高科技范儿的密室逃脱，连实景岩洞、水池皮划都能在神秘屋里体验到。解开谜题的钥匙可能藏在任何物件里，有可能你身上穿的衣服也能帮你逃出牢笼。</p>\n<h2 id=\"人均消费：140元\"><a href=\"#人均消费：140元\" class=\"headerlink\" title=\"人均消费：140元\"></a>人均消费：140元</h2><h2 id=\"路线-3\"><a href=\"#路线-3\" class=\"headerlink\" title=\"路线\"></a>路线</h2><ul>\n<li>地址：朝阳区 工体北路13号世茂广场·工三 2层(工体北门对面)。</li>\n<li>营业时间：10:00—2:20(22:30之后来店需提前电话咨询)</li>\n<li>电话：4008598298。</li>\n</ul>\n<h1 id=\"北京自然博物馆\"><a href=\"#北京自然博物馆\" class=\"headerlink\" title=\"北京自然博物馆\"></a>北京自然博物馆</h1><p>如果不知道该如何打发时间，就来位于天桥南侧的北京自然博物馆吧~ 里面有各种动、植物标本、恐龙骨架、人体知识、小小水族馆….在这里，时间仿佛是静止的，不知孩子，大人也能玩的不亦乐乎~<br>有恐龙的化石骨骼，有恐龙的仿真模型，那些模型十分逼真，甚至有的还可以发出恐龙的叫声~<br>还有小小的海洋世界，没有太平洋富国海底世界那么大，只是一个不大的走廊，但是你也可以看到很多的海洋动植物~ 如果小朋友来这里，真的能疯玩一整天！</p>\n<h2 id=\"门票：门票免费，至少需提前一天预约，不能预约当日参观门票\"><a href=\"#门票：门票免费，至少需提前一天预约，不能预约当日参观门票\" class=\"headerlink\" title=\"门票：门票免费，至少需提前一天预约，不能预约当日参观门票\"></a>门票：门票免费，至少需提前一天预约，不能预约当日参观门票</h2><h2 id=\"路线-4\"><a href=\"#路线-4\" class=\"headerlink\" title=\"路线\"></a>路线</h2><ul>\n<li>地址：北京市东城区天桥南大街126号</li>\n<li>公交7路, 17路, 20路, 35路, 36路, 69路, 71路, 72路<code>天桥西门</code>下车</li>\n<li>地铁：地铁7号线 <code>珠市口站</code></li>\n</ul>\n<h1 id=\"地质博物馆\"><a href=\"#地质博物馆\" class=\"headerlink\" title=\"地质博物馆\"></a>地质博物馆</h1><p>中国地质博物馆是<code>中国成立最早的地质学博物馆</code>，创建于1916年，以其典藏系统、成果丰硕、陈列精美称雄于亚洲同类博物馆，并且在世界范围内享有盛誉。<br>中国地质博物馆收藏地质标本20余万件，涵盖地学各个领域。其中有蜚声海内外的<code>巨型山东龙</code>、<code>中华龙鸟等恐龙系列化石</code>，<code>北京人</code>、<code>元谋人</code>、<code>山顶洞人</code>等著名古人类化石等。</p>\n<h2 id=\"门票：30元\"><a href=\"#门票：30元\" class=\"headerlink\" title=\"门票：30元\"></a>门票：30元</h2><h2 id=\"乘车线路：-2\"><a href=\"#乘车线路：-2\" class=\"headerlink\" title=\"乘车线路：\"></a>乘车线路：</h2><p>市内交通：乘13、22、38、47、68、101、102、103、105、109、124、409、603、709、726、806、808、812、814、823、826、846、850路公共汽车西四站下</p>\n<h1 id=\"世界花卉大观园\"><a href=\"#世界花卉大观园\" class=\"headerlink\" title=\"世界花卉大观园\"></a>世界花卉大观园</h1><p>世界花卉大观园位于北京南四环辅路北侧，京开公路东侧，全园41.8公顷，是<code>北京市四环以内最大的植物园</code>。<br>世界花卉大观园景观由<code>七大温室</code>和<code>十五个花园广场</code>组成。各温室内的植物千奇百怪、花锦簇。<br>热带植物馆中有数百年的佛肚树、重阳木、古榕树等乔木1800余种；沙生植物温室有上百种仙人掌、仙人球；精品花卉厅有生动风趣的植物生肖园、精品盆景园等等。</p>\n<h2 id=\"门票：60元-1\"><a href=\"#门票：60元-1\" class=\"headerlink\" title=\"门票：60元\"></a>门票：60元</h2><h2 id=\"乘车线路：-3\"><a href=\"#乘车线路：-3\" class=\"headerlink\" title=\"乘车线路：\"></a>乘车线路：</h2><p>4号线<code>公益西桥站</code>下车换乘646路到<code>世界花卉大观园站</code>下车。</p>\n","site":{"data":{}},"excerpt":"<p><a href=\"http://www.360doc.com/content/16/1202/06/38518105_611197220.shtml\" target=\"_blank\" rel=\"external\">发愁冬天去哪玩？北京这10个地方好玩还不冷！周末约起~</a><br>转来的<br>","more":"</p>\n<h1 id=\"古北水镇过暖冬\"><a href=\"#古北水镇过暖冬\" class=\"headerlink\" title=\"古北水镇过暖冬\"></a>古北水镇过暖冬</h1><p>冬日的水镇一改盛夏的浓艳，鳞次栉比的房屋，青石板的老街，悠长的胡同……让水镇更添几分宁静、祥和。这时候来古北逛逛古镇，看看夜景，泡泡温泉，真是从头到脚的舒心！</p>\n<h2 id=\"门票信息：180-00元（体验价80-00元）\"><a href=\"#门票信息：180-00元（体验价80-00元）\" class=\"headerlink\" title=\"门票信息：180.00元（体验价80.00元）\"></a>门票信息：180.00元（体验价80.00元）</h2><h2 id=\"自驾路线：\"><a href=\"#自驾路线：\" class=\"headerlink\" title=\"自驾路线：\"></a>自驾路线：</h2><p>上了京承高速，一直前行，路上会有古北水镇的标示牌，下了高速，基本就到停车场。从京承高速收费站到古北水镇大约有120公里的路程。<br>tips：四季皆宜。 春季碧波荡漾，水镇宛若一幅江南水墨画；夏季纳凉避暑，戏水游乐；秋季银杏落叶和古朴的建筑情景交融，摄影取材的好去处；冬季皑皑白雪的覆盖下，河面冻结，嬉雪赏冰雕……</p>\n<h1 id=\"首都博物馆\"><a href=\"#首都博物馆\" class=\"headerlink\" title=\"首都博物馆\"></a>首都博物馆</h1><p>欲了解一个地方，必去当地的博物馆！首都博物馆是咱们“老北京的博物馆”，从北京的历史文化，生活民俗，风土人文，全面的介绍北京的兴衰变迁。是深度了解北京的好地方。</p>\n<h2 id=\"门票：持有效证件免费参观\"><a href=\"#门票：持有效证件免费参观\" class=\"headerlink\" title=\"门票：持有效证件免费参观\"></a>门票：持有效证件免费参观</h2><ul>\n<li>地址：西城区复兴门外大街16号<h2 id=\"路线\"><a href=\"#路线\" class=\"headerlink\" title=\"路线\"></a>路线</h2></li>\n<li>地铁：乘坐地铁1号线<code>木樨地站</code>下</li>\n<li>公交：26、80、45、114、308、特19、937、843、844、840、845路<code>白云路站</code></li>\n</ul>\n<h1 id=\"呀路古热带植物园\"><a href=\"#呀路古热带植物园\" class=\"headerlink\" title=\"呀路古热带植物园\"></a>呀路古热带植物园</h1><p>北京呀路古热带植物园位于北京市大兴区长子营镇，是北京市最大的热带植物园，占地面积600亩。虽然外面寒风烈烈，但这里确是温暖如春！<br>景区收集了热带果树、热带饮料植物、热带观赏植物、热带药用植物、棕榈植物、热带濒危植物、热带珍奇植物和蔬菜作物等，热带亚热带物种达上千余种<br>景区内主要景点有勐巴拉娜西热带植物馆、土司堡民族展览馆和恐龙馆、孔雀馆等。景区内森林繁茂，蔓藤缠绕，不失为冬季的好去处。</p>\n<h2 id=\"门票：60元\"><a href=\"#门票：60元\" class=\"headerlink\" title=\"门票：60元\"></a>门票：60元</h2><h2 id=\"乘车线路：\"><a href=\"#乘车线路：\" class=\"headerlink\" title=\"乘车线路：\"></a>乘车线路：</h2><ul>\n<li>1、市区游客可乘坐976路、826路、926路公交车。 </li>\n<li>2、大兴黄村地区的游客可以坐940路公交车<code>朱庄站</code>下车前行200米即到。</li>\n</ul>\n<h1 id=\"北京天文馆\"><a href=\"#北京天文馆\" class=\"headerlink\" title=\"北京天文馆\"></a>北京天文馆</h1><h2 id=\"简介\"><a href=\"#简介\" class=\"headerlink\" title=\"简介\"></a>简介</h2><p>北京天文馆是<code>中国第一座天文馆</code>，馆内有直径23.5米象征天穹的天象厅，中间安装精致的国产大型天象仪，<code>可表演日、月、星辰、流星彗星、日食以及月食等天象</code>。<br>北京天文馆包含<code>A、B两馆</code>，共4个科普剧场。</p>\n<h3 id=\"A馆\"><a href=\"#A馆\" class=\"headerlink\" title=\"A馆\"></a>A馆</h3><ul>\n<li>门厅正中 ： 反映<code>地球自转的傅科摆</code></li>\n<li>西侧展厅 ： 陈列天文知识展览</li>\n<li>东侧演讲厅 ： 经常举行学术交流和普及天文科学知识报告。</li>\n<li>庭院中有两座天文台，其中一座装有口径13厘米的望远镜，可通过它观看月亮、行星、星云、星团，白天观测太阳黑子。</li>\n</ul>\n<h2 id=\"门票：\"><a href=\"#门票：\" class=\"headerlink\" title=\"门票：\"></a>门票：</h2><h3 id=\"10元-人\"><a href=\"#10元-人\" class=\"headerlink\" title=\"10元/人\"></a>10元/人</h3><h3 id=\"天象厅：45元-人\"><a href=\"#天象厅：45元-人\" class=\"headerlink\" title=\"天象厅：45元/人\"></a>天象厅：45元/人</h3><h3 id=\"宇宙剧场：30元-人\"><a href=\"#宇宙剧场：30元-人\" class=\"headerlink\" title=\"宇宙剧场：30元/人\"></a>宇宙剧场：30元/人</h3><h3 id=\"3D剧场、4D剧场：45元-人\"><a href=\"#3D剧场、4D剧场：45元-人\" class=\"headerlink\" title=\"3D剧场、4D剧场：45元/人\"></a>3D剧场、4D剧场：45元/人</h3><h2 id=\"乘车线路：-1\"><a href=\"#乘车线路：-1\" class=\"headerlink\" title=\"乘车线路：\"></a>乘车线路：</h2><p>乘7、15、19、27、65、102、103、105、107、111、319、332、334、347、360、362、534、601、632、634、714、732、808、814、运通104、运通105、运通106、特4路<code>动物园站</code>下;地铁4号线<code>动物园站D</code>出口。</p>\n<h1 id=\"南宫温泉水世界\"><a href=\"#南宫温泉水世界\" class=\"headerlink\" title=\"南宫温泉水世界\"></a>南宫温泉水世界</h1><p>南宫温泉坐落在4A级南宫旅游景区内，这里可是“<code>中国地热第一村</code>”！也是北京最大的一块地热田！温泉水都来自2980米深得地热井，每天出水量为2700吨，温度69—72℃~<br>整座水世界呈热带雨林的风情，里面种满了热带树木、植物，还有数十种汤泉药浴；儿童戏水乐园，漂流、戏水滑道….</p>\n<h2 id=\"路线-1\"><a href=\"#路线-1\" class=\"headerlink\" title=\"路线\"></a>路线</h2><ul>\n<li>地址:北京市丰台区王佐镇南宫南路9号</li>\n<li>自驾：京港澳高速’南宫王佐19A’出口出向北第二个红绿灯右转200米路北</li>\n<li>公交：乘458路,459路,951路,836路直达<code>王佐镇政府站</code>下车</li>\n</ul>\n<h1 id=\"顺景温泉\"><a href=\"#顺景温泉\" class=\"headerlink\" title=\"顺景温泉\"></a>顺景温泉</h1><p>日式汤屋、溶洞、水世界…在帝都，温泉我只服这一家！顺景温泉总占地13万平米，是吉尼斯认证的“<code>全球最大室内温泉</code>”！<br>这里的温泉水非常珍贵！活性矿物质远远高于理疗热矿水浓度标准室内外温泉池相互衔接，清池湖泊、小桥流水…充满着神秘色彩，给人以原始丛林的生态之美。<br>还有千奇百怪、突兀嶙峋的溶洞。置身于顺景的溶洞景观中，仿入梦境。满眼都是数万年的各异钟乳石、石笋，一切都分外神秘与美丽！    </p>\n<h2 id=\"人均：240元左右-人\"><a href=\"#人均：240元左右-人\" class=\"headerlink\" title=\"人均：240元左右/人\"></a>人均：240元左右/人</h2><h2 id=\"路线-2\"><a href=\"#路线-2\" class=\"headerlink\" title=\"路线\"></a>路线</h2><ul>\n<li>地址：朝阳区北四环东路2号</li>\n<li>电话：010-84420088 010-85696688</li>\n<li>乘车路线：847路、131路、401路、404路、641路公交在<code>四元桥西站</code>下车，步行至酒店。</li>\n</ul>\n<h1 id=\"X先生密室\"><a href=\"#X先生密室\" class=\"headerlink\" title=\"X先生密室\"></a>X先生密室</h1><p>X先生密室是一家大型真人密室逃脱游戏场所，致力于打造最全面的融合紧张刺激，需要玩家在房间中寻找线索，通过合作找出所有线索，交流和思考解开全部谜题，一步一步的走近最终答案，最终逃出密室。<br>绝对属于高科技范儿的密室逃脱，连实景岩洞、水池皮划都能在神秘屋里体验到。解开谜题的钥匙可能藏在任何物件里，有可能你身上穿的衣服也能帮你逃出牢笼。</p>\n<h2 id=\"人均消费：140元\"><a href=\"#人均消费：140元\" class=\"headerlink\" title=\"人均消费：140元\"></a>人均消费：140元</h2><h2 id=\"路线-3\"><a href=\"#路线-3\" class=\"headerlink\" title=\"路线\"></a>路线</h2><ul>\n<li>地址：朝阳区 工体北路13号世茂广场·工三 2层(工体北门对面)。</li>\n<li>营业时间：10:00—2:20(22:30之后来店需提前电话咨询)</li>\n<li>电话：4008598298。</li>\n</ul>\n<h1 id=\"北京自然博物馆\"><a href=\"#北京自然博物馆\" class=\"headerlink\" title=\"北京自然博物馆\"></a>北京自然博物馆</h1><p>如果不知道该如何打发时间，就来位于天桥南侧的北京自然博物馆吧~ 里面有各种动、植物标本、恐龙骨架、人体知识、小小水族馆….在这里，时间仿佛是静止的，不知孩子，大人也能玩的不亦乐乎~<br>有恐龙的化石骨骼，有恐龙的仿真模型，那些模型十分逼真，甚至有的还可以发出恐龙的叫声~<br>还有小小的海洋世界，没有太平洋富国海底世界那么大，只是一个不大的走廊，但是你也可以看到很多的海洋动植物~ 如果小朋友来这里，真的能疯玩一整天！</p>\n<h2 id=\"门票：门票免费，至少需提前一天预约，不能预约当日参观门票\"><a href=\"#门票：门票免费，至少需提前一天预约，不能预约当日参观门票\" class=\"headerlink\" title=\"门票：门票免费，至少需提前一天预约，不能预约当日参观门票\"></a>门票：门票免费，至少需提前一天预约，不能预约当日参观门票</h2><h2 id=\"路线-4\"><a href=\"#路线-4\" class=\"headerlink\" title=\"路线\"></a>路线</h2><ul>\n<li>地址：北京市东城区天桥南大街126号</li>\n<li>公交7路, 17路, 20路, 35路, 36路, 69路, 71路, 72路<code>天桥西门</code>下车</li>\n<li>地铁：地铁7号线 <code>珠市口站</code></li>\n</ul>\n<h1 id=\"地质博物馆\"><a href=\"#地质博物馆\" class=\"headerlink\" title=\"地质博物馆\"></a>地质博物馆</h1><p>中国地质博物馆是<code>中国成立最早的地质学博物馆</code>，创建于1916年，以其典藏系统、成果丰硕、陈列精美称雄于亚洲同类博物馆，并且在世界范围内享有盛誉。<br>中国地质博物馆收藏地质标本20余万件，涵盖地学各个领域。其中有蜚声海内外的<code>巨型山东龙</code>、<code>中华龙鸟等恐龙系列化石</code>，<code>北京人</code>、<code>元谋人</code>、<code>山顶洞人</code>等著名古人类化石等。</p>\n<h2 id=\"门票：30元\"><a href=\"#门票：30元\" class=\"headerlink\" title=\"门票：30元\"></a>门票：30元</h2><h2 id=\"乘车线路：-2\"><a href=\"#乘车线路：-2\" class=\"headerlink\" title=\"乘车线路：\"></a>乘车线路：</h2><p>市内交通：乘13、22、38、47、68、101、102、103、105、109、124、409、603、709、726、806、808、812、814、823、826、846、850路公共汽车西四站下</p>\n<h1 id=\"世界花卉大观园\"><a href=\"#世界花卉大观园\" class=\"headerlink\" title=\"世界花卉大观园\"></a>世界花卉大观园</h1><p>世界花卉大观园位于北京南四环辅路北侧，京开公路东侧，全园41.8公顷，是<code>北京市四环以内最大的植物园</code>。<br>世界花卉大观园景观由<code>七大温室</code>和<code>十五个花园广场</code>组成。各温室内的植物千奇百怪、花锦簇。<br>热带植物馆中有数百年的佛肚树、重阳木、古榕树等乔木1800余种；沙生植物温室有上百种仙人掌、仙人球；精品花卉厅有生动风趣的植物生肖园、精品盆景园等等。</p>\n<h2 id=\"门票：60元-1\"><a href=\"#门票：60元-1\" class=\"headerlink\" title=\"门票：60元\"></a>门票：60元</h2><h2 id=\"乘车线路：-3\"><a href=\"#乘车线路：-3\" class=\"headerlink\" title=\"乘车线路：\"></a>乘车线路：</h2><p>4号线<code>公益西桥站</code>下车换乘646路到<code>世界花卉大观园站</code>下车。</p>"},{"title":"记录有北京游玩的链接","toc":true,"date":"2017-12-22T15:51:55.000Z","scaffolds":null,"_content":"[发愁冬天去哪玩？北京这10个地方好玩还不冷！周末约起~](http://www.360doc.com/content/16/1202/06/38518105_611197220.shtml)\n\n\n\n\n\n\n\n","source":"_posts/其他/记录有北京游玩的链接.md","raw":"---\ntitle: 记录有北京游玩的链接\ncategories: 玩\ntags:\n  - 北京\n  - 游玩\ntoc: true\ndate: 2017-12-22 23:51:55\nscaffolds:\n---\n[发愁冬天去哪玩？北京这10个地方好玩还不冷！周末约起~](http://www.360doc.com/content/16/1202/06/38518105_611197220.shtml)\n\n\n\n\n\n\n\n","slug":"其他/记录有北京游玩的链接","published":1,"updated":"2017-12-22T15:54:43.950Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjcsq4lf5000cx4vfxtu7ar9z","content":"<p><a href=\"http://www.360doc.com/content/16/1202/06/38518105_611197220.shtml\" target=\"_blank\" rel=\"external\">发愁冬天去哪玩？北京这10个地方好玩还不冷！周末约起~</a></p>\n","site":{"data":{}},"excerpt":"","more":"<p><a href=\"http://www.360doc.com/content/16/1202/06/38518105_611197220.shtml\" target=\"_blank\" rel=\"external\">发愁冬天去哪玩？北京这10个地方好玩还不冷！周末约起~</a></p>\n"},{"title":"大数据02-01-1 linux本地yum库","toc":true,"date":"2017-11-14T13:58:01.000Z","scaffolds":null,"_content":"# 本地yum仓库的安装配置\n## 两种方式：  \n### 每一台机器都配一个本地文件系统上的yum仓库 file:///packege/path/\n### 在局域网内部配置一台节点(server-base)的本地文件系统yum仓库，然后将其发布到web服务器中，其他节点就可以通过http://server-base/pagekege/path/\n<!-- more -->\n\n- 制作流程：  \n- 先挑选一台机器mini4，挂载一个系统光盘到本地目录/mnt/cdrom，\n- 然后启动一个httpd服务器，\n- 将/mnt/cdrom 软连接到httpd服务器的/var/www/html目录中 (cd /var/www/html; ln -s /mnt/cdrom ./centos )\n- 然后通过网页访问测试一下：  http://mini4/centos   会看到光盘的目录内容\n\n至此：网络版yum私有仓库已经建立完毕  \n剩下就是去各台yum的客户端配置这个http地址到repo配置文件中\n\t\t\t\n\n\t\t\t\n\n\t\t\t\n# 无论哪种配置，都需要先将光盘挂在到本地文件目录中\n> mount -t iso9660 /dev/cdrom   /mnt/cdrom\n\n为了避免每次重启后都要手动mount，可以在/etc/fstab中加入一行挂载配置，即可自动挂载\n```\nvi  /etc/fstab\n/dev/cdrom              /mnt/cdrom              iso9660 defaults        0 0\t\t\n```\t\n\n# minimal安装的系统出现的问题：缺各种命令，安装软件时缺各种依赖\n\nscp命令都没有：yum install -y openssh-clients\n每台机器上都要安装才行\n\n\n\t\t\t","source":"_posts/大数据/大数据02-01-1-linux本地yum库.md","raw":"---\ntitle: 大数据02-01-1 linux本地yum库\ncategories: 学习\ntags:\n  - 大数据\n  - linux\n  - centos7\ntoc: true\ndate: 2017-11-14 21:58:01\nscaffolds:\n---\n# 本地yum仓库的安装配置\n## 两种方式：  \n### 每一台机器都配一个本地文件系统上的yum仓库 file:///packege/path/\n### 在局域网内部配置一台节点(server-base)的本地文件系统yum仓库，然后将其发布到web服务器中，其他节点就可以通过http://server-base/pagekege/path/\n<!-- more -->\n\n- 制作流程：  \n- 先挑选一台机器mini4，挂载一个系统光盘到本地目录/mnt/cdrom，\n- 然后启动一个httpd服务器，\n- 将/mnt/cdrom 软连接到httpd服务器的/var/www/html目录中 (cd /var/www/html; ln -s /mnt/cdrom ./centos )\n- 然后通过网页访问测试一下：  http://mini4/centos   会看到光盘的目录内容\n\n至此：网络版yum私有仓库已经建立完毕  \n剩下就是去各台yum的客户端配置这个http地址到repo配置文件中\n\t\t\t\n\n\t\t\t\n\n\t\t\t\n# 无论哪种配置，都需要先将光盘挂在到本地文件目录中\n> mount -t iso9660 /dev/cdrom   /mnt/cdrom\n\n为了避免每次重启后都要手动mount，可以在/etc/fstab中加入一行挂载配置，即可自动挂载\n```\nvi  /etc/fstab\n/dev/cdrom              /mnt/cdrom              iso9660 defaults        0 0\t\t\n```\t\n\n# minimal安装的系统出现的问题：缺各种命令，安装软件时缺各种依赖\n\nscp命令都没有：yum install -y openssh-clients\n每台机器上都要安装才行\n\n\n\t\t\t","slug":"大数据/大数据02-01-1-linux本地yum库","published":1,"updated":"2017-11-14T15:07:55.300Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjcsq4lf7000fx4vfjicqj8rg","content":"<h1 id=\"本地yum仓库的安装配置\"><a href=\"#本地yum仓库的安装配置\" class=\"headerlink\" title=\"本地yum仓库的安装配置\"></a>本地yum仓库的安装配置</h1><h2 id=\"两种方式：\"><a href=\"#两种方式：\" class=\"headerlink\" title=\"两种方式：\"></a>两种方式：</h2><h3 id=\"每一台机器都配一个本地文件系统上的yum仓库-file-packege-path\"><a href=\"#每一台机器都配一个本地文件系统上的yum仓库-file-packege-path\" class=\"headerlink\" title=\"每一台机器都配一个本地文件系统上的yum仓库 file:///packege/path/\"></a>每一台机器都配一个本地文件系统上的yum仓库 file:///packege/path/</h3><h3 id=\"在局域网内部配置一台节点-server-base-的本地文件系统yum仓库，然后将其发布到web服务器中，其他节点就可以通过http-server-base-pagekege-path\"><a href=\"#在局域网内部配置一台节点-server-base-的本地文件系统yum仓库，然后将其发布到web服务器中，其他节点就可以通过http-server-base-pagekege-path\" class=\"headerlink\" title=\"在局域网内部配置一台节点(server-base)的本地文件系统yum仓库，然后将其发布到web服务器中，其他节点就可以通过http://server-base/pagekege/path/\"></a>在局域网内部配置一台节点(server-base)的本地文件系统yum仓库，然后将其发布到web服务器中，其他节点就可以通过<a href=\"http://server-base/pagekege/path/\" target=\"_blank\" rel=\"external\">http://server-base/pagekege/path/</a></h3><a id=\"more\"></a>\n<ul>\n<li>制作流程：  </li>\n<li>先挑选一台机器mini4，挂载一个系统光盘到本地目录/mnt/cdrom，</li>\n<li>然后启动一个httpd服务器，</li>\n<li>将/mnt/cdrom 软连接到httpd服务器的/var/www/html目录中 (cd /var/www/html; ln -s /mnt/cdrom ./centos )</li>\n<li>然后通过网页访问测试一下：  <a href=\"http://mini4/centos\" target=\"_blank\" rel=\"external\">http://mini4/centos</a>   会看到光盘的目录内容</li>\n</ul>\n<p>至此：网络版yum私有仓库已经建立完毕<br>剩下就是去各台yum的客户端配置这个http地址到repo配置文件中</p>\n<h1 id=\"无论哪种配置，都需要先将光盘挂在到本地文件目录中\"><a href=\"#无论哪种配置，都需要先将光盘挂在到本地文件目录中\" class=\"headerlink\" title=\"无论哪种配置，都需要先将光盘挂在到本地文件目录中\"></a>无论哪种配置，都需要先将光盘挂在到本地文件目录中</h1><blockquote>\n<p>mount -t iso9660 /dev/cdrom   /mnt/cdrom</p>\n</blockquote>\n<p>为了避免每次重启后都要手动mount，可以在/etc/fstab中加入一行挂载配置，即可自动挂载</p>\n<pre><code>vi  /etc/fstab\n/dev/cdrom              /mnt/cdrom              iso9660 defaults        0 0\n</code></pre><h1 id=\"minimal安装的系统出现的问题：缺各种命令，安装软件时缺各种依赖\"><a href=\"#minimal安装的系统出现的问题：缺各种命令，安装软件时缺各种依赖\" class=\"headerlink\" title=\"minimal安装的系统出现的问题：缺各种命令，安装软件时缺各种依赖\"></a>minimal安装的系统出现的问题：缺各种命令，安装软件时缺各种依赖</h1><p>scp命令都没有：yum install -y openssh-clients<br>每台机器上都要安装才行</p>\n","site":{"data":{}},"excerpt":"<h1 id=\"本地yum仓库的安装配置\"><a href=\"#本地yum仓库的安装配置\" class=\"headerlink\" title=\"本地yum仓库的安装配置\"></a>本地yum仓库的安装配置</h1><h2 id=\"两种方式：\"><a href=\"#两种方式：\" class=\"headerlink\" title=\"两种方式：\"></a>两种方式：</h2><h3 id=\"每一台机器都配一个本地文件系统上的yum仓库-file-packege-path\"><a href=\"#每一台机器都配一个本地文件系统上的yum仓库-file-packege-path\" class=\"headerlink\" title=\"每一台机器都配一个本地文件系统上的yum仓库 file:///packege/path/\"></a>每一台机器都配一个本地文件系统上的yum仓库 file:///packege/path/</h3><h3 id=\"在局域网内部配置一台节点-server-base-的本地文件系统yum仓库，然后将其发布到web服务器中，其他节点就可以通过http-server-base-pagekege-path\"><a href=\"#在局域网内部配置一台节点-server-base-的本地文件系统yum仓库，然后将其发布到web服务器中，其他节点就可以通过http-server-base-pagekege-path\" class=\"headerlink\" title=\"在局域网内部配置一台节点(server-base)的本地文件系统yum仓库，然后将其发布到web服务器中，其他节点就可以通过http://server-base/pagekege/path/\"></a>在局域网内部配置一台节点(server-base)的本地文件系统yum仓库，然后将其发布到web服务器中，其他节点就可以通过<a href=\"http://server-base/pagekege/path/\" target=\"_blank\" rel=\"external\">http://server-base/pagekege/path/</a></h3>","more":"<ul>\n<li>制作流程：  </li>\n<li>先挑选一台机器mini4，挂载一个系统光盘到本地目录/mnt/cdrom，</li>\n<li>然后启动一个httpd服务器，</li>\n<li>将/mnt/cdrom 软连接到httpd服务器的/var/www/html目录中 (cd /var/www/html; ln -s /mnt/cdrom ./centos )</li>\n<li>然后通过网页访问测试一下：  <a href=\"http://mini4/centos\" target=\"_blank\" rel=\"external\">http://mini4/centos</a>   会看到光盘的目录内容</li>\n</ul>\n<p>至此：网络版yum私有仓库已经建立完毕<br>剩下就是去各台yum的客户端配置这个http地址到repo配置文件中</p>\n<h1 id=\"无论哪种配置，都需要先将光盘挂在到本地文件目录中\"><a href=\"#无论哪种配置，都需要先将光盘挂在到本地文件目录中\" class=\"headerlink\" title=\"无论哪种配置，都需要先将光盘挂在到本地文件目录中\"></a>无论哪种配置，都需要先将光盘挂在到本地文件目录中</h1><blockquote>\n<p>mount -t iso9660 /dev/cdrom   /mnt/cdrom</p>\n</blockquote>\n<p>为了避免每次重启后都要手动mount，可以在/etc/fstab中加入一行挂载配置，即可自动挂载</p>\n<pre><code>vi  /etc/fstab\n/dev/cdrom              /mnt/cdrom              iso9660 defaults        0 0\n</code></pre><h1 id=\"minimal安装的系统出现的问题：缺各种命令，安装软件时缺各种依赖\"><a href=\"#minimal安装的系统出现的问题：缺各种命令，安装软件时缺各种依赖\" class=\"headerlink\" title=\"minimal安装的系统出现的问题：缺各种命令，安装软件时缺各种依赖\"></a>minimal安装的系统出现的问题：缺各种命令，安装软件时缺各种依赖</h1><p>scp命令都没有：yum install -y openssh-clients<br>每台机器上都要安装才行</p>"},{"title":"大数据01-linux安装及基本命令.md","toc":true,"date":"2017-10-30T14:30:38.000Z","scaffolds":null,"_content":"\n# linux 文件目录\n> 约定俗成\n\n目录 | 功能\n------- | -------\n/bin | 可执行文件\n/sbin | 系统可执行文件\n/boot | 跟启动相关的东西\n/dev | 设备 硬件\n/etc | 配置文件 \n/lib | 依赖包\n/lib64 | 依赖包\n/media | 一些外接设备\n/mnt | 挂载\n/home | 用户目录\n/usr | user share resource 公用的一些软件\n/tmp | 临时文件\n<!-- more -->\n# linux 网络相关\n## 网卡相关:\n1. ip ：一般 1 给网关  255是广播地址\n2. gateway ： 网关\n3. netmask ： 子网掩码\n4. dns ：\n\n### 子网掩码\n是用来判断自己属于哪个网段\n\n网段的计算:\n将IP地址的二进制 & 子网掩码的二进制 = 网段地址\n例如：192.168.33.2 & 255.255.255.0 = 192.168.33.0\n### dns 域名解析\n1. 从本地hosts中寻找域名 -> ip映射信息\n2. 如果没有则去服务器找\n3. 访问服务器\n\n填写:\n1. 网关地址\n2. dns服务器\n\n![域名工作流程](http://ovasdkxqr.bkt.clouddn.com/dashuju/%E5%9F%9F%E5%90%8D%E6%9C%8D%E5%8A%A1%E7%9A%84%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B.png)\n\nlinux dns配置文件\n> /etc/hosts\n\n## 网络模式\n### NAT模式  \n![NAT模式图](http://ovasdkxqr.bkt.clouddn.com/dashuju/NAT虚拟网络配置.png)  \n### 桥接模式  \n![桥接模式图](http://ovasdkxqr.bkt.clouddn.com/dashuju/ssh%E5%85%8D%E5%AF%86%E7%99%BB%E9%99%86%E6%9C%BA%E5%88%B6%E7%A4%BA%E6%84%8F%E5%9B%BE.png)\n### HOST only  \n![host only](http://ovasdkxqr.bkt.clouddn.com/dashuju/%E6%A1%A5%E6%8E%A5%E5%92%8Chostonly%E8%99%9A%E6%8B%9F%E7%BD%91%E7%BB%9C%E9%85%8D%E7%BD%AE.png)\n\n## 修改linux ip\n修改主机名:  \n> vi /etc/sysconfig/network  \n    NETWORKING=yes\n    HOSTNAME=server1.itcast.cn\n\n修改IP地址  \nvi /etc/sysconfig/network-scripts/ifcfg-eth0  \n\n    DEVICE=eth0\n    TYPE=Ethernet\n    ONBOOT=yes          #是否开机启用\n    BOOTPROTO=static    #ip地址设置为静态\n    IPADDR=192.168.0.101\n    NETMASK=255.255.255.0\n\n修改ip地址和主机名的映射关系  \nvi /etc/hosts  \n\n    127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4\n    ::1         localhost localhost.localdomain localhost6 localhost6.localdomain6\n    192.168.0.101 server1.itcast.cn\n\n关闭iptables并设置其开机启动/不启动  \n\n    service iptables stop\n    chkconfig iptables on\n    chkconfig iptables off\n\n# linux 简单命令\n创建文件\ntouch somefile.1 创建一个空文本\necho \"i love u\" **>** somefile.2 利用重定向写入 覆盖原文件\necho \"i love u\" **>>** somefile.2 追加\n\nctrl+v进入块选择模式\nshift+v 进入行选择模式\n\n:%s/key/newword 查找并替换\n\n## 文件权限操作\ndrw-r--r--\n\nd：标识节点类型（d 文件夹 - 文件 l 链接)\nr 可读 w可写 x可执行\n拥有者 所属组 其他用户\n\n方式1 :\nchmod g-rw somefile.1\n\ng 组 o 其他 u用户  +-(增加/删除权限)  rwx\n\n方式2 : \nchmod 700 somfile.1\n\n文件夹及下面文件\n\nchmod -R 770 aaa/\n\n修改所有者(必须要root用户)\nchown angela:angela aaa/   组/用户\n\n## 基本的用户管理\n添加用户\n\nuseradd nagela\n修改密码\npasswd nagela 按提示输入密码即可\n\nsudo useradd xiaobai\n\n为用户配置sudo权限\n用root编辑 \nvi /etc/sudoers \n在文件如下位置,为hadoop添加一行即可\nroot ALL=(ALL) ALL  \nhadoop ALL=(ALL) ALL  \n\n## 系统管理操作\n1.查看主机名\nhostname\n\n2.修改主机名(重启后无效)\nhostname hadoop\n\n3.修改主机名(重启后永久生效)\nvi /ect/sysconfig/network\n\n4.修改IP(重启后无效)\nifconfig eth0 192.168.12.22\n\n5.修改IP(重启后永久生效)\nvi /etc/sysconfig/network-scripts/ifcfg-eth0\n\n6.查看系统信息\nuname -a\nuname -r\n\n7.查看ID命令\nid -u\nid -g\n\n8.日期\ndate\ndate +%Y-%m-%d\ndate +%T\ndate +%Y-%m-%d\" \"%T\n\n9.日历\ncal 2012\n\n10.查看文件信息\nfile filename\n\n11.挂载硬盘\nmount\numount\n加载windows共享\nmount -t cifs //192.168.1.100/tools /mnt\n\n挂载cdrom 里面是iso镜像文件\n```\nmount -t iso9660 -o ro /dev/cdrom /mnt/cdrom\n[root@server1 mnt]# ll cdrom/\ntotal 654\n-rw-r--r-- 1 root root     14 Dec  5  2016 CentOS_BuildTag\ndrwxr-xr-x 3 root root   2048 Dec  5  2016 EFI\n-rw-r--r-- 1 root root    215 Dec  9  2015 EULA\n-rw-r--r-- 1 root root  18009 Dec  9  2015 GPL\ndrwxr-xr-x 3 root root   2048 Dec  5  2016 images\ndrwxr-xr-x 2 root root   2048 Dec  5  2016 isolinux\ndrwxr-xr-x 2 root root   2048 Dec  5  2016 LiveOS\ndrwxrwxr-x 2 root root 630784 Dec  5  2016 Packages\ndrwxrwxr-x 2 root root   4096 Dec  5  2016 repodata\n-rw-r--r-- 1 root root   1690 Dec  9  2015 RPM-GPG-KEY-CentOS-7\n-rw-r--r-- 1 root root   1690 Dec  9  2015 RPM-GPG-KEY-CentOS-Testing-7\n-r--r--r-- 1 root root   2883 Dec  5  2016 TRANS.TBL\n```\n\n12.查看文件大小\ndu -h\ndu -ah\n\n13.查看分区\ndf -h\n\n14.ssh\nssh hadoop@192.168.1.1\n\n15.关机\nshutdown -h now /init 0\nshutdown -r now /reboot\n\n\n# ssh免密登录\n![](http://ovasdkxqr.bkt.clouddn.com/dashuju/ssh%E5%85%8D%E5%AF%86%E7%99%BB%E9%99%86%E6%9C%BA%E5%88%B6%E7%A4%BA%E6%84%8F%E5%9B%BE.png)\n\n假如 A  要登陆  B\n在A上操作：\n首先生成密钥对\n\n    ssh-keygen   (提示时，直接回车即可)\n再将A自己的公钥拷贝并追加到B的授权列表文件authorized_keys中\n\n    ssh-copy-id   B\n\n\n\n","source":"_posts/大数据/大数据01-linux安装及基本命令.md","raw":"---\ntitle: 大数据01-linux安装及基本命令.md\ncategories: 大数据学习笔记\ntags: [linux,大数据,linux命令]\ntoc: true\ndate: 2017-10-30 22:30:38\nscaffolds:\n---\n\n# linux 文件目录\n> 约定俗成\n\n目录 | 功能\n------- | -------\n/bin | 可执行文件\n/sbin | 系统可执行文件\n/boot | 跟启动相关的东西\n/dev | 设备 硬件\n/etc | 配置文件 \n/lib | 依赖包\n/lib64 | 依赖包\n/media | 一些外接设备\n/mnt | 挂载\n/home | 用户目录\n/usr | user share resource 公用的一些软件\n/tmp | 临时文件\n<!-- more -->\n# linux 网络相关\n## 网卡相关:\n1. ip ：一般 1 给网关  255是广播地址\n2. gateway ： 网关\n3. netmask ： 子网掩码\n4. dns ：\n\n### 子网掩码\n是用来判断自己属于哪个网段\n\n网段的计算:\n将IP地址的二进制 & 子网掩码的二进制 = 网段地址\n例如：192.168.33.2 & 255.255.255.0 = 192.168.33.0\n### dns 域名解析\n1. 从本地hosts中寻找域名 -> ip映射信息\n2. 如果没有则去服务器找\n3. 访问服务器\n\n填写:\n1. 网关地址\n2. dns服务器\n\n![域名工作流程](http://ovasdkxqr.bkt.clouddn.com/dashuju/%E5%9F%9F%E5%90%8D%E6%9C%8D%E5%8A%A1%E7%9A%84%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B.png)\n\nlinux dns配置文件\n> /etc/hosts\n\n## 网络模式\n### NAT模式  \n![NAT模式图](http://ovasdkxqr.bkt.clouddn.com/dashuju/NAT虚拟网络配置.png)  \n### 桥接模式  \n![桥接模式图](http://ovasdkxqr.bkt.clouddn.com/dashuju/ssh%E5%85%8D%E5%AF%86%E7%99%BB%E9%99%86%E6%9C%BA%E5%88%B6%E7%A4%BA%E6%84%8F%E5%9B%BE.png)\n### HOST only  \n![host only](http://ovasdkxqr.bkt.clouddn.com/dashuju/%E6%A1%A5%E6%8E%A5%E5%92%8Chostonly%E8%99%9A%E6%8B%9F%E7%BD%91%E7%BB%9C%E9%85%8D%E7%BD%AE.png)\n\n## 修改linux ip\n修改主机名:  \n> vi /etc/sysconfig/network  \n    NETWORKING=yes\n    HOSTNAME=server1.itcast.cn\n\n修改IP地址  \nvi /etc/sysconfig/network-scripts/ifcfg-eth0  \n\n    DEVICE=eth0\n    TYPE=Ethernet\n    ONBOOT=yes          #是否开机启用\n    BOOTPROTO=static    #ip地址设置为静态\n    IPADDR=192.168.0.101\n    NETMASK=255.255.255.0\n\n修改ip地址和主机名的映射关系  \nvi /etc/hosts  \n\n    127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4\n    ::1         localhost localhost.localdomain localhost6 localhost6.localdomain6\n    192.168.0.101 server1.itcast.cn\n\n关闭iptables并设置其开机启动/不启动  \n\n    service iptables stop\n    chkconfig iptables on\n    chkconfig iptables off\n\n# linux 简单命令\n创建文件\ntouch somefile.1 创建一个空文本\necho \"i love u\" **>** somefile.2 利用重定向写入 覆盖原文件\necho \"i love u\" **>>** somefile.2 追加\n\nctrl+v进入块选择模式\nshift+v 进入行选择模式\n\n:%s/key/newword 查找并替换\n\n## 文件权限操作\ndrw-r--r--\n\nd：标识节点类型（d 文件夹 - 文件 l 链接)\nr 可读 w可写 x可执行\n拥有者 所属组 其他用户\n\n方式1 :\nchmod g-rw somefile.1\n\ng 组 o 其他 u用户  +-(增加/删除权限)  rwx\n\n方式2 : \nchmod 700 somfile.1\n\n文件夹及下面文件\n\nchmod -R 770 aaa/\n\n修改所有者(必须要root用户)\nchown angela:angela aaa/   组/用户\n\n## 基本的用户管理\n添加用户\n\nuseradd nagela\n修改密码\npasswd nagela 按提示输入密码即可\n\nsudo useradd xiaobai\n\n为用户配置sudo权限\n用root编辑 \nvi /etc/sudoers \n在文件如下位置,为hadoop添加一行即可\nroot ALL=(ALL) ALL  \nhadoop ALL=(ALL) ALL  \n\n## 系统管理操作\n1.查看主机名\nhostname\n\n2.修改主机名(重启后无效)\nhostname hadoop\n\n3.修改主机名(重启后永久生效)\nvi /ect/sysconfig/network\n\n4.修改IP(重启后无效)\nifconfig eth0 192.168.12.22\n\n5.修改IP(重启后永久生效)\nvi /etc/sysconfig/network-scripts/ifcfg-eth0\n\n6.查看系统信息\nuname -a\nuname -r\n\n7.查看ID命令\nid -u\nid -g\n\n8.日期\ndate\ndate +%Y-%m-%d\ndate +%T\ndate +%Y-%m-%d\" \"%T\n\n9.日历\ncal 2012\n\n10.查看文件信息\nfile filename\n\n11.挂载硬盘\nmount\numount\n加载windows共享\nmount -t cifs //192.168.1.100/tools /mnt\n\n挂载cdrom 里面是iso镜像文件\n```\nmount -t iso9660 -o ro /dev/cdrom /mnt/cdrom\n[root@server1 mnt]# ll cdrom/\ntotal 654\n-rw-r--r-- 1 root root     14 Dec  5  2016 CentOS_BuildTag\ndrwxr-xr-x 3 root root   2048 Dec  5  2016 EFI\n-rw-r--r-- 1 root root    215 Dec  9  2015 EULA\n-rw-r--r-- 1 root root  18009 Dec  9  2015 GPL\ndrwxr-xr-x 3 root root   2048 Dec  5  2016 images\ndrwxr-xr-x 2 root root   2048 Dec  5  2016 isolinux\ndrwxr-xr-x 2 root root   2048 Dec  5  2016 LiveOS\ndrwxrwxr-x 2 root root 630784 Dec  5  2016 Packages\ndrwxrwxr-x 2 root root   4096 Dec  5  2016 repodata\n-rw-r--r-- 1 root root   1690 Dec  9  2015 RPM-GPG-KEY-CentOS-7\n-rw-r--r-- 1 root root   1690 Dec  9  2015 RPM-GPG-KEY-CentOS-Testing-7\n-r--r--r-- 1 root root   2883 Dec  5  2016 TRANS.TBL\n```\n\n12.查看文件大小\ndu -h\ndu -ah\n\n13.查看分区\ndf -h\n\n14.ssh\nssh hadoop@192.168.1.1\n\n15.关机\nshutdown -h now /init 0\nshutdown -r now /reboot\n\n\n# ssh免密登录\n![](http://ovasdkxqr.bkt.clouddn.com/dashuju/ssh%E5%85%8D%E5%AF%86%E7%99%BB%E9%99%86%E6%9C%BA%E5%88%B6%E7%A4%BA%E6%84%8F%E5%9B%BE.png)\n\n假如 A  要登陆  B\n在A上操作：\n首先生成密钥对\n\n    ssh-keygen   (提示时，直接回车即可)\n再将A自己的公钥拷贝并追加到B的授权列表文件authorized_keys中\n\n    ssh-copy-id   B\n\n\n\n","slug":"大数据/大数据01-linux安装及基本命令","published":1,"updated":"2017-11-14T15:13:50.941Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjcsq4lfa000gx4vf78qf7b1g","content":"<h1 id=\"linux-文件目录\"><a href=\"#linux-文件目录\" class=\"headerlink\" title=\"linux 文件目录\"></a>linux 文件目录</h1><blockquote>\n<p>约定俗成</p>\n</blockquote>\n<table>\n<thead>\n<tr>\n<th>目录</th>\n<th>功能</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>/bin</td>\n<td>可执行文件</td>\n</tr>\n<tr>\n<td>/sbin</td>\n<td>系统可执行文件</td>\n</tr>\n<tr>\n<td>/boot</td>\n<td>跟启动相关的东西</td>\n</tr>\n<tr>\n<td>/dev</td>\n<td>设备 硬件</td>\n</tr>\n<tr>\n<td>/etc</td>\n<td>配置文件 </td>\n</tr>\n<tr>\n<td>/lib</td>\n<td>依赖包</td>\n</tr>\n<tr>\n<td>/lib64</td>\n<td>依赖包</td>\n</tr>\n<tr>\n<td>/media</td>\n<td>一些外接设备</td>\n</tr>\n<tr>\n<td>/mnt</td>\n<td>挂载</td>\n</tr>\n<tr>\n<td>/home</td>\n<td>用户目录</td>\n</tr>\n<tr>\n<td>/usr</td>\n<td>user share resource 公用的一些软件</td>\n</tr>\n<tr>\n<td>/tmp</td>\n<td>临时文件</td>\n</tr>\n</tbody>\n</table>\n<a id=\"more\"></a>\n<h1 id=\"linux-网络相关\"><a href=\"#linux-网络相关\" class=\"headerlink\" title=\"linux 网络相关\"></a>linux 网络相关</h1><h2 id=\"网卡相关\"><a href=\"#网卡相关\" class=\"headerlink\" title=\"网卡相关:\"></a>网卡相关:</h2><ol>\n<li>ip ：一般 1 给网关  255是广播地址</li>\n<li>gateway ： 网关</li>\n<li>netmask ： 子网掩码</li>\n<li>dns ：</li>\n</ol>\n<h3 id=\"子网掩码\"><a href=\"#子网掩码\" class=\"headerlink\" title=\"子网掩码\"></a>子网掩码</h3><p>是用来判断自己属于哪个网段</p>\n<p>网段的计算:<br>将IP地址的二进制 &amp; 子网掩码的二进制 = 网段地址<br>例如：192.168.33.2 &amp; 255.255.255.0 = 192.168.33.0</p>\n<h3 id=\"dns-域名解析\"><a href=\"#dns-域名解析\" class=\"headerlink\" title=\"dns 域名解析\"></a>dns 域名解析</h3><ol>\n<li>从本地hosts中寻找域名 -&gt; ip映射信息</li>\n<li>如果没有则去服务器找</li>\n<li>访问服务器</li>\n</ol>\n<p>填写:</p>\n<ol>\n<li>网关地址</li>\n<li>dns服务器</li>\n</ol>\n<p><img src=\"http://ovasdkxqr.bkt.clouddn.com/dashuju/%E5%9F%9F%E5%90%8D%E6%9C%8D%E5%8A%A1%E7%9A%84%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B.png\" alt=\"域名工作流程\"></p>\n<p>linux dns配置文件</p>\n<blockquote>\n<p>/etc/hosts</p>\n</blockquote>\n<h2 id=\"网络模式\"><a href=\"#网络模式\" class=\"headerlink\" title=\"网络模式\"></a>网络模式</h2><h3 id=\"NAT模式\"><a href=\"#NAT模式\" class=\"headerlink\" title=\"NAT模式\"></a>NAT模式</h3><p><img src=\"http://ovasdkxqr.bkt.clouddn.com/dashuju/NAT虚拟网络配置.png\" alt=\"NAT模式图\">  </p>\n<h3 id=\"桥接模式\"><a href=\"#桥接模式\" class=\"headerlink\" title=\"桥接模式\"></a>桥接模式</h3><p><img src=\"http://ovasdkxqr.bkt.clouddn.com/dashuju/ssh%E5%85%8D%E5%AF%86%E7%99%BB%E9%99%86%E6%9C%BA%E5%88%B6%E7%A4%BA%E6%84%8F%E5%9B%BE.png\" alt=\"桥接模式图\"></p>\n<h3 id=\"HOST-only\"><a href=\"#HOST-only\" class=\"headerlink\" title=\"HOST only\"></a>HOST only</h3><p><img src=\"http://ovasdkxqr.bkt.clouddn.com/dashuju/%E6%A1%A5%E6%8E%A5%E5%92%8Chostonly%E8%99%9A%E6%8B%9F%E7%BD%91%E7%BB%9C%E9%85%8D%E7%BD%AE.png\" alt=\"host only\"></p>\n<h2 id=\"修改linux-ip\"><a href=\"#修改linux-ip\" class=\"headerlink\" title=\"修改linux ip\"></a>修改linux ip</h2><p>修改主机名:  </p>\n<blockquote>\n<p>vi /etc/sysconfig/network<br>    NETWORKING=yes<br>    HOSTNAME=server1.itcast.cn</p>\n</blockquote>\n<p>修改IP地址<br>vi /etc/sysconfig/network-scripts/ifcfg-eth0  </p>\n<pre><code>DEVICE=eth0\nTYPE=Ethernet\nONBOOT=yes          #是否开机启用\nBOOTPROTO=static    #ip地址设置为静态\nIPADDR=192.168.0.101\nNETMASK=255.255.255.0\n</code></pre><p>修改ip地址和主机名的映射关系<br>vi /etc/hosts  </p>\n<pre><code>127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4\n::1         localhost localhost.localdomain localhost6 localhost6.localdomain6\n192.168.0.101 server1.itcast.cn\n</code></pre><p>关闭iptables并设置其开机启动/不启动  </p>\n<pre><code>service iptables stop\nchkconfig iptables on\nchkconfig iptables off\n</code></pre><h1 id=\"linux-简单命令\"><a href=\"#linux-简单命令\" class=\"headerlink\" title=\"linux 简单命令\"></a>linux 简单命令</h1><p>创建文件<br>touch somefile.1 创建一个空文本<br>echo “i love u” <strong>&gt;</strong> somefile.2 利用重定向写入 覆盖原文件<br>echo “i love u” <strong>&gt;&gt;</strong> somefile.2 追加</p>\n<p>ctrl+v进入块选择模式<br>shift+v 进入行选择模式</p>\n<p>:%s/key/newword 查找并替换</p>\n<h2 id=\"文件权限操作\"><a href=\"#文件权限操作\" class=\"headerlink\" title=\"文件权限操作\"></a>文件权限操作</h2><p>drw-r–r–</p>\n<p>d：标识节点类型（d 文件夹 - 文件 l 链接)<br>r 可读 w可写 x可执行<br>拥有者 所属组 其他用户</p>\n<p>方式1 :<br>chmod g-rw somefile.1</p>\n<p>g 组 o 其他 u用户  +-(增加/删除权限)  rwx</p>\n<p>方式2 :<br>chmod 700 somfile.1</p>\n<p>文件夹及下面文件</p>\n<p>chmod -R 770 aaa/</p>\n<p>修改所有者(必须要root用户)<br>chown angela:angela aaa/   组/用户</p>\n<h2 id=\"基本的用户管理\"><a href=\"#基本的用户管理\" class=\"headerlink\" title=\"基本的用户管理\"></a>基本的用户管理</h2><p>添加用户</p>\n<p>useradd nagela<br>修改密码<br>passwd nagela 按提示输入密码即可</p>\n<p>sudo useradd xiaobai</p>\n<p>为用户配置sudo权限<br>用root编辑<br>vi /etc/sudoers<br>在文件如下位置,为hadoop添加一行即可<br>root ALL=(ALL) ALL<br>hadoop ALL=(ALL) ALL  </p>\n<h2 id=\"系统管理操作\"><a href=\"#系统管理操作\" class=\"headerlink\" title=\"系统管理操作\"></a>系统管理操作</h2><p>1.查看主机名<br>hostname</p>\n<p>2.修改主机名(重启后无效)<br>hostname hadoop</p>\n<p>3.修改主机名(重启后永久生效)<br>vi /ect/sysconfig/network</p>\n<p>4.修改IP(重启后无效)<br>ifconfig eth0 192.168.12.22</p>\n<p>5.修改IP(重启后永久生效)<br>vi /etc/sysconfig/network-scripts/ifcfg-eth0</p>\n<p>6.查看系统信息<br>uname -a<br>uname -r</p>\n<p>7.查看ID命令<br>id -u<br>id -g</p>\n<p>8.日期<br>date<br>date +%Y-%m-%d<br>date +%T<br>date +%Y-%m-%d” “%T</p>\n<p>9.日历<br>cal 2012</p>\n<p>10.查看文件信息<br>file filename</p>\n<p>11.挂载硬盘<br>mount<br>umount<br>加载windows共享<br>mount -t cifs //192.168.1.100/tools /mnt</p>\n<p>挂载cdrom 里面是iso镜像文件<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div></pre></td><td class=\"code\"><pre><div class=\"line\">mount -t iso9660 -o ro /dev/cdrom /mnt/cdrom</div><div class=\"line\">[root@server1 mnt]# ll cdrom/</div><div class=\"line\">total 654</div><div class=\"line\">-rw-r--r-- 1 root root     14 Dec  5  2016 CentOS_BuildTag</div><div class=\"line\">drwxr-xr-x 3 root root   2048 Dec  5  2016 EFI</div><div class=\"line\">-rw-r--r-- 1 root root    215 Dec  9  2015 EULA</div><div class=\"line\">-rw-r--r-- 1 root root  18009 Dec  9  2015 GPL</div><div class=\"line\">drwxr-xr-x 3 root root   2048 Dec  5  2016 images</div><div class=\"line\">drwxr-xr-x 2 root root   2048 Dec  5  2016 isolinux</div><div class=\"line\">drwxr-xr-x 2 root root   2048 Dec  5  2016 LiveOS</div><div class=\"line\">drwxrwxr-x 2 root root 630784 Dec  5  2016 Packages</div><div class=\"line\">drwxrwxr-x 2 root root   4096 Dec  5  2016 repodata</div><div class=\"line\">-rw-r--r-- 1 root root   1690 Dec  9  2015 RPM-GPG-KEY-CentOS-7</div><div class=\"line\">-rw-r--r-- 1 root root   1690 Dec  9  2015 RPM-GPG-KEY-CentOS-Testing-7</div><div class=\"line\">-r--r--r-- 1 root root   2883 Dec  5  2016 TRANS.TBL</div></pre></td></tr></table></figure></p>\n<p>12.查看文件大小<br>du -h<br>du -ah</p>\n<p>13.查看分区<br>df -h</p>\n<p>14.ssh<br>ssh hadoop@192.168.1.1</p>\n<p>15.关机<br>shutdown -h now /init 0<br>shutdown -r now /reboot</p>\n<h1 id=\"ssh免密登录\"><a href=\"#ssh免密登录\" class=\"headerlink\" title=\"ssh免密登录\"></a>ssh免密登录</h1><p><img src=\"http://ovasdkxqr.bkt.clouddn.com/dashuju/ssh%E5%85%8D%E5%AF%86%E7%99%BB%E9%99%86%E6%9C%BA%E5%88%B6%E7%A4%BA%E6%84%8F%E5%9B%BE.png\" alt=\"\"></p>\n<p>假如 A  要登陆  B<br>在A上操作：<br>首先生成密钥对</p>\n<pre><code>ssh-keygen   (提示时，直接回车即可)\n</code></pre><p>再将A自己的公钥拷贝并追加到B的授权列表文件authorized_keys中</p>\n<pre><code>ssh-copy-id   B\n</code></pre>","site":{"data":{}},"excerpt":"<h1 id=\"linux-文件目录\"><a href=\"#linux-文件目录\" class=\"headerlink\" title=\"linux 文件目录\"></a>linux 文件目录</h1><blockquote>\n<p>约定俗成</p>\n</blockquote>\n<table>\n<thead>\n<tr>\n<th>目录</th>\n<th>功能</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>/bin</td>\n<td>可执行文件</td>\n</tr>\n<tr>\n<td>/sbin</td>\n<td>系统可执行文件</td>\n</tr>\n<tr>\n<td>/boot</td>\n<td>跟启动相关的东西</td>\n</tr>\n<tr>\n<td>/dev</td>\n<td>设备 硬件</td>\n</tr>\n<tr>\n<td>/etc</td>\n<td>配置文件 </td>\n</tr>\n<tr>\n<td>/lib</td>\n<td>依赖包</td>\n</tr>\n<tr>\n<td>/lib64</td>\n<td>依赖包</td>\n</tr>\n<tr>\n<td>/media</td>\n<td>一些外接设备</td>\n</tr>\n<tr>\n<td>/mnt</td>\n<td>挂载</td>\n</tr>\n<tr>\n<td>/home</td>\n<td>用户目录</td>\n</tr>\n<tr>\n<td>/usr</td>\n<td>user share resource 公用的一些软件</td>\n</tr>\n<tr>\n<td>/tmp</td>\n<td>临时文件</td>\n</tr>\n</tbody>\n</table>","more":"<h1 id=\"linux-网络相关\"><a href=\"#linux-网络相关\" class=\"headerlink\" title=\"linux 网络相关\"></a>linux 网络相关</h1><h2 id=\"网卡相关\"><a href=\"#网卡相关\" class=\"headerlink\" title=\"网卡相关:\"></a>网卡相关:</h2><ol>\n<li>ip ：一般 1 给网关  255是广播地址</li>\n<li>gateway ： 网关</li>\n<li>netmask ： 子网掩码</li>\n<li>dns ：</li>\n</ol>\n<h3 id=\"子网掩码\"><a href=\"#子网掩码\" class=\"headerlink\" title=\"子网掩码\"></a>子网掩码</h3><p>是用来判断自己属于哪个网段</p>\n<p>网段的计算:<br>将IP地址的二进制 &amp; 子网掩码的二进制 = 网段地址<br>例如：192.168.33.2 &amp; 255.255.255.0 = 192.168.33.0</p>\n<h3 id=\"dns-域名解析\"><a href=\"#dns-域名解析\" class=\"headerlink\" title=\"dns 域名解析\"></a>dns 域名解析</h3><ol>\n<li>从本地hosts中寻找域名 -&gt; ip映射信息</li>\n<li>如果没有则去服务器找</li>\n<li>访问服务器</li>\n</ol>\n<p>填写:</p>\n<ol>\n<li>网关地址</li>\n<li>dns服务器</li>\n</ol>\n<p><img src=\"http://ovasdkxqr.bkt.clouddn.com/dashuju/%E5%9F%9F%E5%90%8D%E6%9C%8D%E5%8A%A1%E7%9A%84%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B.png\" alt=\"域名工作流程\"></p>\n<p>linux dns配置文件</p>\n<blockquote>\n<p>/etc/hosts</p>\n</blockquote>\n<h2 id=\"网络模式\"><a href=\"#网络模式\" class=\"headerlink\" title=\"网络模式\"></a>网络模式</h2><h3 id=\"NAT模式\"><a href=\"#NAT模式\" class=\"headerlink\" title=\"NAT模式\"></a>NAT模式</h3><p><img src=\"http://ovasdkxqr.bkt.clouddn.com/dashuju/NAT虚拟网络配置.png\" alt=\"NAT模式图\">  </p>\n<h3 id=\"桥接模式\"><a href=\"#桥接模式\" class=\"headerlink\" title=\"桥接模式\"></a>桥接模式</h3><p><img src=\"http://ovasdkxqr.bkt.clouddn.com/dashuju/ssh%E5%85%8D%E5%AF%86%E7%99%BB%E9%99%86%E6%9C%BA%E5%88%B6%E7%A4%BA%E6%84%8F%E5%9B%BE.png\" alt=\"桥接模式图\"></p>\n<h3 id=\"HOST-only\"><a href=\"#HOST-only\" class=\"headerlink\" title=\"HOST only\"></a>HOST only</h3><p><img src=\"http://ovasdkxqr.bkt.clouddn.com/dashuju/%E6%A1%A5%E6%8E%A5%E5%92%8Chostonly%E8%99%9A%E6%8B%9F%E7%BD%91%E7%BB%9C%E9%85%8D%E7%BD%AE.png\" alt=\"host only\"></p>\n<h2 id=\"修改linux-ip\"><a href=\"#修改linux-ip\" class=\"headerlink\" title=\"修改linux ip\"></a>修改linux ip</h2><p>修改主机名:  </p>\n<blockquote>\n<p>vi /etc/sysconfig/network<br>    NETWORKING=yes<br>    HOSTNAME=server1.itcast.cn</p>\n</blockquote>\n<p>修改IP地址<br>vi /etc/sysconfig/network-scripts/ifcfg-eth0  </p>\n<pre><code>DEVICE=eth0\nTYPE=Ethernet\nONBOOT=yes          #是否开机启用\nBOOTPROTO=static    #ip地址设置为静态\nIPADDR=192.168.0.101\nNETMASK=255.255.255.0\n</code></pre><p>修改ip地址和主机名的映射关系<br>vi /etc/hosts  </p>\n<pre><code>127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4\n::1         localhost localhost.localdomain localhost6 localhost6.localdomain6\n192.168.0.101 server1.itcast.cn\n</code></pre><p>关闭iptables并设置其开机启动/不启动  </p>\n<pre><code>service iptables stop\nchkconfig iptables on\nchkconfig iptables off\n</code></pre><h1 id=\"linux-简单命令\"><a href=\"#linux-简单命令\" class=\"headerlink\" title=\"linux 简单命令\"></a>linux 简单命令</h1><p>创建文件<br>touch somefile.1 创建一个空文本<br>echo “i love u” <strong>&gt;</strong> somefile.2 利用重定向写入 覆盖原文件<br>echo “i love u” <strong>&gt;&gt;</strong> somefile.2 追加</p>\n<p>ctrl+v进入块选择模式<br>shift+v 进入行选择模式</p>\n<p>:%s/key/newword 查找并替换</p>\n<h2 id=\"文件权限操作\"><a href=\"#文件权限操作\" class=\"headerlink\" title=\"文件权限操作\"></a>文件权限操作</h2><p>drw-r–r–</p>\n<p>d：标识节点类型（d 文件夹 - 文件 l 链接)<br>r 可读 w可写 x可执行<br>拥有者 所属组 其他用户</p>\n<p>方式1 :<br>chmod g-rw somefile.1</p>\n<p>g 组 o 其他 u用户  +-(增加/删除权限)  rwx</p>\n<p>方式2 :<br>chmod 700 somfile.1</p>\n<p>文件夹及下面文件</p>\n<p>chmod -R 770 aaa/</p>\n<p>修改所有者(必须要root用户)<br>chown angela:angela aaa/   组/用户</p>\n<h2 id=\"基本的用户管理\"><a href=\"#基本的用户管理\" class=\"headerlink\" title=\"基本的用户管理\"></a>基本的用户管理</h2><p>添加用户</p>\n<p>useradd nagela<br>修改密码<br>passwd nagela 按提示输入密码即可</p>\n<p>sudo useradd xiaobai</p>\n<p>为用户配置sudo权限<br>用root编辑<br>vi /etc/sudoers<br>在文件如下位置,为hadoop添加一行即可<br>root ALL=(ALL) ALL<br>hadoop ALL=(ALL) ALL  </p>\n<h2 id=\"系统管理操作\"><a href=\"#系统管理操作\" class=\"headerlink\" title=\"系统管理操作\"></a>系统管理操作</h2><p>1.查看主机名<br>hostname</p>\n<p>2.修改主机名(重启后无效)<br>hostname hadoop</p>\n<p>3.修改主机名(重启后永久生效)<br>vi /ect/sysconfig/network</p>\n<p>4.修改IP(重启后无效)<br>ifconfig eth0 192.168.12.22</p>\n<p>5.修改IP(重启后永久生效)<br>vi /etc/sysconfig/network-scripts/ifcfg-eth0</p>\n<p>6.查看系统信息<br>uname -a<br>uname -r</p>\n<p>7.查看ID命令<br>id -u<br>id -g</p>\n<p>8.日期<br>date<br>date +%Y-%m-%d<br>date +%T<br>date +%Y-%m-%d” “%T</p>\n<p>9.日历<br>cal 2012</p>\n<p>10.查看文件信息<br>file filename</p>\n<p>11.挂载硬盘<br>mount<br>umount<br>加载windows共享<br>mount -t cifs //192.168.1.100/tools /mnt</p>\n<p>挂载cdrom 里面是iso镜像文件<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div></pre></td><td class=\"code\"><pre><div class=\"line\">mount -t iso9660 -o ro /dev/cdrom /mnt/cdrom</div><div class=\"line\">[root@server1 mnt]# ll cdrom/</div><div class=\"line\">total 654</div><div class=\"line\">-rw-r--r-- 1 root root     14 Dec  5  2016 CentOS_BuildTag</div><div class=\"line\">drwxr-xr-x 3 root root   2048 Dec  5  2016 EFI</div><div class=\"line\">-rw-r--r-- 1 root root    215 Dec  9  2015 EULA</div><div class=\"line\">-rw-r--r-- 1 root root  18009 Dec  9  2015 GPL</div><div class=\"line\">drwxr-xr-x 3 root root   2048 Dec  5  2016 images</div><div class=\"line\">drwxr-xr-x 2 root root   2048 Dec  5  2016 isolinux</div><div class=\"line\">drwxr-xr-x 2 root root   2048 Dec  5  2016 LiveOS</div><div class=\"line\">drwxrwxr-x 2 root root 630784 Dec  5  2016 Packages</div><div class=\"line\">drwxrwxr-x 2 root root   4096 Dec  5  2016 repodata</div><div class=\"line\">-rw-r--r-- 1 root root   1690 Dec  9  2015 RPM-GPG-KEY-CentOS-7</div><div class=\"line\">-rw-r--r-- 1 root root   1690 Dec  9  2015 RPM-GPG-KEY-CentOS-Testing-7</div><div class=\"line\">-r--r--r-- 1 root root   2883 Dec  5  2016 TRANS.TBL</div></pre></td></tr></table></figure></p>\n<p>12.查看文件大小<br>du -h<br>du -ah</p>\n<p>13.查看分区<br>df -h</p>\n<p>14.ssh<br>ssh hadoop@192.168.1.1</p>\n<p>15.关机<br>shutdown -h now /init 0<br>shutdown -r now /reboot</p>\n<h1 id=\"ssh免密登录\"><a href=\"#ssh免密登录\" class=\"headerlink\" title=\"ssh免密登录\"></a>ssh免密登录</h1><p><img src=\"http://ovasdkxqr.bkt.clouddn.com/dashuju/ssh%E5%85%8D%E5%AF%86%E7%99%BB%E9%99%86%E6%9C%BA%E5%88%B6%E7%A4%BA%E6%84%8F%E5%9B%BE.png\" alt=\"\"></p>\n<p>假如 A  要登陆  B<br>在A上操作：<br>首先生成密钥对</p>\n<pre><code>ssh-keygen   (提示时，直接回车即可)\n</code></pre><p>再将A自己的公钥拷贝并追加到B的授权列表文件authorized_keys中</p>\n<pre><code>ssh-copy-id   B\n</code></pre>"},{"title":"大数据02-01 linux命令继续学习.md","toc":true,"date":"2017-10-29T14:30:38.000Z","scaffolds":null,"_content":"# vmare克隆后修改地址问题\n解决克隆后eth0不见的问题\n\n直接修改  /etc/sysconfig/network-script/ifcfg-eth0 \n删掉UUID  HWADDR\n配置静态地址\n然后：\n修改 /etc/udev/rules.d/70-persistent-net.rules\n然后 reboot\n<!--more-->\n# linux命令继续学习\n## 查看文件内容\ncat    somefile    一次性将文件内容全部输出（控制台）\nmore   somefile     可以翻页查看, 下翻一页(空格)    上翻一页（b）   退出（q）\nless   somefile      可以翻页查看,下翻一页(空格)    上翻一页（b），上翻一行(↑)  下翻一行（↓）  可以搜索关键字（/keyword）\n\ntail -10  install.log   查看文件尾部的10行\ntail -f install.log    小f跟踪文件的唯一inode号，就算文件改名后，还是跟踪原来这个inode表示的文件\ntail -F install.log    大F按照文件名来跟踪\n\nhead -10  install.log   查看文件头部的10行\n\n## 后台服务管理\nservice network status   查看指定服务的状态\nservice network stop     停止指定服务\nservice network start    启动指定服务\nservice network restart  重启指定服务\nservice --status-all  查看系统中所有的后台服务\n\n## 设置后台服务的自启配置\nchkconfig   查看所有服务器自启配置\nchkconfig iptables off   关掉指定服务的自动启动\nchkconfig iptables on   开启指定服务的自动启动\n\n## 系统启动级别管理\nvi  /etc/inittab\n```\n# Default runlevel. The runlevels used are:\n#   0 - halt (Do NOT set initdefault to this)\n#   1 - Single user mode\n#   2 - Multiuser, without NFS (The same as 3, if you do not have networking)\n#   3 - Full multiuser mode\n#   4 - unused\n#   5 - X11\n#   6 - reboot (Do NOT set initdefault to this)\n#\nid:3:initdefault:\n```\n\n# 软件安装\n\n\n\n## 如何上传安装包到服务器\n\n- 可以使用图形化工具，如： filezilla\n- 可以使用sftp工具：  alt+p 调出后，用put命令上传\n上传（如果不cd指定目录，则上传到当前用户的主目录）：\n```\nsftp> cd /home/   \nsftp> put C:\\Users\\Administrator\\Desktop\\day02\\soft\\jdk-7u45-linux-x64.tar.gz\n```\n下载（lcd[local cd]指定下载到本地的目标路径）\n```\nsftp> lcd d:/                            \nsftp> get /home/jdk-7u45-linux-x64.tar.gz\n```\n\n- lrzsz\n\n\n## 安装jdk\n### 压缩解压缩的相关命令\n压缩解压缩\n\n    root@mini1 ~]# gzip access.log \n    [root@mini1 ~]# ll\n    总用量 134892\n    -rw-r--r--. 1 root root        68 4月   3 17:37 access.log.gz\n\n解压gz文件：  ```gzip -d access.log.gz```\n\n### 打包解包\n```\n[root@mini1 ~]# tar -cvf myfirsttarball.tar aaa/\naaa/\naaa/2.txt\naaa/3.txt\naaa/1.txt\n```\n解包：\n```\n[root@mini1 ~]# tar -xvf myfirsttarball.tar \naaa/\naaa/2.txt\naaa/3.txt\naaa/1.txt\n```\n\n### 一次性完成打包&&压缩的操作\n产生压缩包：\n```\n[root@mini1 ~]# tar -zcvf my.tar.gz aaa/\naaa/\naaa/2.txt\naaa/3.txt\naaa/1.txt\n```\n\n解压缩包：\n```\n[root@mini1 ~]# tar -zxvf my.tar.gz \naaa/\naaa/2.txt\naaa/3.txt\naaa/1.txt\n```\n\n\n### 安装jdk的过程：\n- 解压安装包\n\n    tar -zxvf jdk-7u45-linux-x64.tar.gz -C apps/\n- 然后修改环境变量\n\n    vi /etc/profile  \n    在文件最后添加\n    export JAVA_HOME=/root/apps/jdk1.7.0_45\n    export PATH=$PATH:$JAVA_HOME/bin\n    保存退出\n\n- 然后重新加载环境变量 \n\n    source /etc/profile\n\n\n\n## 安装rpm包软件，如mysql\n### 查看系统中安装的rpm包\n\n    rpm -qa | grep mysql\n\n### 上传rpm安装包\n\n    MySQL-client-5.5.48-1.linux2.6.x86_64.rpm\n    MySQL-server-5.5.48-1.linux2.6.x86_64.rpm\n    per * .rpm\n\n### 安装perl依赖\n\n    rpm -ivh perl*\n_可能会提示有包冲突，解决： rpm -e 冲突包名 --nodeps_\n\n### 安装server\n\n    rpm -ivh MySQL-server-5.5.48-1.linux2.6.x86_64.rpm\n    \n如果成功，会看到进度条，最后，有关于root密码设置的提示，一定要记下来\n这个版本的提示是，先启动server\n\n    service mysql start\n    \n然后```/usr/bin/mysql_secure_installation``` 命令去交互式修改root密码\n\n### 修改密码时，提示需要先安装client\n\n    rpm -ivh MySQL-client-5.5.48-1.linux2.6.x86_64.rpm\n\n客户端安装成功后，记得还要用/usr/bin/mysql_secure_installation 命令去交互式修改root密码\n\n### 登录验证\n\n    mysql -uroot -proot","source":"_posts/大数据/大数据02-01 linux命令继续学习.md","raw":"---\ntitle: 大数据02-01 linux命令继续学习.md\ncategories: 大数据学习笔记\ntags: [大数据,linux,linux命令]\ntoc: true\ndate: 2017-10-29 22:30:38\nscaffolds:\n---\n# vmare克隆后修改地址问题\n解决克隆后eth0不见的问题\n\n直接修改  /etc/sysconfig/network-script/ifcfg-eth0 \n删掉UUID  HWADDR\n配置静态地址\n然后：\n修改 /etc/udev/rules.d/70-persistent-net.rules\n然后 reboot\n<!--more-->\n# linux命令继续学习\n## 查看文件内容\ncat    somefile    一次性将文件内容全部输出（控制台）\nmore   somefile     可以翻页查看, 下翻一页(空格)    上翻一页（b）   退出（q）\nless   somefile      可以翻页查看,下翻一页(空格)    上翻一页（b），上翻一行(↑)  下翻一行（↓）  可以搜索关键字（/keyword）\n\ntail -10  install.log   查看文件尾部的10行\ntail -f install.log    小f跟踪文件的唯一inode号，就算文件改名后，还是跟踪原来这个inode表示的文件\ntail -F install.log    大F按照文件名来跟踪\n\nhead -10  install.log   查看文件头部的10行\n\n## 后台服务管理\nservice network status   查看指定服务的状态\nservice network stop     停止指定服务\nservice network start    启动指定服务\nservice network restart  重启指定服务\nservice --status-all  查看系统中所有的后台服务\n\n## 设置后台服务的自启配置\nchkconfig   查看所有服务器自启配置\nchkconfig iptables off   关掉指定服务的自动启动\nchkconfig iptables on   开启指定服务的自动启动\n\n## 系统启动级别管理\nvi  /etc/inittab\n```\n# Default runlevel. The runlevels used are:\n#   0 - halt (Do NOT set initdefault to this)\n#   1 - Single user mode\n#   2 - Multiuser, without NFS (The same as 3, if you do not have networking)\n#   3 - Full multiuser mode\n#   4 - unused\n#   5 - X11\n#   6 - reboot (Do NOT set initdefault to this)\n#\nid:3:initdefault:\n```\n\n# 软件安装\n\n\n\n## 如何上传安装包到服务器\n\n- 可以使用图形化工具，如： filezilla\n- 可以使用sftp工具：  alt+p 调出后，用put命令上传\n上传（如果不cd指定目录，则上传到当前用户的主目录）：\n```\nsftp> cd /home/   \nsftp> put C:\\Users\\Administrator\\Desktop\\day02\\soft\\jdk-7u45-linux-x64.tar.gz\n```\n下载（lcd[local cd]指定下载到本地的目标路径）\n```\nsftp> lcd d:/                            \nsftp> get /home/jdk-7u45-linux-x64.tar.gz\n```\n\n- lrzsz\n\n\n## 安装jdk\n### 压缩解压缩的相关命令\n压缩解压缩\n\n    root@mini1 ~]# gzip access.log \n    [root@mini1 ~]# ll\n    总用量 134892\n    -rw-r--r--. 1 root root        68 4月   3 17:37 access.log.gz\n\n解压gz文件：  ```gzip -d access.log.gz```\n\n### 打包解包\n```\n[root@mini1 ~]# tar -cvf myfirsttarball.tar aaa/\naaa/\naaa/2.txt\naaa/3.txt\naaa/1.txt\n```\n解包：\n```\n[root@mini1 ~]# tar -xvf myfirsttarball.tar \naaa/\naaa/2.txt\naaa/3.txt\naaa/1.txt\n```\n\n### 一次性完成打包&&压缩的操作\n产生压缩包：\n```\n[root@mini1 ~]# tar -zcvf my.tar.gz aaa/\naaa/\naaa/2.txt\naaa/3.txt\naaa/1.txt\n```\n\n解压缩包：\n```\n[root@mini1 ~]# tar -zxvf my.tar.gz \naaa/\naaa/2.txt\naaa/3.txt\naaa/1.txt\n```\n\n\n### 安装jdk的过程：\n- 解压安装包\n\n    tar -zxvf jdk-7u45-linux-x64.tar.gz -C apps/\n- 然后修改环境变量\n\n    vi /etc/profile  \n    在文件最后添加\n    export JAVA_HOME=/root/apps/jdk1.7.0_45\n    export PATH=$PATH:$JAVA_HOME/bin\n    保存退出\n\n- 然后重新加载环境变量 \n\n    source /etc/profile\n\n\n\n## 安装rpm包软件，如mysql\n### 查看系统中安装的rpm包\n\n    rpm -qa | grep mysql\n\n### 上传rpm安装包\n\n    MySQL-client-5.5.48-1.linux2.6.x86_64.rpm\n    MySQL-server-5.5.48-1.linux2.6.x86_64.rpm\n    per * .rpm\n\n### 安装perl依赖\n\n    rpm -ivh perl*\n_可能会提示有包冲突，解决： rpm -e 冲突包名 --nodeps_\n\n### 安装server\n\n    rpm -ivh MySQL-server-5.5.48-1.linux2.6.x86_64.rpm\n    \n如果成功，会看到进度条，最后，有关于root密码设置的提示，一定要记下来\n这个版本的提示是，先启动server\n\n    service mysql start\n    \n然后```/usr/bin/mysql_secure_installation``` 命令去交互式修改root密码\n\n### 修改密码时，提示需要先安装client\n\n    rpm -ivh MySQL-client-5.5.48-1.linux2.6.x86_64.rpm\n\n客户端安装成功后，记得还要用/usr/bin/mysql_secure_installation 命令去交互式修改root密码\n\n### 登录验证\n\n    mysql -uroot -proot","slug":"大数据/大数据02-01 linux命令继续学习","published":1,"updated":"2017-11-14T15:15:02.319Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjcsq4lfc000hx4vfqexklzlg","content":"<h1 id=\"vmare克隆后修改地址问题\"><a href=\"#vmare克隆后修改地址问题\" class=\"headerlink\" title=\"vmare克隆后修改地址问题\"></a>vmare克隆后修改地址问题</h1><p>解决克隆后eth0不见的问题</p>\n<p>直接修改  /etc/sysconfig/network-script/ifcfg-eth0<br>删掉UUID  HWADDR<br>配置静态地址<br>然后：<br>修改 /etc/udev/rules.d/70-persistent-net.rules<br>然后 reboot<br><a id=\"more\"></a></p>\n<h1 id=\"linux命令继续学习\"><a href=\"#linux命令继续学习\" class=\"headerlink\" title=\"linux命令继续学习\"></a>linux命令继续学习</h1><h2 id=\"查看文件内容\"><a href=\"#查看文件内容\" class=\"headerlink\" title=\"查看文件内容\"></a>查看文件内容</h2><p>cat    somefile    一次性将文件内容全部输出（控制台）<br>more   somefile     可以翻页查看, 下翻一页(空格)    上翻一页（b）   退出（q）<br>less   somefile      可以翻页查看,下翻一页(空格)    上翻一页（b），上翻一行(↑)  下翻一行（↓）  可以搜索关键字（/keyword）</p>\n<p>tail -10  install.log   查看文件尾部的10行<br>tail -f install.log    小f跟踪文件的唯一inode号，就算文件改名后，还是跟踪原来这个inode表示的文件<br>tail -F install.log    大F按照文件名来跟踪</p>\n<p>head -10  install.log   查看文件头部的10行</p>\n<h2 id=\"后台服务管理\"><a href=\"#后台服务管理\" class=\"headerlink\" title=\"后台服务管理\"></a>后台服务管理</h2><p>service network status   查看指定服务的状态<br>service network stop     停止指定服务<br>service network start    启动指定服务<br>service network restart  重启指定服务<br>service –status-all  查看系统中所有的后台服务</p>\n<h2 id=\"设置后台服务的自启配置\"><a href=\"#设置后台服务的自启配置\" class=\"headerlink\" title=\"设置后台服务的自启配置\"></a>设置后台服务的自启配置</h2><p>chkconfig   查看所有服务器自启配置<br>chkconfig iptables off   关掉指定服务的自动启动<br>chkconfig iptables on   开启指定服务的自动启动</p>\n<h2 id=\"系统启动级别管理\"><a href=\"#系统启动级别管理\" class=\"headerlink\" title=\"系统启动级别管理\"></a>系统启动级别管理</h2><p>vi  /etc/inittab<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div></pre></td><td class=\"code\"><pre><div class=\"line\"># Default runlevel. The runlevels used are:</div><div class=\"line\">#   0 - halt (Do NOT set initdefault to this)</div><div class=\"line\">#   1 - Single user mode</div><div class=\"line\">#   2 - Multiuser, without NFS (The same as 3, if you do not have networking)</div><div class=\"line\">#   3 - Full multiuser mode</div><div class=\"line\">#   4 - unused</div><div class=\"line\">#   5 - X11</div><div class=\"line\">#   6 - reboot (Do NOT set initdefault to this)</div><div class=\"line\">#</div><div class=\"line\">id:3:initdefault:</div></pre></td></tr></table></figure></p>\n<h1 id=\"软件安装\"><a href=\"#软件安装\" class=\"headerlink\" title=\"软件安装\"></a>软件安装</h1><h2 id=\"如何上传安装包到服务器\"><a href=\"#如何上传安装包到服务器\" class=\"headerlink\" title=\"如何上传安装包到服务器\"></a>如何上传安装包到服务器</h2><ul>\n<li>可以使用图形化工具，如： filezilla</li>\n<li>可以使用sftp工具：  alt+p 调出后，用put命令上传<br>上传（如果不cd指定目录，则上传到当前用户的主目录）：<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\">sftp&gt; cd /home/   </div><div class=\"line\">sftp&gt; put C:\\Users\\Administrator\\Desktop\\day02\\soft\\jdk-7u45-linux-x64.tar.gz</div></pre></td></tr></table></figure>\n</li>\n</ul>\n<p>下载（lcd[local cd]指定下载到本地的目标路径）<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\">sftp&gt; lcd d:/                            </div><div class=\"line\">sftp&gt; get /home/jdk-7u45-linux-x64.tar.gz</div></pre></td></tr></table></figure></p>\n<ul>\n<li>lrzsz</li>\n</ul>\n<h2 id=\"安装jdk\"><a href=\"#安装jdk\" class=\"headerlink\" title=\"安装jdk\"></a>安装jdk</h2><h3 id=\"压缩解压缩的相关命令\"><a href=\"#压缩解压缩的相关命令\" class=\"headerlink\" title=\"压缩解压缩的相关命令\"></a>压缩解压缩的相关命令</h3><p>压缩解压缩</p>\n<pre><code>root@mini1 ~]# gzip access.log \n[root@mini1 ~]# ll\n总用量 134892\n-rw-r--r--. 1 root root        68 4月   3 17:37 access.log.gz\n</code></pre><p>解压gz文件：  <figure class=\"highlight plain\"><figcaption><span>-d access.log.gz```</span></figcaption><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\"></div><div class=\"line\">### 打包解包</div></pre></td></tr></table></figure></p>\n<p>[root@mini1 ~]# tar -cvf myfirsttarball.tar aaa/<br>aaa/<br>aaa/2.txt<br>aaa/3.txt<br>aaa/1.txt<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">解包：</div></pre></td></tr></table></figure></p>\n<p>[root@mini1 ~]# tar -xvf myfirsttarball.tar<br>aaa/<br>aaa/2.txt<br>aaa/3.txt<br>aaa/1.txt<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\"></div><div class=\"line\">### 一次性完成打包&amp;&amp;压缩的操作</div><div class=\"line\">产生压缩包：</div></pre></td></tr></table></figure></p>\n<p>[root@mini1 ~]# tar -zcvf my.tar.gz aaa/<br>aaa/<br>aaa/2.txt<br>aaa/3.txt<br>aaa/1.txt<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\"></div><div class=\"line\">解压缩包：</div></pre></td></tr></table></figure></p>\n<p>[root@mini1 ~]# tar -zxvf my.tar.gz<br>aaa/<br>aaa/2.txt<br>aaa/3.txt<br>aaa/1.txt<br>```</p>\n<h3 id=\"安装jdk的过程：\"><a href=\"#安装jdk的过程：\" class=\"headerlink\" title=\"安装jdk的过程：\"></a>安装jdk的过程：</h3><ul>\n<li><p>解压安装包</p>\n<p>  tar -zxvf jdk-7u45-linux-x64.tar.gz -C apps/</p>\n</li>\n<li><p>然后修改环境变量</p>\n<p>  vi /etc/profile<br>  在文件最后添加<br>  export JAVA_HOME=/root/apps/jdk1.7.0_45<br>  export PATH=$PATH:$JAVA_HOME/bin<br>  保存退出</p>\n</li>\n<li><p>然后重新加载环境变量 </p>\n<p>  source /etc/profile</p>\n</li>\n</ul>\n<h2 id=\"安装rpm包软件，如mysql\"><a href=\"#安装rpm包软件，如mysql\" class=\"headerlink\" title=\"安装rpm包软件，如mysql\"></a>安装rpm包软件，如mysql</h2><h3 id=\"查看系统中安装的rpm包\"><a href=\"#查看系统中安装的rpm包\" class=\"headerlink\" title=\"查看系统中安装的rpm包\"></a>查看系统中安装的rpm包</h3><pre><code>rpm -qa | grep mysql\n</code></pre><h3 id=\"上传rpm安装包\"><a href=\"#上传rpm安装包\" class=\"headerlink\" title=\"上传rpm安装包\"></a>上传rpm安装包</h3><pre><code>MySQL-client-5.5.48-1.linux2.6.x86_64.rpm\nMySQL-server-5.5.48-1.linux2.6.x86_64.rpm\nper * .rpm\n</code></pre><h3 id=\"安装perl依赖\"><a href=\"#安装perl依赖\" class=\"headerlink\" title=\"安装perl依赖\"></a>安装perl依赖</h3><pre><code>rpm -ivh perl*\n</code></pre><p><em>可能会提示有包冲突，解决： rpm -e 冲突包名 –nodeps</em></p>\n<h3 id=\"安装server\"><a href=\"#安装server\" class=\"headerlink\" title=\"安装server\"></a>安装server</h3><pre><code>rpm -ivh MySQL-server-5.5.48-1.linux2.6.x86_64.rpm\n</code></pre><p>如果成功，会看到进度条，最后，有关于root密码设置的提示，一定要记下来<br>这个版本的提示是，先启动server</p>\n<pre><code>service mysql start\n</code></pre><p>然后<code>/usr/bin/mysql_secure_installation</code> 命令去交互式修改root密码</p>\n<h3 id=\"修改密码时，提示需要先安装client\"><a href=\"#修改密码时，提示需要先安装client\" class=\"headerlink\" title=\"修改密码时，提示需要先安装client\"></a>修改密码时，提示需要先安装client</h3><pre><code>rpm -ivh MySQL-client-5.5.48-1.linux2.6.x86_64.rpm\n</code></pre><p>客户端安装成功后，记得还要用/usr/bin/mysql_secure_installation 命令去交互式修改root密码</p>\n<h3 id=\"登录验证\"><a href=\"#登录验证\" class=\"headerlink\" title=\"登录验证\"></a>登录验证</h3><pre><code>mysql -uroot -proot\n</code></pre>","site":{"data":{}},"excerpt":"<h1 id=\"vmare克隆后修改地址问题\"><a href=\"#vmare克隆后修改地址问题\" class=\"headerlink\" title=\"vmare克隆后修改地址问题\"></a>vmare克隆后修改地址问题</h1><p>解决克隆后eth0不见的问题</p>\n<p>直接修改  /etc/sysconfig/network-script/ifcfg-eth0<br>删掉UUID  HWADDR<br>配置静态地址<br>然后：<br>修改 /etc/udev/rules.d/70-persistent-net.rules<br>然后 reboot<br>","more":"</p>\n<h1 id=\"linux命令继续学习\"><a href=\"#linux命令继续学习\" class=\"headerlink\" title=\"linux命令继续学习\"></a>linux命令继续学习</h1><h2 id=\"查看文件内容\"><a href=\"#查看文件内容\" class=\"headerlink\" title=\"查看文件内容\"></a>查看文件内容</h2><p>cat    somefile    一次性将文件内容全部输出（控制台）<br>more   somefile     可以翻页查看, 下翻一页(空格)    上翻一页（b）   退出（q）<br>less   somefile      可以翻页查看,下翻一页(空格)    上翻一页（b），上翻一行(↑)  下翻一行（↓）  可以搜索关键字（/keyword）</p>\n<p>tail -10  install.log   查看文件尾部的10行<br>tail -f install.log    小f跟踪文件的唯一inode号，就算文件改名后，还是跟踪原来这个inode表示的文件<br>tail -F install.log    大F按照文件名来跟踪</p>\n<p>head -10  install.log   查看文件头部的10行</p>\n<h2 id=\"后台服务管理\"><a href=\"#后台服务管理\" class=\"headerlink\" title=\"后台服务管理\"></a>后台服务管理</h2><p>service network status   查看指定服务的状态<br>service network stop     停止指定服务<br>service network start    启动指定服务<br>service network restart  重启指定服务<br>service –status-all  查看系统中所有的后台服务</p>\n<h2 id=\"设置后台服务的自启配置\"><a href=\"#设置后台服务的自启配置\" class=\"headerlink\" title=\"设置后台服务的自启配置\"></a>设置后台服务的自启配置</h2><p>chkconfig   查看所有服务器自启配置<br>chkconfig iptables off   关掉指定服务的自动启动<br>chkconfig iptables on   开启指定服务的自动启动</p>\n<h2 id=\"系统启动级别管理\"><a href=\"#系统启动级别管理\" class=\"headerlink\" title=\"系统启动级别管理\"></a>系统启动级别管理</h2><p>vi  /etc/inittab<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div></pre></td><td class=\"code\"><pre><div class=\"line\"># Default runlevel. The runlevels used are:</div><div class=\"line\">#   0 - halt (Do NOT set initdefault to this)</div><div class=\"line\">#   1 - Single user mode</div><div class=\"line\">#   2 - Multiuser, without NFS (The same as 3, if you do not have networking)</div><div class=\"line\">#   3 - Full multiuser mode</div><div class=\"line\">#   4 - unused</div><div class=\"line\">#   5 - X11</div><div class=\"line\">#   6 - reboot (Do NOT set initdefault to this)</div><div class=\"line\">#</div><div class=\"line\">id:3:initdefault:</div></pre></td></tr></table></figure></p>\n<h1 id=\"软件安装\"><a href=\"#软件安装\" class=\"headerlink\" title=\"软件安装\"></a>软件安装</h1><h2 id=\"如何上传安装包到服务器\"><a href=\"#如何上传安装包到服务器\" class=\"headerlink\" title=\"如何上传安装包到服务器\"></a>如何上传安装包到服务器</h2><ul>\n<li>可以使用图形化工具，如： filezilla</li>\n<li>可以使用sftp工具：  alt+p 调出后，用put命令上传<br>上传（如果不cd指定目录，则上传到当前用户的主目录）：<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\">sftp&gt; cd /home/   </div><div class=\"line\">sftp&gt; put C:\\Users\\Administrator\\Desktop\\day02\\soft\\jdk-7u45-linux-x64.tar.gz</div></pre></td></tr></table></figure>\n</li>\n</ul>\n<p>下载（lcd[local cd]指定下载到本地的目标路径）<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\">sftp&gt; lcd d:/                            </div><div class=\"line\">sftp&gt; get /home/jdk-7u45-linux-x64.tar.gz</div></pre></td></tr></table></figure></p>\n<ul>\n<li>lrzsz</li>\n</ul>\n<h2 id=\"安装jdk\"><a href=\"#安装jdk\" class=\"headerlink\" title=\"安装jdk\"></a>安装jdk</h2><h3 id=\"压缩解压缩的相关命令\"><a href=\"#压缩解压缩的相关命令\" class=\"headerlink\" title=\"压缩解压缩的相关命令\"></a>压缩解压缩的相关命令</h3><p>压缩解压缩</p>\n<pre><code>root@mini1 ~]# gzip access.log \n[root@mini1 ~]# ll\n总用量 134892\n-rw-r--r--. 1 root root        68 4月   3 17:37 access.log.gz\n</code></pre><p>解压gz文件：  <figure class=\"highlight plain\"><figcaption><span>-d access.log.gz```</span></figcaption><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\"></div><div class=\"line\">### 打包解包</div></pre></td></tr></table></figure></p>\n<p>[root@mini1 ~]# tar -cvf myfirsttarball.tar aaa/<br>aaa/<br>aaa/2.txt<br>aaa/3.txt<br>aaa/1.txt<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">解包：</div></pre></td></tr></table></figure></p>\n<p>[root@mini1 ~]# tar -xvf myfirsttarball.tar<br>aaa/<br>aaa/2.txt<br>aaa/3.txt<br>aaa/1.txt<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\"></div><div class=\"line\">### 一次性完成打包&amp;&amp;压缩的操作</div><div class=\"line\">产生压缩包：</div></pre></td></tr></table></figure></p>\n<p>[root@mini1 ~]# tar -zcvf my.tar.gz aaa/<br>aaa/<br>aaa/2.txt<br>aaa/3.txt<br>aaa/1.txt<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\"></div><div class=\"line\">解压缩包：</div></pre></td></tr></table></figure></p>\n<p>[root@mini1 ~]# tar -zxvf my.tar.gz<br>aaa/<br>aaa/2.txt<br>aaa/3.txt<br>aaa/1.txt<br>```</p>\n<h3 id=\"安装jdk的过程：\"><a href=\"#安装jdk的过程：\" class=\"headerlink\" title=\"安装jdk的过程：\"></a>安装jdk的过程：</h3><ul>\n<li><p>解压安装包</p>\n<p>  tar -zxvf jdk-7u45-linux-x64.tar.gz -C apps/</p>\n</li>\n<li><p>然后修改环境变量</p>\n<p>  vi /etc/profile<br>  在文件最后添加<br>  export JAVA_HOME=/root/apps/jdk1.7.0_45<br>  export PATH=$PATH:$JAVA_HOME/bin<br>  保存退出</p>\n</li>\n<li><p>然后重新加载环境变量 </p>\n<p>  source /etc/profile</p>\n</li>\n</ul>\n<h2 id=\"安装rpm包软件，如mysql\"><a href=\"#安装rpm包软件，如mysql\" class=\"headerlink\" title=\"安装rpm包软件，如mysql\"></a>安装rpm包软件，如mysql</h2><h3 id=\"查看系统中安装的rpm包\"><a href=\"#查看系统中安装的rpm包\" class=\"headerlink\" title=\"查看系统中安装的rpm包\"></a>查看系统中安装的rpm包</h3><pre><code>rpm -qa | grep mysql\n</code></pre><h3 id=\"上传rpm安装包\"><a href=\"#上传rpm安装包\" class=\"headerlink\" title=\"上传rpm安装包\"></a>上传rpm安装包</h3><pre><code>MySQL-client-5.5.48-1.linux2.6.x86_64.rpm\nMySQL-server-5.5.48-1.linux2.6.x86_64.rpm\nper * .rpm\n</code></pre><h3 id=\"安装perl依赖\"><a href=\"#安装perl依赖\" class=\"headerlink\" title=\"安装perl依赖\"></a>安装perl依赖</h3><pre><code>rpm -ivh perl*\n</code></pre><p><em>可能会提示有包冲突，解决： rpm -e 冲突包名 –nodeps</em></p>\n<h3 id=\"安装server\"><a href=\"#安装server\" class=\"headerlink\" title=\"安装server\"></a>安装server</h3><pre><code>rpm -ivh MySQL-server-5.5.48-1.linux2.6.x86_64.rpm\n</code></pre><p>如果成功，会看到进度条，最后，有关于root密码设置的提示，一定要记下来<br>这个版本的提示是，先启动server</p>\n<pre><code>service mysql start\n</code></pre><p>然后<code>/usr/bin/mysql_secure_installation</code> 命令去交互式修改root密码</p>\n<h3 id=\"修改密码时，提示需要先安装client\"><a href=\"#修改密码时，提示需要先安装client\" class=\"headerlink\" title=\"修改密码时，提示需要先安装client\"></a>修改密码时，提示需要先安装client</h3><pre><code>rpm -ivh MySQL-client-5.5.48-1.linux2.6.x86_64.rpm\n</code></pre><p>客户端安装成功后，记得还要用/usr/bin/mysql_secure_installation 命令去交互式修改root密码</p>\n<h3 id=\"登录验证\"><a href=\"#登录验证\" class=\"headerlink\" title=\"登录验证\"></a>登录验证</h3><pre><code>mysql -uroot -proot\n</code></pre>"},{"title":"大数据02-02 linux命令继续学习 yum","toc":true,"date":"2017-11-01T15:50:39.000Z","scaffolds":null,"_content":"# YUM的常用命令\n\n安装httpd并确认安装\n```\nyum instll -y httpd\n```\n列出所有可用的package和package组\n```\nyum list\n```\n<!--more-->\n清除所有缓冲数据\n```\nyum clean all\n```\n列出一个包所有依赖的包\n```\nyum deplist httpd\n```\n删除httpd\n```\nyum remove httpd\n```\n# 配置本地yum源\ncd /etc/yum.repos.d \n\n# 安装jdk\n解压安装包\n> tar -zxvf jdk-7u45-linux-x64.tar.gz -C apps/\n\n然后修改环境变量\n> vi /etc/profile\n\n在文件最后添加\n```\nexport JAVA_HOME=/root/apps/jdk1.7.0_45\nexport PATH=$PATH:$JAVA_HOME/bin\n```\n\n保存退出\n\n然后重新加载环境变量\n> source /etc/profile\n\n# 装mysql\n# 安装tomcat\n1. 上传tomcat包\n2. 解压\n3. 启动\n4. 测试访问\n","source":"_posts/大数据/大数据02-02-linux命令继续学习-yum.md","raw":"---\ntitle: 大数据02-02 linux命令继续学习 yum\ncategories: 学习\ntags:\n  - 大数据\n  - linux\n  - centos7\n  - linux命令\ntoc: true\ndate: 2017-11-01 23:50:39\nscaffolds:\n---\n# YUM的常用命令\n\n安装httpd并确认安装\n```\nyum instll -y httpd\n```\n列出所有可用的package和package组\n```\nyum list\n```\n<!--more-->\n清除所有缓冲数据\n```\nyum clean all\n```\n列出一个包所有依赖的包\n```\nyum deplist httpd\n```\n删除httpd\n```\nyum remove httpd\n```\n# 配置本地yum源\ncd /etc/yum.repos.d \n\n# 安装jdk\n解压安装包\n> tar -zxvf jdk-7u45-linux-x64.tar.gz -C apps/\n\n然后修改环境变量\n> vi /etc/profile\n\n在文件最后添加\n```\nexport JAVA_HOME=/root/apps/jdk1.7.0_45\nexport PATH=$PATH:$JAVA_HOME/bin\n```\n\n保存退出\n\n然后重新加载环境变量\n> source /etc/profile\n\n# 装mysql\n# 安装tomcat\n1. 上传tomcat包\n2. 解压\n3. 启动\n4. 测试访问\n","slug":"大数据/大数据02-02-linux命令继续学习-yum","published":1,"updated":"2017-11-14T15:12:52.333Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjcsq4lfg000kx4vftxgikp0y","content":"<h1 id=\"YUM的常用命令\"><a href=\"#YUM的常用命令\" class=\"headerlink\" title=\"YUM的常用命令\"></a>YUM的常用命令</h1><p>安装httpd并确认安装<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">yum instll -y httpd</div></pre></td></tr></table></figure></p>\n<p>列出所有可用的package和package组<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">yum list</div></pre></td></tr></table></figure></p>\n<a id=\"more\"></a>\n<p>清除所有缓冲数据<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">yum clean all</div></pre></td></tr></table></figure></p>\n<p>列出一个包所有依赖的包<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">yum deplist httpd</div></pre></td></tr></table></figure></p>\n<p>删除httpd<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">yum remove httpd</div></pre></td></tr></table></figure></p>\n<h1 id=\"配置本地yum源\"><a href=\"#配置本地yum源\" class=\"headerlink\" title=\"配置本地yum源\"></a>配置本地yum源</h1><p>cd /etc/yum.repos.d </p>\n<h1 id=\"安装jdk\"><a href=\"#安装jdk\" class=\"headerlink\" title=\"安装jdk\"></a>安装jdk</h1><p>解压安装包</p>\n<blockquote>\n<p>tar -zxvf jdk-7u45-linux-x64.tar.gz -C apps/</p>\n</blockquote>\n<p>然后修改环境变量</p>\n<blockquote>\n<p>vi /etc/profile</p>\n</blockquote>\n<p>在文件最后添加<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\">export JAVA_HOME=/root/apps/jdk1.7.0_45</div><div class=\"line\">export PATH=$PATH:$JAVA_HOME/bin</div></pre></td></tr></table></figure></p>\n<p>保存退出</p>\n<p>然后重新加载环境变量</p>\n<blockquote>\n<p>source /etc/profile</p>\n</blockquote>\n<h1 id=\"装mysql\"><a href=\"#装mysql\" class=\"headerlink\" title=\"装mysql\"></a>装mysql</h1><h1 id=\"安装tomcat\"><a href=\"#安装tomcat\" class=\"headerlink\" title=\"安装tomcat\"></a>安装tomcat</h1><ol>\n<li>上传tomcat包</li>\n<li>解压</li>\n<li>启动</li>\n<li>测试访问</li>\n</ol>\n","site":{"data":{}},"excerpt":"<h1 id=\"YUM的常用命令\"><a href=\"#YUM的常用命令\" class=\"headerlink\" title=\"YUM的常用命令\"></a>YUM的常用命令</h1><p>安装httpd并确认安装<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">yum instll -y httpd</div></pre></td></tr></table></figure></p>\n<p>列出所有可用的package和package组<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">yum list</div></pre></td></tr></table></figure></p>","more":"<p>清除所有缓冲数据<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">yum clean all</div></pre></td></tr></table></figure></p>\n<p>列出一个包所有依赖的包<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">yum deplist httpd</div></pre></td></tr></table></figure></p>\n<p>删除httpd<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">yum remove httpd</div></pre></td></tr></table></figure></p>\n<h1 id=\"配置本地yum源\"><a href=\"#配置本地yum源\" class=\"headerlink\" title=\"配置本地yum源\"></a>配置本地yum源</h1><p>cd /etc/yum.repos.d </p>\n<h1 id=\"安装jdk\"><a href=\"#安装jdk\" class=\"headerlink\" title=\"安装jdk\"></a>安装jdk</h1><p>解压安装包</p>\n<blockquote>\n<p>tar -zxvf jdk-7u45-linux-x64.tar.gz -C apps/</p>\n</blockquote>\n<p>然后修改环境变量</p>\n<blockquote>\n<p>vi /etc/profile</p>\n</blockquote>\n<p>在文件最后添加<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\">export JAVA_HOME=/root/apps/jdk1.7.0_45</div><div class=\"line\">export PATH=$PATH:$JAVA_HOME/bin</div></pre></td></tr></table></figure></p>\n<p>保存退出</p>\n<p>然后重新加载环境变量</p>\n<blockquote>\n<p>source /etc/profile</p>\n</blockquote>\n<h1 id=\"装mysql\"><a href=\"#装mysql\" class=\"headerlink\" title=\"装mysql\"></a>装mysql</h1><h1 id=\"安装tomcat\"><a href=\"#安装tomcat\" class=\"headerlink\" title=\"安装tomcat\"></a>安装tomcat</h1><ol>\n<li>上传tomcat包</li>\n<li>解压</li>\n<li>启动</li>\n<li>测试访问</li>\n</ol>"},{"title":"大数据02-03 shell编程语法讲解","toc":true,"date":"2017-11-06T15:02:36.000Z","scaffolds":null,"_content":"\n# 变量\n## 系统变量\n* $HOME\n* $PWD\n* $SHELL\n* $USER\n显示当前shell中所有变量\n\nset\n\n<!-- more -->\n## 用户自定义变量\n定义变量\n> STR=\"hello world\"\n\n> A=9\n\n> unset A 撤销变量 A\n\n> readonly B=2 声明静态的变量 B=2 ，不能 unset\n\n> export 变量名 可把变量提升为全局环境变量，可供其他shell程序使用\n\n将命令的返回值赋给变量\n\n```\nA=`ls -la` 反引号，运行里面的命令，并把结果返回给变量A\nA=$(ls -la) 等价于反引号\n```\n## shell中的特殊变量\n* $? 表示上一个命令退出的状态  true 0 false 1 错误127\n* $$ 表示当前进程编号\n* $0 表示当前脚本名称\n* $n 表示n位置的输入参数（n代表数字，n>=1）\n* $# \t表示参数的个数，常用于循环\n* $*和$@ 都表示参数列表 \n### $*与$@区别\n* $* 和 $@ 都表示传递给函数或脚本的所有参数，不被双引号\" \"包含时，都以$1  $2  … $n 的形式输出所有参数  \n* 当它们被双引号\" \"包含时，\"$*\" 会将所有的参数作为一个整体，以\"$1 $2 … $n\"的形式输出所有参数；\"$@\" 会将各个参数分开，以\"$1\" \"$2\" … \"$n\" 的形式输出所有参数\n\n## 运算符\n> 格式 :expr m + n 或$((m+n)) 注意expr运算符间要有空格\n\n例如计算（2 ＋3 ）×4 的值\n1 .分步计算\u000b\tS=`expr 2 + 3`\u000b\texpr $S \\* 4\n2.一步完成计算\n```bash\n\texpr `expr 2 + 3 ` \\* 4\n\techo `expr \\`expr 2 + 3\\` \\* 4`\n\t或\n\t$(((2+3)*4))\n```\n# for循环\n\n## 第一种：\n```bash\nfor N in 1 2 3\ndo\n\techo $N\ndone\n或\nfor N in 1 2 3; do echo $N; done\n或\nfor N in {1..3}; do echo $N; done\n```\n## 第二种：\n```bash\nfor ((i = 0; i <= 5; i++))\ndo\n\techo \"welcome $i times\"\ndone\n或\nfor ((i = 0; i <= 5; i++)); do echo \"welcome $i times\"; done\n```\n\n# while循环\n\n## 第一种\n```bash\nwhile expression\ndo\ncommand\n…\ndone\n```\n\n## 第二种\n```bash\ni=1\nwhile ((i<=3))\ndo\n  echo $i\n  let i++\ndone\n```\n# case语句\n\n格式\n```bash\ncase $1 in\nstart)\n\techo \"starting\"\n\t;;\nstop)\n\techo \"stoping\"\n\t;;\n*)\n\techo \"Usage: {start|stop} “\nesac\n\n```\n# read命令\nread -p(提示语句)-n(字符个数) -t(等待时间) \n\tread -p \"please input your name: \" NAME\n\n使用示例：\n```\n[vagrant@mysql1 ~]$ read -p \"please enter a number:\" numb\nplease enter a number:1\n[vagrant@mysql1 ~]$ echo $numb\n1\n[vagrant@mysql1 ~]$ \n```\n\n# if判断\n语法\n```bash\nif condition \nthen \n    statements\n[elif condition \n    then statements. ..] \n[else \n    statements ] \nfi\n\n```\n# 判断语句\n[ condition ] **(注意condition前后要有空格)**\n#非空返回true，可使用$?验证（0为true，>1为false）\n[ test ]\n\n#空返回false\n[  ]\n\n> [ condition ] && echo OK || echo notok\n\n条件满足，执行后面的语句 不满足执行 || 后面的语句\n\n# 常用判断条件\n* = 字符串比较\n* -lt 小于\n* -le 小于等于\n* -eq 等于\n* -gt 大于\n* -ge 大于等于\n* -ne 不等于\n\n* -r 有读的权限\n* -w 有写的权限\n* -x 有执行的权限\n* **-f 文件存在并且是一个常规的文件**\n* -s 文件存在且不为空\n* -d 文件存在并是一个目录\n* -b文件存在并且是一个块设备\n* -L 文件存在并且是一个链接\n\n# Shell自定义函数\n语法\n```bash\n [ function ] funname [()]\n{\n    action;\n    [return int;]\n}\n\n```\n三种声明方式:\n* function start()  \n* function start \n* start()\n\n注意\n1. 必须在调用函数地方之前，先声明函数，shell脚本是逐行运行。不会像其它语言一样先预编译\n2. 函数返回值，只能通过$? 系统变量获得，可以显示加：return 返回，如果不加，将以最后一条命令运行结果，作为返回值。 return后跟数值n(0-255)\n\n## 例子\n```bash\n#!/bin/bash\nfSum 3 2;\nfunction fSum()\n{\n    echo $1,$2;\n    return $(($1+$2));\n}\nfSum 5 7;\ntotal=$?;\necho $total,$?;\n\n```\n结果\n```\n[vagrant@mysql1 ~]$ sh test \ntest: line 2: fSum: command not found\n5,7\n12,0\n\n```\n# 脚本调试\n* sh -vx helloWorld.sh\n* 或者在脚本中增加set -x\n\n# cut命令\ncut命令可以从一个文本文件或者文本流中提取文本列。\n\n## 语法\n```\ncut -d'分隔字符' -f fields <==用于有特定分隔字符\ncut -c 字符区间            <==用于排列整齐的信息\n\n```\n* -d  ：后面接分隔字符。与 -f 一起使用；\n* -f  ：依据 -d 的分隔字符将一段信息分割成为数段，用 -f 取出第几段的意思；\n* -c  ：以字符 (characters) 的单位取出固定字符区间；\n\n## 例子\n### PATH 变量如下\n\n```\n[root@www ~]# echo $PATH\n/bin:/usr/bin:/sbin:/usr/sbin:/usr/local/bin:/usr/X11R6/bin:/usr/games\n# 1 | 2       | 3   | 4       | 5            | 6            | 7\n\n```\n### 将 PATH 变量取出，我要找出第五个路径。\n\n```\n#echo $PATH | cut -d ':' -f 5\n/usr/local/bin\n\n```\n### 将 PATH 变量取出，我要找出第三和第五个路径。\n\n```\n#echo $PATH | cut -d ':' -f 3,5\n/sbin:/usr/local/bin\n\n```\n### 将 PATH 变量取出，我要找出第三到最后一个路径。\n\n```\necho $PATH | cut -d ':' -f 3-\n/sbin:/usr/sbin:/usr/local/bin:/usr/X11R6/bin:/usr/games\n\n```\n\n### 将 PATH 变量取出，我要找出第一到第三个路径。\n\n```\n#echo $PATH | cut -d ':' -f 1-3\n/bin:/usr/bin:/sbin:\n\n```\n### 将 PATH 变量取出，我要找出第一到第三，还有第五个路径。\n\n```\necho $PATH | cut -d ':' -f 1-3,5\n/bin:/usr/bin:/sbin:/usr/local/bin\n```\n\n## 实用例子:只显示/etc/passwd的用户和shell\n\n```\n#cat /etc/passwd | cut -d ':' -f 1,7 \nroot:/bin/bash\ndaemon:/bin/sh\nbin:/bin/sh\n```\n\n# sort命令\nsort 命令对 File 参数指定的文件中的行排序，并将结果写到标准输出。如果 File 参数指定多个文件，那么 sort 命令将这些文件连接起来，并当作一个文件进行排序。\n## 语法\n`[root@www ~]# sort [-fbMnrtuk] [file or stdin]`\n选项与参数：\n* -f  ：忽略大小写的差异，例如 A 与 a 视为编码相同；\n* -b  ：忽略最前面的空格符部分；\n* -M  ：以月份的名字来排序，例如 JAN, DEC 等等的排序方法；\n* -n  ：使用『纯数字』进行排序(默认是以文字型态来排序的)；\n* -r  ：反向排序；\n* -u  ：就是 uniq ，相同的数据中，仅出现一行代表；\n* -t  ：分隔符，默认是用 [tab] 键来分隔；\n* -k  ：以那个区间 (field) 来进行排序的意思\n\n## 对/etc/passwd 的账号进行排序\n```bash\n[root@www ~]# cat /etc/passwd | sort\nadm:x:3:4:adm:/var/adm:/sbin/nologin\napache:x:48:48:Apache:/var/www:/sbin/nologin\nbin:x:1:1:bin:/bin:/sbin/nologin\ndaemon:x:2:2:daemon:/sbin:/sbin/nologin\n\n```\nsort 是默认以第一个数据来排序，而且默认是以字符串形式来排序,所以由字母 a 开始升序排序。\n## /etc/passwd 内容是以 : 来分隔的，我想以第三栏来排序，该如何\n\n```\n[root@www ~]# cat /etc/passwd | sort -t ':' -k 3\nroot:x:0:0:root:/root:/bin/bash\nuucp:x:10:14:uucp:/var/spool/uucp:/sbin/nologin\noperator:x:11:0:operator:/root:/sbin/nologin\nbin:x:1:1:bin:/bin:/sbin/nologin\ngames:x:12:100:games:/usr/games:/sbin/nologin\n\n```\n## 默认是以字符串来排序的，如果想要使用数字排序：\n```\ncat /etc/passwd | sort -t ':' -k 3n\nroot:x:0:0:root:/root:/bin/bash\ndaemon:x:1:1:daemon:/usr/sbin:/bin/sh\nbin:x:2:2:bin:/bin:/bin/sh\n\n```\n## 默认是升序排序，如果要倒序排序，如下\n\n```\ncat /etc/passwd | sort -t ':' -k 3nr\nnobody:x:65534:65534:nobody:/nonexistent:/bin/sh\nntp:x:106:113::/home/ntp:/bin/false\nmessagebus:x:105:109::/var/run/dbus:/bin/false\nsshd:x:104:65534::/var/run/sshd:/usr/sbin/nologin\n\n```\n## 如果要对/etc/passwd,先以第六个域的第2个字符到第4个字符进行正向排序，再基于第一个域进行反向排序。\n\n```\ncat /etc/passwd |  sort -t':' -k 6.2,6.4 -k 1r      \nsync:x:4:65534:sync:/bin:/bin/sync\nproxy:x:13:13:proxy:/bin:/bin/sh\nbin:x:2:2:bin:/bin:/bin/sh\nsys:x:3:3:sys:/dev:/bin/sh\n\n```\n## 查看/etc/passwd有多少个shell:对/etc/passwd的第七个域进行排序，然后去重:\n```\ncat /etc/passwd |  sort -t':' -k 7 -u\nroot:x:0:0:root:/root:/bin/bash\nsyslog:x:101:102::/home/syslog:/bin/false\ndaemon:x:1:1:daemon:/usr/sbin:/bin/sh\nsync:x:4:65534:sync:/bin:/bin/sync\nsshd:x:104:65534::/var/run/sshd:/usr/sbin/nologin\n```\n# uniq去重命令\n uniq命令可以去除排序过的文件中的重复行，因此uniq经常和sort合用。也就是说，为了使uniq起作用，所有的重复行必须是相邻的。\n\n## uniq语法\n`[root@www ~]# uniq [-icu]`\n选项与参数：\n* -i   ：忽略大小写字符的不同；\n* -c  ：进行计数\n* -u  ：只显示唯一的行\n\ntestfile的内容如下\n```\ncat testfile\nhello\nworld\nfriend\nhello\nworld\nhello\n```\n直接删除未经排序的文件，将会发现没有任何行被删除\n```\n#uniq testfile  \nhello\nworld\nfriend\nhello\nworld\nhello\n```\n排序文件，默认是去重\n```\n#cat testfile | sort |uniq\nfriend\nhello\nworld\n```\n排序之后删除了重复行，同时在行首位置输出该行重复的次数\n```\n#sort testfile | uniq -c\n1 friend\n3 hello\n2 world\n```\n仅显示存在重复的行，并在行首显示该行重复的次数\n```\n#sort testfile | uniq -dc\n3 hello\n2 world\n```\n仅显示不重复的行\n```\nsort testfile | uniq -u\nfriend  \n```\n\n\n# wc命令\n## 语法\n`[root@www ~]# wc [-lwm]`\n选项与参数：\n* -l  ：仅列出行；\n* -w  ：仅列出多少字(英文单字)；\n* -m  ：多少字符；\n## 默认使用wc统计/etc/passwd\n\n```\n#wc /etc/passwd\n40   45 1719 /etc/passwd\n40是行数，45是单词数，1719是字节数\n\n```\nwc的命令比较简单使用，每个参数使用如下：\n \n```\n#wc -l /etc/passwd   #统计行数，在对记录数时，很常用\n40 /etc/passwd       #表示系统有40个账户\n\n#wc -w /etc/passwd  #统计单词出现次数\n45 /etc/passwd\n\n#wc -m /etc/passwd  #统计文件的字符数\n1719\n\n```\n\n\n\n\n\n\n\n\n","source":"_posts/大数据/大数据02-03 shell编程语法讲解.md","raw":"---\ntitle: 大数据02-03 shell编程语法讲解\ncategories: 学习\ntags:\n  - 大数据\n  - linux\n  - centos7\n  - linux命令\ntoc: true\ndate: 2017-11-06 23:02:36\nscaffolds:\n---\n\n# 变量\n## 系统变量\n* $HOME\n* $PWD\n* $SHELL\n* $USER\n显示当前shell中所有变量\n\nset\n\n<!-- more -->\n## 用户自定义变量\n定义变量\n> STR=\"hello world\"\n\n> A=9\n\n> unset A 撤销变量 A\n\n> readonly B=2 声明静态的变量 B=2 ，不能 unset\n\n> export 变量名 可把变量提升为全局环境变量，可供其他shell程序使用\n\n将命令的返回值赋给变量\n\n```\nA=`ls -la` 反引号，运行里面的命令，并把结果返回给变量A\nA=$(ls -la) 等价于反引号\n```\n## shell中的特殊变量\n* $? 表示上一个命令退出的状态  true 0 false 1 错误127\n* $$ 表示当前进程编号\n* $0 表示当前脚本名称\n* $n 表示n位置的输入参数（n代表数字，n>=1）\n* $# \t表示参数的个数，常用于循环\n* $*和$@ 都表示参数列表 \n### $*与$@区别\n* $* 和 $@ 都表示传递给函数或脚本的所有参数，不被双引号\" \"包含时，都以$1  $2  … $n 的形式输出所有参数  \n* 当它们被双引号\" \"包含时，\"$*\" 会将所有的参数作为一个整体，以\"$1 $2 … $n\"的形式输出所有参数；\"$@\" 会将各个参数分开，以\"$1\" \"$2\" … \"$n\" 的形式输出所有参数\n\n## 运算符\n> 格式 :expr m + n 或$((m+n)) 注意expr运算符间要有空格\n\n例如计算（2 ＋3 ）×4 的值\n1 .分步计算\u000b\tS=`expr 2 + 3`\u000b\texpr $S \\* 4\n2.一步完成计算\n```bash\n\texpr `expr 2 + 3 ` \\* 4\n\techo `expr \\`expr 2 + 3\\` \\* 4`\n\t或\n\t$(((2+3)*4))\n```\n# for循环\n\n## 第一种：\n```bash\nfor N in 1 2 3\ndo\n\techo $N\ndone\n或\nfor N in 1 2 3; do echo $N; done\n或\nfor N in {1..3}; do echo $N; done\n```\n## 第二种：\n```bash\nfor ((i = 0; i <= 5; i++))\ndo\n\techo \"welcome $i times\"\ndone\n或\nfor ((i = 0; i <= 5; i++)); do echo \"welcome $i times\"; done\n```\n\n# while循环\n\n## 第一种\n```bash\nwhile expression\ndo\ncommand\n…\ndone\n```\n\n## 第二种\n```bash\ni=1\nwhile ((i<=3))\ndo\n  echo $i\n  let i++\ndone\n```\n# case语句\n\n格式\n```bash\ncase $1 in\nstart)\n\techo \"starting\"\n\t;;\nstop)\n\techo \"stoping\"\n\t;;\n*)\n\techo \"Usage: {start|stop} “\nesac\n\n```\n# read命令\nread -p(提示语句)-n(字符个数) -t(等待时间) \n\tread -p \"please input your name: \" NAME\n\n使用示例：\n```\n[vagrant@mysql1 ~]$ read -p \"please enter a number:\" numb\nplease enter a number:1\n[vagrant@mysql1 ~]$ echo $numb\n1\n[vagrant@mysql1 ~]$ \n```\n\n# if判断\n语法\n```bash\nif condition \nthen \n    statements\n[elif condition \n    then statements. ..] \n[else \n    statements ] \nfi\n\n```\n# 判断语句\n[ condition ] **(注意condition前后要有空格)**\n#非空返回true，可使用$?验证（0为true，>1为false）\n[ test ]\n\n#空返回false\n[  ]\n\n> [ condition ] && echo OK || echo notok\n\n条件满足，执行后面的语句 不满足执行 || 后面的语句\n\n# 常用判断条件\n* = 字符串比较\n* -lt 小于\n* -le 小于等于\n* -eq 等于\n* -gt 大于\n* -ge 大于等于\n* -ne 不等于\n\n* -r 有读的权限\n* -w 有写的权限\n* -x 有执行的权限\n* **-f 文件存在并且是一个常规的文件**\n* -s 文件存在且不为空\n* -d 文件存在并是一个目录\n* -b文件存在并且是一个块设备\n* -L 文件存在并且是一个链接\n\n# Shell自定义函数\n语法\n```bash\n [ function ] funname [()]\n{\n    action;\n    [return int;]\n}\n\n```\n三种声明方式:\n* function start()  \n* function start \n* start()\n\n注意\n1. 必须在调用函数地方之前，先声明函数，shell脚本是逐行运行。不会像其它语言一样先预编译\n2. 函数返回值，只能通过$? 系统变量获得，可以显示加：return 返回，如果不加，将以最后一条命令运行结果，作为返回值。 return后跟数值n(0-255)\n\n## 例子\n```bash\n#!/bin/bash\nfSum 3 2;\nfunction fSum()\n{\n    echo $1,$2;\n    return $(($1+$2));\n}\nfSum 5 7;\ntotal=$?;\necho $total,$?;\n\n```\n结果\n```\n[vagrant@mysql1 ~]$ sh test \ntest: line 2: fSum: command not found\n5,7\n12,0\n\n```\n# 脚本调试\n* sh -vx helloWorld.sh\n* 或者在脚本中增加set -x\n\n# cut命令\ncut命令可以从一个文本文件或者文本流中提取文本列。\n\n## 语法\n```\ncut -d'分隔字符' -f fields <==用于有特定分隔字符\ncut -c 字符区间            <==用于排列整齐的信息\n\n```\n* -d  ：后面接分隔字符。与 -f 一起使用；\n* -f  ：依据 -d 的分隔字符将一段信息分割成为数段，用 -f 取出第几段的意思；\n* -c  ：以字符 (characters) 的单位取出固定字符区间；\n\n## 例子\n### PATH 变量如下\n\n```\n[root@www ~]# echo $PATH\n/bin:/usr/bin:/sbin:/usr/sbin:/usr/local/bin:/usr/X11R6/bin:/usr/games\n# 1 | 2       | 3   | 4       | 5            | 6            | 7\n\n```\n### 将 PATH 变量取出，我要找出第五个路径。\n\n```\n#echo $PATH | cut -d ':' -f 5\n/usr/local/bin\n\n```\n### 将 PATH 变量取出，我要找出第三和第五个路径。\n\n```\n#echo $PATH | cut -d ':' -f 3,5\n/sbin:/usr/local/bin\n\n```\n### 将 PATH 变量取出，我要找出第三到最后一个路径。\n\n```\necho $PATH | cut -d ':' -f 3-\n/sbin:/usr/sbin:/usr/local/bin:/usr/X11R6/bin:/usr/games\n\n```\n\n### 将 PATH 变量取出，我要找出第一到第三个路径。\n\n```\n#echo $PATH | cut -d ':' -f 1-3\n/bin:/usr/bin:/sbin:\n\n```\n### 将 PATH 变量取出，我要找出第一到第三，还有第五个路径。\n\n```\necho $PATH | cut -d ':' -f 1-3,5\n/bin:/usr/bin:/sbin:/usr/local/bin\n```\n\n## 实用例子:只显示/etc/passwd的用户和shell\n\n```\n#cat /etc/passwd | cut -d ':' -f 1,7 \nroot:/bin/bash\ndaemon:/bin/sh\nbin:/bin/sh\n```\n\n# sort命令\nsort 命令对 File 参数指定的文件中的行排序，并将结果写到标准输出。如果 File 参数指定多个文件，那么 sort 命令将这些文件连接起来，并当作一个文件进行排序。\n## 语法\n`[root@www ~]# sort [-fbMnrtuk] [file or stdin]`\n选项与参数：\n* -f  ：忽略大小写的差异，例如 A 与 a 视为编码相同；\n* -b  ：忽略最前面的空格符部分；\n* -M  ：以月份的名字来排序，例如 JAN, DEC 等等的排序方法；\n* -n  ：使用『纯数字』进行排序(默认是以文字型态来排序的)；\n* -r  ：反向排序；\n* -u  ：就是 uniq ，相同的数据中，仅出现一行代表；\n* -t  ：分隔符，默认是用 [tab] 键来分隔；\n* -k  ：以那个区间 (field) 来进行排序的意思\n\n## 对/etc/passwd 的账号进行排序\n```bash\n[root@www ~]# cat /etc/passwd | sort\nadm:x:3:4:adm:/var/adm:/sbin/nologin\napache:x:48:48:Apache:/var/www:/sbin/nologin\nbin:x:1:1:bin:/bin:/sbin/nologin\ndaemon:x:2:2:daemon:/sbin:/sbin/nologin\n\n```\nsort 是默认以第一个数据来排序，而且默认是以字符串形式来排序,所以由字母 a 开始升序排序。\n## /etc/passwd 内容是以 : 来分隔的，我想以第三栏来排序，该如何\n\n```\n[root@www ~]# cat /etc/passwd | sort -t ':' -k 3\nroot:x:0:0:root:/root:/bin/bash\nuucp:x:10:14:uucp:/var/spool/uucp:/sbin/nologin\noperator:x:11:0:operator:/root:/sbin/nologin\nbin:x:1:1:bin:/bin:/sbin/nologin\ngames:x:12:100:games:/usr/games:/sbin/nologin\n\n```\n## 默认是以字符串来排序的，如果想要使用数字排序：\n```\ncat /etc/passwd | sort -t ':' -k 3n\nroot:x:0:0:root:/root:/bin/bash\ndaemon:x:1:1:daemon:/usr/sbin:/bin/sh\nbin:x:2:2:bin:/bin:/bin/sh\n\n```\n## 默认是升序排序，如果要倒序排序，如下\n\n```\ncat /etc/passwd | sort -t ':' -k 3nr\nnobody:x:65534:65534:nobody:/nonexistent:/bin/sh\nntp:x:106:113::/home/ntp:/bin/false\nmessagebus:x:105:109::/var/run/dbus:/bin/false\nsshd:x:104:65534::/var/run/sshd:/usr/sbin/nologin\n\n```\n## 如果要对/etc/passwd,先以第六个域的第2个字符到第4个字符进行正向排序，再基于第一个域进行反向排序。\n\n```\ncat /etc/passwd |  sort -t':' -k 6.2,6.4 -k 1r      \nsync:x:4:65534:sync:/bin:/bin/sync\nproxy:x:13:13:proxy:/bin:/bin/sh\nbin:x:2:2:bin:/bin:/bin/sh\nsys:x:3:3:sys:/dev:/bin/sh\n\n```\n## 查看/etc/passwd有多少个shell:对/etc/passwd的第七个域进行排序，然后去重:\n```\ncat /etc/passwd |  sort -t':' -k 7 -u\nroot:x:0:0:root:/root:/bin/bash\nsyslog:x:101:102::/home/syslog:/bin/false\ndaemon:x:1:1:daemon:/usr/sbin:/bin/sh\nsync:x:4:65534:sync:/bin:/bin/sync\nsshd:x:104:65534::/var/run/sshd:/usr/sbin/nologin\n```\n# uniq去重命令\n uniq命令可以去除排序过的文件中的重复行，因此uniq经常和sort合用。也就是说，为了使uniq起作用，所有的重复行必须是相邻的。\n\n## uniq语法\n`[root@www ~]# uniq [-icu]`\n选项与参数：\n* -i   ：忽略大小写字符的不同；\n* -c  ：进行计数\n* -u  ：只显示唯一的行\n\ntestfile的内容如下\n```\ncat testfile\nhello\nworld\nfriend\nhello\nworld\nhello\n```\n直接删除未经排序的文件，将会发现没有任何行被删除\n```\n#uniq testfile  \nhello\nworld\nfriend\nhello\nworld\nhello\n```\n排序文件，默认是去重\n```\n#cat testfile | sort |uniq\nfriend\nhello\nworld\n```\n排序之后删除了重复行，同时在行首位置输出该行重复的次数\n```\n#sort testfile | uniq -c\n1 friend\n3 hello\n2 world\n```\n仅显示存在重复的行，并在行首显示该行重复的次数\n```\n#sort testfile | uniq -dc\n3 hello\n2 world\n```\n仅显示不重复的行\n```\nsort testfile | uniq -u\nfriend  \n```\n\n\n# wc命令\n## 语法\n`[root@www ~]# wc [-lwm]`\n选项与参数：\n* -l  ：仅列出行；\n* -w  ：仅列出多少字(英文单字)；\n* -m  ：多少字符；\n## 默认使用wc统计/etc/passwd\n\n```\n#wc /etc/passwd\n40   45 1719 /etc/passwd\n40是行数，45是单词数，1719是字节数\n\n```\nwc的命令比较简单使用，每个参数使用如下：\n \n```\n#wc -l /etc/passwd   #统计行数，在对记录数时，很常用\n40 /etc/passwd       #表示系统有40个账户\n\n#wc -w /etc/passwd  #统计单词出现次数\n45 /etc/passwd\n\n#wc -m /etc/passwd  #统计文件的字符数\n1719\n\n```\n\n\n\n\n\n\n\n\n","slug":"大数据/大数据02-03 shell编程语法讲解","published":1,"updated":"2017-12-05T16:01:22.799Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjcsq4lfj000mx4vfjss7lpgd","content":"<h1 id=\"变量\"><a href=\"#变量\" class=\"headerlink\" title=\"变量\"></a>变量</h1><h2 id=\"系统变量\"><a href=\"#系统变量\" class=\"headerlink\" title=\"系统变量\"></a>系统变量</h2><ul>\n<li>$HOME</li>\n<li>$PWD</li>\n<li>$SHELL</li>\n<li>$USER<br>显示当前shell中所有变量</li>\n</ul>\n<p>set</p>\n<a id=\"more\"></a>\n<h2 id=\"用户自定义变量\"><a href=\"#用户自定义变量\" class=\"headerlink\" title=\"用户自定义变量\"></a>用户自定义变量</h2><p>定义变量</p>\n<blockquote>\n<p>STR=”hello world”</p>\n<p>A=9</p>\n<p>unset A 撤销变量 A</p>\n<p>readonly B=2 声明静态的变量 B=2 ，不能 unset</p>\n<p>export 变量名 可把变量提升为全局环境变量，可供其他shell程序使用</p>\n</blockquote>\n<p>将命令的返回值赋给变量</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\">A=`ls -la` 反引号，运行里面的命令，并把结果返回给变量A</div><div class=\"line\">A=$(ls -la) 等价于反引号</div></pre></td></tr></table></figure>\n<h2 id=\"shell中的特殊变量\"><a href=\"#shell中的特殊变量\" class=\"headerlink\" title=\"shell中的特殊变量\"></a>shell中的特殊变量</h2><ul>\n<li>$? 表示上一个命令退出的状态  true 0 false 1 错误127</li>\n<li>$$ 表示当前进程编号</li>\n<li>$0 表示当前脚本名称</li>\n<li>$n 表示n位置的输入参数（n代表数字，n&gt;=1）</li>\n<li>$#     表示参数的个数，常用于循环</li>\n<li>$*和$@ 都表示参数列表 <h3 id=\"与-区别\"><a href=\"#与-区别\" class=\"headerlink\" title=\"$*与$@区别\"></a>$*与$@区别</h3></li>\n<li>$* 和 $@ 都表示传递给函数或脚本的所有参数，不被双引号” “包含时，都以$1  $2  … $n 的形式输出所有参数  </li>\n<li>当它们被双引号” “包含时，”$*” 会将所有的参数作为一个整体，以”$1 $2 … $n”的形式输出所有参数；”$@” 会将各个参数分开，以”$1” “$2” … “$n” 的形式输出所有参数</li>\n</ul>\n<h2 id=\"运算符\"><a href=\"#运算符\" class=\"headerlink\" title=\"运算符\"></a>运算符</h2><blockquote>\n<p>格式 :expr m + n 或$((m+n)) 注意expr运算符间要有空格</p>\n</blockquote>\n<p>例如计算（2 ＋3 ）×4 的值<br>1 .分步计算\u000b    S=<code>expr 2 + 3</code>\u000b    expr $S * 4<br>2.一步完成计算<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\">expr `expr 2 + 3 ` \\* 4</div><div class=\"line\"><span class=\"built_in\">echo</span> `expr \\`expr 2 + 3\\` \\* 4`</div><div class=\"line\">或</div><div class=\"line\">$(((2+3)*4))</div></pre></td></tr></table></figure></p>\n<h1 id=\"for循环\"><a href=\"#for循环\" class=\"headerlink\" title=\"for循环\"></a>for循环</h1><h2 id=\"第一种：\"><a href=\"#第一种：\" class=\"headerlink\" title=\"第一种：\"></a>第一种：</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">for</span> N <span class=\"keyword\">in</span> 1 2 3</div><div class=\"line\"><span class=\"keyword\">do</span></div><div class=\"line\">\t<span class=\"built_in\">echo</span> <span class=\"variable\">$N</span></div><div class=\"line\"><span class=\"keyword\">done</span></div><div class=\"line\">或</div><div class=\"line\"><span class=\"keyword\">for</span> N <span class=\"keyword\">in</span> 1 2 3; <span class=\"keyword\">do</span> <span class=\"built_in\">echo</span> <span class=\"variable\">$N</span>; <span class=\"keyword\">done</span></div><div class=\"line\">或</div><div class=\"line\"><span class=\"keyword\">for</span> N <span class=\"keyword\">in</span> &#123;1..3&#125;; <span class=\"keyword\">do</span> <span class=\"built_in\">echo</span> <span class=\"variable\">$N</span>; <span class=\"keyword\">done</span></div></pre></td></tr></table></figure>\n<h2 id=\"第二种：\"><a href=\"#第二种：\" class=\"headerlink\" title=\"第二种：\"></a>第二种：</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">for</span> ((i = 0; i &lt;= 5; i++))</div><div class=\"line\"><span class=\"keyword\">do</span></div><div class=\"line\">\t<span class=\"built_in\">echo</span> <span class=\"string\">\"welcome <span class=\"variable\">$i</span> times\"</span></div><div class=\"line\"><span class=\"keyword\">done</span></div><div class=\"line\">或</div><div class=\"line\"><span class=\"keyword\">for</span> ((i = 0; i &lt;= 5; i++)); <span class=\"keyword\">do</span> <span class=\"built_in\">echo</span> <span class=\"string\">\"welcome <span class=\"variable\">$i</span> times\"</span>; <span class=\"keyword\">done</span></div></pre></td></tr></table></figure>\n<h1 id=\"while循环\"><a href=\"#while循环\" class=\"headerlink\" title=\"while循环\"></a>while循环</h1><h2 id=\"第一种\"><a href=\"#第一种\" class=\"headerlink\" title=\"第一种\"></a>第一种</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">while</span> expression</div><div class=\"line\"><span class=\"keyword\">do</span></div><div class=\"line\"><span class=\"built_in\">command</span></div><div class=\"line\">…</div><div class=\"line\"><span class=\"keyword\">done</span></div></pre></td></tr></table></figure>\n<h2 id=\"第二种\"><a href=\"#第二种\" class=\"headerlink\" title=\"第二种\"></a>第二种</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\">i=1</div><div class=\"line\"><span class=\"keyword\">while</span> ((i&lt;=3))</div><div class=\"line\"><span class=\"keyword\">do</span></div><div class=\"line\">  <span class=\"built_in\">echo</span> <span class=\"variable\">$i</span></div><div class=\"line\">  <span class=\"built_in\">let</span> i++</div><div class=\"line\"><span class=\"keyword\">done</span></div></pre></td></tr></table></figure>\n<h1 id=\"case语句\"><a href=\"#case语句\" class=\"headerlink\" title=\"case语句\"></a>case语句</h1><p>格式<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">case</span> <span class=\"variable\">$1</span> <span class=\"keyword\">in</span></div><div class=\"line\">start)</div><div class=\"line\">\t<span class=\"built_in\">echo</span> <span class=\"string\">\"starting\"</span></div><div class=\"line\">\t;;</div><div class=\"line\">stop)</div><div class=\"line\">\t<span class=\"built_in\">echo</span> <span class=\"string\">\"stoping\"</span></div><div class=\"line\">\t;;</div><div class=\"line\">*)</div><div class=\"line\">\t<span class=\"built_in\">echo</span> <span class=\"string\">\"Usage: &#123;start|stop&#125; “</span></div><div class=\"line\"><span class=\"string\">esac</span></div></pre></td></tr></table></figure></p>\n<h1 id=\"read命令\"><a href=\"#read命令\" class=\"headerlink\" title=\"read命令\"></a>read命令</h1><p>read -p(提示语句)-n(字符个数) -t(等待时间)<br>    read -p “please input your name: “ NAME</p>\n<p>使用示例：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\">[vagrant@mysql1 ~]$ read -p &quot;please enter a number:&quot; numb</div><div class=\"line\">please enter a number:1</div><div class=\"line\">[vagrant@mysql1 ~]$ echo $numb</div><div class=\"line\">1</div><div class=\"line\">[vagrant@mysql1 ~]$</div></pre></td></tr></table></figure></p>\n<h1 id=\"if判断\"><a href=\"#if判断\" class=\"headerlink\" title=\"if判断\"></a>if判断</h1><p>语法<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">if</span> condition </div><div class=\"line\"><span class=\"keyword\">then</span> </div><div class=\"line\">    statements</div><div class=\"line\">[<span class=\"keyword\">elif</span> condition </div><div class=\"line\">    <span class=\"keyword\">then</span> statements. ..] </div><div class=\"line\">[<span class=\"keyword\">else</span> </div><div class=\"line\">    statements ] </div><div class=\"line\"><span class=\"keyword\">fi</span></div></pre></td></tr></table></figure></p>\n<h1 id=\"判断语句\"><a href=\"#判断语句\" class=\"headerlink\" title=\"判断语句\"></a>判断语句</h1><p>[ condition ] <strong>(注意condition前后要有空格)</strong></p>\n<p>#非空返回true，可使用$?验证（0为true，&gt;1为false）<br>[ test ]</p>\n<p>#空返回false<br>[  ]</p>\n<blockquote>\n<p>[ condition ] &amp;&amp; echo OK || echo notok</p>\n</blockquote>\n<p>条件满足，执行后面的语句 不满足执行 || 后面的语句</p>\n<h1 id=\"常用判断条件\"><a href=\"#常用判断条件\" class=\"headerlink\" title=\"常用判断条件\"></a>常用判断条件</h1><ul>\n<li>= 字符串比较</li>\n<li>-lt 小于</li>\n<li>-le 小于等于</li>\n<li>-eq 等于</li>\n<li>-gt 大于</li>\n<li>-ge 大于等于</li>\n<li><p>-ne 不等于</p>\n</li>\n<li><p>-r 有读的权限</p>\n</li>\n<li>-w 有写的权限</li>\n<li>-x 有执行的权限</li>\n<li><strong>-f 文件存在并且是一个常规的文件</strong></li>\n<li>-s 文件存在且不为空</li>\n<li>-d 文件存在并是一个目录</li>\n<li>-b文件存在并且是一个块设备</li>\n<li>-L 文件存在并且是一个链接</li>\n</ul>\n<h1 id=\"Shell自定义函数\"><a href=\"#Shell自定义函数\" class=\"headerlink\" title=\"Shell自定义函数\"></a>Shell自定义函数</h1><p>语法<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\"> [ <span class=\"keyword\">function</span> ] funname [()]</div><div class=\"line\">&#123;</div><div class=\"line\">    action;</div><div class=\"line\">    [<span class=\"built_in\">return</span> int;]</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>三种声明方式:</p>\n<ul>\n<li>function start()  </li>\n<li>function start </li>\n<li>start()</li>\n</ul>\n<p>注意</p>\n<ol>\n<li>必须在调用函数地方之前，先声明函数，shell脚本是逐行运行。不会像其它语言一样先预编译</li>\n<li>函数返回值，只能通过$? 系统变量获得，可以显示加：return 返回，如果不加，将以最后一条命令运行结果，作为返回值。 return后跟数值n(0-255)</li>\n</ol>\n<h2 id=\"例子\"><a href=\"#例子\" class=\"headerlink\" title=\"例子\"></a>例子</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">#!/bin/bash</span></div><div class=\"line\">fSum 3 2;</div><div class=\"line\"><span class=\"keyword\">function</span> fSum()</div><div class=\"line\">&#123;</div><div class=\"line\">    <span class=\"built_in\">echo</span> <span class=\"variable\">$1</span>,<span class=\"variable\">$2</span>;</div><div class=\"line\">    <span class=\"built_in\">return</span> $((<span class=\"variable\">$1</span>+<span class=\"variable\">$2</span>));</div><div class=\"line\">&#125;</div><div class=\"line\">fSum 5 7;</div><div class=\"line\">total=$?;</div><div class=\"line\"><span class=\"built_in\">echo</span> <span class=\"variable\">$total</span>,$?;</div></pre></td></tr></table></figure>\n<p>结果<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\">[vagrant@mysql1 ~]$ sh test </div><div class=\"line\">test: line 2: fSum: command not found</div><div class=\"line\">5,7</div><div class=\"line\">12,0</div></pre></td></tr></table></figure></p>\n<h1 id=\"脚本调试\"><a href=\"#脚本调试\" class=\"headerlink\" title=\"脚本调试\"></a>脚本调试</h1><ul>\n<li>sh -vx helloWorld.sh</li>\n<li>或者在脚本中增加set -x</li>\n</ul>\n<h1 id=\"cut命令\"><a href=\"#cut命令\" class=\"headerlink\" title=\"cut命令\"></a>cut命令</h1><p>cut命令可以从一个文本文件或者文本流中提取文本列。</p>\n<h2 id=\"语法\"><a href=\"#语法\" class=\"headerlink\" title=\"语法\"></a>语法</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\">cut -d&apos;分隔字符&apos; -f fields &lt;==用于有特定分隔字符</div><div class=\"line\">cut -c 字符区间            &lt;==用于排列整齐的信息</div></pre></td></tr></table></figure>\n<ul>\n<li>-d  ：后面接分隔字符。与 -f 一起使用；</li>\n<li>-f  ：依据 -d 的分隔字符将一段信息分割成为数段，用 -f 取出第几段的意思；</li>\n<li>-c  ：以字符 (characters) 的单位取出固定字符区间；</li>\n</ul>\n<h2 id=\"例子-1\"><a href=\"#例子-1\" class=\"headerlink\" title=\"例子\"></a>例子</h2><h3 id=\"PATH-变量如下\"><a href=\"#PATH-变量如下\" class=\"headerlink\" title=\"PATH 变量如下\"></a>PATH 变量如下</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\">[root@www ~]# echo $PATH</div><div class=\"line\">/bin:/usr/bin:/sbin:/usr/sbin:/usr/local/bin:/usr/X11R6/bin:/usr/games</div><div class=\"line\"># 1 | 2       | 3   | 4       | 5            | 6            | 7</div></pre></td></tr></table></figure>\n<h3 id=\"将-PATH-变量取出，我要找出第五个路径。\"><a href=\"#将-PATH-变量取出，我要找出第五个路径。\" class=\"headerlink\" title=\"将 PATH 变量取出，我要找出第五个路径。\"></a>将 PATH 变量取出，我要找出第五个路径。</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\">#echo $PATH | cut -d &apos;:&apos; -f 5</div><div class=\"line\">/usr/local/bin</div></pre></td></tr></table></figure>\n<h3 id=\"将-PATH-变量取出，我要找出第三和第五个路径。\"><a href=\"#将-PATH-变量取出，我要找出第三和第五个路径。\" class=\"headerlink\" title=\"将 PATH 变量取出，我要找出第三和第五个路径。\"></a>将 PATH 变量取出，我要找出第三和第五个路径。</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\">#echo $PATH | cut -d &apos;:&apos; -f 3,5</div><div class=\"line\">/sbin:/usr/local/bin</div></pre></td></tr></table></figure>\n<h3 id=\"将-PATH-变量取出，我要找出第三到最后一个路径。\"><a href=\"#将-PATH-变量取出，我要找出第三到最后一个路径。\" class=\"headerlink\" title=\"将 PATH 变量取出，我要找出第三到最后一个路径。\"></a>将 PATH 变量取出，我要找出第三到最后一个路径。</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\">echo $PATH | cut -d &apos;:&apos; -f 3-</div><div class=\"line\">/sbin:/usr/sbin:/usr/local/bin:/usr/X11R6/bin:/usr/games</div></pre></td></tr></table></figure>\n<h3 id=\"将-PATH-变量取出，我要找出第一到第三个路径。\"><a href=\"#将-PATH-变量取出，我要找出第一到第三个路径。\" class=\"headerlink\" title=\"将 PATH 变量取出，我要找出第一到第三个路径。\"></a>将 PATH 变量取出，我要找出第一到第三个路径。</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\">#echo $PATH | cut -d &apos;:&apos; -f 1-3</div><div class=\"line\">/bin:/usr/bin:/sbin:</div></pre></td></tr></table></figure>\n<h3 id=\"将-PATH-变量取出，我要找出第一到第三，还有第五个路径。\"><a href=\"#将-PATH-变量取出，我要找出第一到第三，还有第五个路径。\" class=\"headerlink\" title=\"将 PATH 变量取出，我要找出第一到第三，还有第五个路径。\"></a>将 PATH 变量取出，我要找出第一到第三，还有第五个路径。</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\">echo $PATH | cut -d &apos;:&apos; -f 1-3,5</div><div class=\"line\">/bin:/usr/bin:/sbin:/usr/local/bin</div></pre></td></tr></table></figure>\n<h2 id=\"实用例子-只显示-etc-passwd的用户和shell\"><a href=\"#实用例子-只显示-etc-passwd的用户和shell\" class=\"headerlink\" title=\"实用例子:只显示/etc/passwd的用户和shell\"></a>实用例子:只显示/etc/passwd的用户和shell</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\">#cat /etc/passwd | cut -d &apos;:&apos; -f 1,7 </div><div class=\"line\">root:/bin/bash</div><div class=\"line\">daemon:/bin/sh</div><div class=\"line\">bin:/bin/sh</div></pre></td></tr></table></figure>\n<h1 id=\"sort命令\"><a href=\"#sort命令\" class=\"headerlink\" title=\"sort命令\"></a>sort命令</h1><p>sort 命令对 File 参数指定的文件中的行排序，并将结果写到标准输出。如果 File 参数指定多个文件，那么 sort 命令将这些文件连接起来，并当作一个文件进行排序。</p>\n<h2 id=\"语法-1\"><a href=\"#语法-1\" class=\"headerlink\" title=\"语法\"></a>语法</h2><p><code>[root@www ~]# sort [-fbMnrtuk] [file or stdin]</code><br>选项与参数：</p>\n<ul>\n<li>-f  ：忽略大小写的差异，例如 A 与 a 视为编码相同；</li>\n<li>-b  ：忽略最前面的空格符部分；</li>\n<li>-M  ：以月份的名字来排序，例如 JAN, DEC 等等的排序方法；</li>\n<li>-n  ：使用『纯数字』进行排序(默认是以文字型态来排序的)；</li>\n<li>-r  ：反向排序；</li>\n<li>-u  ：就是 uniq ，相同的数据中，仅出现一行代表；</li>\n<li>-t  ：分隔符，默认是用 [tab] 键来分隔；</li>\n<li>-k  ：以那个区间 (field) 来进行排序的意思</li>\n</ul>\n<h2 id=\"对-etc-passwd-的账号进行排序\"><a href=\"#对-etc-passwd-的账号进行排序\" class=\"headerlink\" title=\"对/etc/passwd 的账号进行排序\"></a>对/etc/passwd 的账号进行排序</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\">[root@www ~]<span class=\"comment\"># cat /etc/passwd | sort</span></div><div class=\"line\">adm:x:3:4:adm:/var/adm:/sbin/nologin</div><div class=\"line\">apache:x:48:48:Apache:/var/www:/sbin/nologin</div><div class=\"line\">bin:x:1:1:bin:/bin:/sbin/nologin</div><div class=\"line\">daemon:x:2:2:daemon:/sbin:/sbin/nologin</div></pre></td></tr></table></figure>\n<p>sort 是默认以第一个数据来排序，而且默认是以字符串形式来排序,所以由字母 a 开始升序排序。</p>\n<h2 id=\"etc-passwd-内容是以-来分隔的，我想以第三栏来排序，该如何\"><a href=\"#etc-passwd-内容是以-来分隔的，我想以第三栏来排序，该如何\" class=\"headerlink\" title=\"/etc/passwd 内容是以 : 来分隔的，我想以第三栏来排序，该如何\"></a>/etc/passwd 内容是以 : 来分隔的，我想以第三栏来排序，该如何</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\">[root@www ~]# cat /etc/passwd | sort -t &apos;:&apos; -k 3</div><div class=\"line\">root:x:0:0:root:/root:/bin/bash</div><div class=\"line\">uucp:x:10:14:uucp:/var/spool/uucp:/sbin/nologin</div><div class=\"line\">operator:x:11:0:operator:/root:/sbin/nologin</div><div class=\"line\">bin:x:1:1:bin:/bin:/sbin/nologin</div><div class=\"line\">games:x:12:100:games:/usr/games:/sbin/nologin</div></pre></td></tr></table></figure>\n<h2 id=\"默认是以字符串来排序的，如果想要使用数字排序：\"><a href=\"#默认是以字符串来排序的，如果想要使用数字排序：\" class=\"headerlink\" title=\"默认是以字符串来排序的，如果想要使用数字排序：\"></a>默认是以字符串来排序的，如果想要使用数字排序：</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\">cat /etc/passwd | sort -t &apos;:&apos; -k 3n</div><div class=\"line\">root:x:0:0:root:/root:/bin/bash</div><div class=\"line\">daemon:x:1:1:daemon:/usr/sbin:/bin/sh</div><div class=\"line\">bin:x:2:2:bin:/bin:/bin/sh</div></pre></td></tr></table></figure>\n<h2 id=\"默认是升序排序，如果要倒序排序，如下\"><a href=\"#默认是升序排序，如果要倒序排序，如下\" class=\"headerlink\" title=\"默认是升序排序，如果要倒序排序，如下\"></a>默认是升序排序，如果要倒序排序，如下</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\">cat /etc/passwd | sort -t &apos;:&apos; -k 3nr</div><div class=\"line\">nobody:x:65534:65534:nobody:/nonexistent:/bin/sh</div><div class=\"line\">ntp:x:106:113::/home/ntp:/bin/false</div><div class=\"line\">messagebus:x:105:109::/var/run/dbus:/bin/false</div><div class=\"line\">sshd:x:104:65534::/var/run/sshd:/usr/sbin/nologin</div></pre></td></tr></table></figure>\n<h2 id=\"如果要对-etc-passwd-先以第六个域的第2个字符到第4个字符进行正向排序，再基于第一个域进行反向排序。\"><a href=\"#如果要对-etc-passwd-先以第六个域的第2个字符到第4个字符进行正向排序，再基于第一个域进行反向排序。\" class=\"headerlink\" title=\"如果要对/etc/passwd,先以第六个域的第2个字符到第4个字符进行正向排序，再基于第一个域进行反向排序。\"></a>如果要对/etc/passwd,先以第六个域的第2个字符到第4个字符进行正向排序，再基于第一个域进行反向排序。</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\">cat /etc/passwd |  sort -t&apos;:&apos; -k 6.2,6.4 -k 1r      </div><div class=\"line\">sync:x:4:65534:sync:/bin:/bin/sync</div><div class=\"line\">proxy:x:13:13:proxy:/bin:/bin/sh</div><div class=\"line\">bin:x:2:2:bin:/bin:/bin/sh</div><div class=\"line\">sys:x:3:3:sys:/dev:/bin/sh</div></pre></td></tr></table></figure>\n<h2 id=\"查看-etc-passwd有多少个shell-对-etc-passwd的第七个域进行排序，然后去重\"><a href=\"#查看-etc-passwd有多少个shell-对-etc-passwd的第七个域进行排序，然后去重\" class=\"headerlink\" title=\"查看/etc/passwd有多少个shell:对/etc/passwd的第七个域进行排序，然后去重:\"></a>查看/etc/passwd有多少个shell:对/etc/passwd的第七个域进行排序，然后去重:</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\">cat /etc/passwd |  sort -t&apos;:&apos; -k 7 -u</div><div class=\"line\">root:x:0:0:root:/root:/bin/bash</div><div class=\"line\">syslog:x:101:102::/home/syslog:/bin/false</div><div class=\"line\">daemon:x:1:1:daemon:/usr/sbin:/bin/sh</div><div class=\"line\">sync:x:4:65534:sync:/bin:/bin/sync</div><div class=\"line\">sshd:x:104:65534::/var/run/sshd:/usr/sbin/nologin</div></pre></td></tr></table></figure>\n<h1 id=\"uniq去重命令\"><a href=\"#uniq去重命令\" class=\"headerlink\" title=\"uniq去重命令\"></a>uniq去重命令</h1><p> uniq命令可以去除排序过的文件中的重复行，因此uniq经常和sort合用。也就是说，为了使uniq起作用，所有的重复行必须是相邻的。</p>\n<h2 id=\"uniq语法\"><a href=\"#uniq语法\" class=\"headerlink\" title=\"uniq语法\"></a>uniq语法</h2><p><code>[root@www ~]# uniq [-icu]</code><br>选项与参数：</p>\n<ul>\n<li>-i   ：忽略大小写字符的不同；</li>\n<li>-c  ：进行计数</li>\n<li>-u  ：只显示唯一的行</li>\n</ul>\n<p>testfile的内容如下<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div></pre></td><td class=\"code\"><pre><div class=\"line\">cat testfile</div><div class=\"line\">hello</div><div class=\"line\">world</div><div class=\"line\">friend</div><div class=\"line\">hello</div><div class=\"line\">world</div><div class=\"line\">hello</div></pre></td></tr></table></figure></p>\n<p>直接删除未经排序的文件，将会发现没有任何行被删除<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div></pre></td><td class=\"code\"><pre><div class=\"line\">#uniq testfile  </div><div class=\"line\">hello</div><div class=\"line\">world</div><div class=\"line\">friend</div><div class=\"line\">hello</div><div class=\"line\">world</div><div class=\"line\">hello</div></pre></td></tr></table></figure></p>\n<p>排序文件，默认是去重<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\">#cat testfile | sort |uniq</div><div class=\"line\">friend</div><div class=\"line\">hello</div><div class=\"line\">world</div></pre></td></tr></table></figure></p>\n<p>排序之后删除了重复行，同时在行首位置输出该行重复的次数<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\">#sort testfile | uniq -c</div><div class=\"line\">1 friend</div><div class=\"line\">3 hello</div><div class=\"line\">2 world</div></pre></td></tr></table></figure></p>\n<p>仅显示存在重复的行，并在行首显示该行重复的次数<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\">#sort testfile | uniq -dc</div><div class=\"line\">3 hello</div><div class=\"line\">2 world</div></pre></td></tr></table></figure></p>\n<p>仅显示不重复的行<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\">sort testfile | uniq -u</div><div class=\"line\">friend</div></pre></td></tr></table></figure></p>\n<h1 id=\"wc命令\"><a href=\"#wc命令\" class=\"headerlink\" title=\"wc命令\"></a>wc命令</h1><h2 id=\"语法-2\"><a href=\"#语法-2\" class=\"headerlink\" title=\"语法\"></a>语法</h2><p><code>[root@www ~]# wc [-lwm]</code><br>选项与参数：</p>\n<ul>\n<li>-l  ：仅列出行；</li>\n<li>-w  ：仅列出多少字(英文单字)；</li>\n<li>-m  ：多少字符；<h2 id=\"默认使用wc统计-etc-passwd\"><a href=\"#默认使用wc统计-etc-passwd\" class=\"headerlink\" title=\"默认使用wc统计/etc/passwd\"></a>默认使用wc统计/etc/passwd</h2></li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\">#wc /etc/passwd</div><div class=\"line\">40   45 1719 /etc/passwd</div><div class=\"line\">40是行数，45是单词数，1719是字节数</div></pre></td></tr></table></figure>\n<p>wc的命令比较简单使用，每个参数使用如下：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div></pre></td><td class=\"code\"><pre><div class=\"line\">#wc -l /etc/passwd   #统计行数，在对记录数时，很常用</div><div class=\"line\">40 /etc/passwd       #表示系统有40个账户</div><div class=\"line\"></div><div class=\"line\">#wc -w /etc/passwd  #统计单词出现次数</div><div class=\"line\">45 /etc/passwd</div><div class=\"line\"></div><div class=\"line\">#wc -m /etc/passwd  #统计文件的字符数</div><div class=\"line\">1719</div></pre></td></tr></table></figure>\n","site":{"data":{}},"excerpt":"<h1 id=\"变量\"><a href=\"#变量\" class=\"headerlink\" title=\"变量\"></a>变量</h1><h2 id=\"系统变量\"><a href=\"#系统变量\" class=\"headerlink\" title=\"系统变量\"></a>系统变量</h2><ul>\n<li>$HOME</li>\n<li>$PWD</li>\n<li>$SHELL</li>\n<li>$USER<br>显示当前shell中所有变量</li>\n</ul>\n<p>set</p>","more":"<h2 id=\"用户自定义变量\"><a href=\"#用户自定义变量\" class=\"headerlink\" title=\"用户自定义变量\"></a>用户自定义变量</h2><p>定义变量</p>\n<blockquote>\n<p>STR=”hello world”</p>\n<p>A=9</p>\n<p>unset A 撤销变量 A</p>\n<p>readonly B=2 声明静态的变量 B=2 ，不能 unset</p>\n<p>export 变量名 可把变量提升为全局环境变量，可供其他shell程序使用</p>\n</blockquote>\n<p>将命令的返回值赋给变量</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\">A=`ls -la` 反引号，运行里面的命令，并把结果返回给变量A</div><div class=\"line\">A=$(ls -la) 等价于反引号</div></pre></td></tr></table></figure>\n<h2 id=\"shell中的特殊变量\"><a href=\"#shell中的特殊变量\" class=\"headerlink\" title=\"shell中的特殊变量\"></a>shell中的特殊变量</h2><ul>\n<li>$? 表示上一个命令退出的状态  true 0 false 1 错误127</li>\n<li>$$ 表示当前进程编号</li>\n<li>$0 表示当前脚本名称</li>\n<li>$n 表示n位置的输入参数（n代表数字，n&gt;=1）</li>\n<li>$#     表示参数的个数，常用于循环</li>\n<li>$*和$@ 都表示参数列表 <h3 id=\"与-区别\"><a href=\"#与-区别\" class=\"headerlink\" title=\"$*与$@区别\"></a>$*与$@区别</h3></li>\n<li>$* 和 $@ 都表示传递给函数或脚本的所有参数，不被双引号” “包含时，都以$1  $2  … $n 的形式输出所有参数  </li>\n<li>当它们被双引号” “包含时，”$*” 会将所有的参数作为一个整体，以”$1 $2 … $n”的形式输出所有参数；”$@” 会将各个参数分开，以”$1” “$2” … “$n” 的形式输出所有参数</li>\n</ul>\n<h2 id=\"运算符\"><a href=\"#运算符\" class=\"headerlink\" title=\"运算符\"></a>运算符</h2><blockquote>\n<p>格式 :expr m + n 或$((m+n)) 注意expr运算符间要有空格</p>\n</blockquote>\n<p>例如计算（2 ＋3 ）×4 的值<br>1 .分步计算\u000b    S=<code>expr 2 + 3</code>\u000b    expr $S * 4<br>2.一步完成计算<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\">expr `expr 2 + 3 ` \\* 4</div><div class=\"line\"><span class=\"built_in\">echo</span> `expr \\`expr 2 + 3\\` \\* 4`</div><div class=\"line\">或</div><div class=\"line\">$(((2+3)*4))</div></pre></td></tr></table></figure></p>\n<h1 id=\"for循环\"><a href=\"#for循环\" class=\"headerlink\" title=\"for循环\"></a>for循环</h1><h2 id=\"第一种：\"><a href=\"#第一种：\" class=\"headerlink\" title=\"第一种：\"></a>第一种：</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">for</span> N <span class=\"keyword\">in</span> 1 2 3</div><div class=\"line\"><span class=\"keyword\">do</span></div><div class=\"line\">\t<span class=\"built_in\">echo</span> <span class=\"variable\">$N</span></div><div class=\"line\"><span class=\"keyword\">done</span></div><div class=\"line\">或</div><div class=\"line\"><span class=\"keyword\">for</span> N <span class=\"keyword\">in</span> 1 2 3; <span class=\"keyword\">do</span> <span class=\"built_in\">echo</span> <span class=\"variable\">$N</span>; <span class=\"keyword\">done</span></div><div class=\"line\">或</div><div class=\"line\"><span class=\"keyword\">for</span> N <span class=\"keyword\">in</span> &#123;1..3&#125;; <span class=\"keyword\">do</span> <span class=\"built_in\">echo</span> <span class=\"variable\">$N</span>; <span class=\"keyword\">done</span></div></pre></td></tr></table></figure>\n<h2 id=\"第二种：\"><a href=\"#第二种：\" class=\"headerlink\" title=\"第二种：\"></a>第二种：</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">for</span> ((i = 0; i &lt;= 5; i++))</div><div class=\"line\"><span class=\"keyword\">do</span></div><div class=\"line\">\t<span class=\"built_in\">echo</span> <span class=\"string\">\"welcome <span class=\"variable\">$i</span> times\"</span></div><div class=\"line\"><span class=\"keyword\">done</span></div><div class=\"line\">或</div><div class=\"line\"><span class=\"keyword\">for</span> ((i = 0; i &lt;= 5; i++)); <span class=\"keyword\">do</span> <span class=\"built_in\">echo</span> <span class=\"string\">\"welcome <span class=\"variable\">$i</span> times\"</span>; <span class=\"keyword\">done</span></div></pre></td></tr></table></figure>\n<h1 id=\"while循环\"><a href=\"#while循环\" class=\"headerlink\" title=\"while循环\"></a>while循环</h1><h2 id=\"第一种\"><a href=\"#第一种\" class=\"headerlink\" title=\"第一种\"></a>第一种</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">while</span> expression</div><div class=\"line\"><span class=\"keyword\">do</span></div><div class=\"line\"><span class=\"built_in\">command</span></div><div class=\"line\">…</div><div class=\"line\"><span class=\"keyword\">done</span></div></pre></td></tr></table></figure>\n<h2 id=\"第二种\"><a href=\"#第二种\" class=\"headerlink\" title=\"第二种\"></a>第二种</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\">i=1</div><div class=\"line\"><span class=\"keyword\">while</span> ((i&lt;=3))</div><div class=\"line\"><span class=\"keyword\">do</span></div><div class=\"line\">  <span class=\"built_in\">echo</span> <span class=\"variable\">$i</span></div><div class=\"line\">  <span class=\"built_in\">let</span> i++</div><div class=\"line\"><span class=\"keyword\">done</span></div></pre></td></tr></table></figure>\n<h1 id=\"case语句\"><a href=\"#case语句\" class=\"headerlink\" title=\"case语句\"></a>case语句</h1><p>格式<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">case</span> <span class=\"variable\">$1</span> <span class=\"keyword\">in</span></div><div class=\"line\">start)</div><div class=\"line\">\t<span class=\"built_in\">echo</span> <span class=\"string\">\"starting\"</span></div><div class=\"line\">\t;;</div><div class=\"line\">stop)</div><div class=\"line\">\t<span class=\"built_in\">echo</span> <span class=\"string\">\"stoping\"</span></div><div class=\"line\">\t;;</div><div class=\"line\">*)</div><div class=\"line\">\t<span class=\"built_in\">echo</span> <span class=\"string\">\"Usage: &#123;start|stop&#125; “</span></div><div class=\"line\"><span class=\"string\">esac</span></div></pre></td></tr></table></figure></p>\n<h1 id=\"read命令\"><a href=\"#read命令\" class=\"headerlink\" title=\"read命令\"></a>read命令</h1><p>read -p(提示语句)-n(字符个数) -t(等待时间)<br>    read -p “please input your name: “ NAME</p>\n<p>使用示例：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\">[vagrant@mysql1 ~]$ read -p &quot;please enter a number:&quot; numb</div><div class=\"line\">please enter a number:1</div><div class=\"line\">[vagrant@mysql1 ~]$ echo $numb</div><div class=\"line\">1</div><div class=\"line\">[vagrant@mysql1 ~]$</div></pre></td></tr></table></figure></p>\n<h1 id=\"if判断\"><a href=\"#if判断\" class=\"headerlink\" title=\"if判断\"></a>if判断</h1><p>语法<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">if</span> condition </div><div class=\"line\"><span class=\"keyword\">then</span> </div><div class=\"line\">    statements</div><div class=\"line\">[<span class=\"keyword\">elif</span> condition </div><div class=\"line\">    <span class=\"keyword\">then</span> statements. ..] </div><div class=\"line\">[<span class=\"keyword\">else</span> </div><div class=\"line\">    statements ] </div><div class=\"line\"><span class=\"keyword\">fi</span></div></pre></td></tr></table></figure></p>\n<h1 id=\"判断语句\"><a href=\"#判断语句\" class=\"headerlink\" title=\"判断语句\"></a>判断语句</h1><p>[ condition ] <strong>(注意condition前后要有空格)</strong></p>\n<p>#非空返回true，可使用$?验证（0为true，&gt;1为false）<br>[ test ]</p>\n<p>#空返回false<br>[  ]</p>\n<blockquote>\n<p>[ condition ] &amp;&amp; echo OK || echo notok</p>\n</blockquote>\n<p>条件满足，执行后面的语句 不满足执行 || 后面的语句</p>\n<h1 id=\"常用判断条件\"><a href=\"#常用判断条件\" class=\"headerlink\" title=\"常用判断条件\"></a>常用判断条件</h1><ul>\n<li>= 字符串比较</li>\n<li>-lt 小于</li>\n<li>-le 小于等于</li>\n<li>-eq 等于</li>\n<li>-gt 大于</li>\n<li>-ge 大于等于</li>\n<li><p>-ne 不等于</p>\n</li>\n<li><p>-r 有读的权限</p>\n</li>\n<li>-w 有写的权限</li>\n<li>-x 有执行的权限</li>\n<li><strong>-f 文件存在并且是一个常规的文件</strong></li>\n<li>-s 文件存在且不为空</li>\n<li>-d 文件存在并是一个目录</li>\n<li>-b文件存在并且是一个块设备</li>\n<li>-L 文件存在并且是一个链接</li>\n</ul>\n<h1 id=\"Shell自定义函数\"><a href=\"#Shell自定义函数\" class=\"headerlink\" title=\"Shell自定义函数\"></a>Shell自定义函数</h1><p>语法<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\"> [ <span class=\"keyword\">function</span> ] funname [()]</div><div class=\"line\">&#123;</div><div class=\"line\">    action;</div><div class=\"line\">    [<span class=\"built_in\">return</span> int;]</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>三种声明方式:</p>\n<ul>\n<li>function start()  </li>\n<li>function start </li>\n<li>start()</li>\n</ul>\n<p>注意</p>\n<ol>\n<li>必须在调用函数地方之前，先声明函数，shell脚本是逐行运行。不会像其它语言一样先预编译</li>\n<li>函数返回值，只能通过$? 系统变量获得，可以显示加：return 返回，如果不加，将以最后一条命令运行结果，作为返回值。 return后跟数值n(0-255)</li>\n</ol>\n<h2 id=\"例子\"><a href=\"#例子\" class=\"headerlink\" title=\"例子\"></a>例子</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">#!/bin/bash</span></div><div class=\"line\">fSum 3 2;</div><div class=\"line\"><span class=\"keyword\">function</span> fSum()</div><div class=\"line\">&#123;</div><div class=\"line\">    <span class=\"built_in\">echo</span> <span class=\"variable\">$1</span>,<span class=\"variable\">$2</span>;</div><div class=\"line\">    <span class=\"built_in\">return</span> $((<span class=\"variable\">$1</span>+<span class=\"variable\">$2</span>));</div><div class=\"line\">&#125;</div><div class=\"line\">fSum 5 7;</div><div class=\"line\">total=$?;</div><div class=\"line\"><span class=\"built_in\">echo</span> <span class=\"variable\">$total</span>,$?;</div></pre></td></tr></table></figure>\n<p>结果<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\">[vagrant@mysql1 ~]$ sh test </div><div class=\"line\">test: line 2: fSum: command not found</div><div class=\"line\">5,7</div><div class=\"line\">12,0</div></pre></td></tr></table></figure></p>\n<h1 id=\"脚本调试\"><a href=\"#脚本调试\" class=\"headerlink\" title=\"脚本调试\"></a>脚本调试</h1><ul>\n<li>sh -vx helloWorld.sh</li>\n<li>或者在脚本中增加set -x</li>\n</ul>\n<h1 id=\"cut命令\"><a href=\"#cut命令\" class=\"headerlink\" title=\"cut命令\"></a>cut命令</h1><p>cut命令可以从一个文本文件或者文本流中提取文本列。</p>\n<h2 id=\"语法\"><a href=\"#语法\" class=\"headerlink\" title=\"语法\"></a>语法</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\">cut -d&apos;分隔字符&apos; -f fields &lt;==用于有特定分隔字符</div><div class=\"line\">cut -c 字符区间            &lt;==用于排列整齐的信息</div></pre></td></tr></table></figure>\n<ul>\n<li>-d  ：后面接分隔字符。与 -f 一起使用；</li>\n<li>-f  ：依据 -d 的分隔字符将一段信息分割成为数段，用 -f 取出第几段的意思；</li>\n<li>-c  ：以字符 (characters) 的单位取出固定字符区间；</li>\n</ul>\n<h2 id=\"例子-1\"><a href=\"#例子-1\" class=\"headerlink\" title=\"例子\"></a>例子</h2><h3 id=\"PATH-变量如下\"><a href=\"#PATH-变量如下\" class=\"headerlink\" title=\"PATH 变量如下\"></a>PATH 变量如下</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\">[root@www ~]# echo $PATH</div><div class=\"line\">/bin:/usr/bin:/sbin:/usr/sbin:/usr/local/bin:/usr/X11R6/bin:/usr/games</div><div class=\"line\"># 1 | 2       | 3   | 4       | 5            | 6            | 7</div></pre></td></tr></table></figure>\n<h3 id=\"将-PATH-变量取出，我要找出第五个路径。\"><a href=\"#将-PATH-变量取出，我要找出第五个路径。\" class=\"headerlink\" title=\"将 PATH 变量取出，我要找出第五个路径。\"></a>将 PATH 变量取出，我要找出第五个路径。</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\">#echo $PATH | cut -d &apos;:&apos; -f 5</div><div class=\"line\">/usr/local/bin</div></pre></td></tr></table></figure>\n<h3 id=\"将-PATH-变量取出，我要找出第三和第五个路径。\"><a href=\"#将-PATH-变量取出，我要找出第三和第五个路径。\" class=\"headerlink\" title=\"将 PATH 变量取出，我要找出第三和第五个路径。\"></a>将 PATH 变量取出，我要找出第三和第五个路径。</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\">#echo $PATH | cut -d &apos;:&apos; -f 3,5</div><div class=\"line\">/sbin:/usr/local/bin</div></pre></td></tr></table></figure>\n<h3 id=\"将-PATH-变量取出，我要找出第三到最后一个路径。\"><a href=\"#将-PATH-变量取出，我要找出第三到最后一个路径。\" class=\"headerlink\" title=\"将 PATH 变量取出，我要找出第三到最后一个路径。\"></a>将 PATH 变量取出，我要找出第三到最后一个路径。</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\">echo $PATH | cut -d &apos;:&apos; -f 3-</div><div class=\"line\">/sbin:/usr/sbin:/usr/local/bin:/usr/X11R6/bin:/usr/games</div></pre></td></tr></table></figure>\n<h3 id=\"将-PATH-变量取出，我要找出第一到第三个路径。\"><a href=\"#将-PATH-变量取出，我要找出第一到第三个路径。\" class=\"headerlink\" title=\"将 PATH 变量取出，我要找出第一到第三个路径。\"></a>将 PATH 变量取出，我要找出第一到第三个路径。</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\">#echo $PATH | cut -d &apos;:&apos; -f 1-3</div><div class=\"line\">/bin:/usr/bin:/sbin:</div></pre></td></tr></table></figure>\n<h3 id=\"将-PATH-变量取出，我要找出第一到第三，还有第五个路径。\"><a href=\"#将-PATH-变量取出，我要找出第一到第三，还有第五个路径。\" class=\"headerlink\" title=\"将 PATH 变量取出，我要找出第一到第三，还有第五个路径。\"></a>将 PATH 变量取出，我要找出第一到第三，还有第五个路径。</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\">echo $PATH | cut -d &apos;:&apos; -f 1-3,5</div><div class=\"line\">/bin:/usr/bin:/sbin:/usr/local/bin</div></pre></td></tr></table></figure>\n<h2 id=\"实用例子-只显示-etc-passwd的用户和shell\"><a href=\"#实用例子-只显示-etc-passwd的用户和shell\" class=\"headerlink\" title=\"实用例子:只显示/etc/passwd的用户和shell\"></a>实用例子:只显示/etc/passwd的用户和shell</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\">#cat /etc/passwd | cut -d &apos;:&apos; -f 1,7 </div><div class=\"line\">root:/bin/bash</div><div class=\"line\">daemon:/bin/sh</div><div class=\"line\">bin:/bin/sh</div></pre></td></tr></table></figure>\n<h1 id=\"sort命令\"><a href=\"#sort命令\" class=\"headerlink\" title=\"sort命令\"></a>sort命令</h1><p>sort 命令对 File 参数指定的文件中的行排序，并将结果写到标准输出。如果 File 参数指定多个文件，那么 sort 命令将这些文件连接起来，并当作一个文件进行排序。</p>\n<h2 id=\"语法-1\"><a href=\"#语法-1\" class=\"headerlink\" title=\"语法\"></a>语法</h2><p><code>[root@www ~]# sort [-fbMnrtuk] [file or stdin]</code><br>选项与参数：</p>\n<ul>\n<li>-f  ：忽略大小写的差异，例如 A 与 a 视为编码相同；</li>\n<li>-b  ：忽略最前面的空格符部分；</li>\n<li>-M  ：以月份的名字来排序，例如 JAN, DEC 等等的排序方法；</li>\n<li>-n  ：使用『纯数字』进行排序(默认是以文字型态来排序的)；</li>\n<li>-r  ：反向排序；</li>\n<li>-u  ：就是 uniq ，相同的数据中，仅出现一行代表；</li>\n<li>-t  ：分隔符，默认是用 [tab] 键来分隔；</li>\n<li>-k  ：以那个区间 (field) 来进行排序的意思</li>\n</ul>\n<h2 id=\"对-etc-passwd-的账号进行排序\"><a href=\"#对-etc-passwd-的账号进行排序\" class=\"headerlink\" title=\"对/etc/passwd 的账号进行排序\"></a>对/etc/passwd 的账号进行排序</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\">[root@www ~]<span class=\"comment\"># cat /etc/passwd | sort</span></div><div class=\"line\">adm:x:3:4:adm:/var/adm:/sbin/nologin</div><div class=\"line\">apache:x:48:48:Apache:/var/www:/sbin/nologin</div><div class=\"line\">bin:x:1:1:bin:/bin:/sbin/nologin</div><div class=\"line\">daemon:x:2:2:daemon:/sbin:/sbin/nologin</div></pre></td></tr></table></figure>\n<p>sort 是默认以第一个数据来排序，而且默认是以字符串形式来排序,所以由字母 a 开始升序排序。</p>\n<h2 id=\"etc-passwd-内容是以-来分隔的，我想以第三栏来排序，该如何\"><a href=\"#etc-passwd-内容是以-来分隔的，我想以第三栏来排序，该如何\" class=\"headerlink\" title=\"/etc/passwd 内容是以 : 来分隔的，我想以第三栏来排序，该如何\"></a>/etc/passwd 内容是以 : 来分隔的，我想以第三栏来排序，该如何</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\">[root@www ~]# cat /etc/passwd | sort -t &apos;:&apos; -k 3</div><div class=\"line\">root:x:0:0:root:/root:/bin/bash</div><div class=\"line\">uucp:x:10:14:uucp:/var/spool/uucp:/sbin/nologin</div><div class=\"line\">operator:x:11:0:operator:/root:/sbin/nologin</div><div class=\"line\">bin:x:1:1:bin:/bin:/sbin/nologin</div><div class=\"line\">games:x:12:100:games:/usr/games:/sbin/nologin</div></pre></td></tr></table></figure>\n<h2 id=\"默认是以字符串来排序的，如果想要使用数字排序：\"><a href=\"#默认是以字符串来排序的，如果想要使用数字排序：\" class=\"headerlink\" title=\"默认是以字符串来排序的，如果想要使用数字排序：\"></a>默认是以字符串来排序的，如果想要使用数字排序：</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\">cat /etc/passwd | sort -t &apos;:&apos; -k 3n</div><div class=\"line\">root:x:0:0:root:/root:/bin/bash</div><div class=\"line\">daemon:x:1:1:daemon:/usr/sbin:/bin/sh</div><div class=\"line\">bin:x:2:2:bin:/bin:/bin/sh</div></pre></td></tr></table></figure>\n<h2 id=\"默认是升序排序，如果要倒序排序，如下\"><a href=\"#默认是升序排序，如果要倒序排序，如下\" class=\"headerlink\" title=\"默认是升序排序，如果要倒序排序，如下\"></a>默认是升序排序，如果要倒序排序，如下</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\">cat /etc/passwd | sort -t &apos;:&apos; -k 3nr</div><div class=\"line\">nobody:x:65534:65534:nobody:/nonexistent:/bin/sh</div><div class=\"line\">ntp:x:106:113::/home/ntp:/bin/false</div><div class=\"line\">messagebus:x:105:109::/var/run/dbus:/bin/false</div><div class=\"line\">sshd:x:104:65534::/var/run/sshd:/usr/sbin/nologin</div></pre></td></tr></table></figure>\n<h2 id=\"如果要对-etc-passwd-先以第六个域的第2个字符到第4个字符进行正向排序，再基于第一个域进行反向排序。\"><a href=\"#如果要对-etc-passwd-先以第六个域的第2个字符到第4个字符进行正向排序，再基于第一个域进行反向排序。\" class=\"headerlink\" title=\"如果要对/etc/passwd,先以第六个域的第2个字符到第4个字符进行正向排序，再基于第一个域进行反向排序。\"></a>如果要对/etc/passwd,先以第六个域的第2个字符到第4个字符进行正向排序，再基于第一个域进行反向排序。</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\">cat /etc/passwd |  sort -t&apos;:&apos; -k 6.2,6.4 -k 1r      </div><div class=\"line\">sync:x:4:65534:sync:/bin:/bin/sync</div><div class=\"line\">proxy:x:13:13:proxy:/bin:/bin/sh</div><div class=\"line\">bin:x:2:2:bin:/bin:/bin/sh</div><div class=\"line\">sys:x:3:3:sys:/dev:/bin/sh</div></pre></td></tr></table></figure>\n<h2 id=\"查看-etc-passwd有多少个shell-对-etc-passwd的第七个域进行排序，然后去重\"><a href=\"#查看-etc-passwd有多少个shell-对-etc-passwd的第七个域进行排序，然后去重\" class=\"headerlink\" title=\"查看/etc/passwd有多少个shell:对/etc/passwd的第七个域进行排序，然后去重:\"></a>查看/etc/passwd有多少个shell:对/etc/passwd的第七个域进行排序，然后去重:</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\">cat /etc/passwd |  sort -t&apos;:&apos; -k 7 -u</div><div class=\"line\">root:x:0:0:root:/root:/bin/bash</div><div class=\"line\">syslog:x:101:102::/home/syslog:/bin/false</div><div class=\"line\">daemon:x:1:1:daemon:/usr/sbin:/bin/sh</div><div class=\"line\">sync:x:4:65534:sync:/bin:/bin/sync</div><div class=\"line\">sshd:x:104:65534::/var/run/sshd:/usr/sbin/nologin</div></pre></td></tr></table></figure>\n<h1 id=\"uniq去重命令\"><a href=\"#uniq去重命令\" class=\"headerlink\" title=\"uniq去重命令\"></a>uniq去重命令</h1><p> uniq命令可以去除排序过的文件中的重复行，因此uniq经常和sort合用。也就是说，为了使uniq起作用，所有的重复行必须是相邻的。</p>\n<h2 id=\"uniq语法\"><a href=\"#uniq语法\" class=\"headerlink\" title=\"uniq语法\"></a>uniq语法</h2><p><code>[root@www ~]# uniq [-icu]</code><br>选项与参数：</p>\n<ul>\n<li>-i   ：忽略大小写字符的不同；</li>\n<li>-c  ：进行计数</li>\n<li>-u  ：只显示唯一的行</li>\n</ul>\n<p>testfile的内容如下<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div></pre></td><td class=\"code\"><pre><div class=\"line\">cat testfile</div><div class=\"line\">hello</div><div class=\"line\">world</div><div class=\"line\">friend</div><div class=\"line\">hello</div><div class=\"line\">world</div><div class=\"line\">hello</div></pre></td></tr></table></figure></p>\n<p>直接删除未经排序的文件，将会发现没有任何行被删除<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div></pre></td><td class=\"code\"><pre><div class=\"line\">#uniq testfile  </div><div class=\"line\">hello</div><div class=\"line\">world</div><div class=\"line\">friend</div><div class=\"line\">hello</div><div class=\"line\">world</div><div class=\"line\">hello</div></pre></td></tr></table></figure></p>\n<p>排序文件，默认是去重<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\">#cat testfile | sort |uniq</div><div class=\"line\">friend</div><div class=\"line\">hello</div><div class=\"line\">world</div></pre></td></tr></table></figure></p>\n<p>排序之后删除了重复行，同时在行首位置输出该行重复的次数<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\">#sort testfile | uniq -c</div><div class=\"line\">1 friend</div><div class=\"line\">3 hello</div><div class=\"line\">2 world</div></pre></td></tr></table></figure></p>\n<p>仅显示存在重复的行，并在行首显示该行重复的次数<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\">#sort testfile | uniq -dc</div><div class=\"line\">3 hello</div><div class=\"line\">2 world</div></pre></td></tr></table></figure></p>\n<p>仅显示不重复的行<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\">sort testfile | uniq -u</div><div class=\"line\">friend</div></pre></td></tr></table></figure></p>\n<h1 id=\"wc命令\"><a href=\"#wc命令\" class=\"headerlink\" title=\"wc命令\"></a>wc命令</h1><h2 id=\"语法-2\"><a href=\"#语法-2\" class=\"headerlink\" title=\"语法\"></a>语法</h2><p><code>[root@www ~]# wc [-lwm]</code><br>选项与参数：</p>\n<ul>\n<li>-l  ：仅列出行；</li>\n<li>-w  ：仅列出多少字(英文单字)；</li>\n<li>-m  ：多少字符；<h2 id=\"默认使用wc统计-etc-passwd\"><a href=\"#默认使用wc统计-etc-passwd\" class=\"headerlink\" title=\"默认使用wc统计/etc/passwd\"></a>默认使用wc统计/etc/passwd</h2></li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\">#wc /etc/passwd</div><div class=\"line\">40   45 1719 /etc/passwd</div><div class=\"line\">40是行数，45是单词数，1719是字节数</div></pre></td></tr></table></figure>\n<p>wc的命令比较简单使用，每个参数使用如下：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div></pre></td><td class=\"code\"><pre><div class=\"line\">#wc -l /etc/passwd   #统计行数，在对记录数时，很常用</div><div class=\"line\">40 /etc/passwd       #表示系统有40个账户</div><div class=\"line\"></div><div class=\"line\">#wc -w /etc/passwd  #统计单词出现次数</div><div class=\"line\">45 /etc/passwd</div><div class=\"line\"></div><div class=\"line\">#wc -m /etc/passwd  #统计文件的字符数</div><div class=\"line\">1719</div></pre></td></tr></table></figure>"},{"title":"大数据02-04-shell编程-sed命令","toc":true,"date":"2017-11-06T15:02:56.000Z","scaffolds":null,"_content":"# Sed简介\nsed 是一种在线编辑器，它一次处理一行内容。处理时，把当前处理的行存储在临时缓冲区中，称为“模式空间”（pattern space），接着用sed命令处理缓冲区中的内容，处理完成后，把缓冲区的内容送往屏幕。接着处理下一行，这样不断重复，直到文件末尾。文件内容并没有 改变，除非你使用重定向存储输出。Sed主要用来自动编辑一个或多个文件；简化对文件的反复操作；编写转换程序等。以下介绍的是Gnu版本的Sed 3.02。做备份,以后速查用.\n<!-- more -->\n## 定址\n可以通过定址来定位你所希望编辑的行，该地址用数字构成，用逗号分隔的两个行数表示以这两行为起止的行的范围（包括行数表示的那两行）。如1，3表示1，2，3行，美元符号($)表示最后一行。范围可以通过数据，正则表达式或者二者结合的方式确定 。\n\n## Sed命令\n调用sed命令有两种形式：\n* sed [options] 'command' file(s)\n* sed [options] -f scriptfile file(s)\n  * a\n  在当前行后面加入一行文本。\n  * b lable\n  分支到脚本中带有标记的地方，如果分支不存在则分支到脚本的末尾。\n  * c\n  用新的文本改变本行的文本。\n  * d\n  从模板块（Pattern space）位置删除行。\n  * D\n  删除模板块的第一行。\n  * i\n  在当前行上面插入文本。\n  * h\n  拷贝模板块的内容到内存中的缓冲区。\n  * H\n  追加模板块的内容到内存中的缓冲区\n  * g\n  获得内存缓冲区的内容，并替代当前模板块中的文本。\n  * G\n  获得内存缓冲区的内容，并追加到当前模板块文本的后面。\n  * l\n  列表不能打印字符的清单。\n  * n\n  读取下一个输入行，用下一个命令处理新的行而不是用第一个命令。\n  * N\n  追加下一个输入行到模板块后面并在二者间嵌入一个新行，改变当前行号码。\n  * p\n  打印模板块的行。\n  * P（大写）\n  打印模板块的第一行。\n  * q\n  退出Sed。\n  * r file\n  从file中读行。\n  * t label\n  if分支，从最后一行开始，条件一旦满足或者T，t命令，将导致分支到带有标号的命令处，或者到脚本的末尾。\n  * T label\n  错误分支，从最后一行开始，一旦发生错误或者T，t命令，将导致分支到带有标号的命令处，或者到脚本的末尾。\n  * w file\n  写并追加模板块到file末尾。\n  * W file\n  写并追加模板块的第一行到file末尾。\n  * !\n  表示后面的命令对所有没有被选定的行发生作用。\n  * s/re/string\n  用string替换正则表达式re。\n  * =\n  打印当前行号码。\n  * #把注释扩展到下一个换行符以前。\n### 以下的是替换标记\n* g表示行内全面替换。\n* p表示打印行。\n* w表示把行写入一个文件。\n* x表示互换模板块中的文本和缓冲区中的文本。\n* y表示把一个字符翻译为另外的字符（但是不用于正则表达式）\n\n## 选项\n`-e command, --expression=command`\n允许多台编辑。\n* -h, --help\n打印帮助，并显示bug列表的地址。\n* -n, --quiet, --silent\n取消默认输出。\n* -f, --filer=script-file\n引导sed脚本文件名。\n* -V, --version\n打印版本和版权信息。\n\n## 元字符集^\n锚定行的开始 如：/^sed/匹配所有以sed开头的行。 \n$\n* 锚定行的结束 如：/sed$/匹配所有以sed结尾的行。 \n.\n* 匹配一个非换行符的字符 如：/s.d/匹配s后接一个任意字符，然后是d。 \n*\n* 匹配零或多个字符 如：/*sed/匹配所有模板是一个或多个空格后紧跟sed的行。 \n[]\n* 匹配一个指定范围内的字符，如/[Ss]ed/匹配sed和Sed。 \n[^]\n* 匹配一个不在指定范围内的字符，如：/[^A-RT-Z]ed/匹配不包含A-R和T-Z的一个字母开头，紧跟ed的行。 \n\\(..\\)\n* 保存匹配的字符，如s/\\(love\\)able/\\1rs，loveable被替换成lovers。 \n&\n* 保存搜索字符用来替换其他字符，如s/love/**&**/，love这成**love**。 \n\\<\n* 锚定单词的开始，如:/\\<love/匹配包含以love开头的单词的行。 \n\\>\n* 锚定单词的结束，如/love\\>/匹配包含以love结尾的单词的行。 \nx\\{m\\}\n* 重复字符x，m次，如：/o\\{5\\}/匹配包含5个o的行。 \nx\\{m,\\}\n* 重复字符x,至少m次，如：/o\\{5,\\}/匹配至少有5个o的行。 \nx\\{m,n\\}\n* 重复字符x，至少m次，不多于n次，如：/o\\{5,10\\}/匹配5--10个o的行。\n## 实例\n### 删除：d命令\n* $ sed '2d' example-----删除example文件的第二行。\n* $ sed '2,$d' example-----删除example文件的第二行到末尾所有行。\n* $ sed '$d' example-----删除example文件的最后一行。\n* $ sed '/test/'d example-----删除example文件所有包含test的行。\n### 替换：s命令\n* $ sed 's/test/mytest/g' example-----在整行范围内把test替换为mytest。如果没有g标记，则只有每行第一个匹配的test被替换成mytest。\n* $ sed -n 's/^test/mytest/p' example-----(-n)选项和p标志一起使用表示只打印那些发生替换的行。也就是说，如果某一行开头的test被替换成mytest，就打印它。\n* $ sed 's/^192.168.0.1/&localhost/' example-----&符号表示替换换字符串中被找到的部份。所有以192.168.0.1开头的行都会被替换成它自已加 localhost，变成192.168.0.1localhost。\n* $ sed -n 's/\\(love\\)able/\\1rs/p' example-----love被标记为1，所有loveable会被替换成lovers，而且替换的行会被打印出来。\n* $ sed 's#10#100#g' example-----不论什么字符，紧跟着s命令的都被认为是新的分隔符，所以，“#”在这里是分隔符，代替了默认的“/”分隔符。表示把所有10替换成100。\n选定行的范围：逗号\n* $ sed -n '/test/,/check/p' example-----所有在模板test和check所确定的范围内的行都被打印。\n* $ sed -n '5,/^test/p' example-----打印从第五行开始到第一个包含以test开始的行之间的所有行。\n* $ sed '/test/,/check/s/$/sed test/' example-----对于模板test和west之间的行，每行的末尾用字符串sed test替换。\n### 多点编辑：e命令\n* $ sed -e '1,5d' -e 's/test/check/' example-----(-e)选项允许在同一行里执行多条命令。如例子所示，第一条命令删除1至5行，第二条命令用check替换test。命令的执 行顺序对结果有影响。如果两个命令都是替换命令，那么第一个替换命令将影响第二个替换命令的结果。\n* $ sed --expression='s/test/check/' --expression='/love/d' example-----一个比-e更好的命令是--expression。它能给sed表达式赋值。\n### 从文件读入：r命令\n* $ sed '/test/r file' example-----file里的内容被读进来，显示在与test匹配的行后面，如果匹配多行，则file的内容将显示在所有匹配行的下面。\n### 写入文件：w命令\n* $ sed -n '/test/w file' example-----在example中所有包含test的行都被写入file里。\n### 追加命令：a命令\n\n* $ sed '/^test/a\\\\--->this is a example' example    '----->this is a example'被追加到以test开头的行后面，sed要求命令a后面有一个反斜杠。\n### 插入：i命令\n* $ sed '/test/i\\\\\nnew line\n-------------------------' example\n如果test被匹配，则把反斜杠后面的文本插入到匹配行的前面。\n下一个：n命令\n* $ sed '/test/{ n; s/aa/bb/; }' example-----如果test被匹配，则移动到匹配行的下一行，替换这一行的aa，变为bb，并打印该行，然后继续。\n变形：y命令\n\n* $ sed '1,10y/abcde/ABCDE/' example-----把1--10行内所有abcde转变为大写，注意，正则表达式元字符不能使用这个命令。\n退出：q命令\n* $ sed '10q' example-----打印完第10行后，退出sed。\n保持和获取：h命令和G命令\n* $ sed -e '/test/h' -e '$G example-----在sed处理文件的时候，每一行都被保存在一个叫模式空间的临时缓冲区中，除非行被删除或者输出被取消，否则所有被处理的行都将 打印在屏幕上。接着模式空间被清空，并存入新的一行等待处理。在这个例子里，匹配test的行被找到后，将存入模式空间，h命令将其复制并存入一个称为保 持缓存区的特殊缓冲区内。第二条语句的意思是，当到达最后一行后，G命令取出保持缓冲区的行，然后把它放回模式空间中，且追加到现在已经存在于模式空间中 的行的末尾。在这个例子中就是追加到最后一行。简单来说，任何包含test的行都被复制并追加到该文件的末尾。\n保持和互换：h命令和x命令\n* $ sed -e '/test/h' -e '/check/x' example -----互换模式空间和保持缓冲区的内容。也就是把包含test与check的行互换。\n### 脚本\nSed脚本是一个sed的命令清单，启动Sed时以-f选项引导脚本文件名。Sed对于脚本中输入的命令非常挑剔，在命令的末尾不能有任何空白或文本，如果在一行中有多个命令，要用分号分隔。以#开头的行为注释行，且不能跨行。\n","source":"_posts/大数据/大数据02-04-shell编程-sed命令.md","raw":"---\ntitle: 大数据02-04-shell编程-sed命令\ncategories: 学习\ntags:\n  - 大数据\n  - linux\n  - centos7\n  - linux命令\ntoc: true\ndate: 2017-11-06 23:02:56\nscaffolds:\n---\n# Sed简介\nsed 是一种在线编辑器，它一次处理一行内容。处理时，把当前处理的行存储在临时缓冲区中，称为“模式空间”（pattern space），接着用sed命令处理缓冲区中的内容，处理完成后，把缓冲区的内容送往屏幕。接着处理下一行，这样不断重复，直到文件末尾。文件内容并没有 改变，除非你使用重定向存储输出。Sed主要用来自动编辑一个或多个文件；简化对文件的反复操作；编写转换程序等。以下介绍的是Gnu版本的Sed 3.02。做备份,以后速查用.\n<!-- more -->\n## 定址\n可以通过定址来定位你所希望编辑的行，该地址用数字构成，用逗号分隔的两个行数表示以这两行为起止的行的范围（包括行数表示的那两行）。如1，3表示1，2，3行，美元符号($)表示最后一行。范围可以通过数据，正则表达式或者二者结合的方式确定 。\n\n## Sed命令\n调用sed命令有两种形式：\n* sed [options] 'command' file(s)\n* sed [options] -f scriptfile file(s)\n  * a\n  在当前行后面加入一行文本。\n  * b lable\n  分支到脚本中带有标记的地方，如果分支不存在则分支到脚本的末尾。\n  * c\n  用新的文本改变本行的文本。\n  * d\n  从模板块（Pattern space）位置删除行。\n  * D\n  删除模板块的第一行。\n  * i\n  在当前行上面插入文本。\n  * h\n  拷贝模板块的内容到内存中的缓冲区。\n  * H\n  追加模板块的内容到内存中的缓冲区\n  * g\n  获得内存缓冲区的内容，并替代当前模板块中的文本。\n  * G\n  获得内存缓冲区的内容，并追加到当前模板块文本的后面。\n  * l\n  列表不能打印字符的清单。\n  * n\n  读取下一个输入行，用下一个命令处理新的行而不是用第一个命令。\n  * N\n  追加下一个输入行到模板块后面并在二者间嵌入一个新行，改变当前行号码。\n  * p\n  打印模板块的行。\n  * P（大写）\n  打印模板块的第一行。\n  * q\n  退出Sed。\n  * r file\n  从file中读行。\n  * t label\n  if分支，从最后一行开始，条件一旦满足或者T，t命令，将导致分支到带有标号的命令处，或者到脚本的末尾。\n  * T label\n  错误分支，从最后一行开始，一旦发生错误或者T，t命令，将导致分支到带有标号的命令处，或者到脚本的末尾。\n  * w file\n  写并追加模板块到file末尾。\n  * W file\n  写并追加模板块的第一行到file末尾。\n  * !\n  表示后面的命令对所有没有被选定的行发生作用。\n  * s/re/string\n  用string替换正则表达式re。\n  * =\n  打印当前行号码。\n  * #把注释扩展到下一个换行符以前。\n### 以下的是替换标记\n* g表示行内全面替换。\n* p表示打印行。\n* w表示把行写入一个文件。\n* x表示互换模板块中的文本和缓冲区中的文本。\n* y表示把一个字符翻译为另外的字符（但是不用于正则表达式）\n\n## 选项\n`-e command, --expression=command`\n允许多台编辑。\n* -h, --help\n打印帮助，并显示bug列表的地址。\n* -n, --quiet, --silent\n取消默认输出。\n* -f, --filer=script-file\n引导sed脚本文件名。\n* -V, --version\n打印版本和版权信息。\n\n## 元字符集^\n锚定行的开始 如：/^sed/匹配所有以sed开头的行。 \n$\n* 锚定行的结束 如：/sed$/匹配所有以sed结尾的行。 \n.\n* 匹配一个非换行符的字符 如：/s.d/匹配s后接一个任意字符，然后是d。 \n*\n* 匹配零或多个字符 如：/*sed/匹配所有模板是一个或多个空格后紧跟sed的行。 \n[]\n* 匹配一个指定范围内的字符，如/[Ss]ed/匹配sed和Sed。 \n[^]\n* 匹配一个不在指定范围内的字符，如：/[^A-RT-Z]ed/匹配不包含A-R和T-Z的一个字母开头，紧跟ed的行。 \n\\(..\\)\n* 保存匹配的字符，如s/\\(love\\)able/\\1rs，loveable被替换成lovers。 \n&\n* 保存搜索字符用来替换其他字符，如s/love/**&**/，love这成**love**。 \n\\<\n* 锚定单词的开始，如:/\\<love/匹配包含以love开头的单词的行。 \n\\>\n* 锚定单词的结束，如/love\\>/匹配包含以love结尾的单词的行。 \nx\\{m\\}\n* 重复字符x，m次，如：/o\\{5\\}/匹配包含5个o的行。 \nx\\{m,\\}\n* 重复字符x,至少m次，如：/o\\{5,\\}/匹配至少有5个o的行。 \nx\\{m,n\\}\n* 重复字符x，至少m次，不多于n次，如：/o\\{5,10\\}/匹配5--10个o的行。\n## 实例\n### 删除：d命令\n* $ sed '2d' example-----删除example文件的第二行。\n* $ sed '2,$d' example-----删除example文件的第二行到末尾所有行。\n* $ sed '$d' example-----删除example文件的最后一行。\n* $ sed '/test/'d example-----删除example文件所有包含test的行。\n### 替换：s命令\n* $ sed 's/test/mytest/g' example-----在整行范围内把test替换为mytest。如果没有g标记，则只有每行第一个匹配的test被替换成mytest。\n* $ sed -n 's/^test/mytest/p' example-----(-n)选项和p标志一起使用表示只打印那些发生替换的行。也就是说，如果某一行开头的test被替换成mytest，就打印它。\n* $ sed 's/^192.168.0.1/&localhost/' example-----&符号表示替换换字符串中被找到的部份。所有以192.168.0.1开头的行都会被替换成它自已加 localhost，变成192.168.0.1localhost。\n* $ sed -n 's/\\(love\\)able/\\1rs/p' example-----love被标记为1，所有loveable会被替换成lovers，而且替换的行会被打印出来。\n* $ sed 's#10#100#g' example-----不论什么字符，紧跟着s命令的都被认为是新的分隔符，所以，“#”在这里是分隔符，代替了默认的“/”分隔符。表示把所有10替换成100。\n选定行的范围：逗号\n* $ sed -n '/test/,/check/p' example-----所有在模板test和check所确定的范围内的行都被打印。\n* $ sed -n '5,/^test/p' example-----打印从第五行开始到第一个包含以test开始的行之间的所有行。\n* $ sed '/test/,/check/s/$/sed test/' example-----对于模板test和west之间的行，每行的末尾用字符串sed test替换。\n### 多点编辑：e命令\n* $ sed -e '1,5d' -e 's/test/check/' example-----(-e)选项允许在同一行里执行多条命令。如例子所示，第一条命令删除1至5行，第二条命令用check替换test。命令的执 行顺序对结果有影响。如果两个命令都是替换命令，那么第一个替换命令将影响第二个替换命令的结果。\n* $ sed --expression='s/test/check/' --expression='/love/d' example-----一个比-e更好的命令是--expression。它能给sed表达式赋值。\n### 从文件读入：r命令\n* $ sed '/test/r file' example-----file里的内容被读进来，显示在与test匹配的行后面，如果匹配多行，则file的内容将显示在所有匹配行的下面。\n### 写入文件：w命令\n* $ sed -n '/test/w file' example-----在example中所有包含test的行都被写入file里。\n### 追加命令：a命令\n\n* $ sed '/^test/a\\\\--->this is a example' example    '----->this is a example'被追加到以test开头的行后面，sed要求命令a后面有一个反斜杠。\n### 插入：i命令\n* $ sed '/test/i\\\\\nnew line\n-------------------------' example\n如果test被匹配，则把反斜杠后面的文本插入到匹配行的前面。\n下一个：n命令\n* $ sed '/test/{ n; s/aa/bb/; }' example-----如果test被匹配，则移动到匹配行的下一行，替换这一行的aa，变为bb，并打印该行，然后继续。\n变形：y命令\n\n* $ sed '1,10y/abcde/ABCDE/' example-----把1--10行内所有abcde转变为大写，注意，正则表达式元字符不能使用这个命令。\n退出：q命令\n* $ sed '10q' example-----打印完第10行后，退出sed。\n保持和获取：h命令和G命令\n* $ sed -e '/test/h' -e '$G example-----在sed处理文件的时候，每一行都被保存在一个叫模式空间的临时缓冲区中，除非行被删除或者输出被取消，否则所有被处理的行都将 打印在屏幕上。接着模式空间被清空，并存入新的一行等待处理。在这个例子里，匹配test的行被找到后，将存入模式空间，h命令将其复制并存入一个称为保 持缓存区的特殊缓冲区内。第二条语句的意思是，当到达最后一行后，G命令取出保持缓冲区的行，然后把它放回模式空间中，且追加到现在已经存在于模式空间中 的行的末尾。在这个例子中就是追加到最后一行。简单来说，任何包含test的行都被复制并追加到该文件的末尾。\n保持和互换：h命令和x命令\n* $ sed -e '/test/h' -e '/check/x' example -----互换模式空间和保持缓冲区的内容。也就是把包含test与check的行互换。\n### 脚本\nSed脚本是一个sed的命令清单，启动Sed时以-f选项引导脚本文件名。Sed对于脚本中输入的命令非常挑剔，在命令的末尾不能有任何空白或文本，如果在一行中有多个命令，要用分号分隔。以#开头的行为注释行，且不能跨行。\n","slug":"大数据/大数据02-04-shell编程-sed命令","published":1,"updated":"2017-11-06T16:13:52.587Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjcsq4lfl000px4vf9wxzb5r7","content":"<h1 id=\"Sed简介\"><a href=\"#Sed简介\" class=\"headerlink\" title=\"Sed简介\"></a>Sed简介</h1><p>sed 是一种在线编辑器，它一次处理一行内容。处理时，把当前处理的行存储在临时缓冲区中，称为“模式空间”（pattern space），接着用sed命令处理缓冲区中的内容，处理完成后，把缓冲区的内容送往屏幕。接着处理下一行，这样不断重复，直到文件末尾。文件内容并没有 改变，除非你使用重定向存储输出。Sed主要用来自动编辑一个或多个文件；简化对文件的反复操作；编写转换程序等。以下介绍的是Gnu版本的Sed 3.02。做备份,以后速查用.<br><a id=\"more\"></a></p>\n<h2 id=\"定址\"><a href=\"#定址\" class=\"headerlink\" title=\"定址\"></a>定址</h2><p>可以通过定址来定位你所希望编辑的行，该地址用数字构成，用逗号分隔的两个行数表示以这两行为起止的行的范围（包括行数表示的那两行）。如1，3表示1，2，3行，美元符号($)表示最后一行。范围可以通过数据，正则表达式或者二者结合的方式确定 。</p>\n<h2 id=\"Sed命令\"><a href=\"#Sed命令\" class=\"headerlink\" title=\"Sed命令\"></a>Sed命令</h2><p>调用sed命令有两种形式：</p>\n<ul>\n<li>sed [options] ‘command’ file(s)</li>\n<li>sed [options] -f scriptfile file(s)<ul>\n<li>a<br>在当前行后面加入一行文本。</li>\n<li>b lable<br>分支到脚本中带有标记的地方，如果分支不存在则分支到脚本的末尾。</li>\n<li>c<br>用新的文本改变本行的文本。</li>\n<li>d<br>从模板块（Pattern space）位置删除行。</li>\n<li>D<br>删除模板块的第一行。</li>\n<li>i<br>在当前行上面插入文本。</li>\n<li>h<br>拷贝模板块的内容到内存中的缓冲区。</li>\n<li>H<br>追加模板块的内容到内存中的缓冲区</li>\n<li>g<br>获得内存缓冲区的内容，并替代当前模板块中的文本。</li>\n<li>G<br>获得内存缓冲区的内容，并追加到当前模板块文本的后面。</li>\n<li>l<br>列表不能打印字符的清单。</li>\n<li>n<br>读取下一个输入行，用下一个命令处理新的行而不是用第一个命令。</li>\n<li>N<br>追加下一个输入行到模板块后面并在二者间嵌入一个新行，改变当前行号码。</li>\n<li>p<br>打印模板块的行。</li>\n<li>P（大写）<br>打印模板块的第一行。</li>\n<li>q<br>退出Sed。</li>\n<li>r file<br>从file中读行。</li>\n<li>t label<br>if分支，从最后一行开始，条件一旦满足或者T，t命令，将导致分支到带有标号的命令处，或者到脚本的末尾。</li>\n<li>T label<br>错误分支，从最后一行开始，一旦发生错误或者T，t命令，将导致分支到带有标号的命令处，或者到脚本的末尾。</li>\n<li>w file<br>写并追加模板块到file末尾。</li>\n<li>W file<br>写并追加模板块的第一行到file末尾。</li>\n<li>!<br>表示后面的命令对所有没有被选定的行发生作用。</li>\n<li>s/re/string<br>用string替换正则表达式re。</li>\n<li>=<br>打印当前行号码。</li>\n<li>#把注释扩展到下一个换行符以前。<h3 id=\"以下的是替换标记\"><a href=\"#以下的是替换标记\" class=\"headerlink\" title=\"以下的是替换标记\"></a>以下的是替换标记</h3></li>\n</ul>\n</li>\n<li>g表示行内全面替换。</li>\n<li>p表示打印行。</li>\n<li>w表示把行写入一个文件。</li>\n<li>x表示互换模板块中的文本和缓冲区中的文本。</li>\n<li>y表示把一个字符翻译为另外的字符（但是不用于正则表达式）</li>\n</ul>\n<h2 id=\"选项\"><a href=\"#选项\" class=\"headerlink\" title=\"选项\"></a>选项</h2><p><code>-e command, --expression=command</code><br>允许多台编辑。</p>\n<ul>\n<li>-h, –help<br>打印帮助，并显示bug列表的地址。</li>\n<li>-n, –quiet, –silent<br>取消默认输出。</li>\n<li>-f, –filer=script-file<br>引导sed脚本文件名。</li>\n<li>-V, –version<br>打印版本和版权信息。</li>\n</ul>\n<h2 id=\"元字符集\"><a href=\"#元字符集\" class=\"headerlink\" title=\"元字符集^\"></a>元字符集^</h2><p>锚定行的开始 如：/^sed/匹配所有以sed开头的行。<br>$</p>\n<ul>\n<li>锚定行的结束 如：/sed$/匹配所有以sed结尾的行。<br>.</li>\n<li>匹配一个非换行符的字符 如：/s.d/匹配s后接一个任意字符，然后是d。<br>*</li>\n<li>匹配零或多个字符 如：/*sed/匹配所有模板是一个或多个空格后紧跟sed的行。<br>[]</li>\n<li>匹配一个指定范围内的字符，如/[Ss]ed/匹配sed和Sed。<br>[^]</li>\n<li>匹配一个不在指定范围内的字符，如：/[^A-RT-Z]ed/匹配不包含A-R和T-Z的一个字母开头，紧跟ed的行。<br>(..)</li>\n<li>保存匹配的字符，如s/(love)able/\\1rs，loveable被替换成lovers。<br>&amp;</li>\n<li>保存搜索字符用来替换其他字符，如s/love/<strong>&amp;</strong>/，love这成<strong>love</strong>。<br>\\&lt;</li>\n<li>锚定单词的开始，如:/\\<love 匹配包含以love开头的单词的行。=\"\" \\=\"\"></love></li>\n<li>锚定单词的结束，如/love>/匹配包含以love结尾的单词的行。<br>x{m}</li>\n<li>重复字符x，m次，如：/o{5}/匹配包含5个o的行。<br>x{m,}</li>\n<li>重复字符x,至少m次，如：/o{5,}/匹配至少有5个o的行。<br>x{m,n}</li>\n<li>重复字符x，至少m次，不多于n次，如：/o{5,10}/匹配5–10个o的行。<h2 id=\"实例\"><a href=\"#实例\" class=\"headerlink\" title=\"实例\"></a>实例</h2><h3 id=\"删除：d命令\"><a href=\"#删除：d命令\" class=\"headerlink\" title=\"删除：d命令\"></a>删除：d命令</h3></li>\n<li>$ sed ‘2d’ example—–删除example文件的第二行。</li>\n<li>$ sed ‘2,$d’ example—–删除example文件的第二行到末尾所有行。</li>\n<li>$ sed ‘$d’ example—–删除example文件的最后一行。</li>\n<li>$ sed ‘/test/‘d example—–删除example文件所有包含test的行。<h3 id=\"替换：s命令\"><a href=\"#替换：s命令\" class=\"headerlink\" title=\"替换：s命令\"></a>替换：s命令</h3></li>\n<li>$ sed ‘s/test/mytest/g’ example—–在整行范围内把test替换为mytest。如果没有g标记，则只有每行第一个匹配的test被替换成mytest。</li>\n<li>$ sed -n ‘s/^test/mytest/p’ example—–(-n)选项和p标志一起使用表示只打印那些发生替换的行。也就是说，如果某一行开头的test被替换成mytest，就打印它。</li>\n<li>$ sed ‘s/^192.168.0.1/&amp;localhost/‘ example—–&amp;符号表示替换换字符串中被找到的部份。所有以192.168.0.1开头的行都会被替换成它自已加 localhost，变成192.168.0.1localhost。</li>\n<li>$ sed -n ‘s/(love)able/\\1rs/p’ example—–love被标记为1，所有loveable会被替换成lovers，而且替换的行会被打印出来。</li>\n<li>$ sed ‘s#10#100#g’ example—–不论什么字符，紧跟着s命令的都被认为是新的分隔符，所以，“#”在这里是分隔符，代替了默认的“/”分隔符。表示把所有10替换成100。<br>选定行的范围：逗号</li>\n<li>$ sed -n ‘/test/,/check/p’ example—–所有在模板test和check所确定的范围内的行都被打印。</li>\n<li>$ sed -n ‘5,/^test/p’ example—–打印从第五行开始到第一个包含以test开始的行之间的所有行。</li>\n<li>$ sed ‘/test/,/check/s/$/sed test/‘ example—–对于模板test和west之间的行，每行的末尾用字符串sed test替换。<h3 id=\"多点编辑：e命令\"><a href=\"#多点编辑：e命令\" class=\"headerlink\" title=\"多点编辑：e命令\"></a>多点编辑：e命令</h3></li>\n<li>$ sed -e ‘1,5d’ -e ‘s/test/check/‘ example—–(-e)选项允许在同一行里执行多条命令。如例子所示，第一条命令删除1至5行，第二条命令用check替换test。命令的执 行顺序对结果有影响。如果两个命令都是替换命令，那么第一个替换命令将影响第二个替换命令的结果。</li>\n<li>$ sed –expression=’s/test/check/‘ –expression=’/love/d’ example—–一个比-e更好的命令是–expression。它能给sed表达式赋值。<h3 id=\"从文件读入：r命令\"><a href=\"#从文件读入：r命令\" class=\"headerlink\" title=\"从文件读入：r命令\"></a>从文件读入：r命令</h3></li>\n<li>$ sed ‘/test/r file’ example—–file里的内容被读进来，显示在与test匹配的行后面，如果匹配多行，则file的内容将显示在所有匹配行的下面。<h3 id=\"写入文件：w命令\"><a href=\"#写入文件：w命令\" class=\"headerlink\" title=\"写入文件：w命令\"></a>写入文件：w命令</h3></li>\n<li><p>$ sed -n ‘/test/w file’ example—–在example中所有包含test的行都被写入file里。</p>\n<h3 id=\"追加命令：a命令\"><a href=\"#追加命令：a命令\" class=\"headerlink\" title=\"追加命令：a命令\"></a>追加命令：a命令</h3></li>\n<li><p>$ sed ‘/^test/a\\—&gt;this is a example’ example    ‘—–&gt;this is a example’被追加到以test开头的行后面，sed要求命令a后面有一个反斜杠。</p>\n<h3 id=\"插入：i命令\"><a href=\"#插入：i命令\" class=\"headerlink\" title=\"插入：i命令\"></a>插入：i命令</h3></li>\n<li>$ sed ‘/test/i\\<br>new line<br>————————-‘ example<br>如果test被匹配，则把反斜杠后面的文本插入到匹配行的前面。<br>下一个：n命令</li>\n<li><p>$ sed ‘/test/{ n; s/aa/bb/; }’ example—–如果test被匹配，则移动到匹配行的下一行，替换这一行的aa，变为bb，并打印该行，然后继续。<br>变形：y命令</p>\n</li>\n<li><p>$ sed ‘1,10y/abcde/ABCDE/‘ example—–把1–10行内所有abcde转变为大写，注意，正则表达式元字符不能使用这个命令。<br>退出：q命令</p>\n</li>\n<li>$ sed ‘10q’ example—–打印完第10行后，退出sed。<br>保持和获取：h命令和G命令</li>\n<li>$ sed -e ‘/test/h’ -e ‘$G example—–在sed处理文件的时候，每一行都被保存在一个叫模式空间的临时缓冲区中，除非行被删除或者输出被取消，否则所有被处理的行都将 打印在屏幕上。接着模式空间被清空，并存入新的一行等待处理。在这个例子里，匹配test的行被找到后，将存入模式空间，h命令将其复制并存入一个称为保 持缓存区的特殊缓冲区内。第二条语句的意思是，当到达最后一行后，G命令取出保持缓冲区的行，然后把它放回模式空间中，且追加到现在已经存在于模式空间中 的行的末尾。在这个例子中就是追加到最后一行。简单来说，任何包含test的行都被复制并追加到该文件的末尾。<br>保持和互换：h命令和x命令</li>\n<li>$ sed -e ‘/test/h’ -e ‘/check/x’ example —–互换模式空间和保持缓冲区的内容。也就是把包含test与check的行互换。<h3 id=\"脚本\"><a href=\"#脚本\" class=\"headerlink\" title=\"脚本\"></a>脚本</h3>Sed脚本是一个sed的命令清单，启动Sed时以-f选项引导脚本文件名。Sed对于脚本中输入的命令非常挑剔，在命令的末尾不能有任何空白或文本，如果在一行中有多个命令，要用分号分隔。以#开头的行为注释行，且不能跨行。</li>\n</ul>\n","site":{"data":{}},"excerpt":"<h1 id=\"Sed简介\"><a href=\"#Sed简介\" class=\"headerlink\" title=\"Sed简介\"></a>Sed简介</h1><p>sed 是一种在线编辑器，它一次处理一行内容。处理时，把当前处理的行存储在临时缓冲区中，称为“模式空间”（pattern space），接着用sed命令处理缓冲区中的内容，处理完成后，把缓冲区的内容送往屏幕。接着处理下一行，这样不断重复，直到文件末尾。文件内容并没有 改变，除非你使用重定向存储输出。Sed主要用来自动编辑一个或多个文件；简化对文件的反复操作；编写转换程序等。以下介绍的是Gnu版本的Sed 3.02。做备份,以后速查用.<br>","more":"</p>\n<h2 id=\"定址\"><a href=\"#定址\" class=\"headerlink\" title=\"定址\"></a>定址</h2><p>可以通过定址来定位你所希望编辑的行，该地址用数字构成，用逗号分隔的两个行数表示以这两行为起止的行的范围（包括行数表示的那两行）。如1，3表示1，2，3行，美元符号($)表示最后一行。范围可以通过数据，正则表达式或者二者结合的方式确定 。</p>\n<h2 id=\"Sed命令\"><a href=\"#Sed命令\" class=\"headerlink\" title=\"Sed命令\"></a>Sed命令</h2><p>调用sed命令有两种形式：</p>\n<ul>\n<li>sed [options] ‘command’ file(s)</li>\n<li>sed [options] -f scriptfile file(s)<ul>\n<li>a<br>在当前行后面加入一行文本。</li>\n<li>b lable<br>分支到脚本中带有标记的地方，如果分支不存在则分支到脚本的末尾。</li>\n<li>c<br>用新的文本改变本行的文本。</li>\n<li>d<br>从模板块（Pattern space）位置删除行。</li>\n<li>D<br>删除模板块的第一行。</li>\n<li>i<br>在当前行上面插入文本。</li>\n<li>h<br>拷贝模板块的内容到内存中的缓冲区。</li>\n<li>H<br>追加模板块的内容到内存中的缓冲区</li>\n<li>g<br>获得内存缓冲区的内容，并替代当前模板块中的文本。</li>\n<li>G<br>获得内存缓冲区的内容，并追加到当前模板块文本的后面。</li>\n<li>l<br>列表不能打印字符的清单。</li>\n<li>n<br>读取下一个输入行，用下一个命令处理新的行而不是用第一个命令。</li>\n<li>N<br>追加下一个输入行到模板块后面并在二者间嵌入一个新行，改变当前行号码。</li>\n<li>p<br>打印模板块的行。</li>\n<li>P（大写）<br>打印模板块的第一行。</li>\n<li>q<br>退出Sed。</li>\n<li>r file<br>从file中读行。</li>\n<li>t label<br>if分支，从最后一行开始，条件一旦满足或者T，t命令，将导致分支到带有标号的命令处，或者到脚本的末尾。</li>\n<li>T label<br>错误分支，从最后一行开始，一旦发生错误或者T，t命令，将导致分支到带有标号的命令处，或者到脚本的末尾。</li>\n<li>w file<br>写并追加模板块到file末尾。</li>\n<li>W file<br>写并追加模板块的第一行到file末尾。</li>\n<li>!<br>表示后面的命令对所有没有被选定的行发生作用。</li>\n<li>s/re/string<br>用string替换正则表达式re。</li>\n<li>=<br>打印当前行号码。</li>\n<li>#把注释扩展到下一个换行符以前。<h3 id=\"以下的是替换标记\"><a href=\"#以下的是替换标记\" class=\"headerlink\" title=\"以下的是替换标记\"></a>以下的是替换标记</h3></li>\n</ul>\n</li>\n<li>g表示行内全面替换。</li>\n<li>p表示打印行。</li>\n<li>w表示把行写入一个文件。</li>\n<li>x表示互换模板块中的文本和缓冲区中的文本。</li>\n<li>y表示把一个字符翻译为另外的字符（但是不用于正则表达式）</li>\n</ul>\n<h2 id=\"选项\"><a href=\"#选项\" class=\"headerlink\" title=\"选项\"></a>选项</h2><p><code>-e command, --expression=command</code><br>允许多台编辑。</p>\n<ul>\n<li>-h, –help<br>打印帮助，并显示bug列表的地址。</li>\n<li>-n, –quiet, –silent<br>取消默认输出。</li>\n<li>-f, –filer=script-file<br>引导sed脚本文件名。</li>\n<li>-V, –version<br>打印版本和版权信息。</li>\n</ul>\n<h2 id=\"元字符集\"><a href=\"#元字符集\" class=\"headerlink\" title=\"元字符集^\"></a>元字符集^</h2><p>锚定行的开始 如：/^sed/匹配所有以sed开头的行。<br>$</p>\n<ul>\n<li>锚定行的结束 如：/sed$/匹配所有以sed结尾的行。<br>.</li>\n<li>匹配一个非换行符的字符 如：/s.d/匹配s后接一个任意字符，然后是d。<br>*</li>\n<li>匹配零或多个字符 如：/*sed/匹配所有模板是一个或多个空格后紧跟sed的行。<br>[]</li>\n<li>匹配一个指定范围内的字符，如/[Ss]ed/匹配sed和Sed。<br>[^]</li>\n<li>匹配一个不在指定范围内的字符，如：/[^A-RT-Z]ed/匹配不包含A-R和T-Z的一个字母开头，紧跟ed的行。<br>(..)</li>\n<li>保存匹配的字符，如s/(love)able/\\1rs，loveable被替换成lovers。<br>&amp;</li>\n<li>保存搜索字符用来替换其他字符，如s/love/<strong>&amp;</strong>/，love这成<strong>love</strong>。<br>\\&lt;</li>\n<li>锚定单词的开始，如:/\\<love 匹配包含以love开头的单词的行。=\"\" \\=\"\"></love></li>\n<li>锚定单词的结束，如/love>/匹配包含以love结尾的单词的行。<br>x{m}</li>\n<li>重复字符x，m次，如：/o{5}/匹配包含5个o的行。<br>x{m,}</li>\n<li>重复字符x,至少m次，如：/o{5,}/匹配至少有5个o的行。<br>x{m,n}</li>\n<li>重复字符x，至少m次，不多于n次，如：/o{5,10}/匹配5–10个o的行。<h2 id=\"实例\"><a href=\"#实例\" class=\"headerlink\" title=\"实例\"></a>实例</h2><h3 id=\"删除：d命令\"><a href=\"#删除：d命令\" class=\"headerlink\" title=\"删除：d命令\"></a>删除：d命令</h3></li>\n<li>$ sed ‘2d’ example—–删除example文件的第二行。</li>\n<li>$ sed ‘2,$d’ example—–删除example文件的第二行到末尾所有行。</li>\n<li>$ sed ‘$d’ example—–删除example文件的最后一行。</li>\n<li>$ sed ‘/test/‘d example—–删除example文件所有包含test的行。<h3 id=\"替换：s命令\"><a href=\"#替换：s命令\" class=\"headerlink\" title=\"替换：s命令\"></a>替换：s命令</h3></li>\n<li>$ sed ‘s/test/mytest/g’ example—–在整行范围内把test替换为mytest。如果没有g标记，则只有每行第一个匹配的test被替换成mytest。</li>\n<li>$ sed -n ‘s/^test/mytest/p’ example—–(-n)选项和p标志一起使用表示只打印那些发生替换的行。也就是说，如果某一行开头的test被替换成mytest，就打印它。</li>\n<li>$ sed ‘s/^192.168.0.1/&amp;localhost/‘ example—–&amp;符号表示替换换字符串中被找到的部份。所有以192.168.0.1开头的行都会被替换成它自已加 localhost，变成192.168.0.1localhost。</li>\n<li>$ sed -n ‘s/(love)able/\\1rs/p’ example—–love被标记为1，所有loveable会被替换成lovers，而且替换的行会被打印出来。</li>\n<li>$ sed ‘s#10#100#g’ example—–不论什么字符，紧跟着s命令的都被认为是新的分隔符，所以，“#”在这里是分隔符，代替了默认的“/”分隔符。表示把所有10替换成100。<br>选定行的范围：逗号</li>\n<li>$ sed -n ‘/test/,/check/p’ example—–所有在模板test和check所确定的范围内的行都被打印。</li>\n<li>$ sed -n ‘5,/^test/p’ example—–打印从第五行开始到第一个包含以test开始的行之间的所有行。</li>\n<li>$ sed ‘/test/,/check/s/$/sed test/‘ example—–对于模板test和west之间的行，每行的末尾用字符串sed test替换。<h3 id=\"多点编辑：e命令\"><a href=\"#多点编辑：e命令\" class=\"headerlink\" title=\"多点编辑：e命令\"></a>多点编辑：e命令</h3></li>\n<li>$ sed -e ‘1,5d’ -e ‘s/test/check/‘ example—–(-e)选项允许在同一行里执行多条命令。如例子所示，第一条命令删除1至5行，第二条命令用check替换test。命令的执 行顺序对结果有影响。如果两个命令都是替换命令，那么第一个替换命令将影响第二个替换命令的结果。</li>\n<li>$ sed –expression=’s/test/check/‘ –expression=’/love/d’ example—–一个比-e更好的命令是–expression。它能给sed表达式赋值。<h3 id=\"从文件读入：r命令\"><a href=\"#从文件读入：r命令\" class=\"headerlink\" title=\"从文件读入：r命令\"></a>从文件读入：r命令</h3></li>\n<li>$ sed ‘/test/r file’ example—–file里的内容被读进来，显示在与test匹配的行后面，如果匹配多行，则file的内容将显示在所有匹配行的下面。<h3 id=\"写入文件：w命令\"><a href=\"#写入文件：w命令\" class=\"headerlink\" title=\"写入文件：w命令\"></a>写入文件：w命令</h3></li>\n<li><p>$ sed -n ‘/test/w file’ example—–在example中所有包含test的行都被写入file里。</p>\n<h3 id=\"追加命令：a命令\"><a href=\"#追加命令：a命令\" class=\"headerlink\" title=\"追加命令：a命令\"></a>追加命令：a命令</h3></li>\n<li><p>$ sed ‘/^test/a\\—&gt;this is a example’ example    ‘—–&gt;this is a example’被追加到以test开头的行后面，sed要求命令a后面有一个反斜杠。</p>\n<h3 id=\"插入：i命令\"><a href=\"#插入：i命令\" class=\"headerlink\" title=\"插入：i命令\"></a>插入：i命令</h3></li>\n<li>$ sed ‘/test/i\\<br>new line<br>————————-‘ example<br>如果test被匹配，则把反斜杠后面的文本插入到匹配行的前面。<br>下一个：n命令</li>\n<li><p>$ sed ‘/test/{ n; s/aa/bb/; }’ example—–如果test被匹配，则移动到匹配行的下一行，替换这一行的aa，变为bb，并打印该行，然后继续。<br>变形：y命令</p>\n</li>\n<li><p>$ sed ‘1,10y/abcde/ABCDE/‘ example—–把1–10行内所有abcde转变为大写，注意，正则表达式元字符不能使用这个命令。<br>退出：q命令</p>\n</li>\n<li>$ sed ‘10q’ example—–打印完第10行后，退出sed。<br>保持和获取：h命令和G命令</li>\n<li>$ sed -e ‘/test/h’ -e ‘$G example—–在sed处理文件的时候，每一行都被保存在一个叫模式空间的临时缓冲区中，除非行被删除或者输出被取消，否则所有被处理的行都将 打印在屏幕上。接着模式空间被清空，并存入新的一行等待处理。在这个例子里，匹配test的行被找到后，将存入模式空间，h命令将其复制并存入一个称为保 持缓存区的特殊缓冲区内。第二条语句的意思是，当到达最后一行后，G命令取出保持缓冲区的行，然后把它放回模式空间中，且追加到现在已经存在于模式空间中 的行的末尾。在这个例子中就是追加到最后一行。简单来说，任何包含test的行都被复制并追加到该文件的末尾。<br>保持和互换：h命令和x命令</li>\n<li>$ sed -e ‘/test/h’ -e ‘/check/x’ example —–互换模式空间和保持缓冲区的内容。也就是把包含test与check的行互换。<h3 id=\"脚本\"><a href=\"#脚本\" class=\"headerlink\" title=\"脚本\"></a>脚本</h3>Sed脚本是一个sed的命令清单，启动Sed时以-f选项引导脚本文件名。Sed对于脚本中输入的命令非常挑剔，在命令的末尾不能有任何空白或文本，如果在一行中有多个命令，要用分号分隔。以#开头的行为注释行，且不能跨行。</li>\n</ul>"},{"title":"大数据03-01-自动化部署脚本","toc":true,"date":"2017-11-14T14:43:45.000Z","scaffolds":null,"_content":"实现ssh免密登录及jdk的自动安装\n# boot.sh\n免密登录 及复制安装脚本到目标机器\n<!-- more -->\n```bash\n#!/bin/bash\n\nSERVERS=\"node-3.itcast.cn node-4.itcast.cn\"\nPASSWORD=123456\nBASE_SERVER=172.16.203.100\n\nauto_ssh_copy_id() {\n    expect -c \"set timeout -1;\n        spawn ssh-copy-id $1;\n        expect {\n            *(yes/no)* {send -- yes\\r;exp_continue;}\n            *assword:* {send -- $2\\r;exp_continue;}\n            eof        {exit 0;}\n        }\";\n}\n\nssh_copy_id_to_all() {\n    for SERVER in $SERVERS\n    do\n        auto_ssh_copy_id $SERVER $PASSWORD\n    done\n}\n\nssh_copy_id_to_all\n\n\nfor SERVER in $SERVERS\ndo\n    scp install.sh root@$SERVER:/root\n    ssh root@$SERVER /root/install.sh\ndone\n```\n# install_everyone.sh\n安装jdk\n```bash\n#!/bin/bash\n\nBASE_SERVER=mini4\nyum install -y wget\nwget $BASE_SERVER/soft/jdk-7u45-linux-x64.tar.gz\ntar -zxvf jdk-7u45-linux-x64.tar.gz -C /usr/local\ncat >> /etc/profile << EOF\nexport JAVA_HOME=/usr/local/jdk1.7.0_45\nexport PATH=\\$PATH:\\$JAVA_HOME/bin\nEOF\n```\n说明:\n- expect 模拟人机交互\n- EOF临时文本输入","source":"_posts/大数据/大数据03-01-自动化部署脚本.md","raw":"---\ntitle: 大数据03-01-自动化部署脚本\ncategories: 学习\ntags:\n  - 大数据\n  - linux\n  - centos7\ntoc: true\ndate: 2017-11-14 22:43:45\nscaffolds:\n---\n实现ssh免密登录及jdk的自动安装\n# boot.sh\n免密登录 及复制安装脚本到目标机器\n<!-- more -->\n```bash\n#!/bin/bash\n\nSERVERS=\"node-3.itcast.cn node-4.itcast.cn\"\nPASSWORD=123456\nBASE_SERVER=172.16.203.100\n\nauto_ssh_copy_id() {\n    expect -c \"set timeout -1;\n        spawn ssh-copy-id $1;\n        expect {\n            *(yes/no)* {send -- yes\\r;exp_continue;}\n            *assword:* {send -- $2\\r;exp_continue;}\n            eof        {exit 0;}\n        }\";\n}\n\nssh_copy_id_to_all() {\n    for SERVER in $SERVERS\n    do\n        auto_ssh_copy_id $SERVER $PASSWORD\n    done\n}\n\nssh_copy_id_to_all\n\n\nfor SERVER in $SERVERS\ndo\n    scp install.sh root@$SERVER:/root\n    ssh root@$SERVER /root/install.sh\ndone\n```\n# install_everyone.sh\n安装jdk\n```bash\n#!/bin/bash\n\nBASE_SERVER=mini4\nyum install -y wget\nwget $BASE_SERVER/soft/jdk-7u45-linux-x64.tar.gz\ntar -zxvf jdk-7u45-linux-x64.tar.gz -C /usr/local\ncat >> /etc/profile << EOF\nexport JAVA_HOME=/usr/local/jdk1.7.0_45\nexport PATH=\\$PATH:\\$JAVA_HOME/bin\nEOF\n```\n说明:\n- expect 模拟人机交互\n- EOF临时文本输入","slug":"大数据/大数据03-01-自动化部署脚本","published":1,"updated":"2017-11-14T15:06:55.689Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjcsq4lfn000rx4vf8xga9jf2","content":"<p>实现ssh免密登录及jdk的自动安装</p>\n<h1 id=\"boot-sh\"><a href=\"#boot-sh\" class=\"headerlink\" title=\"boot.sh\"></a>boot.sh</h1><p>免密登录 及复制安装脚本到目标机器<br><a id=\"more\"></a><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">#!/bin/bash</span></div><div class=\"line\"></div><div class=\"line\">SERVERS=<span class=\"string\">\"node-3.itcast.cn node-4.itcast.cn\"</span></div><div class=\"line\">PASSWORD=123456</div><div class=\"line\">BASE_SERVER=172.16.203.100</div><div class=\"line\"></div><div class=\"line\"><span class=\"function\"><span class=\"title\">auto_ssh_copy_id</span></span>() &#123;</div><div class=\"line\">    expect -c <span class=\"string\">\"set timeout -1;</span></div><div class=\"line\"><span class=\"string\">        spawn ssh-copy-id <span class=\"variable\">$1</span>;</span></div><div class=\"line\"><span class=\"string\">        expect &#123;</span></div><div class=\"line\"><span class=\"string\">            *(yes/no)* &#123;send -- yes\\r;exp_continue;&#125;</span></div><div class=\"line\"><span class=\"string\">            *assword:* &#123;send -- <span class=\"variable\">$2</span>\\r;exp_continue;&#125;</span></div><div class=\"line\"><span class=\"string\">            eof        &#123;exit 0;&#125;</span></div><div class=\"line\"><span class=\"string\">        &#125;\"</span>;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"function\"><span class=\"title\">ssh_copy_id_to_all</span></span>() &#123;</div><div class=\"line\">    <span class=\"keyword\">for</span> SERVER <span class=\"keyword\">in</span> <span class=\"variable\">$SERVERS</span></div><div class=\"line\">    <span class=\"keyword\">do</span></div><div class=\"line\">        auto_ssh_copy_id <span class=\"variable\">$SERVER</span> <span class=\"variable\">$PASSWORD</span></div><div class=\"line\">    <span class=\"keyword\">done</span></div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\">ssh_copy_id_to_all</div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">for</span> SERVER <span class=\"keyword\">in</span> <span class=\"variable\">$SERVERS</span></div><div class=\"line\"><span class=\"keyword\">do</span></div><div class=\"line\">    scp install.sh root@<span class=\"variable\">$SERVER</span>:/root</div><div class=\"line\">    ssh root@<span class=\"variable\">$SERVER</span> /root/install.sh</div><div class=\"line\"><span class=\"keyword\">done</span></div></pre></td></tr></table></figure></p>\n<h1 id=\"install-everyone-sh\"><a href=\"#install-everyone-sh\" class=\"headerlink\" title=\"install_everyone.sh\"></a>install_everyone.sh</h1><p>安装jdk<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">#!/bin/bash</span></div><div class=\"line\"></div><div class=\"line\">BASE_SERVER=mini4</div><div class=\"line\">yum install -y wget</div><div class=\"line\">wget <span class=\"variable\">$BASE_SERVER</span>/soft/jdk-7u45-linux-x64.tar.gz</div><div class=\"line\">tar -zxvf jdk-7u45-linux-x64.tar.gz -C /usr/<span class=\"built_in\">local</span></div><div class=\"line\">cat &gt;&gt; /etc/profile &lt;&lt; EOF</div><div class=\"line\"><span class=\"built_in\">export</span> JAVA_HOME=/usr/<span class=\"built_in\">local</span>/jdk1.7.0_45</div><div class=\"line\"><span class=\"built_in\">export</span> PATH=\\<span class=\"variable\">$PATH</span>:\\<span class=\"variable\">$JAVA_HOME</span>/bin</div><div class=\"line\">EOF</div></pre></td></tr></table></figure></p>\n<p>说明:</p>\n<ul>\n<li>expect 模拟人机交互</li>\n<li>EOF临时文本输入</li>\n</ul>\n","site":{"data":{}},"excerpt":"<p>实现ssh免密登录及jdk的自动安装</p>\n<h1 id=\"boot-sh\"><a href=\"#boot-sh\" class=\"headerlink\" title=\"boot.sh\"></a>boot.sh</h1><p>免密登录 及复制安装脚本到目标机器<br>","more":"<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">#!/bin/bash</span></div><div class=\"line\"></div><div class=\"line\">SERVERS=<span class=\"string\">\"node-3.itcast.cn node-4.itcast.cn\"</span></div><div class=\"line\">PASSWORD=123456</div><div class=\"line\">BASE_SERVER=172.16.203.100</div><div class=\"line\"></div><div class=\"line\"><span class=\"function\"><span class=\"title\">auto_ssh_copy_id</span></span>() &#123;</div><div class=\"line\">    expect -c <span class=\"string\">\"set timeout -1;</span></div><div class=\"line\"><span class=\"string\">        spawn ssh-copy-id <span class=\"variable\">$1</span>;</span></div><div class=\"line\"><span class=\"string\">        expect &#123;</span></div><div class=\"line\"><span class=\"string\">            *(yes/no)* &#123;send -- yes\\r;exp_continue;&#125;</span></div><div class=\"line\"><span class=\"string\">            *assword:* &#123;send -- <span class=\"variable\">$2</span>\\r;exp_continue;&#125;</span></div><div class=\"line\"><span class=\"string\">            eof        &#123;exit 0;&#125;</span></div><div class=\"line\"><span class=\"string\">        &#125;\"</span>;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"function\"><span class=\"title\">ssh_copy_id_to_all</span></span>() &#123;</div><div class=\"line\">    <span class=\"keyword\">for</span> SERVER <span class=\"keyword\">in</span> <span class=\"variable\">$SERVERS</span></div><div class=\"line\">    <span class=\"keyword\">do</span></div><div class=\"line\">        auto_ssh_copy_id <span class=\"variable\">$SERVER</span> <span class=\"variable\">$PASSWORD</span></div><div class=\"line\">    <span class=\"keyword\">done</span></div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\">ssh_copy_id_to_all</div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">for</span> SERVER <span class=\"keyword\">in</span> <span class=\"variable\">$SERVERS</span></div><div class=\"line\"><span class=\"keyword\">do</span></div><div class=\"line\">    scp install.sh root@<span class=\"variable\">$SERVER</span>:/root</div><div class=\"line\">    ssh root@<span class=\"variable\">$SERVER</span> /root/install.sh</div><div class=\"line\"><span class=\"keyword\">done</span></div></pre></td></tr></table></figure></p>\n<h1 id=\"install-everyone-sh\"><a href=\"#install-everyone-sh\" class=\"headerlink\" title=\"install_everyone.sh\"></a>install_everyone.sh</h1><p>安装jdk<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">#!/bin/bash</span></div><div class=\"line\"></div><div class=\"line\">BASE_SERVER=mini4</div><div class=\"line\">yum install -y wget</div><div class=\"line\">wget <span class=\"variable\">$BASE_SERVER</span>/soft/jdk-7u45-linux-x64.tar.gz</div><div class=\"line\">tar -zxvf jdk-7u45-linux-x64.tar.gz -C /usr/<span class=\"built_in\">local</span></div><div class=\"line\">cat &gt;&gt; /etc/profile &lt;&lt; EOF</div><div class=\"line\"><span class=\"built_in\">export</span> JAVA_HOME=/usr/<span class=\"built_in\">local</span>/jdk1.7.0_45</div><div class=\"line\"><span class=\"built_in\">export</span> PATH=\\<span class=\"variable\">$PATH</span>:\\<span class=\"variable\">$JAVA_HOME</span>/bin</div><div class=\"line\">EOF</div></pre></td></tr></table></figure></p>\n<p>说明:</p>\n<ul>\n<li>expect 模拟人机交互</li>\n<li>EOF临时文本输入</li>\n</ul>"},{"title":"大数据02-05-shell编程-awk命令","toc":true,"date":"2017-11-06T15:25:05.000Z","scaffolds":null,"_content":"# 简介\nawk是一个强大的文本分析工具，相对于grep的查找，sed的编辑，awk在其对数据分析并生成报告时，显得尤为强大。简单来说awk就是把文件逐行的读入，以空格为默认分隔符将每行切片，切开的部分再进行各种分析处理。\n\nawk有3个不同版本: awk、nawk和gawk，未作特别说明，一般指gawk，gawk 是 AWK 的 GNU 版本。\n\nawk其名称得自于它的创始人 Alfred Aho 、Peter Weinberger 和 Brian Kernighan 姓氏的首个字母。实际上 AWK 的确拥有自己的语言： AWK 程序设计语言 ， 三位创建者已将它正式定义为“样式扫描和处理语言”。它允许您创建简短的程序，这些程序读取输入文件、为数据排序、处理数据、对输入执行计算以及生成报表，还有无数其他的功能。\n<!--more -->\n \n\n# 使用方法\n> `awk '{pattern + action}' {filenames}`\n\n尽管操作可能会很复杂，但语法总是这样，其中 pattern 表示 AWK 在数据中查找的内容，而 action 是在找到匹配内容时所执行的一系列命令。花括号（{}）不需要在程序中始终出现，但它们用于根据特定的模式对一系列指令进行分组。 pattern就是要表示的正则表达式，用斜杠括起来。\n\nawk语言的最基本功能是在文件或者字符串中基于指定规则浏览和抽取信息，awk抽取信息后，才能进行其他文本操作。完整的awk脚本通常用来格式化文本文件中的信息。\n\n通常，awk是以文件的一行为处理单位的。awk每接收文件的一行，然后执行相应的命令，来处理文本。\n\n \n## 调用awk\n\n有三种方式调用awk\n\n \n### 1.命令行方式\n> awk [-F  field-separator]  'commands'  input-file(s)\n其中，commands 是真正awk命令，[-F域分隔符]是可选的。 input-file(s) 是待处理的文件。\n在awk中，文件的每一行中，由域分隔符分开的每一项称为一个域。通常，在不指名-F域分隔符的情况下，默认的域分隔符是空格。\n\n### 2.shell脚本方式\n将所有的awk命令插入一个文件，并使awk程序可执行，然后awk命令解释器作为脚本的首行，一遍通过键入脚本名称来调用。\n相当于shell脚本首行的：#!/bin/sh\n可以换成：#!/bin/awk\n\n### 3.将所有的awk命令插入一个单独文件，然后调用：\n> awk -f awk-script-file input-file(s)\n其中，-f选项加载awk-script-file中的awk脚本，input-file(s)跟上面的是一样的。\n \n 本章重点介绍命令行方式。\n\n \n\n## 入门实例\n假设last -n 5的输出如下\n\n> [root@www ~]# last -n 5 <==仅取出前五行\n\n```\nroot     pts/1   192.168.1.100  Tue Feb 10 11:21   still logged in\nroot     pts/1   192.168.1.100  Tue Feb 10 00:46 - 02:28  (01:41)\nroot     pts/1   192.168.1.100  Mon Feb  9 11:41 - 18:30  (06:48)\ndmtsai   pts/1   192.168.1.100  Mon Feb  9 11:41 - 11:41  (00:00)\nroot     tty1                   Fri Sep  5 14:09 - 14:10  (00:01)\n\n```\n如果只是显示最近登录的5个帐号\n\n```\n#last -n 5 | awk  '{print $1}'\nroot\nroot\nroot\ndmtsai\nroot\n\n```\nawk工作流程是这样的：读入有'\\n'换行符分割的一条记录，然后将记录按指定的域分隔符划分域，填充域，$0则表示所有域,$1表示第一个域,$n表示第n个域。默认域分隔符是\"空白键\" 或 \"[tab]键\",所以$1表示登录用户，$3表示登录用户ip,以此类推。\n\n \n\n如果只是显示/etc/passwd的账户\n\n```\n#cat /etc/passwd |awk  -F ':'  '{print $1}'  \nroot\ndaemon\nbin\nsys\n\n```\n这种是awk+action的示例，每行都会执行action{print $1}。\n\n> -F指定域分隔符为':'。\n\n \n\n如果只是显示/etc/passwd的账户和账户对应的shell,而账户与shell之间以tab键分割\n\n```\n#cat /etc/passwd |awk  -F ':'  '{print $1\"\\t\"$7}'\nroot    /bin/bash\ndaemon  /bin/sh\nbin     /bin/sh\nsys     /bin/sh\n\n``` \n\n如果只是显示/etc/passwd的账户和账户对应的shell,而账户与shell之间以逗号分割,而且在所有行添加列名name,shell,在最后一行添加\"blue,/bin/nosh\"。\n\n \n```\ncat /etc/passwd |awk  -F ':'  'BEGIN {print \"name,shell\"}  {print $1\",\"$7} END {print \"blue,/bin/nosh\"}'\nname,shell\nroot,/bin/bash\ndaemon,/bin/sh\nbin,/bin/sh\nsys,/bin/sh\n....\nblue,/bin/nosh\n\n``` \n\nawk工作流程是这样的：先执行BEGING，然后读取文件，读入有/n换行符分割的一条记录，然后将记录按指定的域分隔符划分域，填充域，$0则表示所有域,$1表示第一个域,$n表示第n个域,随后开始执行模式所对应的动作action。接着开始读入第二条记录······直到所有的记录都读完，最后执行END操作。\n\n \n\n搜索/etc/passwd有root关键字的所有行\n\n> #awk -F: '/root/' /etc/passwd\nroot:x:0:0:root:/root:/bin/bash\n这种是pattern的使用示例，匹配了pattern(这里是root)的行才会执行action(没有指定action，默认输出每行的内容)。\n\n搜索支持正则，例如找root开头的: ```awk -F: '/^root/' /etc/passwd```\n\n \n\n搜索/etc/passwd有root关键字的所有行，并显示对应的shell\n\n> # awk -F: '/root/{print $7}' /etc/passwd             \n/bin/bash\n 这里指定了action{print $7}\n\n \n\n## awk内置变量\nawk有许多内置变量用来设置环境信息，这些变量可以被改变，下面给出了最常用的一些变量。\n\n \n    ARGC               命令行参数个数\n    ARGV               命令行参数排列\n    ENVIRON            支持队列中系统环境变量的使用\n    FILENAME           awk浏览的文件名\n    FNR                浏览文件的记录数\n    FS                 设置输入域分隔符，等价于命令行 -F选项\n    NF                 浏览记录的域的个数\n    NR                 已读的记录数\n    OFS                输出域分隔符\n    ORS                输出记录分隔符\n    RS                 控制记录分隔符\n \n 此外,$0变量是指整条记录。$1表示当前行的第一个域,$2表示当前行的第二个域,......以此类推。\n\n \n\n统计/etc/passwd:文件名，每行的行号，每行的列数，对应的完整行内容:\n\n> #awk  -F ':'  '{print \"filename:\" FILENAME \",linenumber:\" NR \",columns:\" NF \",linecontent:\"$0}' /etc/passwd\n```\nfilename:/etc/passwd,linenumber:1,columns:7,linecontent:root:x:0:0:root:/root:/bin/bash\nfilename:/etc/passwd,linenumber:2,columns:7,linecontent:daemon:x:1:1:daemon:/usr/sbin:/bin/sh\nfilename:/etc/passwd,linenumber:3,columns:7,linecontent:bin:x:2:2:bin:/bin:/bin/sh\nfilename:/etc/passwd,linenumber:4,columns:7,linecontent:sys:x:3:3:sys:/dev:/bin/sh\n\n``` \n\n使用printf替代print,可以让代码更加简洁，易读\n\n > awk  -F ':'  '{printf(\"filename:%s,linenumber:%s,columns:%s,linecontent:%s\\n\",FILENAME,NR,NF,$0)}' /etc/passwd\n \n\n## print和printf\nawk中同时提供了print和printf两种打印输出的函数。\n\n其中print函数的参数可以是变量、数值或者字符串。字符串必须用双引号引用，参数用逗号分隔。如果没有逗号，参数就串联在一起而无法区分。这里，逗号的作用与输出文件的分隔符的作用是一样的，只是后者是空格而已。\n\nprintf函数，其用法和c语言中printf基本相似,可以格式化字符串,输出复杂时，printf更加好用，代码更易懂。\n\n%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% \n\n#  awk编程\n 变量和赋值\n\n除了awk的内置变量，awk还可以自定义变量。\n\n## 下面统计/etc/passwd的账户人数\n```\n\nawk '{count++;print $0;} END{print \"user count is \", count}' /etc/passwd\nroot:x:0:0:root:/root:/bin/bash\n......\nuser count is  40\n\n```\n\ncount是自定义变量。之前的action{}里都是只有一个print,其实print只是一个语句，而action{}可以有多个语句，以;号隔开。\n\n \n\n这里没有初始化count，虽然默认是0，但是妥当的做法还是初始化为0:\n\n```\nawk 'BEGIN {count=0;print \"[start]user count is \", count} {count=count+1;print $0;} END{print \"[end]user count is \", count}' /etc/passwd\n[start]user count is  0\nroot:x:0:0:root:/root:/bin/bash\n...\n[end]user count is  40\n\n``` \n\n统计某个文件夹下的文件占用的字节数\n\n```\nls -l |awk 'BEGIN {size=0;} {size=size+$5;} END{print \"[end]size is \", size}'\n[end]size is  8657198\n\n``` \n\n如果以M为单位显示:\n\n```\nls -l |awk 'BEGIN {size=0;} {size=size+$5;} END{print \"[end]size is \", size/1024/1024,\"M\"}' \n[end]size is  8.25889 M\n\n```\n注意，统计不包括文件夹的子目录。\n\n \n\n### 条件语句\n\n awk中的条件语句是从C语言中借鉴来的，见如下声明方式：\n\n \n```\nif (expression) {\n    statement;\n    statement;\n    ... ...\n}\n\n\nif (expression) {\n    statement;\n} else {\n    statement2;\n}\n\nif (expression) {\n    statement1;\n} else if (expression1) {\n    statement2;\n} else {\n    statement3;\n}\n \n ```\n\n统计某个文件夹下的文件占用的字节数,过滤4096大小的文件(一般都是文件夹):\n\n```\nls -l |awk 'BEGIN {size=0;print \"[start]size is \", size} {if($5!=4096){size=size+$5;}} END{print \"[end]size is \", size/1024/1024,\"M\"}' \n[end]size is  8.22339 M\n\n``` \n\n### 循环语句\n\nawk中的循环语句同样借鉴于C语言，支持while、do/while、for、break、continue，这些关键字的语义和C语言中的语义完全相同。\n\n \n\n### 数组\n\n  因为awk中数组的下标可以是数字和字母，数组的下标通常被称为关键字(key)。值和关键字都存储在内部的一张针对key/value应用hash的表格里。由于hash不是顺序存储，因此在显示数组内容时会发现，它们并不是按照你预料的顺序显示出来的。数组和变量一样，都是在使用时自动创建的，awk也同样会自动判断其存储的是数字还是字符串。一般而言，awk中的数组用来从记录中收集信息，可以用于计算总和、统计单词以及跟踪模板被匹配的次数等等。\n\n \n\n显示/etc/passwd的账户\n\n \n```\nawk -F ':' 'BEGIN {count=0;} {name[count] = $1;count++;}; END{for (i = 0; i < NR; i++) print i, name[i]}' /etc/passwd\n0 root\n1 daemon\n2 bin\n3 sys\n4 sync\n5 games\n......\n\n``` \n这里使用for循环遍历数组\n\n \n\nawk编程的内容极多，这里只罗列简单常用的用法，更多请参考 http://www.gnu.org/software/gawk/manual/gawk.html","source":"_posts/大数据/大数据02-05-shell编程-awk命令.md","raw":"---\ntitle: 大数据02-05-shell编程-awk命令\ncategories: 学习\ntags:\n  - 大数据\n  - linux\n  - centos7\n  - linux命令\ntoc: true\ndate: 2017-11-06 23:25:05\nscaffolds:\n---\n# 简介\nawk是一个强大的文本分析工具，相对于grep的查找，sed的编辑，awk在其对数据分析并生成报告时，显得尤为强大。简单来说awk就是把文件逐行的读入，以空格为默认分隔符将每行切片，切开的部分再进行各种分析处理。\n\nawk有3个不同版本: awk、nawk和gawk，未作特别说明，一般指gawk，gawk 是 AWK 的 GNU 版本。\n\nawk其名称得自于它的创始人 Alfred Aho 、Peter Weinberger 和 Brian Kernighan 姓氏的首个字母。实际上 AWK 的确拥有自己的语言： AWK 程序设计语言 ， 三位创建者已将它正式定义为“样式扫描和处理语言”。它允许您创建简短的程序，这些程序读取输入文件、为数据排序、处理数据、对输入执行计算以及生成报表，还有无数其他的功能。\n<!--more -->\n \n\n# 使用方法\n> `awk '{pattern + action}' {filenames}`\n\n尽管操作可能会很复杂，但语法总是这样，其中 pattern 表示 AWK 在数据中查找的内容，而 action 是在找到匹配内容时所执行的一系列命令。花括号（{}）不需要在程序中始终出现，但它们用于根据特定的模式对一系列指令进行分组。 pattern就是要表示的正则表达式，用斜杠括起来。\n\nawk语言的最基本功能是在文件或者字符串中基于指定规则浏览和抽取信息，awk抽取信息后，才能进行其他文本操作。完整的awk脚本通常用来格式化文本文件中的信息。\n\n通常，awk是以文件的一行为处理单位的。awk每接收文件的一行，然后执行相应的命令，来处理文本。\n\n \n## 调用awk\n\n有三种方式调用awk\n\n \n### 1.命令行方式\n> awk [-F  field-separator]  'commands'  input-file(s)\n其中，commands 是真正awk命令，[-F域分隔符]是可选的。 input-file(s) 是待处理的文件。\n在awk中，文件的每一行中，由域分隔符分开的每一项称为一个域。通常，在不指名-F域分隔符的情况下，默认的域分隔符是空格。\n\n### 2.shell脚本方式\n将所有的awk命令插入一个文件，并使awk程序可执行，然后awk命令解释器作为脚本的首行，一遍通过键入脚本名称来调用。\n相当于shell脚本首行的：#!/bin/sh\n可以换成：#!/bin/awk\n\n### 3.将所有的awk命令插入一个单独文件，然后调用：\n> awk -f awk-script-file input-file(s)\n其中，-f选项加载awk-script-file中的awk脚本，input-file(s)跟上面的是一样的。\n \n 本章重点介绍命令行方式。\n\n \n\n## 入门实例\n假设last -n 5的输出如下\n\n> [root@www ~]# last -n 5 <==仅取出前五行\n\n```\nroot     pts/1   192.168.1.100  Tue Feb 10 11:21   still logged in\nroot     pts/1   192.168.1.100  Tue Feb 10 00:46 - 02:28  (01:41)\nroot     pts/1   192.168.1.100  Mon Feb  9 11:41 - 18:30  (06:48)\ndmtsai   pts/1   192.168.1.100  Mon Feb  9 11:41 - 11:41  (00:00)\nroot     tty1                   Fri Sep  5 14:09 - 14:10  (00:01)\n\n```\n如果只是显示最近登录的5个帐号\n\n```\n#last -n 5 | awk  '{print $1}'\nroot\nroot\nroot\ndmtsai\nroot\n\n```\nawk工作流程是这样的：读入有'\\n'换行符分割的一条记录，然后将记录按指定的域分隔符划分域，填充域，$0则表示所有域,$1表示第一个域,$n表示第n个域。默认域分隔符是\"空白键\" 或 \"[tab]键\",所以$1表示登录用户，$3表示登录用户ip,以此类推。\n\n \n\n如果只是显示/etc/passwd的账户\n\n```\n#cat /etc/passwd |awk  -F ':'  '{print $1}'  \nroot\ndaemon\nbin\nsys\n\n```\n这种是awk+action的示例，每行都会执行action{print $1}。\n\n> -F指定域分隔符为':'。\n\n \n\n如果只是显示/etc/passwd的账户和账户对应的shell,而账户与shell之间以tab键分割\n\n```\n#cat /etc/passwd |awk  -F ':'  '{print $1\"\\t\"$7}'\nroot    /bin/bash\ndaemon  /bin/sh\nbin     /bin/sh\nsys     /bin/sh\n\n``` \n\n如果只是显示/etc/passwd的账户和账户对应的shell,而账户与shell之间以逗号分割,而且在所有行添加列名name,shell,在最后一行添加\"blue,/bin/nosh\"。\n\n \n```\ncat /etc/passwd |awk  -F ':'  'BEGIN {print \"name,shell\"}  {print $1\",\"$7} END {print \"blue,/bin/nosh\"}'\nname,shell\nroot,/bin/bash\ndaemon,/bin/sh\nbin,/bin/sh\nsys,/bin/sh\n....\nblue,/bin/nosh\n\n``` \n\nawk工作流程是这样的：先执行BEGING，然后读取文件，读入有/n换行符分割的一条记录，然后将记录按指定的域分隔符划分域，填充域，$0则表示所有域,$1表示第一个域,$n表示第n个域,随后开始执行模式所对应的动作action。接着开始读入第二条记录······直到所有的记录都读完，最后执行END操作。\n\n \n\n搜索/etc/passwd有root关键字的所有行\n\n> #awk -F: '/root/' /etc/passwd\nroot:x:0:0:root:/root:/bin/bash\n这种是pattern的使用示例，匹配了pattern(这里是root)的行才会执行action(没有指定action，默认输出每行的内容)。\n\n搜索支持正则，例如找root开头的: ```awk -F: '/^root/' /etc/passwd```\n\n \n\n搜索/etc/passwd有root关键字的所有行，并显示对应的shell\n\n> # awk -F: '/root/{print $7}' /etc/passwd             \n/bin/bash\n 这里指定了action{print $7}\n\n \n\n## awk内置变量\nawk有许多内置变量用来设置环境信息，这些变量可以被改变，下面给出了最常用的一些变量。\n\n \n    ARGC               命令行参数个数\n    ARGV               命令行参数排列\n    ENVIRON            支持队列中系统环境变量的使用\n    FILENAME           awk浏览的文件名\n    FNR                浏览文件的记录数\n    FS                 设置输入域分隔符，等价于命令行 -F选项\n    NF                 浏览记录的域的个数\n    NR                 已读的记录数\n    OFS                输出域分隔符\n    ORS                输出记录分隔符\n    RS                 控制记录分隔符\n \n 此外,$0变量是指整条记录。$1表示当前行的第一个域,$2表示当前行的第二个域,......以此类推。\n\n \n\n统计/etc/passwd:文件名，每行的行号，每行的列数，对应的完整行内容:\n\n> #awk  -F ':'  '{print \"filename:\" FILENAME \",linenumber:\" NR \",columns:\" NF \",linecontent:\"$0}' /etc/passwd\n```\nfilename:/etc/passwd,linenumber:1,columns:7,linecontent:root:x:0:0:root:/root:/bin/bash\nfilename:/etc/passwd,linenumber:2,columns:7,linecontent:daemon:x:1:1:daemon:/usr/sbin:/bin/sh\nfilename:/etc/passwd,linenumber:3,columns:7,linecontent:bin:x:2:2:bin:/bin:/bin/sh\nfilename:/etc/passwd,linenumber:4,columns:7,linecontent:sys:x:3:3:sys:/dev:/bin/sh\n\n``` \n\n使用printf替代print,可以让代码更加简洁，易读\n\n > awk  -F ':'  '{printf(\"filename:%s,linenumber:%s,columns:%s,linecontent:%s\\n\",FILENAME,NR,NF,$0)}' /etc/passwd\n \n\n## print和printf\nawk中同时提供了print和printf两种打印输出的函数。\n\n其中print函数的参数可以是变量、数值或者字符串。字符串必须用双引号引用，参数用逗号分隔。如果没有逗号，参数就串联在一起而无法区分。这里，逗号的作用与输出文件的分隔符的作用是一样的，只是后者是空格而已。\n\nprintf函数，其用法和c语言中printf基本相似,可以格式化字符串,输出复杂时，printf更加好用，代码更易懂。\n\n%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% \n\n#  awk编程\n 变量和赋值\n\n除了awk的内置变量，awk还可以自定义变量。\n\n## 下面统计/etc/passwd的账户人数\n```\n\nawk '{count++;print $0;} END{print \"user count is \", count}' /etc/passwd\nroot:x:0:0:root:/root:/bin/bash\n......\nuser count is  40\n\n```\n\ncount是自定义变量。之前的action{}里都是只有一个print,其实print只是一个语句，而action{}可以有多个语句，以;号隔开。\n\n \n\n这里没有初始化count，虽然默认是0，但是妥当的做法还是初始化为0:\n\n```\nawk 'BEGIN {count=0;print \"[start]user count is \", count} {count=count+1;print $0;} END{print \"[end]user count is \", count}' /etc/passwd\n[start]user count is  0\nroot:x:0:0:root:/root:/bin/bash\n...\n[end]user count is  40\n\n``` \n\n统计某个文件夹下的文件占用的字节数\n\n```\nls -l |awk 'BEGIN {size=0;} {size=size+$5;} END{print \"[end]size is \", size}'\n[end]size is  8657198\n\n``` \n\n如果以M为单位显示:\n\n```\nls -l |awk 'BEGIN {size=0;} {size=size+$5;} END{print \"[end]size is \", size/1024/1024,\"M\"}' \n[end]size is  8.25889 M\n\n```\n注意，统计不包括文件夹的子目录。\n\n \n\n### 条件语句\n\n awk中的条件语句是从C语言中借鉴来的，见如下声明方式：\n\n \n```\nif (expression) {\n    statement;\n    statement;\n    ... ...\n}\n\n\nif (expression) {\n    statement;\n} else {\n    statement2;\n}\n\nif (expression) {\n    statement1;\n} else if (expression1) {\n    statement2;\n} else {\n    statement3;\n}\n \n ```\n\n统计某个文件夹下的文件占用的字节数,过滤4096大小的文件(一般都是文件夹):\n\n```\nls -l |awk 'BEGIN {size=0;print \"[start]size is \", size} {if($5!=4096){size=size+$5;}} END{print \"[end]size is \", size/1024/1024,\"M\"}' \n[end]size is  8.22339 M\n\n``` \n\n### 循环语句\n\nawk中的循环语句同样借鉴于C语言，支持while、do/while、for、break、continue，这些关键字的语义和C语言中的语义完全相同。\n\n \n\n### 数组\n\n  因为awk中数组的下标可以是数字和字母，数组的下标通常被称为关键字(key)。值和关键字都存储在内部的一张针对key/value应用hash的表格里。由于hash不是顺序存储，因此在显示数组内容时会发现，它们并不是按照你预料的顺序显示出来的。数组和变量一样，都是在使用时自动创建的，awk也同样会自动判断其存储的是数字还是字符串。一般而言，awk中的数组用来从记录中收集信息，可以用于计算总和、统计单词以及跟踪模板被匹配的次数等等。\n\n \n\n显示/etc/passwd的账户\n\n \n```\nawk -F ':' 'BEGIN {count=0;} {name[count] = $1;count++;}; END{for (i = 0; i < NR; i++) print i, name[i]}' /etc/passwd\n0 root\n1 daemon\n2 bin\n3 sys\n4 sync\n5 games\n......\n\n``` \n这里使用for循环遍历数组\n\n \n\nawk编程的内容极多，这里只罗列简单常用的用法，更多请参考 http://www.gnu.org/software/gawk/manual/gawk.html","slug":"大数据/大数据02-05-shell编程-awk命令","published":1,"updated":"2017-11-14T15:08:18.953Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjcsq4lfq000ux4vf2zw7rg4w","content":"<h1 id=\"简介\"><a href=\"#简介\" class=\"headerlink\" title=\"简介\"></a>简介</h1><p>awk是一个强大的文本分析工具，相对于grep的查找，sed的编辑，awk在其对数据分析并生成报告时，显得尤为强大。简单来说awk就是把文件逐行的读入，以空格为默认分隔符将每行切片，切开的部分再进行各种分析处理。</p>\n<p>awk有3个不同版本: awk、nawk和gawk，未作特别说明，一般指gawk，gawk 是 AWK 的 GNU 版本。</p>\n<p>awk其名称得自于它的创始人 Alfred Aho 、Peter Weinberger 和 Brian Kernighan 姓氏的首个字母。实际上 AWK 的确拥有自己的语言： AWK 程序设计语言 ， 三位创建者已将它正式定义为“样式扫描和处理语言”。它允许您创建简短的程序，这些程序读取输入文件、为数据排序、处理数据、对输入执行计算以及生成报表，还有无数其他的功能。<br><a id=\"more\"></a></p>\n<h1 id=\"使用方法\"><a href=\"#使用方法\" class=\"headerlink\" title=\"使用方法\"></a>使用方法</h1><blockquote>\n<p><code>awk &#39;{pattern + action}&#39; {filenames}</code></p>\n</blockquote>\n<p>尽管操作可能会很复杂，但语法总是这样，其中 pattern 表示 AWK 在数据中查找的内容，而 action 是在找到匹配内容时所执行的一系列命令。花括号（{}）不需要在程序中始终出现，但它们用于根据特定的模式对一系列指令进行分组。 pattern就是要表示的正则表达式，用斜杠括起来。</p>\n<p>awk语言的最基本功能是在文件或者字符串中基于指定规则浏览和抽取信息，awk抽取信息后，才能进行其他文本操作。完整的awk脚本通常用来格式化文本文件中的信息。</p>\n<p>通常，awk是以文件的一行为处理单位的。awk每接收文件的一行，然后执行相应的命令，来处理文本。</p>\n<h2 id=\"调用awk\"><a href=\"#调用awk\" class=\"headerlink\" title=\"调用awk\"></a>调用awk</h2><p>有三种方式调用awk</p>\n<h3 id=\"1-命令行方式\"><a href=\"#1-命令行方式\" class=\"headerlink\" title=\"1.命令行方式\"></a>1.命令行方式</h3><blockquote>\n<p>awk [-F  field-separator]  ‘commands’  input-file(s)<br>其中，commands 是真正awk命令，[-F域分隔符]是可选的。 input-file(s) 是待处理的文件。<br>在awk中，文件的每一行中，由域分隔符分开的每一项称为一个域。通常，在不指名-F域分隔符的情况下，默认的域分隔符是空格。</p>\n</blockquote>\n<h3 id=\"2-shell脚本方式\"><a href=\"#2-shell脚本方式\" class=\"headerlink\" title=\"2.shell脚本方式\"></a>2.shell脚本方式</h3><p>将所有的awk命令插入一个文件，并使awk程序可执行，然后awk命令解释器作为脚本的首行，一遍通过键入脚本名称来调用。<br>相当于shell脚本首行的：#!/bin/sh<br>可以换成：#!/bin/awk</p>\n<h3 id=\"3-将所有的awk命令插入一个单独文件，然后调用：\"><a href=\"#3-将所有的awk命令插入一个单独文件，然后调用：\" class=\"headerlink\" title=\"3.将所有的awk命令插入一个单独文件，然后调用：\"></a>3.将所有的awk命令插入一个单独文件，然后调用：</h3><blockquote>\n<p>awk -f awk-script-file input-file(s)<br>其中，-f选项加载awk-script-file中的awk脚本，input-file(s)跟上面的是一样的。</p>\n</blockquote>\n<p> 本章重点介绍命令行方式。</p>\n<h2 id=\"入门实例\"><a href=\"#入门实例\" class=\"headerlink\" title=\"入门实例\"></a>入门实例</h2><p>假设last -n 5的输出如下</p>\n<blockquote>\n<p>[root@www ~]# last -n 5 &lt;==仅取出前五行</p>\n</blockquote>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\">root     pts/1   192.168.1.100  Tue Feb 10 11:21   still logged in</div><div class=\"line\">root     pts/1   192.168.1.100  Tue Feb 10 00:46 - 02:28  (01:41)</div><div class=\"line\">root     pts/1   192.168.1.100  Mon Feb  9 11:41 - 18:30  (06:48)</div><div class=\"line\">dmtsai   pts/1   192.168.1.100  Mon Feb  9 11:41 - 11:41  (00:00)</div><div class=\"line\">root     tty1                   Fri Sep  5 14:09 - 14:10  (00:01)</div></pre></td></tr></table></figure>\n<p>如果只是显示最近登录的5个帐号</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\">#last -n 5 | awk  &apos;&#123;print $1&#125;&apos;</div><div class=\"line\">root</div><div class=\"line\">root</div><div class=\"line\">root</div><div class=\"line\">dmtsai</div><div class=\"line\">root</div></pre></td></tr></table></figure>\n<p>awk工作流程是这样的：读入有’\\n’换行符分割的一条记录，然后将记录按指定的域分隔符划分域，填充域，$0则表示所有域,$1表示第一个域,$n表示第n个域。默认域分隔符是”空白键” 或 “[tab]键”,所以$1表示登录用户，$3表示登录用户ip,以此类推。</p>\n<p>如果只是显示/etc/passwd的账户</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\">#cat /etc/passwd |awk  -F &apos;:&apos;  &apos;&#123;print $1&#125;&apos;  </div><div class=\"line\">root</div><div class=\"line\">daemon</div><div class=\"line\">bin</div><div class=\"line\">sys</div></pre></td></tr></table></figure>\n<p>这种是awk+action的示例，每行都会执行action{print $1}。</p>\n<blockquote>\n<p>-F指定域分隔符为’:’。</p>\n</blockquote>\n<p>如果只是显示/etc/passwd的账户和账户对应的shell,而账户与shell之间以tab键分割</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div></pre></td><td class=\"code\"><pre><div class=\"line\">#cat /etc/passwd |awk  -F &apos;:&apos;  &apos;&#123;print $1&quot;\\t&quot;$7&#125;&apos;</div><div class=\"line\">root    /bin/bash</div><div class=\"line\">daemon  /bin/sh</div><div class=\"line\">bin     /bin/sh</div><div class=\"line\">sys     /bin/sh</div><div class=\"line\"></div><div class=\"line\">``` </div><div class=\"line\"></div><div class=\"line\">如果只是显示/etc/passwd的账户和账户对应的shell,而账户与shell之间以逗号分割,而且在所有行添加列名name,shell,在最后一行添加&quot;blue,/bin/nosh&quot;。</div></pre></td></tr></table></figure>\n<p>cat /etc/passwd |awk  -F ‘:’  ‘BEGIN {print “name,shell”}  {print $1”,”$7} END {print “blue,/bin/nosh”}’<br>name,shell<br>root,/bin/bash<br>daemon,/bin/sh<br>bin,/bin/sh<br>sys,/bin/sh<br>….<br>blue,/bin/nosh</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div></pre></td><td class=\"code\"><pre><div class=\"line\"></div><div class=\"line\">awk工作流程是这样的：先执行BEGING，然后读取文件，读入有/n换行符分割的一条记录，然后将记录按指定的域分隔符划分域，填充域，$0则表示所有域,$1表示第一个域,$n表示第n个域,随后开始执行模式所对应的动作action。接着开始读入第二条记录······直到所有的记录都读完，最后执行END操作。</div><div class=\"line\"></div><div class=\"line\"> </div><div class=\"line\"></div><div class=\"line\">搜索/etc/passwd有root关键字的所有行</div><div class=\"line\"></div><div class=\"line\">&gt; #awk -F: &apos;/root/&apos; /etc/passwd</div><div class=\"line\">root:x:0:0:root:/root:/bin/bash</div><div class=\"line\">这种是pattern的使用示例，匹配了pattern(这里是root)的行才会执行action(没有指定action，默认输出每行的内容)。</div><div class=\"line\"></div><div class=\"line\">搜索支持正则，例如找root开头的: ```awk -F: &apos;/^root/&apos; /etc/passwd</div></pre></td></tr></table></figure>\n<p>搜索/etc/passwd有root关键字的所有行，并显示对应的shell</p>\n<blockquote>\n<h1 id=\"awk-F-‘-root-print-7-’-etc-passwd\"><a href=\"#awk-F-‘-root-print-7-’-etc-passwd\" class=\"headerlink\" title=\"awk -F: ‘/root/{print $7}’ /etc/passwd\"></a>awk -F: ‘/root/{print $7}’ /etc/passwd</h1><p>/bin/bash<br> 这里指定了action{print $7}</p>\n</blockquote>\n<h2 id=\"awk内置变量\"><a href=\"#awk内置变量\" class=\"headerlink\" title=\"awk内置变量\"></a>awk内置变量</h2><p>awk有许多内置变量用来设置环境信息，这些变量可以被改变，下面给出了最常用的一些变量。</p>\n<pre><code>ARGC               命令行参数个数\nARGV               命令行参数排列\nENVIRON            支持队列中系统环境变量的使用\nFILENAME           awk浏览的文件名\nFNR                浏览文件的记录数\nFS                 设置输入域分隔符，等价于命令行 -F选项\nNF                 浏览记录的域的个数\nNR                 已读的记录数\nOFS                输出域分隔符\nORS                输出记录分隔符\nRS                 控制记录分隔符\n</code></pre><p> 此外,$0变量是指整条记录。$1表示当前行的第一个域,$2表示当前行的第二个域,……以此类推。</p>\n<p>统计/etc/passwd:文件名，每行的行号，每行的列数，对应的完整行内容:</p>\n<blockquote>\n<p>#awk  -F ‘:’  ‘{print “filename:” FILENAME “,linenumber:” NR “,columns:” NF “,linecontent:”$0}’ /etc/passwd<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div></pre></td><td class=\"code\"><pre><div class=\"line\">filename:/etc/passwd,linenumber:1,columns:7,linecontent:root:x:0:0:root:/root:/bin/bash</div><div class=\"line\">filename:/etc/passwd,linenumber:2,columns:7,linecontent:daemon:x:1:1:daemon:/usr/sbin:/bin/sh</div><div class=\"line\">filename:/etc/passwd,linenumber:3,columns:7,linecontent:bin:x:2:2:bin:/bin:/bin/sh</div><div class=\"line\">filename:/etc/passwd,linenumber:4,columns:7,linecontent:sys:x:3:3:sys:/dev:/bin/sh</div><div class=\"line\"></div><div class=\"line\">``` </div><div class=\"line\"></div><div class=\"line\">使用printf替代print,可以让代码更加简洁，易读</div><div class=\"line\"></div><div class=\"line\"> &gt; awk  -F &apos;:&apos;  &apos;&#123;printf(&quot;filename:%s,linenumber:%s,columns:%s,linecontent:%s\\n&quot;,FILENAME,NR,NF,$0)&#125;&apos; /etc/passwd</div><div class=\"line\"> </div><div class=\"line\"></div><div class=\"line\">## print和printf</div><div class=\"line\">awk中同时提供了print和printf两种打印输出的函数。</div><div class=\"line\"></div><div class=\"line\">其中print函数的参数可以是变量、数值或者字符串。字符串必须用双引号引用，参数用逗号分隔。如果没有逗号，参数就串联在一起而无法区分。这里，逗号的作用与输出文件的分隔符的作用是一样的，只是后者是空格而已。</div><div class=\"line\"></div><div class=\"line\">printf函数，其用法和c语言中printf基本相似,可以格式化字符串,输出复杂时，printf更加好用，代码更易懂。</div><div class=\"line\"></div><div class=\"line\">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% </div><div class=\"line\"></div><div class=\"line\">#  awk编程</div><div class=\"line\"> 变量和赋值</div><div class=\"line\"></div><div class=\"line\">除了awk的内置变量，awk还可以自定义变量。</div><div class=\"line\"></div><div class=\"line\">## 下面统计/etc/passwd的账户人数</div></pre></td></tr></table></figure></p>\n</blockquote>\n<p>awk ‘{count++;print $0;} END{print “user count is “, count}’ /etc/passwd<br>root:x:0:0:root:/root:/bin/bash<br>……<br>user count is  40</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\"></div><div class=\"line\">count是自定义变量。之前的action&#123;&#125;里都是只有一个print,其实print只是一个语句，而action&#123;&#125;可以有多个语句，以;号隔开。</div><div class=\"line\"></div><div class=\"line\"> </div><div class=\"line\"></div><div class=\"line\">这里没有初始化count，虽然默认是0，但是妥当的做法还是初始化为0:</div></pre></td></tr></table></figure>\n<p>awk ‘BEGIN {count=0;print “[start]user count is “, count} {count=count+1;print $0;} END{print “[end]user count is “, count}’ /etc/passwd<br>[start]user count is  0<br>root:x:0:0:root:/root:/bin/bash<br>…<br>[end]user count is  40</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\"></div><div class=\"line\">统计某个文件夹下的文件占用的字节数</div></pre></td></tr></table></figure>\n<p>ls -l |awk ‘BEGIN {size=0;} {size=size+$5;} END{print “[end]size is “, size}’<br>[end]size is  8657198</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\"></div><div class=\"line\">如果以M为单位显示:</div></pre></td></tr></table></figure>\n<p>ls -l |awk ‘BEGIN {size=0;} {size=size+$5;} END{print “[end]size is “, size/1024/1024,”M”}’<br>[end]size is  8.25889 M</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div></pre></td><td class=\"code\"><pre><div class=\"line\">注意，统计不包括文件夹的子目录。</div><div class=\"line\"></div><div class=\"line\"> </div><div class=\"line\"></div><div class=\"line\">### 条件语句</div><div class=\"line\"></div><div class=\"line\"> awk中的条件语句是从C语言中借鉴来的，见如下声明方式：</div></pre></td></tr></table></figure>\n<p>if (expression) {<br>    statement;<br>    statement;<br>    … …<br>}</p>\n<p>if (expression) {<br>    statement;<br>} else {<br>    statement2;<br>}</p>\n<p>if (expression) {<br>    statement1;<br>} else if (expression1) {<br>    statement2;<br>} else {<br>    statement3;<br>}</p>\n <figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\"></div><div class=\"line\">统计某个文件夹下的文件占用的字节数,过滤4096大小的文件(一般都是文件夹):</div></pre></td></tr></table></figure>\n<p>ls -l |awk ‘BEGIN {size=0;print “[start]size is “, size} {if($5!=4096){size=size+$5;}} END{print “[end]size is “, size/1024/1024,”M”}’<br>[end]size is  8.22339 M</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div></pre></td><td class=\"code\"><pre><div class=\"line\"></div><div class=\"line\">### 循环语句</div><div class=\"line\"></div><div class=\"line\">awk中的循环语句同样借鉴于C语言，支持while、do/while、for、break、continue，这些关键字的语义和C语言中的语义完全相同。</div><div class=\"line\"></div><div class=\"line\"> </div><div class=\"line\"></div><div class=\"line\">### 数组</div><div class=\"line\"></div><div class=\"line\">  因为awk中数组的下标可以是数字和字母，数组的下标通常被称为关键字(key)。值和关键字都存储在内部的一张针对key/value应用hash的表格里。由于hash不是顺序存储，因此在显示数组内容时会发现，它们并不是按照你预料的顺序显示出来的。数组和变量一样，都是在使用时自动创建的，awk也同样会自动判断其存储的是数字还是字符串。一般而言，awk中的数组用来从记录中收集信息，可以用于计算总和、统计单词以及跟踪模板被匹配的次数等等。</div><div class=\"line\"></div><div class=\"line\"> </div><div class=\"line\"></div><div class=\"line\">显示/etc/passwd的账户</div></pre></td></tr></table></figure>\n<p>awk -F ‘:’ ‘BEGIN {count=0;} {name[count] = $1;count++;}; END{for (i = 0; i &lt; NR; i++) print i, name[i]}’ /etc/passwd<br>0 root<br>1 daemon<br>2 bin<br>3 sys<br>4 sync<br>5 games<br>……</p>\n<p>```<br>这里使用for循环遍历数组</p>\n<p>awk编程的内容极多，这里只罗列简单常用的用法，更多请参考 <a href=\"http://www.gnu.org/software/gawk/manual/gawk.html\" target=\"_blank\" rel=\"external\">http://www.gnu.org/software/gawk/manual/gawk.html</a></p>\n","site":{"data":{}},"excerpt":"<h1 id=\"简介\"><a href=\"#简介\" class=\"headerlink\" title=\"简介\"></a>简介</h1><p>awk是一个强大的文本分析工具，相对于grep的查找，sed的编辑，awk在其对数据分析并生成报告时，显得尤为强大。简单来说awk就是把文件逐行的读入，以空格为默认分隔符将每行切片，切开的部分再进行各种分析处理。</p>\n<p>awk有3个不同版本: awk、nawk和gawk，未作特别说明，一般指gawk，gawk 是 AWK 的 GNU 版本。</p>\n<p>awk其名称得自于它的创始人 Alfred Aho 、Peter Weinberger 和 Brian Kernighan 姓氏的首个字母。实际上 AWK 的确拥有自己的语言： AWK 程序设计语言 ， 三位创建者已将它正式定义为“样式扫描和处理语言”。它允许您创建简短的程序，这些程序读取输入文件、为数据排序、处理数据、对输入执行计算以及生成报表，还有无数其他的功能。<br>","more":"</p>\n<h1 id=\"使用方法\"><a href=\"#使用方法\" class=\"headerlink\" title=\"使用方法\"></a>使用方法</h1><blockquote>\n<p><code>awk &#39;{pattern + action}&#39; {filenames}</code></p>\n</blockquote>\n<p>尽管操作可能会很复杂，但语法总是这样，其中 pattern 表示 AWK 在数据中查找的内容，而 action 是在找到匹配内容时所执行的一系列命令。花括号（{}）不需要在程序中始终出现，但它们用于根据特定的模式对一系列指令进行分组。 pattern就是要表示的正则表达式，用斜杠括起来。</p>\n<p>awk语言的最基本功能是在文件或者字符串中基于指定规则浏览和抽取信息，awk抽取信息后，才能进行其他文本操作。完整的awk脚本通常用来格式化文本文件中的信息。</p>\n<p>通常，awk是以文件的一行为处理单位的。awk每接收文件的一行，然后执行相应的命令，来处理文本。</p>\n<h2 id=\"调用awk\"><a href=\"#调用awk\" class=\"headerlink\" title=\"调用awk\"></a>调用awk</h2><p>有三种方式调用awk</p>\n<h3 id=\"1-命令行方式\"><a href=\"#1-命令行方式\" class=\"headerlink\" title=\"1.命令行方式\"></a>1.命令行方式</h3><blockquote>\n<p>awk [-F  field-separator]  ‘commands’  input-file(s)<br>其中，commands 是真正awk命令，[-F域分隔符]是可选的。 input-file(s) 是待处理的文件。<br>在awk中，文件的每一行中，由域分隔符分开的每一项称为一个域。通常，在不指名-F域分隔符的情况下，默认的域分隔符是空格。</p>\n</blockquote>\n<h3 id=\"2-shell脚本方式\"><a href=\"#2-shell脚本方式\" class=\"headerlink\" title=\"2.shell脚本方式\"></a>2.shell脚本方式</h3><p>将所有的awk命令插入一个文件，并使awk程序可执行，然后awk命令解释器作为脚本的首行，一遍通过键入脚本名称来调用。<br>相当于shell脚本首行的：#!/bin/sh<br>可以换成：#!/bin/awk</p>\n<h3 id=\"3-将所有的awk命令插入一个单独文件，然后调用：\"><a href=\"#3-将所有的awk命令插入一个单独文件，然后调用：\" class=\"headerlink\" title=\"3.将所有的awk命令插入一个单独文件，然后调用：\"></a>3.将所有的awk命令插入一个单独文件，然后调用：</h3><blockquote>\n<p>awk -f awk-script-file input-file(s)<br>其中，-f选项加载awk-script-file中的awk脚本，input-file(s)跟上面的是一样的。</p>\n</blockquote>\n<p> 本章重点介绍命令行方式。</p>\n<h2 id=\"入门实例\"><a href=\"#入门实例\" class=\"headerlink\" title=\"入门实例\"></a>入门实例</h2><p>假设last -n 5的输出如下</p>\n<blockquote>\n<p>[root@www ~]# last -n 5 &lt;==仅取出前五行</p>\n</blockquote>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\">root     pts/1   192.168.1.100  Tue Feb 10 11:21   still logged in</div><div class=\"line\">root     pts/1   192.168.1.100  Tue Feb 10 00:46 - 02:28  (01:41)</div><div class=\"line\">root     pts/1   192.168.1.100  Mon Feb  9 11:41 - 18:30  (06:48)</div><div class=\"line\">dmtsai   pts/1   192.168.1.100  Mon Feb  9 11:41 - 11:41  (00:00)</div><div class=\"line\">root     tty1                   Fri Sep  5 14:09 - 14:10  (00:01)</div></pre></td></tr></table></figure>\n<p>如果只是显示最近登录的5个帐号</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\">#last -n 5 | awk  &apos;&#123;print $1&#125;&apos;</div><div class=\"line\">root</div><div class=\"line\">root</div><div class=\"line\">root</div><div class=\"line\">dmtsai</div><div class=\"line\">root</div></pre></td></tr></table></figure>\n<p>awk工作流程是这样的：读入有’\\n’换行符分割的一条记录，然后将记录按指定的域分隔符划分域，填充域，$0则表示所有域,$1表示第一个域,$n表示第n个域。默认域分隔符是”空白键” 或 “[tab]键”,所以$1表示登录用户，$3表示登录用户ip,以此类推。</p>\n<p>如果只是显示/etc/passwd的账户</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\">#cat /etc/passwd |awk  -F &apos;:&apos;  &apos;&#123;print $1&#125;&apos;  </div><div class=\"line\">root</div><div class=\"line\">daemon</div><div class=\"line\">bin</div><div class=\"line\">sys</div></pre></td></tr></table></figure>\n<p>这种是awk+action的示例，每行都会执行action{print $1}。</p>\n<blockquote>\n<p>-F指定域分隔符为’:’。</p>\n</blockquote>\n<p>如果只是显示/etc/passwd的账户和账户对应的shell,而账户与shell之间以tab键分割</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div></pre></td><td class=\"code\"><pre><div class=\"line\">#cat /etc/passwd |awk  -F &apos;:&apos;  &apos;&#123;print $1&quot;\\t&quot;$7&#125;&apos;</div><div class=\"line\">root    /bin/bash</div><div class=\"line\">daemon  /bin/sh</div><div class=\"line\">bin     /bin/sh</div><div class=\"line\">sys     /bin/sh</div><div class=\"line\"></div><div class=\"line\">``` </div><div class=\"line\"></div><div class=\"line\">如果只是显示/etc/passwd的账户和账户对应的shell,而账户与shell之间以逗号分割,而且在所有行添加列名name,shell,在最后一行添加&quot;blue,/bin/nosh&quot;。</div></pre></td></tr></table></figure>\n<p>cat /etc/passwd |awk  -F ‘:’  ‘BEGIN {print “name,shell”}  {print $1”,”$7} END {print “blue,/bin/nosh”}’<br>name,shell<br>root,/bin/bash<br>daemon,/bin/sh<br>bin,/bin/sh<br>sys,/bin/sh<br>….<br>blue,/bin/nosh</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div></pre></td><td class=\"code\"><pre><div class=\"line\"></div><div class=\"line\">awk工作流程是这样的：先执行BEGING，然后读取文件，读入有/n换行符分割的一条记录，然后将记录按指定的域分隔符划分域，填充域，$0则表示所有域,$1表示第一个域,$n表示第n个域,随后开始执行模式所对应的动作action。接着开始读入第二条记录······直到所有的记录都读完，最后执行END操作。</div><div class=\"line\"></div><div class=\"line\"> </div><div class=\"line\"></div><div class=\"line\">搜索/etc/passwd有root关键字的所有行</div><div class=\"line\"></div><div class=\"line\">&gt; #awk -F: &apos;/root/&apos; /etc/passwd</div><div class=\"line\">root:x:0:0:root:/root:/bin/bash</div><div class=\"line\">这种是pattern的使用示例，匹配了pattern(这里是root)的行才会执行action(没有指定action，默认输出每行的内容)。</div><div class=\"line\"></div><div class=\"line\">搜索支持正则，例如找root开头的: ```awk -F: &apos;/^root/&apos; /etc/passwd</div></pre></td></tr></table></figure>\n<p>搜索/etc/passwd有root关键字的所有行，并显示对应的shell</p>\n<blockquote>\n<h1 id=\"awk-F-‘-root-print-7-’-etc-passwd\"><a href=\"#awk-F-‘-root-print-7-’-etc-passwd\" class=\"headerlink\" title=\"awk -F: ‘/root/{print $7}’ /etc/passwd\"></a>awk -F: ‘/root/{print $7}’ /etc/passwd</h1><p>/bin/bash<br> 这里指定了action{print $7}</p>\n</blockquote>\n<h2 id=\"awk内置变量\"><a href=\"#awk内置变量\" class=\"headerlink\" title=\"awk内置变量\"></a>awk内置变量</h2><p>awk有许多内置变量用来设置环境信息，这些变量可以被改变，下面给出了最常用的一些变量。</p>\n<pre><code>ARGC               命令行参数个数\nARGV               命令行参数排列\nENVIRON            支持队列中系统环境变量的使用\nFILENAME           awk浏览的文件名\nFNR                浏览文件的记录数\nFS                 设置输入域分隔符，等价于命令行 -F选项\nNF                 浏览记录的域的个数\nNR                 已读的记录数\nOFS                输出域分隔符\nORS                输出记录分隔符\nRS                 控制记录分隔符\n</code></pre><p> 此外,$0变量是指整条记录。$1表示当前行的第一个域,$2表示当前行的第二个域,……以此类推。</p>\n<p>统计/etc/passwd:文件名，每行的行号，每行的列数，对应的完整行内容:</p>\n<blockquote>\n<p>#awk  -F ‘:’  ‘{print “filename:” FILENAME “,linenumber:” NR “,columns:” NF “,linecontent:”$0}’ /etc/passwd<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div></pre></td><td class=\"code\"><pre><div class=\"line\">filename:/etc/passwd,linenumber:1,columns:7,linecontent:root:x:0:0:root:/root:/bin/bash</div><div class=\"line\">filename:/etc/passwd,linenumber:2,columns:7,linecontent:daemon:x:1:1:daemon:/usr/sbin:/bin/sh</div><div class=\"line\">filename:/etc/passwd,linenumber:3,columns:7,linecontent:bin:x:2:2:bin:/bin:/bin/sh</div><div class=\"line\">filename:/etc/passwd,linenumber:4,columns:7,linecontent:sys:x:3:3:sys:/dev:/bin/sh</div><div class=\"line\"></div><div class=\"line\">``` </div><div class=\"line\"></div><div class=\"line\">使用printf替代print,可以让代码更加简洁，易读</div><div class=\"line\"></div><div class=\"line\"> &gt; awk  -F &apos;:&apos;  &apos;&#123;printf(&quot;filename:%s,linenumber:%s,columns:%s,linecontent:%s\\n&quot;,FILENAME,NR,NF,$0)&#125;&apos; /etc/passwd</div><div class=\"line\"> </div><div class=\"line\"></div><div class=\"line\">## print和printf</div><div class=\"line\">awk中同时提供了print和printf两种打印输出的函数。</div><div class=\"line\"></div><div class=\"line\">其中print函数的参数可以是变量、数值或者字符串。字符串必须用双引号引用，参数用逗号分隔。如果没有逗号，参数就串联在一起而无法区分。这里，逗号的作用与输出文件的分隔符的作用是一样的，只是后者是空格而已。</div><div class=\"line\"></div><div class=\"line\">printf函数，其用法和c语言中printf基本相似,可以格式化字符串,输出复杂时，printf更加好用，代码更易懂。</div><div class=\"line\"></div><div class=\"line\">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% </div><div class=\"line\"></div><div class=\"line\">#  awk编程</div><div class=\"line\"> 变量和赋值</div><div class=\"line\"></div><div class=\"line\">除了awk的内置变量，awk还可以自定义变量。</div><div class=\"line\"></div><div class=\"line\">## 下面统计/etc/passwd的账户人数</div></pre></td></tr></table></figure></p>\n</blockquote>\n<p>awk ‘{count++;print $0;} END{print “user count is “, count}’ /etc/passwd<br>root:x:0:0:root:/root:/bin/bash<br>……<br>user count is  40</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\"></div><div class=\"line\">count是自定义变量。之前的action&#123;&#125;里都是只有一个print,其实print只是一个语句，而action&#123;&#125;可以有多个语句，以;号隔开。</div><div class=\"line\"></div><div class=\"line\"> </div><div class=\"line\"></div><div class=\"line\">这里没有初始化count，虽然默认是0，但是妥当的做法还是初始化为0:</div></pre></td></tr></table></figure>\n<p>awk ‘BEGIN {count=0;print “[start]user count is “, count} {count=count+1;print $0;} END{print “[end]user count is “, count}’ /etc/passwd<br>[start]user count is  0<br>root:x:0:0:root:/root:/bin/bash<br>…<br>[end]user count is  40</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\"></div><div class=\"line\">统计某个文件夹下的文件占用的字节数</div></pre></td></tr></table></figure>\n<p>ls -l |awk ‘BEGIN {size=0;} {size=size+$5;} END{print “[end]size is “, size}’<br>[end]size is  8657198</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\"></div><div class=\"line\">如果以M为单位显示:</div></pre></td></tr></table></figure>\n<p>ls -l |awk ‘BEGIN {size=0;} {size=size+$5;} END{print “[end]size is “, size/1024/1024,”M”}’<br>[end]size is  8.25889 M</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div></pre></td><td class=\"code\"><pre><div class=\"line\">注意，统计不包括文件夹的子目录。</div><div class=\"line\"></div><div class=\"line\"> </div><div class=\"line\"></div><div class=\"line\">### 条件语句</div><div class=\"line\"></div><div class=\"line\"> awk中的条件语句是从C语言中借鉴来的，见如下声明方式：</div></pre></td></tr></table></figure>\n<p>if (expression) {<br>    statement;<br>    statement;<br>    … …<br>}</p>\n<p>if (expression) {<br>    statement;<br>} else {<br>    statement2;<br>}</p>\n<p>if (expression) {<br>    statement1;<br>} else if (expression1) {<br>    statement2;<br>} else {<br>    statement3;<br>}</p>\n <figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\"></div><div class=\"line\">统计某个文件夹下的文件占用的字节数,过滤4096大小的文件(一般都是文件夹):</div></pre></td></tr></table></figure>\n<p>ls -l |awk ‘BEGIN {size=0;print “[start]size is “, size} {if($5!=4096){size=size+$5;}} END{print “[end]size is “, size/1024/1024,”M”}’<br>[end]size is  8.22339 M</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div></pre></td><td class=\"code\"><pre><div class=\"line\"></div><div class=\"line\">### 循环语句</div><div class=\"line\"></div><div class=\"line\">awk中的循环语句同样借鉴于C语言，支持while、do/while、for、break、continue，这些关键字的语义和C语言中的语义完全相同。</div><div class=\"line\"></div><div class=\"line\"> </div><div class=\"line\"></div><div class=\"line\">### 数组</div><div class=\"line\"></div><div class=\"line\">  因为awk中数组的下标可以是数字和字母，数组的下标通常被称为关键字(key)。值和关键字都存储在内部的一张针对key/value应用hash的表格里。由于hash不是顺序存储，因此在显示数组内容时会发现，它们并不是按照你预料的顺序显示出来的。数组和变量一样，都是在使用时自动创建的，awk也同样会自动判断其存储的是数字还是字符串。一般而言，awk中的数组用来从记录中收集信息，可以用于计算总和、统计单词以及跟踪模板被匹配的次数等等。</div><div class=\"line\"></div><div class=\"line\"> </div><div class=\"line\"></div><div class=\"line\">显示/etc/passwd的账户</div></pre></td></tr></table></figure>\n<p>awk -F ‘:’ ‘BEGIN {count=0;} {name[count] = $1;count++;}; END{for (i = 0; i &lt; NR; i++) print i, name[i]}’ /etc/passwd<br>0 root<br>1 daemon<br>2 bin<br>3 sys<br>4 sync<br>5 games<br>……</p>\n<p>```<br>这里使用for循环遍历数组</p>\n<p>awk编程的内容极多，这里只罗列简单常用的用法，更多请参考 <a href=\"http://www.gnu.org/software/gawk/manual/gawk.html\" target=\"_blank\" rel=\"external\">http://www.gnu.org/software/gawk/manual/gawk.html</a></p>"},{"title":"大数据03-02-zookeeper 简介","toc":true,"date":"2017-11-19T12:22:13.000Z","scaffolds":null,"_content":"\n# 学软件，框架\n需要明白三点\n1. 应用场景：干什么的 在哪里用的\n2. 核心工作机制流程功能：组成，角色\n3. 怎么用\n4. 再深一层，原理细节：选择性的深入了解，重要框架\n<!--more-->\n\n# zookeeper\nzookeeper会用\n# 概念简介\n分布式**协调服务**，\n- zookeeper是为别的分布式程序服务的\n- Zookeeper**本身就是一个分布式程序**（只要有半数以上节点存活，zk就能正常服务）\n- Zookeeper所提供的服务涵盖：主从协调、服务器节点动态上下线、统一配置管理、分布式共享锁、统一名称服务……\n- 虽然说可以提供各种服务，但是zookeeper在底层其实只提供了两个功能：\n    - **管理(存储，读取)用户程序提交的数据；**\n    - **并为用户程序提供数据节点监听服务；**\n\n\n## zookeeper一些应用场景\n![20171118194439](http://ovasdkxqr.bkt.clouddn.com/image/blog/20171118194439.png)\n\n## 集群角色分配原理\n![20171118201716](http://ovasdkxqr.bkt.clouddn.com/image/blog/20171118201716.png)\n\n## 集群机制\n半数机制：集群中半数以上机器存活，集群可用。  \nzookeeper适合装在奇数台机器上！！！\n## 安装\n### 上传文件\n```\nzookeeper-3.4.5.tar.gz\n```\n### 解压\n```\ntar -zxvf zookeeper-3.4.5.tar.gz\n```\n### 重命名\n```\nmv zookeeper-3.4.5 zookeeper（重命名文件夹zookeeper-3.4.5为zookeeper）\n```\n### 修改环境变量\n1.  su root (切换到root用户)\n2.  vi /etc/profile (修改文件)\n3.  添加内容：\n    ```\n    export ZOOKEEPER_HOME=/home/hadoop/zookeeper\n    export PATH=$PATH:$ZOOKEEPER_HOME/bin\n    ```\n4.  重新编译文件：\nsource /etc/profile\n5.  注意：3台zookeeper都需要修改\n6.  修改完成后切换回hadoop用户：\n    ```\n    su - hadoop\n    ```\n### 修改配置文件\n1. 用hadoop用户操作\n    ```\n    cd zookeeper/conf\n    cp zoo_sample.cfg zoo.cfg\n    ```\n2. vi zoo.cfg\n3. 添加内容：\n    ```\n    dataDir=/home/hadoop/zookeeper/data\n    dataLogDir=/home/hadoop/zookeeper/log\n    server.1=zk1:2888:3888 (主机名, 心跳端口、数据端口)\n    server.2=zk2:2888:3888\n    server.3=zk3:2888:3888\n    ```\n### 创建文件夹\n```\ncd /home/hadoop/zookeeper/\nmkdir -m 755 data\nmkdir -m 755 log  \n```\n### 在data文件夹下新建myid文件，myid的文件内容为：\ncd data\nvi myid\n添加内容：（数字递增）\n```\n1\n```\n上面的操作都是所有机器一起操作的，如果是单台操作需要把内容复制到其他的机器上\n#### 将集群下发到其他机器上\n```\nscp -r /home/hadoop/zookeeper hadoop@slave2:/home/hadoop/\nscp -r /home/hadoop/zookeeper hadoop@slave3:/home/hadoop/\n```\n#### 修改其他机器的配置文件\n```\n到slave2上：修改myid为：2\n到slave3上：修改myid为：3\n```\n### 启动每台机器\n```\n/root/zookeeper/bin/zkServer.sh start\n```\n### 查看集群状态\n- jps（查看进程）\n- zkServer.sh status（查看集群状态，主从信息）\n\n\n# 其他 \n## 一般集群公司内部使用的时候防火墙是关掉了，不会被外界访问\n```\nservice iptables stop\nchkconfig iptables off\n```\n\n## 遇到错误启动不了\n查看bin下的 zookeeper.out\n## 注意\nconf/zoo.cfg中节点ID必须与myid文件中的id相对应","source":"_posts/大数据/大数据03-02-zookeeper-简介.md","raw":"---\ntitle: 大数据03-02-zookeeper 简介\ncategories: 学习\ntags:\n  - 大数据\n  - zookeeper\ntoc: true\ndate: 2017-11-19 20:22:13\nscaffolds:\n---\n\n# 学软件，框架\n需要明白三点\n1. 应用场景：干什么的 在哪里用的\n2. 核心工作机制流程功能：组成，角色\n3. 怎么用\n4. 再深一层，原理细节：选择性的深入了解，重要框架\n<!--more-->\n\n# zookeeper\nzookeeper会用\n# 概念简介\n分布式**协调服务**，\n- zookeeper是为别的分布式程序服务的\n- Zookeeper**本身就是一个分布式程序**（只要有半数以上节点存活，zk就能正常服务）\n- Zookeeper所提供的服务涵盖：主从协调、服务器节点动态上下线、统一配置管理、分布式共享锁、统一名称服务……\n- 虽然说可以提供各种服务，但是zookeeper在底层其实只提供了两个功能：\n    - **管理(存储，读取)用户程序提交的数据；**\n    - **并为用户程序提供数据节点监听服务；**\n\n\n## zookeeper一些应用场景\n![20171118194439](http://ovasdkxqr.bkt.clouddn.com/image/blog/20171118194439.png)\n\n## 集群角色分配原理\n![20171118201716](http://ovasdkxqr.bkt.clouddn.com/image/blog/20171118201716.png)\n\n## 集群机制\n半数机制：集群中半数以上机器存活，集群可用。  \nzookeeper适合装在奇数台机器上！！！\n## 安装\n### 上传文件\n```\nzookeeper-3.4.5.tar.gz\n```\n### 解压\n```\ntar -zxvf zookeeper-3.4.5.tar.gz\n```\n### 重命名\n```\nmv zookeeper-3.4.5 zookeeper（重命名文件夹zookeeper-3.4.5为zookeeper）\n```\n### 修改环境变量\n1.  su root (切换到root用户)\n2.  vi /etc/profile (修改文件)\n3.  添加内容：\n    ```\n    export ZOOKEEPER_HOME=/home/hadoop/zookeeper\n    export PATH=$PATH:$ZOOKEEPER_HOME/bin\n    ```\n4.  重新编译文件：\nsource /etc/profile\n5.  注意：3台zookeeper都需要修改\n6.  修改完成后切换回hadoop用户：\n    ```\n    su - hadoop\n    ```\n### 修改配置文件\n1. 用hadoop用户操作\n    ```\n    cd zookeeper/conf\n    cp zoo_sample.cfg zoo.cfg\n    ```\n2. vi zoo.cfg\n3. 添加内容：\n    ```\n    dataDir=/home/hadoop/zookeeper/data\n    dataLogDir=/home/hadoop/zookeeper/log\n    server.1=zk1:2888:3888 (主机名, 心跳端口、数据端口)\n    server.2=zk2:2888:3888\n    server.3=zk3:2888:3888\n    ```\n### 创建文件夹\n```\ncd /home/hadoop/zookeeper/\nmkdir -m 755 data\nmkdir -m 755 log  \n```\n### 在data文件夹下新建myid文件，myid的文件内容为：\ncd data\nvi myid\n添加内容：（数字递增）\n```\n1\n```\n上面的操作都是所有机器一起操作的，如果是单台操作需要把内容复制到其他的机器上\n#### 将集群下发到其他机器上\n```\nscp -r /home/hadoop/zookeeper hadoop@slave2:/home/hadoop/\nscp -r /home/hadoop/zookeeper hadoop@slave3:/home/hadoop/\n```\n#### 修改其他机器的配置文件\n```\n到slave2上：修改myid为：2\n到slave3上：修改myid为：3\n```\n### 启动每台机器\n```\n/root/zookeeper/bin/zkServer.sh start\n```\n### 查看集群状态\n- jps（查看进程）\n- zkServer.sh status（查看集群状态，主从信息）\n\n\n# 其他 \n## 一般集群公司内部使用的时候防火墙是关掉了，不会被外界访问\n```\nservice iptables stop\nchkconfig iptables off\n```\n\n## 遇到错误启动不了\n查看bin下的 zookeeper.out\n## 注意\nconf/zoo.cfg中节点ID必须与myid文件中的id相对应","slug":"大数据/大数据03-02-zookeeper-简介","published":1,"updated":"2017-11-19T12:28:24.848Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjcsq4lfs000xx4vfhnwoguhd","content":"<h1 id=\"学软件，框架\"><a href=\"#学软件，框架\" class=\"headerlink\" title=\"学软件，框架\"></a>学软件，框架</h1><p>需要明白三点</p>\n<ol>\n<li>应用场景：干什么的 在哪里用的</li>\n<li>核心工作机制流程功能：组成，角色</li>\n<li>怎么用</li>\n<li>再深一层，原理细节：选择性的深入了解，重要框架<a id=\"more\"></a>\n</li>\n</ol>\n<h1 id=\"zookeeper\"><a href=\"#zookeeper\" class=\"headerlink\" title=\"zookeeper\"></a>zookeeper</h1><p>zookeeper会用</p>\n<h1 id=\"概念简介\"><a href=\"#概念简介\" class=\"headerlink\" title=\"概念简介\"></a>概念简介</h1><p>分布式<strong>协调服务</strong>，</p>\n<ul>\n<li>zookeeper是为别的分布式程序服务的</li>\n<li>Zookeeper<strong>本身就是一个分布式程序</strong>（只要有半数以上节点存活，zk就能正常服务）</li>\n<li>Zookeeper所提供的服务涵盖：主从协调、服务器节点动态上下线、统一配置管理、分布式共享锁、统一名称服务……</li>\n<li>虽然说可以提供各种服务，但是zookeeper在底层其实只提供了两个功能：<ul>\n<li><strong>管理(存储，读取)用户程序提交的数据；</strong></li>\n<li><strong>并为用户程序提供数据节点监听服务；</strong></li>\n</ul>\n</li>\n</ul>\n<h2 id=\"zookeeper一些应用场景\"><a href=\"#zookeeper一些应用场景\" class=\"headerlink\" title=\"zookeeper一些应用场景\"></a>zookeeper一些应用场景</h2><p><img src=\"http://ovasdkxqr.bkt.clouddn.com/image/blog/20171118194439.png\" alt=\"20171118194439\"></p>\n<h2 id=\"集群角色分配原理\"><a href=\"#集群角色分配原理\" class=\"headerlink\" title=\"集群角色分配原理\"></a>集群角色分配原理</h2><p><img src=\"http://ovasdkxqr.bkt.clouddn.com/image/blog/20171118201716.png\" alt=\"20171118201716\"></p>\n<h2 id=\"集群机制\"><a href=\"#集群机制\" class=\"headerlink\" title=\"集群机制\"></a>集群机制</h2><p>半数机制：集群中半数以上机器存活，集群可用。<br>zookeeper适合装在奇数台机器上！！！</p>\n<h2 id=\"安装\"><a href=\"#安装\" class=\"headerlink\" title=\"安装\"></a>安装</h2><h3 id=\"上传文件\"><a href=\"#上传文件\" class=\"headerlink\" title=\"上传文件\"></a>上传文件</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">zookeeper-3.4.5.tar.gz</div></pre></td></tr></table></figure>\n<h3 id=\"解压\"><a href=\"#解压\" class=\"headerlink\" title=\"解压\"></a>解压</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">tar -zxvf zookeeper-3.4.5.tar.gz</div></pre></td></tr></table></figure>\n<h3 id=\"重命名\"><a href=\"#重命名\" class=\"headerlink\" title=\"重命名\"></a>重命名</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">mv zookeeper-3.4.5 zookeeper（重命名文件夹zookeeper-3.4.5为zookeeper）</div></pre></td></tr></table></figure>\n<h3 id=\"修改环境变量\"><a href=\"#修改环境变量\" class=\"headerlink\" title=\"修改环境变量\"></a>修改环境变量</h3><ol>\n<li>su root (切换到root用户)</li>\n<li>vi /etc/profile (修改文件)</li>\n<li><p>添加内容：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\">export ZOOKEEPER_HOME=/home/hadoop/zookeeper</div><div class=\"line\">export PATH=$PATH:$ZOOKEEPER_HOME/bin</div></pre></td></tr></table></figure>\n</li>\n<li><p>重新编译文件：<br>source /etc/profile</p>\n</li>\n<li>注意：3台zookeeper都需要修改</li>\n<li>修改完成后切换回hadoop用户：<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">su - hadoop</div></pre></td></tr></table></figure>\n</li>\n</ol>\n<h3 id=\"修改配置文件\"><a href=\"#修改配置文件\" class=\"headerlink\" title=\"修改配置文件\"></a>修改配置文件</h3><ol>\n<li><p>用hadoop用户操作</p>\n <figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\">cd zookeeper/conf</div><div class=\"line\">cp zoo_sample.cfg zoo.cfg</div></pre></td></tr></table></figure>\n</li>\n<li><p>vi zoo.cfg</p>\n</li>\n<li>添加内容： <figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\">dataDir=/home/hadoop/zookeeper/data</div><div class=\"line\">dataLogDir=/home/hadoop/zookeeper/log</div><div class=\"line\">server.1=zk1:2888:3888 (主机名, 心跳端口、数据端口)</div><div class=\"line\">server.2=zk2:2888:3888</div><div class=\"line\">server.3=zk3:2888:3888</div></pre></td></tr></table></figure>\n</li>\n</ol>\n<h3 id=\"创建文件夹\"><a href=\"#创建文件夹\" class=\"headerlink\" title=\"创建文件夹\"></a>创建文件夹</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\">cd /home/hadoop/zookeeper/</div><div class=\"line\">mkdir -m 755 data</div><div class=\"line\">mkdir -m 755 log</div></pre></td></tr></table></figure>\n<h3 id=\"在data文件夹下新建myid文件，myid的文件内容为：\"><a href=\"#在data文件夹下新建myid文件，myid的文件内容为：\" class=\"headerlink\" title=\"在data文件夹下新建myid文件，myid的文件内容为：\"></a>在data文件夹下新建myid文件，myid的文件内容为：</h3><p>cd data<br>vi myid<br>添加内容：（数字递增）<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">1</div></pre></td></tr></table></figure></p>\n<p>上面的操作都是所有机器一起操作的，如果是单台操作需要把内容复制到其他的机器上</p>\n<h4 id=\"将集群下发到其他机器上\"><a href=\"#将集群下发到其他机器上\" class=\"headerlink\" title=\"将集群下发到其他机器上\"></a>将集群下发到其他机器上</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\">scp -r /home/hadoop/zookeeper hadoop@slave2:/home/hadoop/</div><div class=\"line\">scp -r /home/hadoop/zookeeper hadoop@slave3:/home/hadoop/</div></pre></td></tr></table></figure>\n<h4 id=\"修改其他机器的配置文件\"><a href=\"#修改其他机器的配置文件\" class=\"headerlink\" title=\"修改其他机器的配置文件\"></a>修改其他机器的配置文件</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\">到slave2上：修改myid为：2</div><div class=\"line\">到slave3上：修改myid为：3</div></pre></td></tr></table></figure>\n<h3 id=\"启动每台机器\"><a href=\"#启动每台机器\" class=\"headerlink\" title=\"启动每台机器\"></a>启动每台机器</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">/root/zookeeper/bin/zkServer.sh start</div></pre></td></tr></table></figure>\n<h3 id=\"查看集群状态\"><a href=\"#查看集群状态\" class=\"headerlink\" title=\"查看集群状态\"></a>查看集群状态</h3><ul>\n<li>jps（查看进程）</li>\n<li>zkServer.sh status（查看集群状态，主从信息）</li>\n</ul>\n<h1 id=\"其他\"><a href=\"#其他\" class=\"headerlink\" title=\"其他\"></a>其他</h1><h2 id=\"一般集群公司内部使用的时候防火墙是关掉了，不会被外界访问\"><a href=\"#一般集群公司内部使用的时候防火墙是关掉了，不会被外界访问\" class=\"headerlink\" title=\"一般集群公司内部使用的时候防火墙是关掉了，不会被外界访问\"></a>一般集群公司内部使用的时候防火墙是关掉了，不会被外界访问</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\">service iptables stop</div><div class=\"line\">chkconfig iptables off</div></pre></td></tr></table></figure>\n<h2 id=\"遇到错误启动不了\"><a href=\"#遇到错误启动不了\" class=\"headerlink\" title=\"遇到错误启动不了\"></a>遇到错误启动不了</h2><p>查看bin下的 zookeeper.out</p>\n<h2 id=\"注意\"><a href=\"#注意\" class=\"headerlink\" title=\"注意\"></a>注意</h2><p>conf/zoo.cfg中节点ID必须与myid文件中的id相对应</p>\n","site":{"data":{}},"excerpt":"<h1 id=\"学软件，框架\"><a href=\"#学软件，框架\" class=\"headerlink\" title=\"学软件，框架\"></a>学软件，框架</h1><p>需要明白三点</p>\n<ol>\n<li>应用场景：干什么的 在哪里用的</li>\n<li>核心工作机制流程功能：组成，角色</li>\n<li>怎么用</li>\n<li>再深一层，原理细节：选择性的深入了解，重要框架","more":"</li>\n</ol>\n<h1 id=\"zookeeper\"><a href=\"#zookeeper\" class=\"headerlink\" title=\"zookeeper\"></a>zookeeper</h1><p>zookeeper会用</p>\n<h1 id=\"概念简介\"><a href=\"#概念简介\" class=\"headerlink\" title=\"概念简介\"></a>概念简介</h1><p>分布式<strong>协调服务</strong>，</p>\n<ul>\n<li>zookeeper是为别的分布式程序服务的</li>\n<li>Zookeeper<strong>本身就是一个分布式程序</strong>（只要有半数以上节点存活，zk就能正常服务）</li>\n<li>Zookeeper所提供的服务涵盖：主从协调、服务器节点动态上下线、统一配置管理、分布式共享锁、统一名称服务……</li>\n<li>虽然说可以提供各种服务，但是zookeeper在底层其实只提供了两个功能：<ul>\n<li><strong>管理(存储，读取)用户程序提交的数据；</strong></li>\n<li><strong>并为用户程序提供数据节点监听服务；</strong></li>\n</ul>\n</li>\n</ul>\n<h2 id=\"zookeeper一些应用场景\"><a href=\"#zookeeper一些应用场景\" class=\"headerlink\" title=\"zookeeper一些应用场景\"></a>zookeeper一些应用场景</h2><p><img src=\"http://ovasdkxqr.bkt.clouddn.com/image/blog/20171118194439.png\" alt=\"20171118194439\"></p>\n<h2 id=\"集群角色分配原理\"><a href=\"#集群角色分配原理\" class=\"headerlink\" title=\"集群角色分配原理\"></a>集群角色分配原理</h2><p><img src=\"http://ovasdkxqr.bkt.clouddn.com/image/blog/20171118201716.png\" alt=\"20171118201716\"></p>\n<h2 id=\"集群机制\"><a href=\"#集群机制\" class=\"headerlink\" title=\"集群机制\"></a>集群机制</h2><p>半数机制：集群中半数以上机器存活，集群可用。<br>zookeeper适合装在奇数台机器上！！！</p>\n<h2 id=\"安装\"><a href=\"#安装\" class=\"headerlink\" title=\"安装\"></a>安装</h2><h3 id=\"上传文件\"><a href=\"#上传文件\" class=\"headerlink\" title=\"上传文件\"></a>上传文件</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">zookeeper-3.4.5.tar.gz</div></pre></td></tr></table></figure>\n<h3 id=\"解压\"><a href=\"#解压\" class=\"headerlink\" title=\"解压\"></a>解压</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">tar -zxvf zookeeper-3.4.5.tar.gz</div></pre></td></tr></table></figure>\n<h3 id=\"重命名\"><a href=\"#重命名\" class=\"headerlink\" title=\"重命名\"></a>重命名</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">mv zookeeper-3.4.5 zookeeper（重命名文件夹zookeeper-3.4.5为zookeeper）</div></pre></td></tr></table></figure>\n<h3 id=\"修改环境变量\"><a href=\"#修改环境变量\" class=\"headerlink\" title=\"修改环境变量\"></a>修改环境变量</h3><ol>\n<li>su root (切换到root用户)</li>\n<li>vi /etc/profile (修改文件)</li>\n<li><p>添加内容：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\">export ZOOKEEPER_HOME=/home/hadoop/zookeeper</div><div class=\"line\">export PATH=$PATH:$ZOOKEEPER_HOME/bin</div></pre></td></tr></table></figure>\n</li>\n<li><p>重新编译文件：<br>source /etc/profile</p>\n</li>\n<li>注意：3台zookeeper都需要修改</li>\n<li>修改完成后切换回hadoop用户：<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">su - hadoop</div></pre></td></tr></table></figure>\n</li>\n</ol>\n<h3 id=\"修改配置文件\"><a href=\"#修改配置文件\" class=\"headerlink\" title=\"修改配置文件\"></a>修改配置文件</h3><ol>\n<li><p>用hadoop用户操作</p>\n <figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\">cd zookeeper/conf</div><div class=\"line\">cp zoo_sample.cfg zoo.cfg</div></pre></td></tr></table></figure>\n</li>\n<li><p>vi zoo.cfg</p>\n</li>\n<li>添加内容： <figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\">dataDir=/home/hadoop/zookeeper/data</div><div class=\"line\">dataLogDir=/home/hadoop/zookeeper/log</div><div class=\"line\">server.1=zk1:2888:3888 (主机名, 心跳端口、数据端口)</div><div class=\"line\">server.2=zk2:2888:3888</div><div class=\"line\">server.3=zk3:2888:3888</div></pre></td></tr></table></figure>\n</li>\n</ol>\n<h3 id=\"创建文件夹\"><a href=\"#创建文件夹\" class=\"headerlink\" title=\"创建文件夹\"></a>创建文件夹</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\">cd /home/hadoop/zookeeper/</div><div class=\"line\">mkdir -m 755 data</div><div class=\"line\">mkdir -m 755 log</div></pre></td></tr></table></figure>\n<h3 id=\"在data文件夹下新建myid文件，myid的文件内容为：\"><a href=\"#在data文件夹下新建myid文件，myid的文件内容为：\" class=\"headerlink\" title=\"在data文件夹下新建myid文件，myid的文件内容为：\"></a>在data文件夹下新建myid文件，myid的文件内容为：</h3><p>cd data<br>vi myid<br>添加内容：（数字递增）<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">1</div></pre></td></tr></table></figure></p>\n<p>上面的操作都是所有机器一起操作的，如果是单台操作需要把内容复制到其他的机器上</p>\n<h4 id=\"将集群下发到其他机器上\"><a href=\"#将集群下发到其他机器上\" class=\"headerlink\" title=\"将集群下发到其他机器上\"></a>将集群下发到其他机器上</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\">scp -r /home/hadoop/zookeeper hadoop@slave2:/home/hadoop/</div><div class=\"line\">scp -r /home/hadoop/zookeeper hadoop@slave3:/home/hadoop/</div></pre></td></tr></table></figure>\n<h4 id=\"修改其他机器的配置文件\"><a href=\"#修改其他机器的配置文件\" class=\"headerlink\" title=\"修改其他机器的配置文件\"></a>修改其他机器的配置文件</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\">到slave2上：修改myid为：2</div><div class=\"line\">到slave3上：修改myid为：3</div></pre></td></tr></table></figure>\n<h3 id=\"启动每台机器\"><a href=\"#启动每台机器\" class=\"headerlink\" title=\"启动每台机器\"></a>启动每台机器</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">/root/zookeeper/bin/zkServer.sh start</div></pre></td></tr></table></figure>\n<h3 id=\"查看集群状态\"><a href=\"#查看集群状态\" class=\"headerlink\" title=\"查看集群状态\"></a>查看集群状态</h3><ul>\n<li>jps（查看进程）</li>\n<li>zkServer.sh status（查看集群状态，主从信息）</li>\n</ul>\n<h1 id=\"其他\"><a href=\"#其他\" class=\"headerlink\" title=\"其他\"></a>其他</h1><h2 id=\"一般集群公司内部使用的时候防火墙是关掉了，不会被外界访问\"><a href=\"#一般集群公司内部使用的时候防火墙是关掉了，不会被外界访问\" class=\"headerlink\" title=\"一般集群公司内部使用的时候防火墙是关掉了，不会被外界访问\"></a>一般集群公司内部使用的时候防火墙是关掉了，不会被外界访问</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\">service iptables stop</div><div class=\"line\">chkconfig iptables off</div></pre></td></tr></table></figure>\n<h2 id=\"遇到错误启动不了\"><a href=\"#遇到错误启动不了\" class=\"headerlink\" title=\"遇到错误启动不了\"></a>遇到错误启动不了</h2><p>查看bin下的 zookeeper.out</p>\n<h2 id=\"注意\"><a href=\"#注意\" class=\"headerlink\" title=\"注意\"></a>注意</h2><p>conf/zoo.cfg中节点ID必须与myid文件中的id相对应</p>"},{"title":"大数据03-05-java api","toc":true,"date":"2017-11-25T17:10:40.000Z","scaffolds":null,"_content":"\njava api\n\n<!-- more -->\n```java\npackage cn.itcast.bigdata.zk;\n\nimport java.io.IOException;\nimport java.util.List;\n\nimport org.apache.zookeeper.CreateMode;\nimport org.apache.zookeeper.KeeperException;\nimport org.apache.zookeeper.WatchedEvent;\nimport org.apache.zookeeper.Watcher;\nimport org.apache.zookeeper.ZooDefs.Ids;\nimport org.apache.zookeeper.ZooKeeper;\nimport org.apache.zookeeper.data.Stat;\nimport org.junit.Before;\nimport org.junit.Test;\n\npublic class SimpleZkClient {\n\n\tprivate static final String connectString = \"mini1:2181,mini2:2181,mini3:2181\";\n\tprivate static final int sessionTimeout = 2000;\n\n\tZooKeeper zkClient = null;\n\n\t@Before\n\tpublic void init() throws Exception {\n\t\tzkClient = new ZooKeeper(connectString, sessionTimeout, new Watcher() {\n\t\t\t@Override\n\t\t\tpublic void process(WatchedEvent event) {\n\t\t\t\t// 收到事件通知后的回调函数（应该是我们自己的事件处理逻辑）\n\t\t\t\tSystem.out.println(event.getType() + \"---\" + event.getPath());\n\t\t\t\ttry {\n\t\t\t\t\tzkClient.getChildren(\"/\", true);\n\t\t\t\t} catch (Exception e) {\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t}\n\n\t/**\n\t * 数据的增删改查\n\t * \n\t * @throws InterruptedException\n\t * @throws KeeperException\n\t */\n\n\t// 创建数据节点到zk中\n\tpublic void testCreate() throws KeeperException, InterruptedException {\n\t\t// 参数1：要创建的节点的路径 参数2：节点大数据 参数3：节点的权限 参数4：节点的类型\n\t\tString nodeCreated = zkClient.create(\"/eclipse\", \"hellozk\".getBytes(), Ids.OPEN_ACL_UNSAFE, CreateMode.PERSISTENT);\n\t\t//上传的数据可以是任何类型，但都要转成byte[]\n\t}\n\n\t//判断znode是否存在\n\t@Test\t\n\tpublic void testExist() throws Exception{\n\t\tStat stat = zkClient.exists(\"/eclipse\", false);\n\t\tSystem.out.println(stat==null?\"not exist\":\"exist\");\n\t\t\n\t\t\n\t}\n\t\n\t// 获取子节点\n\t@Test\n\tpublic void getChildren() throws Exception {\n\t\tList<String> children = zkClient.getChildren(\"/\", true);\n\t\tfor (String child : children) {\n\t\t\tSystem.out.println(child);\n\t\t}\n\t\tThread.sleep(Long.MAX_VALUE);\n\t}\n\n\t//获取znode的数据\n\t@Test\n\tpublic void getData() throws Exception {\n\t\t\n\t\tbyte[] data = zkClient.getData(\"/eclipse\", false, null);\n\t\tSystem.out.println(new String(data));\n\t\t\n\t}\n\t\n\t//删除znode\n\t@Test\n\tpublic void deleteZnode() throws Exception {\n\t\t\n\t\t//参数2：指定要删除的版本，-1表示删除所有版本\n\t\tzkClient.delete(\"/eclipse\", -1);\n\t\t\n\t\t\n\t}\n\t//删除znode\n\t@Test\n\tpublic void setData() throws Exception {\n\t\t\n\t\tzkClient.setData(\"/app1\", \"imissyou angelababy\".getBytes(), -1);\n\t\t\n\t\tbyte[] data = zkClient.getData(\"/app1\", false, null);\n\t\tSystem.out.println(new String(data));\n\t\t\n\t}\n}\n```","source":"_posts/大数据/大数据03-05-java-api.md","raw":"---\ntitle: 大数据03-05-java api\ncategories: 学习\ntags:\n  - 大数据\n  - zookeeper\ntoc: true\ndate: 2017-11-26 01:10:40\nscaffolds:\n---\n\njava api\n\n<!-- more -->\n```java\npackage cn.itcast.bigdata.zk;\n\nimport java.io.IOException;\nimport java.util.List;\n\nimport org.apache.zookeeper.CreateMode;\nimport org.apache.zookeeper.KeeperException;\nimport org.apache.zookeeper.WatchedEvent;\nimport org.apache.zookeeper.Watcher;\nimport org.apache.zookeeper.ZooDefs.Ids;\nimport org.apache.zookeeper.ZooKeeper;\nimport org.apache.zookeeper.data.Stat;\nimport org.junit.Before;\nimport org.junit.Test;\n\npublic class SimpleZkClient {\n\n\tprivate static final String connectString = \"mini1:2181,mini2:2181,mini3:2181\";\n\tprivate static final int sessionTimeout = 2000;\n\n\tZooKeeper zkClient = null;\n\n\t@Before\n\tpublic void init() throws Exception {\n\t\tzkClient = new ZooKeeper(connectString, sessionTimeout, new Watcher() {\n\t\t\t@Override\n\t\t\tpublic void process(WatchedEvent event) {\n\t\t\t\t// 收到事件通知后的回调函数（应该是我们自己的事件处理逻辑）\n\t\t\t\tSystem.out.println(event.getType() + \"---\" + event.getPath());\n\t\t\t\ttry {\n\t\t\t\t\tzkClient.getChildren(\"/\", true);\n\t\t\t\t} catch (Exception e) {\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t}\n\n\t/**\n\t * 数据的增删改查\n\t * \n\t * @throws InterruptedException\n\t * @throws KeeperException\n\t */\n\n\t// 创建数据节点到zk中\n\tpublic void testCreate() throws KeeperException, InterruptedException {\n\t\t// 参数1：要创建的节点的路径 参数2：节点大数据 参数3：节点的权限 参数4：节点的类型\n\t\tString nodeCreated = zkClient.create(\"/eclipse\", \"hellozk\".getBytes(), Ids.OPEN_ACL_UNSAFE, CreateMode.PERSISTENT);\n\t\t//上传的数据可以是任何类型，但都要转成byte[]\n\t}\n\n\t//判断znode是否存在\n\t@Test\t\n\tpublic void testExist() throws Exception{\n\t\tStat stat = zkClient.exists(\"/eclipse\", false);\n\t\tSystem.out.println(stat==null?\"not exist\":\"exist\");\n\t\t\n\t\t\n\t}\n\t\n\t// 获取子节点\n\t@Test\n\tpublic void getChildren() throws Exception {\n\t\tList<String> children = zkClient.getChildren(\"/\", true);\n\t\tfor (String child : children) {\n\t\t\tSystem.out.println(child);\n\t\t}\n\t\tThread.sleep(Long.MAX_VALUE);\n\t}\n\n\t//获取znode的数据\n\t@Test\n\tpublic void getData() throws Exception {\n\t\t\n\t\tbyte[] data = zkClient.getData(\"/eclipse\", false, null);\n\t\tSystem.out.println(new String(data));\n\t\t\n\t}\n\t\n\t//删除znode\n\t@Test\n\tpublic void deleteZnode() throws Exception {\n\t\t\n\t\t//参数2：指定要删除的版本，-1表示删除所有版本\n\t\tzkClient.delete(\"/eclipse\", -1);\n\t\t\n\t\t\n\t}\n\t//删除znode\n\t@Test\n\tpublic void setData() throws Exception {\n\t\t\n\t\tzkClient.setData(\"/app1\", \"imissyou angelababy\".getBytes(), -1);\n\t\t\n\t\tbyte[] data = zkClient.getData(\"/app1\", false, null);\n\t\tSystem.out.println(new String(data));\n\t\t\n\t}\n}\n```","slug":"大数据/大数据03-05-java-api","published":1,"updated":"2017-11-26T10:37:50.160Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjcsq4lfx0012x4vfzhrnaylm","content":"<p>java api</p>\n<a id=\"more\"></a>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div><div class=\"line\">87</div><div class=\"line\">88</div><div class=\"line\">89</div><div class=\"line\">90</div><div class=\"line\">91</div><div class=\"line\">92</div><div class=\"line\">93</div><div class=\"line\">94</div><div class=\"line\">95</div><div class=\"line\">96</div><div class=\"line\">97</div><div class=\"line\">98</div><div class=\"line\">99</div><div class=\"line\">100</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">package</span> cn.itcast.bigdata.zk;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">import</span> java.io.IOException;</div><div class=\"line\"><span class=\"keyword\">import</span> java.util.List;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">import</span> org.apache.zookeeper.CreateMode;</div><div class=\"line\"><span class=\"keyword\">import</span> org.apache.zookeeper.KeeperException;</div><div class=\"line\"><span class=\"keyword\">import</span> org.apache.zookeeper.WatchedEvent;</div><div class=\"line\"><span class=\"keyword\">import</span> org.apache.zookeeper.Watcher;</div><div class=\"line\"><span class=\"keyword\">import</span> org.apache.zookeeper.ZooDefs.Ids;</div><div class=\"line\"><span class=\"keyword\">import</span> org.apache.zookeeper.ZooKeeper;</div><div class=\"line\"><span class=\"keyword\">import</span> org.apache.zookeeper.data.Stat;</div><div class=\"line\"><span class=\"keyword\">import</span> org.junit.Before;</div><div class=\"line\"><span class=\"keyword\">import</span> org.junit.Test;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">SimpleZkClient</span> </span>&#123;</div><div class=\"line\"></div><div class=\"line\">\t<span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> String connectString = <span class=\"string\">\"mini1:2181,mini2:2181,mini3:2181\"</span>;</div><div class=\"line\">\t<span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> sessionTimeout = <span class=\"number\">2000</span>;</div><div class=\"line\"></div><div class=\"line\">\tZooKeeper zkClient = <span class=\"keyword\">null</span>;</div><div class=\"line\"></div><div class=\"line\">\t<span class=\"meta\">@Before</span></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">init</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</div><div class=\"line\">\t\tzkClient = <span class=\"keyword\">new</span> ZooKeeper(connectString, sessionTimeout, <span class=\"keyword\">new</span> Watcher() &#123;</div><div class=\"line\">\t\t\t<span class=\"meta\">@Override</span></div><div class=\"line\">\t\t\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">process</span><span class=\"params\">(WatchedEvent event)</span> </span>&#123;</div><div class=\"line\">\t\t\t\t<span class=\"comment\">// 收到事件通知后的回调函数（应该是我们自己的事件处理逻辑）</span></div><div class=\"line\">\t\t\t\tSystem.out.println(event.getType() + <span class=\"string\">\"---\"</span> + event.getPath());</div><div class=\"line\">\t\t\t\t<span class=\"keyword\">try</span> &#123;</div><div class=\"line\">\t\t\t\t\tzkClient.getChildren(<span class=\"string\">\"/\"</span>, <span class=\"keyword\">true</span>);</div><div class=\"line\">\t\t\t\t&#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</div><div class=\"line\">\t\t\t\t&#125;</div><div class=\"line\">\t\t\t&#125;</div><div class=\"line\">\t\t&#125;);</div><div class=\"line\"></div><div class=\"line\">\t&#125;</div><div class=\"line\"></div><div class=\"line\">\t<span class=\"comment\">/**</span></div><div class=\"line\"><span class=\"comment\">\t * 数据的增删改查</span></div><div class=\"line\"><span class=\"comment\">\t * </span></div><div class=\"line\"><span class=\"comment\">\t * <span class=\"doctag\">@throws</span> InterruptedException</span></div><div class=\"line\"><span class=\"comment\">\t * <span class=\"doctag\">@throws</span> KeeperException</span></div><div class=\"line\"><span class=\"comment\">\t */</span></div><div class=\"line\"></div><div class=\"line\">\t<span class=\"comment\">// 创建数据节点到zk中</span></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">testCreate</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> KeeperException, InterruptedException </span>&#123;</div><div class=\"line\">\t\t<span class=\"comment\">// 参数1：要创建的节点的路径 参数2：节点大数据 参数3：节点的权限 参数4：节点的类型</span></div><div class=\"line\">\t\tString nodeCreated = zkClient.create(<span class=\"string\">\"/eclipse\"</span>, <span class=\"string\">\"hellozk\"</span>.getBytes(), Ids.OPEN_ACL_UNSAFE, CreateMode.PERSISTENT);</div><div class=\"line\">\t\t<span class=\"comment\">//上传的数据可以是任何类型，但都要转成byte[]</span></div><div class=\"line\">\t&#125;</div><div class=\"line\"></div><div class=\"line\">\t<span class=\"comment\">//判断znode是否存在</span></div><div class=\"line\">\t<span class=\"meta\">@Test</span>\t</div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">testExist</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> Exception</span>&#123;</div><div class=\"line\">\t\tStat stat = zkClient.exists(<span class=\"string\">\"/eclipse\"</span>, <span class=\"keyword\">false</span>);</div><div class=\"line\">\t\tSystem.out.println(stat==<span class=\"keyword\">null</span>?<span class=\"string\">\"not exist\"</span>:<span class=\"string\">\"exist\"</span>);</div><div class=\"line\">\t\t</div><div class=\"line\">\t\t</div><div class=\"line\">\t&#125;</div><div class=\"line\">\t</div><div class=\"line\">\t<span class=\"comment\">// 获取子节点</span></div><div class=\"line\">\t<span class=\"meta\">@Test</span></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">getChildren</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</div><div class=\"line\">\t\tList&lt;String&gt; children = zkClient.getChildren(<span class=\"string\">\"/\"</span>, <span class=\"keyword\">true</span>);</div><div class=\"line\">\t\t<span class=\"keyword\">for</span> (String child : children) &#123;</div><div class=\"line\">\t\t\tSystem.out.println(child);</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t\tThread.sleep(Long.MAX_VALUE);</div><div class=\"line\">\t&#125;</div><div class=\"line\"></div><div class=\"line\">\t<span class=\"comment\">//获取znode的数据</span></div><div class=\"line\">\t<span class=\"meta\">@Test</span></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">getData</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</div><div class=\"line\">\t\t</div><div class=\"line\">\t\t<span class=\"keyword\">byte</span>[] data = zkClient.getData(<span class=\"string\">\"/eclipse\"</span>, <span class=\"keyword\">false</span>, <span class=\"keyword\">null</span>);</div><div class=\"line\">\t\tSystem.out.println(<span class=\"keyword\">new</span> String(data));</div><div class=\"line\">\t\t</div><div class=\"line\">\t&#125;</div><div class=\"line\">\t</div><div class=\"line\">\t<span class=\"comment\">//删除znode</span></div><div class=\"line\">\t<span class=\"meta\">@Test</span></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">deleteZnode</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</div><div class=\"line\">\t\t</div><div class=\"line\">\t\t<span class=\"comment\">//参数2：指定要删除的版本，-1表示删除所有版本</span></div><div class=\"line\">\t\tzkClient.delete(<span class=\"string\">\"/eclipse\"</span>, -<span class=\"number\">1</span>);</div><div class=\"line\">\t\t</div><div class=\"line\">\t\t</div><div class=\"line\">\t&#125;</div><div class=\"line\">\t<span class=\"comment\">//删除znode</span></div><div class=\"line\">\t<span class=\"meta\">@Test</span></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setData</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</div><div class=\"line\">\t\t</div><div class=\"line\">\t\tzkClient.setData(<span class=\"string\">\"/app1\"</span>, <span class=\"string\">\"imissyou angelababy\"</span>.getBytes(), -<span class=\"number\">1</span>);</div><div class=\"line\">\t\t</div><div class=\"line\">\t\t<span class=\"keyword\">byte</span>[] data = zkClient.getData(<span class=\"string\">\"/app1\"</span>, <span class=\"keyword\">false</span>, <span class=\"keyword\">null</span>);</div><div class=\"line\">\t\tSystem.out.println(<span class=\"keyword\">new</span> String(data));</div><div class=\"line\">\t\t</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>","site":{"data":{}},"excerpt":"<p>java api</p>","more":"<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div><div class=\"line\">87</div><div class=\"line\">88</div><div class=\"line\">89</div><div class=\"line\">90</div><div class=\"line\">91</div><div class=\"line\">92</div><div class=\"line\">93</div><div class=\"line\">94</div><div class=\"line\">95</div><div class=\"line\">96</div><div class=\"line\">97</div><div class=\"line\">98</div><div class=\"line\">99</div><div class=\"line\">100</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">package</span> cn.itcast.bigdata.zk;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">import</span> java.io.IOException;</div><div class=\"line\"><span class=\"keyword\">import</span> java.util.List;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">import</span> org.apache.zookeeper.CreateMode;</div><div class=\"line\"><span class=\"keyword\">import</span> org.apache.zookeeper.KeeperException;</div><div class=\"line\"><span class=\"keyword\">import</span> org.apache.zookeeper.WatchedEvent;</div><div class=\"line\"><span class=\"keyword\">import</span> org.apache.zookeeper.Watcher;</div><div class=\"line\"><span class=\"keyword\">import</span> org.apache.zookeeper.ZooDefs.Ids;</div><div class=\"line\"><span class=\"keyword\">import</span> org.apache.zookeeper.ZooKeeper;</div><div class=\"line\"><span class=\"keyword\">import</span> org.apache.zookeeper.data.Stat;</div><div class=\"line\"><span class=\"keyword\">import</span> org.junit.Before;</div><div class=\"line\"><span class=\"keyword\">import</span> org.junit.Test;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">SimpleZkClient</span> </span>&#123;</div><div class=\"line\"></div><div class=\"line\">\t<span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> String connectString = <span class=\"string\">\"mini1:2181,mini2:2181,mini3:2181\"</span>;</div><div class=\"line\">\t<span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> sessionTimeout = <span class=\"number\">2000</span>;</div><div class=\"line\"></div><div class=\"line\">\tZooKeeper zkClient = <span class=\"keyword\">null</span>;</div><div class=\"line\"></div><div class=\"line\">\t<span class=\"meta\">@Before</span></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">init</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</div><div class=\"line\">\t\tzkClient = <span class=\"keyword\">new</span> ZooKeeper(connectString, sessionTimeout, <span class=\"keyword\">new</span> Watcher() &#123;</div><div class=\"line\">\t\t\t<span class=\"meta\">@Override</span></div><div class=\"line\">\t\t\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">process</span><span class=\"params\">(WatchedEvent event)</span> </span>&#123;</div><div class=\"line\">\t\t\t\t<span class=\"comment\">// 收到事件通知后的回调函数（应该是我们自己的事件处理逻辑）</span></div><div class=\"line\">\t\t\t\tSystem.out.println(event.getType() + <span class=\"string\">\"---\"</span> + event.getPath());</div><div class=\"line\">\t\t\t\t<span class=\"keyword\">try</span> &#123;</div><div class=\"line\">\t\t\t\t\tzkClient.getChildren(<span class=\"string\">\"/\"</span>, <span class=\"keyword\">true</span>);</div><div class=\"line\">\t\t\t\t&#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</div><div class=\"line\">\t\t\t\t&#125;</div><div class=\"line\">\t\t\t&#125;</div><div class=\"line\">\t\t&#125;);</div><div class=\"line\"></div><div class=\"line\">\t&#125;</div><div class=\"line\"></div><div class=\"line\">\t<span class=\"comment\">/**</span></div><div class=\"line\"><span class=\"comment\">\t * 数据的增删改查</span></div><div class=\"line\"><span class=\"comment\">\t * </span></div><div class=\"line\"><span class=\"comment\">\t * <span class=\"doctag\">@throws</span> InterruptedException</span></div><div class=\"line\"><span class=\"comment\">\t * <span class=\"doctag\">@throws</span> KeeperException</span></div><div class=\"line\"><span class=\"comment\">\t */</span></div><div class=\"line\"></div><div class=\"line\">\t<span class=\"comment\">// 创建数据节点到zk中</span></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">testCreate</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> KeeperException, InterruptedException </span>&#123;</div><div class=\"line\">\t\t<span class=\"comment\">// 参数1：要创建的节点的路径 参数2：节点大数据 参数3：节点的权限 参数4：节点的类型</span></div><div class=\"line\">\t\tString nodeCreated = zkClient.create(<span class=\"string\">\"/eclipse\"</span>, <span class=\"string\">\"hellozk\"</span>.getBytes(), Ids.OPEN_ACL_UNSAFE, CreateMode.PERSISTENT);</div><div class=\"line\">\t\t<span class=\"comment\">//上传的数据可以是任何类型，但都要转成byte[]</span></div><div class=\"line\">\t&#125;</div><div class=\"line\"></div><div class=\"line\">\t<span class=\"comment\">//判断znode是否存在</span></div><div class=\"line\">\t<span class=\"meta\">@Test</span>\t</div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">testExist</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> Exception</span>&#123;</div><div class=\"line\">\t\tStat stat = zkClient.exists(<span class=\"string\">\"/eclipse\"</span>, <span class=\"keyword\">false</span>);</div><div class=\"line\">\t\tSystem.out.println(stat==<span class=\"keyword\">null</span>?<span class=\"string\">\"not exist\"</span>:<span class=\"string\">\"exist\"</span>);</div><div class=\"line\">\t\t</div><div class=\"line\">\t\t</div><div class=\"line\">\t&#125;</div><div class=\"line\">\t</div><div class=\"line\">\t<span class=\"comment\">// 获取子节点</span></div><div class=\"line\">\t<span class=\"meta\">@Test</span></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">getChildren</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</div><div class=\"line\">\t\tList&lt;String&gt; children = zkClient.getChildren(<span class=\"string\">\"/\"</span>, <span class=\"keyword\">true</span>);</div><div class=\"line\">\t\t<span class=\"keyword\">for</span> (String child : children) &#123;</div><div class=\"line\">\t\t\tSystem.out.println(child);</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t\tThread.sleep(Long.MAX_VALUE);</div><div class=\"line\">\t&#125;</div><div class=\"line\"></div><div class=\"line\">\t<span class=\"comment\">//获取znode的数据</span></div><div class=\"line\">\t<span class=\"meta\">@Test</span></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">getData</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</div><div class=\"line\">\t\t</div><div class=\"line\">\t\t<span class=\"keyword\">byte</span>[] data = zkClient.getData(<span class=\"string\">\"/eclipse\"</span>, <span class=\"keyword\">false</span>, <span class=\"keyword\">null</span>);</div><div class=\"line\">\t\tSystem.out.println(<span class=\"keyword\">new</span> String(data));</div><div class=\"line\">\t\t</div><div class=\"line\">\t&#125;</div><div class=\"line\">\t</div><div class=\"line\">\t<span class=\"comment\">//删除znode</span></div><div class=\"line\">\t<span class=\"meta\">@Test</span></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">deleteZnode</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</div><div class=\"line\">\t\t</div><div class=\"line\">\t\t<span class=\"comment\">//参数2：指定要删除的版本，-1表示删除所有版本</span></div><div class=\"line\">\t\tzkClient.delete(<span class=\"string\">\"/eclipse\"</span>, -<span class=\"number\">1</span>);</div><div class=\"line\">\t\t</div><div class=\"line\">\t\t</div><div class=\"line\">\t&#125;</div><div class=\"line\">\t<span class=\"comment\">//删除znode</span></div><div class=\"line\">\t<span class=\"meta\">@Test</span></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setData</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</div><div class=\"line\">\t\t</div><div class=\"line\">\t\tzkClient.setData(<span class=\"string\">\"/app1\"</span>, <span class=\"string\">\"imissyou angelababy\"</span>.getBytes(), -<span class=\"number\">1</span>);</div><div class=\"line\">\t\t</div><div class=\"line\">\t\t<span class=\"keyword\">byte</span>[] data = zkClient.getData(<span class=\"string\">\"/app1\"</span>, <span class=\"keyword\">false</span>, <span class=\"keyword\">null</span>);</div><div class=\"line\">\t\tSystem.out.println(<span class=\"keyword\">new</span> String(data));</div><div class=\"line\">\t\t</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>"},{"title":"大数据03-03-zookeeper-命令行客户端及znode数据结构类型监听等功能","toc":true,"date":"2017-11-19T15:54:06.000Z","scaffolds":null,"_content":"\n# 进入客户端\n```\nbin/zkCli.sh (连到本机)\nconnect zk2:2181（连到zk2机器上）\n\n[zk: zk2:2181(CONNECTED) 3] \n```\n# zookeeper结构\n## 特性\n1. Zookeeper：一个leader，多个follower组成的集群\n1. 全局数据一致：每个server保存一份相同的数据副本，client无论连接到哪个server，数据都是一致的\n1. 分布式读写，更新请求转发，由leader实施\n1. 更新请求顺序进行，来自同一个client的更新请求按其发送顺序依次执行\n1. 数据更新原子性，一次数据更新要么成功，要么失败\n1. 实时性，在一定时间范围内，client能读到最新数据\n\n<!-- more -->\n\n## 数据结构 \n1. 层次化的目录结构，命名符合常规文件系统规范(见下图)\n1. 每个节点在zookeeper中叫做znode,并且其有一个唯一的路径标识\n1. 节点Znode可以包含数据和子节点（但是EPHEMERAL类型的节点不能有子节点，下一页详细讲解）\n1. 客户端应用可以在节点上设置监视器（后续详细讲解）\t\n\n## 数据结构图\n![20171119232757](http://ovasdkxqr.bkt.clouddn.com/image/blog/20171119232757.png)\n\n## 节点类型\n1. Znode有两种类型：\n    - 短暂（ephemeral）（断开连接自己删除）\n    - 持久（persistent）（断开连接不删除）\n1. Znode有四种形式的目录节点（默认是persistent ）\n    - PERSISTENT\n    - PERSISTENT_SEQUENTIAL（持久序列/test0000000019 ）\n    - EPHEMERAL\n    - EPHEMERAL_SEQUENTIAL\n1. 创建znode时设置顺序标识，znode名称后会附加一个值，顺序号是一个单调递增的计数器，由父节点维护\n1. 在分布式系统中，顺序号可以被用于为所有的事件进行全局排序，这样客户端可以通过顺序号推断事件的顺序\n\n# 命令行操作\n> 运行 zkCli.sh –server <ip>进入命令行工具\n\n```\n    [zk: zk2:2181(CONNECTED) 2] help\n    ZooKeeper -server host:port cmd args\n            connect host:port\n            get path [watch]\n            ls path [watch]\n            set path data [version]\n            rmr path\n            delquota [-n|-b] path\n            quit \n            printwatches on|off\n            create [-s] [-e] path data acl\n            stat path [watch]\n            close \n            ls2 path [watch]\n            history \n            listquota path\n            setAcl path acl\n            getAcl path\n            sync path\n            redo cmdno\n            addauth scheme auth\n            delete path [version]\n            setquota -n|-b val path\n```\n1. 使用 ls 命令来查看当前 ZooKeeper 中所包含的内容：\n    ```\n    [zk: zk2:2181(CONNECTED) 3] ls /\n    [zookeeper]\n    ```\n1. 创建一个新的 znode ，使用 create /zk myData 。这个命令创建了一个新的 znode 节点“ zk ”以及与它**关联的**字符串：\n    ```\n    [zk: zk2:2181(CONNECTED) 4] create /app 1234\n    Created /app\n    ```\n\n1. 我们运行 get 命令来确认 znode 是否包含我们所创建的字符串：\n    ```\n    [zk: zk2:2181(CONNECTED) 5] get /app\n    1234\n    cZxid = 0x300000004\n    ctime = Sun Nov 19 15:48:32 UTC 2017\n    mZxid = 0x300000004\n    mtime = Sun Nov 19 15:48:32 UTC 2017\n    pZxid = 0x300000004\n    cversion = 0\n    dataVersion = 0\n    aclVersion = 0\n    ephemeralOwner = 0x0\n    dataLength = 4\n    numChildren = 0\n\n    ```\n\n    ```\n    [zk: localhost:2181(CONNECTED) 4] get /app watch\n    #监听这个节点的变化,当另外一个客户端改变/app,它会打出下面的\n    #WATCHER::\n    #WatchedEvent state:SyncConnected type:NodeDataChanged path:/app\n    ```\n\n1. 下面我们通过 set 命令来对 zk 所关联的字符串进行设置：\n    ```\n    [zk: zk2:2181(CONNECTED) 6] set /app 222\n    cZxid = 0x300000004\n    ctime = Sun Nov 19 15:48:32 UTC 2017\n    mZxid = 0x300000005\n    mtime = Sun Nov 19 15:50:46 UTC 2017\n    pZxid = 0x300000004\n    cversion = 0\n    dataVersion = 1\n    aclVersion = 0\n    ephemeralOwner = 0x0\n    dataLength = 3\n    numChildren = 0\n\n    [zk: zk2:2181(CONNECTED) 7] get /app\n    222\n    cZxid = 0x300000004\n    ctime = Sun Nov 19 15:48:32 UTC 2017\n    mZxid = 0x300000005\n    mtime = Sun Nov 19 15:50:46 UTC 2017\n    pZxid = 0x300000004\n    cversion = 0\n    dataVersion = 1\n    aclVersion = 0\n    ephemeralOwner = 0x0\n    dataLength = 3\n    numChildren = 0\n    ```\n1. 下面我们将刚才创建的 znode 删除：只能删除没有子节点的节点\n    ```\n    [zk: zk2:2181(CONNECTED) 8] delete /app\n    [zk: zk2:2181(CONNECTED) 9] ls /\n    [zookeeper]\n    ```\n1. 删除节点：rmr 删除节点及其子节点\n    ```\n    [zk: zk2:2181(CONNECTED) 11] create /app2 12\n    Created /app2\n    [zk: zk2:2181(CONNECTED) 12] rmr /app2\n    [zk: zk2:2181(CONNECTED) 13] ls /           \n    [zookeeper]\n    ```\n","source":"_posts/大数据/大数据03-03-zookeeper-命令行客户端及znode数据结构类型监听等功能.md","raw":"---\ntitle: 大数据03-03-zookeeper-命令行客户端及znode数据结构类型监听等功能\ncategories: 学习\ntags:\n  - 大数据\n  - zookeeper\ntoc: true\ndate: 2017-11-19 23:54:06\nscaffolds:\n---\n\n# 进入客户端\n```\nbin/zkCli.sh (连到本机)\nconnect zk2:2181（连到zk2机器上）\n\n[zk: zk2:2181(CONNECTED) 3] \n```\n# zookeeper结构\n## 特性\n1. Zookeeper：一个leader，多个follower组成的集群\n1. 全局数据一致：每个server保存一份相同的数据副本，client无论连接到哪个server，数据都是一致的\n1. 分布式读写，更新请求转发，由leader实施\n1. 更新请求顺序进行，来自同一个client的更新请求按其发送顺序依次执行\n1. 数据更新原子性，一次数据更新要么成功，要么失败\n1. 实时性，在一定时间范围内，client能读到最新数据\n\n<!-- more -->\n\n## 数据结构 \n1. 层次化的目录结构，命名符合常规文件系统规范(见下图)\n1. 每个节点在zookeeper中叫做znode,并且其有一个唯一的路径标识\n1. 节点Znode可以包含数据和子节点（但是EPHEMERAL类型的节点不能有子节点，下一页详细讲解）\n1. 客户端应用可以在节点上设置监视器（后续详细讲解）\t\n\n## 数据结构图\n![20171119232757](http://ovasdkxqr.bkt.clouddn.com/image/blog/20171119232757.png)\n\n## 节点类型\n1. Znode有两种类型：\n    - 短暂（ephemeral）（断开连接自己删除）\n    - 持久（persistent）（断开连接不删除）\n1. Znode有四种形式的目录节点（默认是persistent ）\n    - PERSISTENT\n    - PERSISTENT_SEQUENTIAL（持久序列/test0000000019 ）\n    - EPHEMERAL\n    - EPHEMERAL_SEQUENTIAL\n1. 创建znode时设置顺序标识，znode名称后会附加一个值，顺序号是一个单调递增的计数器，由父节点维护\n1. 在分布式系统中，顺序号可以被用于为所有的事件进行全局排序，这样客户端可以通过顺序号推断事件的顺序\n\n# 命令行操作\n> 运行 zkCli.sh –server <ip>进入命令行工具\n\n```\n    [zk: zk2:2181(CONNECTED) 2] help\n    ZooKeeper -server host:port cmd args\n            connect host:port\n            get path [watch]\n            ls path [watch]\n            set path data [version]\n            rmr path\n            delquota [-n|-b] path\n            quit \n            printwatches on|off\n            create [-s] [-e] path data acl\n            stat path [watch]\n            close \n            ls2 path [watch]\n            history \n            listquota path\n            setAcl path acl\n            getAcl path\n            sync path\n            redo cmdno\n            addauth scheme auth\n            delete path [version]\n            setquota -n|-b val path\n```\n1. 使用 ls 命令来查看当前 ZooKeeper 中所包含的内容：\n    ```\n    [zk: zk2:2181(CONNECTED) 3] ls /\n    [zookeeper]\n    ```\n1. 创建一个新的 znode ，使用 create /zk myData 。这个命令创建了一个新的 znode 节点“ zk ”以及与它**关联的**字符串：\n    ```\n    [zk: zk2:2181(CONNECTED) 4] create /app 1234\n    Created /app\n    ```\n\n1. 我们运行 get 命令来确认 znode 是否包含我们所创建的字符串：\n    ```\n    [zk: zk2:2181(CONNECTED) 5] get /app\n    1234\n    cZxid = 0x300000004\n    ctime = Sun Nov 19 15:48:32 UTC 2017\n    mZxid = 0x300000004\n    mtime = Sun Nov 19 15:48:32 UTC 2017\n    pZxid = 0x300000004\n    cversion = 0\n    dataVersion = 0\n    aclVersion = 0\n    ephemeralOwner = 0x0\n    dataLength = 4\n    numChildren = 0\n\n    ```\n\n    ```\n    [zk: localhost:2181(CONNECTED) 4] get /app watch\n    #监听这个节点的变化,当另外一个客户端改变/app,它会打出下面的\n    #WATCHER::\n    #WatchedEvent state:SyncConnected type:NodeDataChanged path:/app\n    ```\n\n1. 下面我们通过 set 命令来对 zk 所关联的字符串进行设置：\n    ```\n    [zk: zk2:2181(CONNECTED) 6] set /app 222\n    cZxid = 0x300000004\n    ctime = Sun Nov 19 15:48:32 UTC 2017\n    mZxid = 0x300000005\n    mtime = Sun Nov 19 15:50:46 UTC 2017\n    pZxid = 0x300000004\n    cversion = 0\n    dataVersion = 1\n    aclVersion = 0\n    ephemeralOwner = 0x0\n    dataLength = 3\n    numChildren = 0\n\n    [zk: zk2:2181(CONNECTED) 7] get /app\n    222\n    cZxid = 0x300000004\n    ctime = Sun Nov 19 15:48:32 UTC 2017\n    mZxid = 0x300000005\n    mtime = Sun Nov 19 15:50:46 UTC 2017\n    pZxid = 0x300000004\n    cversion = 0\n    dataVersion = 1\n    aclVersion = 0\n    ephemeralOwner = 0x0\n    dataLength = 3\n    numChildren = 0\n    ```\n1. 下面我们将刚才创建的 znode 删除：只能删除没有子节点的节点\n    ```\n    [zk: zk2:2181(CONNECTED) 8] delete /app\n    [zk: zk2:2181(CONNECTED) 9] ls /\n    [zookeeper]\n    ```\n1. 删除节点：rmr 删除节点及其子节点\n    ```\n    [zk: zk2:2181(CONNECTED) 11] create /app2 12\n    Created /app2\n    [zk: zk2:2181(CONNECTED) 12] rmr /app2\n    [zk: zk2:2181(CONNECTED) 13] ls /           \n    [zookeeper]\n    ```\n","slug":"大数据/大数据03-03-zookeeper-命令行客户端及znode数据结构类型监听等功能","published":1,"updated":"2017-11-21T15:31:47.234Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjcsq4lfy0015x4vfhu375ie8","content":"<h1 id=\"进入客户端\"><a href=\"#进入客户端\" class=\"headerlink\" title=\"进入客户端\"></a>进入客户端</h1><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\">bin/zkCli.sh (连到本机)</div><div class=\"line\">connect zk2:2181（连到zk2机器上）</div><div class=\"line\"></div><div class=\"line\">[zk: zk2:2181(CONNECTED) 3]</div></pre></td></tr></table></figure>\n<h1 id=\"zookeeper结构\"><a href=\"#zookeeper结构\" class=\"headerlink\" title=\"zookeeper结构\"></a>zookeeper结构</h1><h2 id=\"特性\"><a href=\"#特性\" class=\"headerlink\" title=\"特性\"></a>特性</h2><ol>\n<li>Zookeeper：一个leader，多个follower组成的集群</li>\n<li>全局数据一致：每个server保存一份相同的数据副本，client无论连接到哪个server，数据都是一致的</li>\n<li>分布式读写，更新请求转发，由leader实施</li>\n<li>更新请求顺序进行，来自同一个client的更新请求按其发送顺序依次执行</li>\n<li>数据更新原子性，一次数据更新要么成功，要么失败</li>\n<li>实时性，在一定时间范围内，client能读到最新数据</li>\n</ol>\n<a id=\"more\"></a>\n<h2 id=\"数据结构\"><a href=\"#数据结构\" class=\"headerlink\" title=\"数据结构\"></a>数据结构</h2><ol>\n<li>层次化的目录结构，命名符合常规文件系统规范(见下图)</li>\n<li>每个节点在zookeeper中叫做znode,并且其有一个唯一的路径标识</li>\n<li>节点Znode可以包含数据和子节点（但是EPHEMERAL类型的节点不能有子节点，下一页详细讲解）</li>\n<li>客户端应用可以在节点上设置监视器（后续详细讲解）    </li>\n</ol>\n<h2 id=\"数据结构图\"><a href=\"#数据结构图\" class=\"headerlink\" title=\"数据结构图\"></a>数据结构图</h2><p><img src=\"http://ovasdkxqr.bkt.clouddn.com/image/blog/20171119232757.png\" alt=\"20171119232757\"></p>\n<h2 id=\"节点类型\"><a href=\"#节点类型\" class=\"headerlink\" title=\"节点类型\"></a>节点类型</h2><ol>\n<li>Znode有两种类型：<ul>\n<li>短暂（ephemeral）（断开连接自己删除）</li>\n<li>持久（persistent）（断开连接不删除）</li>\n</ul>\n</li>\n<li>Znode有四种形式的目录节点（默认是persistent ）<ul>\n<li>PERSISTENT</li>\n<li>PERSISTENT_SEQUENTIAL（持久序列/test0000000019 ）</li>\n<li>EPHEMERAL</li>\n<li>EPHEMERAL_SEQUENTIAL</li>\n</ul>\n</li>\n<li>创建znode时设置顺序标识，znode名称后会附加一个值，顺序号是一个单调递增的计数器，由父节点维护</li>\n<li>在分布式系统中，顺序号可以被用于为所有的事件进行全局排序，这样客户端可以通过顺序号推断事件的顺序</li>\n</ol>\n<h1 id=\"命令行操作\"><a href=\"#命令行操作\" class=\"headerlink\" title=\"命令行操作\"></a>命令行操作</h1><blockquote>\n<p>运行 zkCli.sh –server <ip>进入命令行工具</ip></p>\n</blockquote>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div></pre></td><td class=\"code\"><pre><div class=\"line\">[zk: zk2:2181(CONNECTED) 2] help</div><div class=\"line\">ZooKeeper -server host:port cmd args</div><div class=\"line\">        connect host:port</div><div class=\"line\">        get path [watch]</div><div class=\"line\">        ls path [watch]</div><div class=\"line\">        set path data [version]</div><div class=\"line\">        rmr path</div><div class=\"line\">        delquota [-n|-b] path</div><div class=\"line\">        quit </div><div class=\"line\">        printwatches on|off</div><div class=\"line\">        create [-s] [-e] path data acl</div><div class=\"line\">        stat path [watch]</div><div class=\"line\">        close </div><div class=\"line\">        ls2 path [watch]</div><div class=\"line\">        history </div><div class=\"line\">        listquota path</div><div class=\"line\">        setAcl path acl</div><div class=\"line\">        getAcl path</div><div class=\"line\">        sync path</div><div class=\"line\">        redo cmdno</div><div class=\"line\">        addauth scheme auth</div><div class=\"line\">        delete path [version]</div><div class=\"line\">        setquota -n|-b val path</div></pre></td></tr></table></figure>\n<ol>\n<li><p>使用 ls 命令来查看当前 ZooKeeper 中所包含的内容：</p>\n <figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\">[zk: zk2:2181(CONNECTED) 3] ls /</div><div class=\"line\">[zookeeper]</div></pre></td></tr></table></figure>\n</li>\n<li><p>创建一个新的 znode ，使用 create /zk myData 。这个命令创建了一个新的 znode 节点“ zk ”以及与它<strong>关联的</strong>字符串：</p>\n <figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\">[zk: zk2:2181(CONNECTED) 4] create /app 1234</div><div class=\"line\">Created /app</div></pre></td></tr></table></figure>\n</li>\n<li><p>我们运行 get 命令来确认 znode 是否包含我们所创建的字符串：</p>\n <figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div></pre></td><td class=\"code\"><pre><div class=\"line\">[zk: zk2:2181(CONNECTED) 5] get /app</div><div class=\"line\">1234</div><div class=\"line\">cZxid = 0x300000004</div><div class=\"line\">ctime = Sun Nov 19 15:48:32 UTC 2017</div><div class=\"line\">mZxid = 0x300000004</div><div class=\"line\">mtime = Sun Nov 19 15:48:32 UTC 2017</div><div class=\"line\">pZxid = 0x300000004</div><div class=\"line\">cversion = 0</div><div class=\"line\">dataVersion = 0</div><div class=\"line\">aclVersion = 0</div><div class=\"line\">ephemeralOwner = 0x0</div><div class=\"line\">dataLength = 4</div><div class=\"line\">numChildren = 0</div></pre></td></tr></table></figure>\n <figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\">[zk: localhost:2181(CONNECTED) 4] get /app watch</div><div class=\"line\">#监听这个节点的变化,当另外一个客户端改变/app,它会打出下面的</div><div class=\"line\">#WATCHER::</div><div class=\"line\">#WatchedEvent state:SyncConnected type:NodeDataChanged path:/app</div></pre></td></tr></table></figure>\n</li>\n<li><p>下面我们通过 set 命令来对 zk 所关联的字符串进行设置：</p>\n <figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div></pre></td><td class=\"code\"><pre><div class=\"line\">[zk: zk2:2181(CONNECTED) 6] set /app 222</div><div class=\"line\">cZxid = 0x300000004</div><div class=\"line\">ctime = Sun Nov 19 15:48:32 UTC 2017</div><div class=\"line\">mZxid = 0x300000005</div><div class=\"line\">mtime = Sun Nov 19 15:50:46 UTC 2017</div><div class=\"line\">pZxid = 0x300000004</div><div class=\"line\">cversion = 0</div><div class=\"line\">dataVersion = 1</div><div class=\"line\">aclVersion = 0</div><div class=\"line\">ephemeralOwner = 0x0</div><div class=\"line\">dataLength = 3</div><div class=\"line\">numChildren = 0</div><div class=\"line\"></div><div class=\"line\">[zk: zk2:2181(CONNECTED) 7] get /app</div><div class=\"line\">222</div><div class=\"line\">cZxid = 0x300000004</div><div class=\"line\">ctime = Sun Nov 19 15:48:32 UTC 2017</div><div class=\"line\">mZxid = 0x300000005</div><div class=\"line\">mtime = Sun Nov 19 15:50:46 UTC 2017</div><div class=\"line\">pZxid = 0x300000004</div><div class=\"line\">cversion = 0</div><div class=\"line\">dataVersion = 1</div><div class=\"line\">aclVersion = 0</div><div class=\"line\">ephemeralOwner = 0x0</div><div class=\"line\">dataLength = 3</div><div class=\"line\">numChildren = 0</div></pre></td></tr></table></figure>\n</li>\n<li><p>下面我们将刚才创建的 znode 删除：只能删除没有子节点的节点</p>\n <figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\">[zk: zk2:2181(CONNECTED) 8] delete /app</div><div class=\"line\">[zk: zk2:2181(CONNECTED) 9] ls /</div><div class=\"line\">[zookeeper]</div></pre></td></tr></table></figure>\n</li>\n<li><p>删除节点：rmr 删除节点及其子节点</p>\n <figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\">[zk: zk2:2181(CONNECTED) 11] create /app2 12</div><div class=\"line\">Created /app2</div><div class=\"line\">[zk: zk2:2181(CONNECTED) 12] rmr /app2</div><div class=\"line\">[zk: zk2:2181(CONNECTED) 13] ls /           </div><div class=\"line\">[zookeeper]</div></pre></td></tr></table></figure>\n</li>\n</ol>\n","site":{"data":{}},"excerpt":"<h1 id=\"进入客户端\"><a href=\"#进入客户端\" class=\"headerlink\" title=\"进入客户端\"></a>进入客户端</h1><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\">bin/zkCli.sh (连到本机)</div><div class=\"line\">connect zk2:2181（连到zk2机器上）</div><div class=\"line\"></div><div class=\"line\">[zk: zk2:2181(CONNECTED) 3]</div></pre></td></tr></table></figure>\n<h1 id=\"zookeeper结构\"><a href=\"#zookeeper结构\" class=\"headerlink\" title=\"zookeeper结构\"></a>zookeeper结构</h1><h2 id=\"特性\"><a href=\"#特性\" class=\"headerlink\" title=\"特性\"></a>特性</h2><ol>\n<li>Zookeeper：一个leader，多个follower组成的集群</li>\n<li>全局数据一致：每个server保存一份相同的数据副本，client无论连接到哪个server，数据都是一致的</li>\n<li>分布式读写，更新请求转发，由leader实施</li>\n<li>更新请求顺序进行，来自同一个client的更新请求按其发送顺序依次执行</li>\n<li>数据更新原子性，一次数据更新要么成功，要么失败</li>\n<li>实时性，在一定时间范围内，client能读到最新数据</li>\n</ol>","more":"<h2 id=\"数据结构\"><a href=\"#数据结构\" class=\"headerlink\" title=\"数据结构\"></a>数据结构</h2><ol>\n<li>层次化的目录结构，命名符合常规文件系统规范(见下图)</li>\n<li>每个节点在zookeeper中叫做znode,并且其有一个唯一的路径标识</li>\n<li>节点Znode可以包含数据和子节点（但是EPHEMERAL类型的节点不能有子节点，下一页详细讲解）</li>\n<li>客户端应用可以在节点上设置监视器（后续详细讲解）    </li>\n</ol>\n<h2 id=\"数据结构图\"><a href=\"#数据结构图\" class=\"headerlink\" title=\"数据结构图\"></a>数据结构图</h2><p><img src=\"http://ovasdkxqr.bkt.clouddn.com/image/blog/20171119232757.png\" alt=\"20171119232757\"></p>\n<h2 id=\"节点类型\"><a href=\"#节点类型\" class=\"headerlink\" title=\"节点类型\"></a>节点类型</h2><ol>\n<li>Znode有两种类型：<ul>\n<li>短暂（ephemeral）（断开连接自己删除）</li>\n<li>持久（persistent）（断开连接不删除）</li>\n</ul>\n</li>\n<li>Znode有四种形式的目录节点（默认是persistent ）<ul>\n<li>PERSISTENT</li>\n<li>PERSISTENT_SEQUENTIAL（持久序列/test0000000019 ）</li>\n<li>EPHEMERAL</li>\n<li>EPHEMERAL_SEQUENTIAL</li>\n</ul>\n</li>\n<li>创建znode时设置顺序标识，znode名称后会附加一个值，顺序号是一个单调递增的计数器，由父节点维护</li>\n<li>在分布式系统中，顺序号可以被用于为所有的事件进行全局排序，这样客户端可以通过顺序号推断事件的顺序</li>\n</ol>\n<h1 id=\"命令行操作\"><a href=\"#命令行操作\" class=\"headerlink\" title=\"命令行操作\"></a>命令行操作</h1><blockquote>\n<p>运行 zkCli.sh –server <ip>进入命令行工具</ip></p>\n</blockquote>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div></pre></td><td class=\"code\"><pre><div class=\"line\">[zk: zk2:2181(CONNECTED) 2] help</div><div class=\"line\">ZooKeeper -server host:port cmd args</div><div class=\"line\">        connect host:port</div><div class=\"line\">        get path [watch]</div><div class=\"line\">        ls path [watch]</div><div class=\"line\">        set path data [version]</div><div class=\"line\">        rmr path</div><div class=\"line\">        delquota [-n|-b] path</div><div class=\"line\">        quit </div><div class=\"line\">        printwatches on|off</div><div class=\"line\">        create [-s] [-e] path data acl</div><div class=\"line\">        stat path [watch]</div><div class=\"line\">        close </div><div class=\"line\">        ls2 path [watch]</div><div class=\"line\">        history </div><div class=\"line\">        listquota path</div><div class=\"line\">        setAcl path acl</div><div class=\"line\">        getAcl path</div><div class=\"line\">        sync path</div><div class=\"line\">        redo cmdno</div><div class=\"line\">        addauth scheme auth</div><div class=\"line\">        delete path [version]</div><div class=\"line\">        setquota -n|-b val path</div></pre></td></tr></table></figure>\n<ol>\n<li><p>使用 ls 命令来查看当前 ZooKeeper 中所包含的内容：</p>\n <figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\">[zk: zk2:2181(CONNECTED) 3] ls /</div><div class=\"line\">[zookeeper]</div></pre></td></tr></table></figure>\n</li>\n<li><p>创建一个新的 znode ，使用 create /zk myData 。这个命令创建了一个新的 znode 节点“ zk ”以及与它<strong>关联的</strong>字符串：</p>\n <figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\">[zk: zk2:2181(CONNECTED) 4] create /app 1234</div><div class=\"line\">Created /app</div></pre></td></tr></table></figure>\n</li>\n<li><p>我们运行 get 命令来确认 znode 是否包含我们所创建的字符串：</p>\n <figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div></pre></td><td class=\"code\"><pre><div class=\"line\">[zk: zk2:2181(CONNECTED) 5] get /app</div><div class=\"line\">1234</div><div class=\"line\">cZxid = 0x300000004</div><div class=\"line\">ctime = Sun Nov 19 15:48:32 UTC 2017</div><div class=\"line\">mZxid = 0x300000004</div><div class=\"line\">mtime = Sun Nov 19 15:48:32 UTC 2017</div><div class=\"line\">pZxid = 0x300000004</div><div class=\"line\">cversion = 0</div><div class=\"line\">dataVersion = 0</div><div class=\"line\">aclVersion = 0</div><div class=\"line\">ephemeralOwner = 0x0</div><div class=\"line\">dataLength = 4</div><div class=\"line\">numChildren = 0</div></pre></td></tr></table></figure>\n <figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\">[zk: localhost:2181(CONNECTED) 4] get /app watch</div><div class=\"line\">#监听这个节点的变化,当另外一个客户端改变/app,它会打出下面的</div><div class=\"line\">#WATCHER::</div><div class=\"line\">#WatchedEvent state:SyncConnected type:NodeDataChanged path:/app</div></pre></td></tr></table></figure>\n</li>\n<li><p>下面我们通过 set 命令来对 zk 所关联的字符串进行设置：</p>\n <figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div></pre></td><td class=\"code\"><pre><div class=\"line\">[zk: zk2:2181(CONNECTED) 6] set /app 222</div><div class=\"line\">cZxid = 0x300000004</div><div class=\"line\">ctime = Sun Nov 19 15:48:32 UTC 2017</div><div class=\"line\">mZxid = 0x300000005</div><div class=\"line\">mtime = Sun Nov 19 15:50:46 UTC 2017</div><div class=\"line\">pZxid = 0x300000004</div><div class=\"line\">cversion = 0</div><div class=\"line\">dataVersion = 1</div><div class=\"line\">aclVersion = 0</div><div class=\"line\">ephemeralOwner = 0x0</div><div class=\"line\">dataLength = 3</div><div class=\"line\">numChildren = 0</div><div class=\"line\"></div><div class=\"line\">[zk: zk2:2181(CONNECTED) 7] get /app</div><div class=\"line\">222</div><div class=\"line\">cZxid = 0x300000004</div><div class=\"line\">ctime = Sun Nov 19 15:48:32 UTC 2017</div><div class=\"line\">mZxid = 0x300000005</div><div class=\"line\">mtime = Sun Nov 19 15:50:46 UTC 2017</div><div class=\"line\">pZxid = 0x300000004</div><div class=\"line\">cversion = 0</div><div class=\"line\">dataVersion = 1</div><div class=\"line\">aclVersion = 0</div><div class=\"line\">ephemeralOwner = 0x0</div><div class=\"line\">dataLength = 3</div><div class=\"line\">numChildren = 0</div></pre></td></tr></table></figure>\n</li>\n<li><p>下面我们将刚才创建的 znode 删除：只能删除没有子节点的节点</p>\n <figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\">[zk: zk2:2181(CONNECTED) 8] delete /app</div><div class=\"line\">[zk: zk2:2181(CONNECTED) 9] ls /</div><div class=\"line\">[zookeeper]</div></pre></td></tr></table></figure>\n</li>\n<li><p>删除节点：rmr 删除节点及其子节点</p>\n <figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\">[zk: zk2:2181(CONNECTED) 11] create /app2 12</div><div class=\"line\">Created /app2</div><div class=\"line\">[zk: zk2:2181(CONNECTED) 12] rmr /app2</div><div class=\"line\">[zk: zk2:2181(CONNECTED) 13] ls /           </div><div class=\"line\">[zookeeper]</div></pre></td></tr></table></figure>\n</li>\n</ol>"},{"title":"大数据03-04-zookeeper集群自动启动脚本及export变量作用域的解析","toc":true,"date":"2017-11-21T15:22:14.000Z","scaffolds":null,"_content":"1. export A=1 定义的变量，会对自己所在的shell进程及其子进程生效\n2. B=1 定义的变量，只对自己所在的shell进程生效\n3. 在script.sh中定义的变量，在当前登录的shell进程中 source script.sh 时，脚本中定义的变量也会进入当前登录的进程\n<!-- more -->\n\n```bash\n#!/bin/sh\necho \"start zkServer...\"\nfor i in 1 2 3\ndo \nssh zk$i \"source /etc/profile;/home/vagrant/apps/zookeeper/bin/zkServer.sh start\"\ndone \n```\n1. 提示输入密码，配置免密登录\n```\nssh-keygen \nssh-copy-id zk1\n```\n2. 可以放到/root/bin 目录下，该目录直接就在环境变量中，不需要配置，可以在其他位置执行了\n","source":"_posts/大数据/大数据03-04-zookeeper集群自动启动脚本及export变量作用域的解析.md","raw":"---\ntitle: 大数据03-04-zookeeper集群自动启动脚本及export变量作用域的解析\ncategories: 学习\ntags:\n  - 大数据\n  - zookeeper\ntoc: true\ndate: 2017-11-21 23:22:14\nscaffolds:\n---\n1. export A=1 定义的变量，会对自己所在的shell进程及其子进程生效\n2. B=1 定义的变量，只对自己所在的shell进程生效\n3. 在script.sh中定义的变量，在当前登录的shell进程中 source script.sh 时，脚本中定义的变量也会进入当前登录的进程\n<!-- more -->\n\n```bash\n#!/bin/sh\necho \"start zkServer...\"\nfor i in 1 2 3\ndo \nssh zk$i \"source /etc/profile;/home/vagrant/apps/zookeeper/bin/zkServer.sh start\"\ndone \n```\n1. 提示输入密码，配置免密登录\n```\nssh-keygen \nssh-copy-id zk1\n```\n2. 可以放到/root/bin 目录下，该目录直接就在环境变量中，不需要配置，可以在其他位置执行了\n","slug":"大数据/大数据03-04-zookeeper集群自动启动脚本及export变量作用域的解析","published":1,"updated":"2017-11-25T17:09:36.081Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjcsq4lg20019x4vfgnsrj7ob","content":"<ol>\n<li>export A=1 定义的变量，会对自己所在的shell进程及其子进程生效</li>\n<li>B=1 定义的变量，只对自己所在的shell进程生效</li>\n<li>在script.sh中定义的变量，在当前登录的shell进程中 source script.sh 时，脚本中定义的变量也会进入当前登录的进程<a id=\"more\"></a>\n</li>\n</ol>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">#!/bin/sh</span></div><div class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">\"start zkServer...\"</span></div><div class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> 1 2 3</div><div class=\"line\"><span class=\"keyword\">do</span> </div><div class=\"line\">ssh zk<span class=\"variable\">$i</span> <span class=\"string\">\"source /etc/profile;/home/vagrant/apps/zookeeper/bin/zkServer.sh start\"</span></div><div class=\"line\"><span class=\"keyword\">done</span></div></pre></td></tr></table></figure>\n<ol>\n<li><p>提示输入密码，配置免密登录</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\">ssh-keygen </div><div class=\"line\">ssh-copy-id zk1</div></pre></td></tr></table></figure>\n</li>\n<li><p>可以放到/root/bin 目录下，该目录直接就在环境变量中，不需要配置，可以在其他位置执行了</p>\n</li>\n</ol>\n","site":{"data":{}},"excerpt":"<ol>\n<li>export A=1 定义的变量，会对自己所在的shell进程及其子进程生效</li>\n<li>B=1 定义的变量，只对自己所在的shell进程生效</li>\n<li>在script.sh中定义的变量，在当前登录的shell进程中 source script.sh 时，脚本中定义的变量也会进入当前登录的进程","more":"</li>\n</ol>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">#!/bin/sh</span></div><div class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">\"start zkServer...\"</span></div><div class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> 1 2 3</div><div class=\"line\"><span class=\"keyword\">do</span> </div><div class=\"line\">ssh zk<span class=\"variable\">$i</span> <span class=\"string\">\"source /etc/profile;/home/vagrant/apps/zookeeper/bin/zkServer.sh start\"</span></div><div class=\"line\"><span class=\"keyword\">done</span></div></pre></td></tr></table></figure>\n<ol>\n<li><p>提示输入密码，配置免密登录</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\">ssh-keygen </div><div class=\"line\">ssh-copy-id zk1</div></pre></td></tr></table></figure>\n</li>\n<li><p>可以放到/root/bin 目录下，该目录直接就在环境变量中，不需要配置，可以在其他位置执行了</p>\n</li>\n</ol>"},{"title":"大数据03-06-系统服务器上下线感知程序","toc":true,"date":"2017-11-25T17:10:58.000Z","scaffolds":null,"_content":"\n分布式服务注册，客户端获取等\n<!-- more -->\n\n# zookeeper动态感知节点的示意图\n\n![2017112604948](http://ovasdkxqr.bkt.clouddn.com/image/blog/2017112604948.png)\n\n# 代码\n\n## 客户端\n```java\npackage cn.itcast.bigdata.zkdist;\n\nimport java.util.ArrayList;\nimport java.util.List;\n\nimport org.apache.zookeeper.KeeperException;\nimport org.apache.zookeeper.WatchedEvent;\nimport org.apache.zookeeper.Watcher;\nimport org.apache.zookeeper.ZooKeeper;\n\npublic class DistributedClient {\n\n\tprivate static final String connectString = \"mini1:2181,mini2:2181,mini3:2181\";\n\tprivate static final int sessionTimeout = 2000;\n\tprivate static final String parentNode = \"/servers\";\n\t// 注意:加volatile的意义何在？\n\tprivate volatile List<String> serverList;\n\tprivate ZooKeeper zk = null;\n\n\t/**\n\t * 创建到zk的客户端连接\n\t * \n\t * @throws Exception\n\t */\n\tpublic void getConnect() throws Exception {\n\n\t\tzk = new ZooKeeper(connectString, sessionTimeout, new Watcher() {\n\t\t\t@Override\n\t\t\tpublic void process(WatchedEvent event) {\n\t\t\t\t// 收到事件通知后的回调函数（应该是我们自己的事件处理逻辑）\n\t\t\t\ttry {\n\t\t\t\t\t//重新更新服务器列表，并且注册了监听\n\t\t\t\t\tgetServerList();\n\n\t\t\t\t} catch (Exception e) {\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t}\n\n\t/**\n\t * 获取服务器信息列表\n\t * \n\t * @throws Exception\n\t */\n\tpublic void getServerList() throws Exception {\n\n\t\t// 获取服务器子节点信息，并且对父节点进行监听\n\t\tList<String> children = zk.getChildren(parentNode, true);\n\n\t\t// 先创建一个局部的list来存服务器信息\n\t\tList<String> servers = new ArrayList<String>();\n\t\tfor (String child : children) {\n\t\t\t// child只是子节点的节点名\n\t\t\tbyte[] data = zk.getData(parentNode + \"/\" + child, false, null);\n\t\t\tservers.add(new String(data));\n\t\t}\n\t\t// 把servers赋值给成员变量serverList，已提供给各业务线程使用\n\t\tserverList = servers;\n\t\t\n\t\t//打印服务器列表\n\t\tSystem.out.println(serverList);\n\t\t\n\t}\n\n\t/**\n\t * 业务功能\n\t * \n\t * @throws InterruptedException\n\t */\n\tpublic void handleBussiness() throws InterruptedException {\n\t\tSystem.out.println(\"client start working.....\");\n\t\tThread.sleep(Long.MAX_VALUE);\n\t}\n\t\n\t\n\t\n\t\n\tpublic static void main(String[] args) throws Exception {\n\n\t\t// 获取zk连接\n\t\tDistributedClient client = new DistributedClient();\n\t\tclient.getConnect();\n\t\t// 获取servers的子节点信息（并监听），从中获取服务器信息列表\n\t\tclient.getServerList();\n\n\t\t// 业务线程启动\n\t\tclient.handleBussiness();\n\t\t\n\t}\n\n}\n```\n\n## 服务端\n```java\npackage cn.itcast.bigdata.zkdist;\n\nimport org.apache.zookeeper.CreateMode;\nimport org.apache.zookeeper.WatchedEvent;\nimport org.apache.zookeeper.Watcher;\nimport org.apache.zookeeper.ZooDefs.Ids;\nimport org.apache.zookeeper.ZooKeeper;\n\npublic class DistributedServer {\n\tprivate static final String connectString = \"mini1:2181,mini2:2181,mini3:2181\";\n\tprivate static final int sessionTimeout = 2000;\n\tprivate static final String parentNode = \"/servers\";\n\n\tprivate ZooKeeper zk = null;\n\n\t/**\n\t * 创建到zk的客户端连接\n\t * \n\t * @throws Exception\n\t */\n\tpublic void getConnect() throws Exception {\n\n\t\tzk = new ZooKeeper(connectString, sessionTimeout, new Watcher() {\n\t\t\t@Override\n\t\t\tpublic void process(WatchedEvent event) {\n\t\t\t\t// 收到事件通知后的回调函数（应该是我们自己的事件处理逻辑）\n\t\t\t\tSystem.out.println(event.getType() + \"---\" + event.getPath());\n\t\t\t\ttry {\n\t\t\t\t\tzk.getChildren(\"/\", true);\n\t\t\t\t} catch (Exception e) {\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t}\n\n\t/**\n\t * 向zk集群注册服务器信息\n\t * \n\t * @param hostname\n\t * @throws Exception\n\t */\n\tpublic void registerServer(String hostname) throws Exception {\n\n\t\tString create = zk.create(parentNode + \"/server\", hostname.getBytes(), Ids.OPEN_ACL_UNSAFE, CreateMode.EPHEMERAL_SEQUENTIAL);\n\t\tSystem.out.println(hostname + \"is online..\" + create);\n\n\t}\n\n\t/**\n\t * 业务功能\n\t * \n\t * @throws InterruptedException\n\t */\n\tpublic void handleBussiness(String hostname) throws InterruptedException {\n\t\tSystem.out.println(hostname + \"start working.....\");\n\t\tThread.sleep(Long.MAX_VALUE);\n\t}\n\n\tpublic static void main(String[] args) throws Exception {\n\n\t\t// 获取zk连接\n\t\tDistributedServer server = new DistributedServer();\n\t\tserver.getConnect();\n\n\t\t// 利用zk连接注册服务器信息\n\t\tserver.registerServer(args[0]);\n\n\t\t// 启动业务功能\n\t\tserver.handleBussiness(args[0]);\n\n\t}\n\n}\n```","source":"_posts/大数据/大数据03-06-系统服务器上下线感知程序.md","raw":"---\ntitle: 大数据03-06-系统服务器上下线感知程序\ncategories: 学习\ntags:\n  - 大数据\n  - zookeeper\ntoc: true\ndate: 2017-11-26 01:10:58\nscaffolds:\n---\n\n分布式服务注册，客户端获取等\n<!-- more -->\n\n# zookeeper动态感知节点的示意图\n\n![2017112604948](http://ovasdkxqr.bkt.clouddn.com/image/blog/2017112604948.png)\n\n# 代码\n\n## 客户端\n```java\npackage cn.itcast.bigdata.zkdist;\n\nimport java.util.ArrayList;\nimport java.util.List;\n\nimport org.apache.zookeeper.KeeperException;\nimport org.apache.zookeeper.WatchedEvent;\nimport org.apache.zookeeper.Watcher;\nimport org.apache.zookeeper.ZooKeeper;\n\npublic class DistributedClient {\n\n\tprivate static final String connectString = \"mini1:2181,mini2:2181,mini3:2181\";\n\tprivate static final int sessionTimeout = 2000;\n\tprivate static final String parentNode = \"/servers\";\n\t// 注意:加volatile的意义何在？\n\tprivate volatile List<String> serverList;\n\tprivate ZooKeeper zk = null;\n\n\t/**\n\t * 创建到zk的客户端连接\n\t * \n\t * @throws Exception\n\t */\n\tpublic void getConnect() throws Exception {\n\n\t\tzk = new ZooKeeper(connectString, sessionTimeout, new Watcher() {\n\t\t\t@Override\n\t\t\tpublic void process(WatchedEvent event) {\n\t\t\t\t// 收到事件通知后的回调函数（应该是我们自己的事件处理逻辑）\n\t\t\t\ttry {\n\t\t\t\t\t//重新更新服务器列表，并且注册了监听\n\t\t\t\t\tgetServerList();\n\n\t\t\t\t} catch (Exception e) {\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t}\n\n\t/**\n\t * 获取服务器信息列表\n\t * \n\t * @throws Exception\n\t */\n\tpublic void getServerList() throws Exception {\n\n\t\t// 获取服务器子节点信息，并且对父节点进行监听\n\t\tList<String> children = zk.getChildren(parentNode, true);\n\n\t\t// 先创建一个局部的list来存服务器信息\n\t\tList<String> servers = new ArrayList<String>();\n\t\tfor (String child : children) {\n\t\t\t// child只是子节点的节点名\n\t\t\tbyte[] data = zk.getData(parentNode + \"/\" + child, false, null);\n\t\t\tservers.add(new String(data));\n\t\t}\n\t\t// 把servers赋值给成员变量serverList，已提供给各业务线程使用\n\t\tserverList = servers;\n\t\t\n\t\t//打印服务器列表\n\t\tSystem.out.println(serverList);\n\t\t\n\t}\n\n\t/**\n\t * 业务功能\n\t * \n\t * @throws InterruptedException\n\t */\n\tpublic void handleBussiness() throws InterruptedException {\n\t\tSystem.out.println(\"client start working.....\");\n\t\tThread.sleep(Long.MAX_VALUE);\n\t}\n\t\n\t\n\t\n\t\n\tpublic static void main(String[] args) throws Exception {\n\n\t\t// 获取zk连接\n\t\tDistributedClient client = new DistributedClient();\n\t\tclient.getConnect();\n\t\t// 获取servers的子节点信息（并监听），从中获取服务器信息列表\n\t\tclient.getServerList();\n\n\t\t// 业务线程启动\n\t\tclient.handleBussiness();\n\t\t\n\t}\n\n}\n```\n\n## 服务端\n```java\npackage cn.itcast.bigdata.zkdist;\n\nimport org.apache.zookeeper.CreateMode;\nimport org.apache.zookeeper.WatchedEvent;\nimport org.apache.zookeeper.Watcher;\nimport org.apache.zookeeper.ZooDefs.Ids;\nimport org.apache.zookeeper.ZooKeeper;\n\npublic class DistributedServer {\n\tprivate static final String connectString = \"mini1:2181,mini2:2181,mini3:2181\";\n\tprivate static final int sessionTimeout = 2000;\n\tprivate static final String parentNode = \"/servers\";\n\n\tprivate ZooKeeper zk = null;\n\n\t/**\n\t * 创建到zk的客户端连接\n\t * \n\t * @throws Exception\n\t */\n\tpublic void getConnect() throws Exception {\n\n\t\tzk = new ZooKeeper(connectString, sessionTimeout, new Watcher() {\n\t\t\t@Override\n\t\t\tpublic void process(WatchedEvent event) {\n\t\t\t\t// 收到事件通知后的回调函数（应该是我们自己的事件处理逻辑）\n\t\t\t\tSystem.out.println(event.getType() + \"---\" + event.getPath());\n\t\t\t\ttry {\n\t\t\t\t\tzk.getChildren(\"/\", true);\n\t\t\t\t} catch (Exception e) {\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t}\n\n\t/**\n\t * 向zk集群注册服务器信息\n\t * \n\t * @param hostname\n\t * @throws Exception\n\t */\n\tpublic void registerServer(String hostname) throws Exception {\n\n\t\tString create = zk.create(parentNode + \"/server\", hostname.getBytes(), Ids.OPEN_ACL_UNSAFE, CreateMode.EPHEMERAL_SEQUENTIAL);\n\t\tSystem.out.println(hostname + \"is online..\" + create);\n\n\t}\n\n\t/**\n\t * 业务功能\n\t * \n\t * @throws InterruptedException\n\t */\n\tpublic void handleBussiness(String hostname) throws InterruptedException {\n\t\tSystem.out.println(hostname + \"start working.....\");\n\t\tThread.sleep(Long.MAX_VALUE);\n\t}\n\n\tpublic static void main(String[] args) throws Exception {\n\n\t\t// 获取zk连接\n\t\tDistributedServer server = new DistributedServer();\n\t\tserver.getConnect();\n\n\t\t// 利用zk连接注册服务器信息\n\t\tserver.registerServer(args[0]);\n\n\t\t// 启动业务功能\n\t\tserver.handleBussiness(args[0]);\n\n\t}\n\n}\n```","slug":"大数据/大数据03-06-系统服务器上下线感知程序","published":1,"updated":"2017-11-26T10:36:18.352Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjcsq4lja003jx4vftqubkpwb","content":"<p>分布式服务注册，客户端获取等<br><a id=\"more\"></a></p>\n<h1 id=\"zookeeper动态感知节点的示意图\"><a href=\"#zookeeper动态感知节点的示意图\" class=\"headerlink\" title=\"zookeeper动态感知节点的示意图\"></a>zookeeper动态感知节点的示意图</h1><p><img src=\"http://ovasdkxqr.bkt.clouddn.com/image/blog/2017112604948.png\" alt=\"2017112604948\"></p>\n<h1 id=\"代码\"><a href=\"#代码\" class=\"headerlink\" title=\"代码\"></a>代码</h1><h2 id=\"客户端\"><a href=\"#客户端\" class=\"headerlink\" title=\"客户端\"></a>客户端</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div><div class=\"line\">87</div><div class=\"line\">88</div><div class=\"line\">89</div><div class=\"line\">90</div><div class=\"line\">91</div><div class=\"line\">92</div><div class=\"line\">93</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">package</span> cn.itcast.bigdata.zkdist;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">import</span> java.util.ArrayList;</div><div class=\"line\"><span class=\"keyword\">import</span> java.util.List;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">import</span> org.apache.zookeeper.KeeperException;</div><div class=\"line\"><span class=\"keyword\">import</span> org.apache.zookeeper.WatchedEvent;</div><div class=\"line\"><span class=\"keyword\">import</span> org.apache.zookeeper.Watcher;</div><div class=\"line\"><span class=\"keyword\">import</span> org.apache.zookeeper.ZooKeeper;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">DistributedClient</span> </span>&#123;</div><div class=\"line\"></div><div class=\"line\">\t<span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> String connectString = <span class=\"string\">\"mini1:2181,mini2:2181,mini3:2181\"</span>;</div><div class=\"line\">\t<span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> sessionTimeout = <span class=\"number\">2000</span>;</div><div class=\"line\">\t<span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> String parentNode = <span class=\"string\">\"/servers\"</span>;</div><div class=\"line\">\t<span class=\"comment\">// 注意:加volatile的意义何在？</span></div><div class=\"line\">\t<span class=\"keyword\">private</span> <span class=\"keyword\">volatile</span> List&lt;String&gt; serverList;</div><div class=\"line\">\t<span class=\"keyword\">private</span> ZooKeeper zk = <span class=\"keyword\">null</span>;</div><div class=\"line\"></div><div class=\"line\">\t<span class=\"comment\">/**</span></div><div class=\"line\"><span class=\"comment\">\t * 创建到zk的客户端连接</span></div><div class=\"line\"><span class=\"comment\">\t * </span></div><div class=\"line\"><span class=\"comment\">\t * <span class=\"doctag\">@throws</span> Exception</span></div><div class=\"line\"><span class=\"comment\">\t */</span></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">getConnect</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</div><div class=\"line\"></div><div class=\"line\">\t\tzk = <span class=\"keyword\">new</span> ZooKeeper(connectString, sessionTimeout, <span class=\"keyword\">new</span> Watcher() &#123;</div><div class=\"line\">\t\t\t<span class=\"meta\">@Override</span></div><div class=\"line\">\t\t\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">process</span><span class=\"params\">(WatchedEvent event)</span> </span>&#123;</div><div class=\"line\">\t\t\t\t<span class=\"comment\">// 收到事件通知后的回调函数（应该是我们自己的事件处理逻辑）</span></div><div class=\"line\">\t\t\t\t<span class=\"keyword\">try</span> &#123;</div><div class=\"line\">\t\t\t\t\t<span class=\"comment\">//重新更新服务器列表，并且注册了监听</span></div><div class=\"line\">\t\t\t\t\tgetServerList();</div><div class=\"line\"></div><div class=\"line\">\t\t\t\t&#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</div><div class=\"line\">\t\t\t\t&#125;</div><div class=\"line\">\t\t\t&#125;</div><div class=\"line\">\t\t&#125;);</div><div class=\"line\"></div><div class=\"line\">\t&#125;</div><div class=\"line\"></div><div class=\"line\">\t<span class=\"comment\">/**</span></div><div class=\"line\"><span class=\"comment\">\t * 获取服务器信息列表</span></div><div class=\"line\"><span class=\"comment\">\t * </span></div><div class=\"line\"><span class=\"comment\">\t * <span class=\"doctag\">@throws</span> Exception</span></div><div class=\"line\"><span class=\"comment\">\t */</span></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">getServerList</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</div><div class=\"line\"></div><div class=\"line\">\t\t<span class=\"comment\">// 获取服务器子节点信息，并且对父节点进行监听</span></div><div class=\"line\">\t\tList&lt;String&gt; children = zk.getChildren(parentNode, <span class=\"keyword\">true</span>);</div><div class=\"line\"></div><div class=\"line\">\t\t<span class=\"comment\">// 先创建一个局部的list来存服务器信息</span></div><div class=\"line\">\t\tList&lt;String&gt; servers = <span class=\"keyword\">new</span> ArrayList&lt;String&gt;();</div><div class=\"line\">\t\t<span class=\"keyword\">for</span> (String child : children) &#123;</div><div class=\"line\">\t\t\t<span class=\"comment\">// child只是子节点的节点名</span></div><div class=\"line\">\t\t\t<span class=\"keyword\">byte</span>[] data = zk.getData(parentNode + <span class=\"string\">\"/\"</span> + child, <span class=\"keyword\">false</span>, <span class=\"keyword\">null</span>);</div><div class=\"line\">\t\t\tservers.add(<span class=\"keyword\">new</span> String(data));</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t\t<span class=\"comment\">// 把servers赋值给成员变量serverList，已提供给各业务线程使用</span></div><div class=\"line\">\t\tserverList = servers;</div><div class=\"line\">\t\t</div><div class=\"line\">\t\t<span class=\"comment\">//打印服务器列表</span></div><div class=\"line\">\t\tSystem.out.println(serverList);</div><div class=\"line\">\t\t</div><div class=\"line\">\t&#125;</div><div class=\"line\"></div><div class=\"line\">\t<span class=\"comment\">/**</span></div><div class=\"line\"><span class=\"comment\">\t * 业务功能</span></div><div class=\"line\"><span class=\"comment\">\t * </span></div><div class=\"line\"><span class=\"comment\">\t * <span class=\"doctag\">@throws</span> InterruptedException</span></div><div class=\"line\"><span class=\"comment\">\t */</span></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">handleBussiness</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> InterruptedException </span>&#123;</div><div class=\"line\">\t\tSystem.out.println(<span class=\"string\">\"client start working.....\"</span>);</div><div class=\"line\">\t\tThread.sleep(Long.MAX_VALUE);</div><div class=\"line\">\t&#125;</div><div class=\"line\">\t</div><div class=\"line\">\t</div><div class=\"line\">\t</div><div class=\"line\">\t</div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</div><div class=\"line\"></div><div class=\"line\">\t\t<span class=\"comment\">// 获取zk连接</span></div><div class=\"line\">\t\tDistributedClient client = <span class=\"keyword\">new</span> DistributedClient();</div><div class=\"line\">\t\tclient.getConnect();</div><div class=\"line\">\t\t<span class=\"comment\">// 获取servers的子节点信息（并监听），从中获取服务器信息列表</span></div><div class=\"line\">\t\tclient.getServerList();</div><div class=\"line\"></div><div class=\"line\">\t\t<span class=\"comment\">// 业务线程启动</span></div><div class=\"line\">\t\tclient.handleBussiness();</div><div class=\"line\">\t\t</div><div class=\"line\">\t&#125;</div><div class=\"line\"></div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h2 id=\"服务端\"><a href=\"#服务端\" class=\"headerlink\" title=\"服务端\"></a>服务端</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">package</span> cn.itcast.bigdata.zkdist;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">import</span> org.apache.zookeeper.CreateMode;</div><div class=\"line\"><span class=\"keyword\">import</span> org.apache.zookeeper.WatchedEvent;</div><div class=\"line\"><span class=\"keyword\">import</span> org.apache.zookeeper.Watcher;</div><div class=\"line\"><span class=\"keyword\">import</span> org.apache.zookeeper.ZooDefs.Ids;</div><div class=\"line\"><span class=\"keyword\">import</span> org.apache.zookeeper.ZooKeeper;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">DistributedServer</span> </span>&#123;</div><div class=\"line\">\t<span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> String connectString = <span class=\"string\">\"mini1:2181,mini2:2181,mini3:2181\"</span>;</div><div class=\"line\">\t<span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> sessionTimeout = <span class=\"number\">2000</span>;</div><div class=\"line\">\t<span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> String parentNode = <span class=\"string\">\"/servers\"</span>;</div><div class=\"line\"></div><div class=\"line\">\t<span class=\"keyword\">private</span> ZooKeeper zk = <span class=\"keyword\">null</span>;</div><div class=\"line\"></div><div class=\"line\">\t<span class=\"comment\">/**</span></div><div class=\"line\"><span class=\"comment\">\t * 创建到zk的客户端连接</span></div><div class=\"line\"><span class=\"comment\">\t * </span></div><div class=\"line\"><span class=\"comment\">\t * <span class=\"doctag\">@throws</span> Exception</span></div><div class=\"line\"><span class=\"comment\">\t */</span></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">getConnect</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</div><div class=\"line\"></div><div class=\"line\">\t\tzk = <span class=\"keyword\">new</span> ZooKeeper(connectString, sessionTimeout, <span class=\"keyword\">new</span> Watcher() &#123;</div><div class=\"line\">\t\t\t<span class=\"meta\">@Override</span></div><div class=\"line\">\t\t\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">process</span><span class=\"params\">(WatchedEvent event)</span> </span>&#123;</div><div class=\"line\">\t\t\t\t<span class=\"comment\">// 收到事件通知后的回调函数（应该是我们自己的事件处理逻辑）</span></div><div class=\"line\">\t\t\t\tSystem.out.println(event.getType() + <span class=\"string\">\"---\"</span> + event.getPath());</div><div class=\"line\">\t\t\t\t<span class=\"keyword\">try</span> &#123;</div><div class=\"line\">\t\t\t\t\tzk.getChildren(<span class=\"string\">\"/\"</span>, <span class=\"keyword\">true</span>);</div><div class=\"line\">\t\t\t\t&#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</div><div class=\"line\">\t\t\t\t&#125;</div><div class=\"line\">\t\t\t&#125;</div><div class=\"line\">\t\t&#125;);</div><div class=\"line\"></div><div class=\"line\">\t&#125;</div><div class=\"line\"></div><div class=\"line\">\t<span class=\"comment\">/**</span></div><div class=\"line\"><span class=\"comment\">\t * 向zk集群注册服务器信息</span></div><div class=\"line\"><span class=\"comment\">\t * </span></div><div class=\"line\"><span class=\"comment\">\t * <span class=\"doctag\">@param</span> hostname</span></div><div class=\"line\"><span class=\"comment\">\t * <span class=\"doctag\">@throws</span> Exception</span></div><div class=\"line\"><span class=\"comment\">\t */</span></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">registerServer</span><span class=\"params\">(String hostname)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</div><div class=\"line\"></div><div class=\"line\">\t\tString create = zk.create(parentNode + <span class=\"string\">\"/server\"</span>, hostname.getBytes(), Ids.OPEN_ACL_UNSAFE, CreateMode.EPHEMERAL_SEQUENTIAL);</div><div class=\"line\">\t\tSystem.out.println(hostname + <span class=\"string\">\"is online..\"</span> + create);</div><div class=\"line\"></div><div class=\"line\">\t&#125;</div><div class=\"line\"></div><div class=\"line\">\t<span class=\"comment\">/**</span></div><div class=\"line\"><span class=\"comment\">\t * 业务功能</span></div><div class=\"line\"><span class=\"comment\">\t * </span></div><div class=\"line\"><span class=\"comment\">\t * <span class=\"doctag\">@throws</span> InterruptedException</span></div><div class=\"line\"><span class=\"comment\">\t */</span></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">handleBussiness</span><span class=\"params\">(String hostname)</span> <span class=\"keyword\">throws</span> InterruptedException </span>&#123;</div><div class=\"line\">\t\tSystem.out.println(hostname + <span class=\"string\">\"start working.....\"</span>);</div><div class=\"line\">\t\tThread.sleep(Long.MAX_VALUE);</div><div class=\"line\">\t&#125;</div><div class=\"line\"></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</div><div class=\"line\"></div><div class=\"line\">\t\t<span class=\"comment\">// 获取zk连接</span></div><div class=\"line\">\t\tDistributedServer server = <span class=\"keyword\">new</span> DistributedServer();</div><div class=\"line\">\t\tserver.getConnect();</div><div class=\"line\"></div><div class=\"line\">\t\t<span class=\"comment\">// 利用zk连接注册服务器信息</span></div><div class=\"line\">\t\tserver.registerServer(args[<span class=\"number\">0</span>]);</div><div class=\"line\"></div><div class=\"line\">\t\t<span class=\"comment\">// 启动业务功能</span></div><div class=\"line\">\t\tserver.handleBussiness(args[<span class=\"number\">0</span>]);</div><div class=\"line\"></div><div class=\"line\">\t&#125;</div><div class=\"line\"></div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>","site":{"data":{}},"excerpt":"<p>分布式服务注册，客户端获取等<br>","more":"</p>\n<h1 id=\"zookeeper动态感知节点的示意图\"><a href=\"#zookeeper动态感知节点的示意图\" class=\"headerlink\" title=\"zookeeper动态感知节点的示意图\"></a>zookeeper动态感知节点的示意图</h1><p><img src=\"http://ovasdkxqr.bkt.clouddn.com/image/blog/2017112604948.png\" alt=\"2017112604948\"></p>\n<h1 id=\"代码\"><a href=\"#代码\" class=\"headerlink\" title=\"代码\"></a>代码</h1><h2 id=\"客户端\"><a href=\"#客户端\" class=\"headerlink\" title=\"客户端\"></a>客户端</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div><div class=\"line\">87</div><div class=\"line\">88</div><div class=\"line\">89</div><div class=\"line\">90</div><div class=\"line\">91</div><div class=\"line\">92</div><div class=\"line\">93</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">package</span> cn.itcast.bigdata.zkdist;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">import</span> java.util.ArrayList;</div><div class=\"line\"><span class=\"keyword\">import</span> java.util.List;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">import</span> org.apache.zookeeper.KeeperException;</div><div class=\"line\"><span class=\"keyword\">import</span> org.apache.zookeeper.WatchedEvent;</div><div class=\"line\"><span class=\"keyword\">import</span> org.apache.zookeeper.Watcher;</div><div class=\"line\"><span class=\"keyword\">import</span> org.apache.zookeeper.ZooKeeper;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">DistributedClient</span> </span>&#123;</div><div class=\"line\"></div><div class=\"line\">\t<span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> String connectString = <span class=\"string\">\"mini1:2181,mini2:2181,mini3:2181\"</span>;</div><div class=\"line\">\t<span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> sessionTimeout = <span class=\"number\">2000</span>;</div><div class=\"line\">\t<span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> String parentNode = <span class=\"string\">\"/servers\"</span>;</div><div class=\"line\">\t<span class=\"comment\">// 注意:加volatile的意义何在？</span></div><div class=\"line\">\t<span class=\"keyword\">private</span> <span class=\"keyword\">volatile</span> List&lt;String&gt; serverList;</div><div class=\"line\">\t<span class=\"keyword\">private</span> ZooKeeper zk = <span class=\"keyword\">null</span>;</div><div class=\"line\"></div><div class=\"line\">\t<span class=\"comment\">/**</span></div><div class=\"line\"><span class=\"comment\">\t * 创建到zk的客户端连接</span></div><div class=\"line\"><span class=\"comment\">\t * </span></div><div class=\"line\"><span class=\"comment\">\t * <span class=\"doctag\">@throws</span> Exception</span></div><div class=\"line\"><span class=\"comment\">\t */</span></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">getConnect</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</div><div class=\"line\"></div><div class=\"line\">\t\tzk = <span class=\"keyword\">new</span> ZooKeeper(connectString, sessionTimeout, <span class=\"keyword\">new</span> Watcher() &#123;</div><div class=\"line\">\t\t\t<span class=\"meta\">@Override</span></div><div class=\"line\">\t\t\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">process</span><span class=\"params\">(WatchedEvent event)</span> </span>&#123;</div><div class=\"line\">\t\t\t\t<span class=\"comment\">// 收到事件通知后的回调函数（应该是我们自己的事件处理逻辑）</span></div><div class=\"line\">\t\t\t\t<span class=\"keyword\">try</span> &#123;</div><div class=\"line\">\t\t\t\t\t<span class=\"comment\">//重新更新服务器列表，并且注册了监听</span></div><div class=\"line\">\t\t\t\t\tgetServerList();</div><div class=\"line\"></div><div class=\"line\">\t\t\t\t&#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</div><div class=\"line\">\t\t\t\t&#125;</div><div class=\"line\">\t\t\t&#125;</div><div class=\"line\">\t\t&#125;);</div><div class=\"line\"></div><div class=\"line\">\t&#125;</div><div class=\"line\"></div><div class=\"line\">\t<span class=\"comment\">/**</span></div><div class=\"line\"><span class=\"comment\">\t * 获取服务器信息列表</span></div><div class=\"line\"><span class=\"comment\">\t * </span></div><div class=\"line\"><span class=\"comment\">\t * <span class=\"doctag\">@throws</span> Exception</span></div><div class=\"line\"><span class=\"comment\">\t */</span></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">getServerList</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</div><div class=\"line\"></div><div class=\"line\">\t\t<span class=\"comment\">// 获取服务器子节点信息，并且对父节点进行监听</span></div><div class=\"line\">\t\tList&lt;String&gt; children = zk.getChildren(parentNode, <span class=\"keyword\">true</span>);</div><div class=\"line\"></div><div class=\"line\">\t\t<span class=\"comment\">// 先创建一个局部的list来存服务器信息</span></div><div class=\"line\">\t\tList&lt;String&gt; servers = <span class=\"keyword\">new</span> ArrayList&lt;String&gt;();</div><div class=\"line\">\t\t<span class=\"keyword\">for</span> (String child : children) &#123;</div><div class=\"line\">\t\t\t<span class=\"comment\">// child只是子节点的节点名</span></div><div class=\"line\">\t\t\t<span class=\"keyword\">byte</span>[] data = zk.getData(parentNode + <span class=\"string\">\"/\"</span> + child, <span class=\"keyword\">false</span>, <span class=\"keyword\">null</span>);</div><div class=\"line\">\t\t\tservers.add(<span class=\"keyword\">new</span> String(data));</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t\t<span class=\"comment\">// 把servers赋值给成员变量serverList，已提供给各业务线程使用</span></div><div class=\"line\">\t\tserverList = servers;</div><div class=\"line\">\t\t</div><div class=\"line\">\t\t<span class=\"comment\">//打印服务器列表</span></div><div class=\"line\">\t\tSystem.out.println(serverList);</div><div class=\"line\">\t\t</div><div class=\"line\">\t&#125;</div><div class=\"line\"></div><div class=\"line\">\t<span class=\"comment\">/**</span></div><div class=\"line\"><span class=\"comment\">\t * 业务功能</span></div><div class=\"line\"><span class=\"comment\">\t * </span></div><div class=\"line\"><span class=\"comment\">\t * <span class=\"doctag\">@throws</span> InterruptedException</span></div><div class=\"line\"><span class=\"comment\">\t */</span></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">handleBussiness</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> InterruptedException </span>&#123;</div><div class=\"line\">\t\tSystem.out.println(<span class=\"string\">\"client start working.....\"</span>);</div><div class=\"line\">\t\tThread.sleep(Long.MAX_VALUE);</div><div class=\"line\">\t&#125;</div><div class=\"line\">\t</div><div class=\"line\">\t</div><div class=\"line\">\t</div><div class=\"line\">\t</div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</div><div class=\"line\"></div><div class=\"line\">\t\t<span class=\"comment\">// 获取zk连接</span></div><div class=\"line\">\t\tDistributedClient client = <span class=\"keyword\">new</span> DistributedClient();</div><div class=\"line\">\t\tclient.getConnect();</div><div class=\"line\">\t\t<span class=\"comment\">// 获取servers的子节点信息（并监听），从中获取服务器信息列表</span></div><div class=\"line\">\t\tclient.getServerList();</div><div class=\"line\"></div><div class=\"line\">\t\t<span class=\"comment\">// 业务线程启动</span></div><div class=\"line\">\t\tclient.handleBussiness();</div><div class=\"line\">\t\t</div><div class=\"line\">\t&#125;</div><div class=\"line\"></div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h2 id=\"服务端\"><a href=\"#服务端\" class=\"headerlink\" title=\"服务端\"></a>服务端</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">package</span> cn.itcast.bigdata.zkdist;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">import</span> org.apache.zookeeper.CreateMode;</div><div class=\"line\"><span class=\"keyword\">import</span> org.apache.zookeeper.WatchedEvent;</div><div class=\"line\"><span class=\"keyword\">import</span> org.apache.zookeeper.Watcher;</div><div class=\"line\"><span class=\"keyword\">import</span> org.apache.zookeeper.ZooDefs.Ids;</div><div class=\"line\"><span class=\"keyword\">import</span> org.apache.zookeeper.ZooKeeper;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">DistributedServer</span> </span>&#123;</div><div class=\"line\">\t<span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> String connectString = <span class=\"string\">\"mini1:2181,mini2:2181,mini3:2181\"</span>;</div><div class=\"line\">\t<span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> sessionTimeout = <span class=\"number\">2000</span>;</div><div class=\"line\">\t<span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> String parentNode = <span class=\"string\">\"/servers\"</span>;</div><div class=\"line\"></div><div class=\"line\">\t<span class=\"keyword\">private</span> ZooKeeper zk = <span class=\"keyword\">null</span>;</div><div class=\"line\"></div><div class=\"line\">\t<span class=\"comment\">/**</span></div><div class=\"line\"><span class=\"comment\">\t * 创建到zk的客户端连接</span></div><div class=\"line\"><span class=\"comment\">\t * </span></div><div class=\"line\"><span class=\"comment\">\t * <span class=\"doctag\">@throws</span> Exception</span></div><div class=\"line\"><span class=\"comment\">\t */</span></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">getConnect</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</div><div class=\"line\"></div><div class=\"line\">\t\tzk = <span class=\"keyword\">new</span> ZooKeeper(connectString, sessionTimeout, <span class=\"keyword\">new</span> Watcher() &#123;</div><div class=\"line\">\t\t\t<span class=\"meta\">@Override</span></div><div class=\"line\">\t\t\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">process</span><span class=\"params\">(WatchedEvent event)</span> </span>&#123;</div><div class=\"line\">\t\t\t\t<span class=\"comment\">// 收到事件通知后的回调函数（应该是我们自己的事件处理逻辑）</span></div><div class=\"line\">\t\t\t\tSystem.out.println(event.getType() + <span class=\"string\">\"---\"</span> + event.getPath());</div><div class=\"line\">\t\t\t\t<span class=\"keyword\">try</span> &#123;</div><div class=\"line\">\t\t\t\t\tzk.getChildren(<span class=\"string\">\"/\"</span>, <span class=\"keyword\">true</span>);</div><div class=\"line\">\t\t\t\t&#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</div><div class=\"line\">\t\t\t\t&#125;</div><div class=\"line\">\t\t\t&#125;</div><div class=\"line\">\t\t&#125;);</div><div class=\"line\"></div><div class=\"line\">\t&#125;</div><div class=\"line\"></div><div class=\"line\">\t<span class=\"comment\">/**</span></div><div class=\"line\"><span class=\"comment\">\t * 向zk集群注册服务器信息</span></div><div class=\"line\"><span class=\"comment\">\t * </span></div><div class=\"line\"><span class=\"comment\">\t * <span class=\"doctag\">@param</span> hostname</span></div><div class=\"line\"><span class=\"comment\">\t * <span class=\"doctag\">@throws</span> Exception</span></div><div class=\"line\"><span class=\"comment\">\t */</span></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">registerServer</span><span class=\"params\">(String hostname)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</div><div class=\"line\"></div><div class=\"line\">\t\tString create = zk.create(parentNode + <span class=\"string\">\"/server\"</span>, hostname.getBytes(), Ids.OPEN_ACL_UNSAFE, CreateMode.EPHEMERAL_SEQUENTIAL);</div><div class=\"line\">\t\tSystem.out.println(hostname + <span class=\"string\">\"is online..\"</span> + create);</div><div class=\"line\"></div><div class=\"line\">\t&#125;</div><div class=\"line\"></div><div class=\"line\">\t<span class=\"comment\">/**</span></div><div class=\"line\"><span class=\"comment\">\t * 业务功能</span></div><div class=\"line\"><span class=\"comment\">\t * </span></div><div class=\"line\"><span class=\"comment\">\t * <span class=\"doctag\">@throws</span> InterruptedException</span></div><div class=\"line\"><span class=\"comment\">\t */</span></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">handleBussiness</span><span class=\"params\">(String hostname)</span> <span class=\"keyword\">throws</span> InterruptedException </span>&#123;</div><div class=\"line\">\t\tSystem.out.println(hostname + <span class=\"string\">\"start working.....\"</span>);</div><div class=\"line\">\t\tThread.sleep(Long.MAX_VALUE);</div><div class=\"line\">\t&#125;</div><div class=\"line\"></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</div><div class=\"line\"></div><div class=\"line\">\t\t<span class=\"comment\">// 获取zk连接</span></div><div class=\"line\">\t\tDistributedServer server = <span class=\"keyword\">new</span> DistributedServer();</div><div class=\"line\">\t\tserver.getConnect();</div><div class=\"line\"></div><div class=\"line\">\t\t<span class=\"comment\">// 利用zk连接注册服务器信息</span></div><div class=\"line\">\t\tserver.registerServer(args[<span class=\"number\">0</span>]);</div><div class=\"line\"></div><div class=\"line\">\t\t<span class=\"comment\">// 启动业务功能</span></div><div class=\"line\">\t\tserver.handleBussiness(args[<span class=\"number\">0</span>]);</div><div class=\"line\"></div><div class=\"line\">\t&#125;</div><div class=\"line\"></div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>"},{"title":"大数据0401-java多线程并发","toc":true,"date":"2017-12-01T14:59:38.000Z","scaffolds":null,"_content":"\n内容包含\n\n1. 掌握多线程\n1. 掌握并发包下的队列\n\n做个笔记，方便查看\n<!-- more -->\n# java多线程增强\n\n## 进程介绍\n不管是我们开发的应用程序，还是我们运行的其他的应用程序，都需要先把程序安装在本地的硬盘上。然后找到这个程序的启动文件，启动程序的时候，其实是电脑把当前的这个程序加载到内存中，在<font color=\"red\">内存中需要给当前的程序分配一段独立的运行空间</font>。这片空间就专门负责当前这个程序的运行。  \n\n不同的应用程序运行的过程中都需要在内存中分配自己独立的运行空间，彼此之间不会相互的影响。我们把每个独立应用程序在内存的独立空间称为当前应用程序运行的一个进程。  \n\n进程：它是内存中的一段独立的空间，可以负责当前应用程序的运行。当前这个进程负责调度当前程序中的所有运行细节。\n\n## 线程介绍\n在一个进程中，每个独立的功能都需要独立的去运行，这时又需要把当前这个进程划分成多个运行区域，每个独立的小区域（小单元）称为一个线程。\n\n线程：它是位于进程中，负责当前进程中的某个具备独立运行资格的空间。  \n进程是负责整个程序的运行，而线程是程序中具体的某个独立功能的运行。一个进程中至少应该有一个线程。\n\n## 多线程介绍\n多线程：<font color=\"red\">在一个进程中，我们同时开启多个线程，让多个线程同时去完成某些任务（功能）。\n(比如后台服务系统，就可以用多个线程同时响应多个客户的请求)</font>  \n多线程的目的：提高程序的运行效率。\n\n## 多线程运行的原理\n\ncpu在线程中做时间片的切换。\n\n其实真正电脑中的程序的运行不是同时在运行的。CPU负责程序的运行，而CPU在运行程序的过程中某个时刻点上，它其实只能运行一个程序。而不是多个程序。而CPU它可以在多个程序之间进行高速的切换。而切换频率和速度太快，导致人的肉眼看不到。  \n每个程序就是进程， 而每个进程中会有多个线程，而CPU是在这些线程之间进行切换。  \n了解了CPU对一个任务的执行过程，我们就必须知道，多线程可以提高程序的运行效率，但不能无限制的开线程。  \n\n## 实现线程的两种方式\n### 继承Thread的方式  \n```java\npackage cn.itcast_01_mythread.thread.testThread;\nimport java.util.Random;\npublic class MyThreadWithExtends extends Thread {\n\tString flag;\n\tpublic MyThreadWithExtends(String flag){\n\t\tthis.flag = flag;\n\t}\n\t@Override\n\tpublic void run() {\n\t\tString tname = Thread.currentThread().getName();\n\t\tSystem.out.println(tname+\"线程的run方法被调用……\");\n\t\tRandom random = new Random();\n\t\tfor(int i=0;i<20;i++){\n\t\t\ttry {\n\t\t\t\tThread.sleep(random.nextInt(10)*100);\n\t\t\t\tSystem.out.println(tname+ \"....\"+ flag);\n\t\t\t} catch (InterruptedException e) {\n\t\t\t\te.printStackTrace();\n\t\t\t}\n\t\t}\n\t}\n\n\tpublic static void main(String[] args) {\n\t\tThread thread1 = new MyThreadWithExtends(\"a\");\n\t\tThread thread2 = new MyThreadWithExtends(\"b\");\n\t\tthread1.start();\n\t\tthread2.start();\n\t\t/**\n\t\t * 如果是调用thread的run方法，则只是一个普通的方法调用，不会开启新的线程\n\t\t */\n//\t\tthread1.run();\n//\t\tthread2.run();\n\t}\n}\n```\n### 声明实现 Runnable 接口的方式  \n```java\npackage cn.itcast_01_mythread.thread.testThread;\npublic class MyThreadWithImpliment implements Runnable {\n\tint x;\n\tpublic MyThreadWithImpliment(int x) {\n\t\tthis.x = x;\n\t}\n\t@Override\n\tpublic void run() {\n\t\tString name = Thread.currentThread().getName();\n\t\tSystem.out.println(\"线程\" + name + \"的run方法被调用……\");\n\t\tfor (int i = 0; i < 10; i++) {\n\t\t\tSystem.out.println(x);\n\t\t\ttry {\n\t\t\t\tThread.sleep(100);\n\t\t\t\t\n\t\t\t} catch (InterruptedException e) {\n\t\t\t\te.printStackTrace();\n\t\t\t}\n\t\t}\n\t}\n\tpublic static void main(String[] args) {\n\t\tThread thread1 = new Thread(new MyThreadWithImpliment(1), \"thread-1\");\n\t\tThread thread2 = new Thread(new MyThreadWithImpliment(2), \"thread-2\");\n\t\t thread1.start();\n\t\t thread2.start();\n\t\t// 注意调用run和调用start的区别,直接调用run，则都运行在main线程中\n//\t\tthread1.run();\n//\t\tthread2.run();\n\t}\n}\n```\n#  java同步关键词解释\n##  synchronized\n### 加同步格式：\n```\nsynchronized( 需要一个任意的对象（锁） ){\n\t代码块中放操作共享数据的代码。\n}\n```\n```java\npackage cn.itcast_01_mythread.thread.testThread;\npublic class MySynchronized {\n\tpublic static void main(String[] args) {\n\t\tfinal MySynchronized mySynchronized = new MySynchronized();\n\t\tfinal MySynchronized mySynchronized2 = new MySynchronized();\n\t\tnew Thread(\"thread1\") {\n\t\t\tpublic void run() {\n\t\t\t\tsynchronized (mySynchronized) {\n\t\t\t\ttry {\n\t\t\t\t\tSystem.out.println(this.getName()+\" start\");\n\t\t\t\t\tint i =1/0;   //如果发生异常，jvm会将锁释放\n\t\t\t\t\tThread.sleep(5000);\n\t\t\t\t\tSystem.out.println(this.getName()+\"醒了\");\n\t\t\t\t\tSystem.out.println(this.getName()+\" end\");\n\t\t\t\t} catch (InterruptedException e) {\n\t\t\t\t\te.printStackTrace();\n\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}.start();\n\t\tnew Thread(\"thread2\") {\n\t\t\tpublic void run() {\n\t\t\t\tsynchronized (mySynchronized) {         //争抢同一把锁时，线程1没释放之前，线程2只能等待\n//\t\t\t\t\tsynchronized (mySynchronized2) {    //如果不是一把锁，可以看到两句话同时打印\n\t\t\t\t\tSystem.out.println(this.getName()+\" start\");\n\t\t\t\t\tSystem.out.println(this.getName()+\" end\");\n\t\t\t\t\t\n\t\t\t\t}\n\t\t\t}\n\t\t}.start();\n\t}\n}\n```\n### synchronized的缺陷\nsynchronized是java中的一个关键字，也就是说是Java语言内置的特性。  \n如果一个代码块被synchronized修饰了，当一个线程获取了对应的锁，并执行该代码块时，其他线程便只能一直等待，等待获取锁的线程释放锁，而这里获取锁的线程释放锁只会有两种情况：\n1. 获取锁的线程执行完了该代码块，然后线程释放对锁的占有；\n2. 线程执行发生异常，此时JVM会让线程自动释放锁。\n\n例子1：  \n如果这个获取锁的线程由于要等待IO或者其他原因（比如调用sleep方法）被阻塞了，但是又没有释放锁，其他线程便只能干巴巴地等待，试想一下，这多么影响程序执行效率。\n因此就需要有一种机制<font color=\"red\">可以不让等待的线程一直无期限地等待下去（比如只等待一定的时间或者能够响应中断），通过Lock就可以办到。</font>\n\n例子2：  \n当有多个线程读写文件时，读操作和写操作会发生冲突现象，写操作和写操作会发生冲突现象，但是读操作和读操作不会发生冲突现象。  \n但是采用synchronized关键字来实现同步的话，就会导致一个问题：  \n如果多个线程都只是进行读操作，当一个线程在进行读操作时，其他线程只能等待无法进行读操作。  \n \n因此就需要一种机制来使得多个线程都只是进行读操作时，线程之间不会发生冲突，通过Lock就可以办到。  \n另外，通过Lock可以知道线程有没有成功获取到锁。这个是synchronized无法办到的。  \n总的来说，也就是说Lock提供了比synchronized更多的功能。  \n\n## lock\n###  lock和synchronized的区别\n1. Lock不是Java语言内置的，synchronized是Java语言的关键字，因此是内置特性。Lock是一个类，通过这个类可以实现同步访问；\n2. Lock和synchronized有一点非常大的不同，采用synchronized不需要用户去手动释放锁，当synchronized方法或者synchronized代码块执行完之后，系统会自动让线程释放对锁的占用；而Lock则必须要用户去手动释放锁，如果没有主动释放锁，就有可能导致出现死锁现象。\n### java.util.concurrent.locks包下常用的类\n#### Lock         \n首先要说明的就是Lock，通过查看Lock的源码可知，Lock是一个接口：\n```java\npublic interface Lock {\n    void lock();\n    void lockInterruptibly() throws InterruptedException;\n    boolean tryLock();\n    boolean tryLock(long time, TimeUnit unit) throws InterruptedException;\n    void unlock();\n}\n```\n获取锁：lock()，lockInterruptibly()， tryLock()，tryLock(long time, TimeUnit unit)  \n释放锁：unlock()\n\n区别： \n- lock()  \n平常使用得最多的一个方法，就是用来获取锁。如果锁已被其他线程获取，则进行等待。  \n由于在前面讲到如果采用Lock，必须主动去释放锁，并且在发生异常时，不会自动释放锁。因此一般来说，使用Lock必须在try{}catch{}块中进行，并且将释放锁的操作放在finally块中进行，以保证锁一定被被释放，防止死锁的发生。\n\n- tryLock()  \n有返回值的，它表示用来尝试获取锁，如果获取成功，则返回true，如果获取失败（即锁已被其他线程获取），则返回false，也就说这个方法无论如何都会立即返回。在拿不到锁时不会一直在那等待。\n\n- tryLock(long time, TimeUnit unit)  \n和tryLock()方法是类似的，只不过区别在于这个方法在拿不到锁时会等待一定的时间，在时间期限之内如果还拿不到锁，就返回false。如果如果一开始拿到锁或者在等待期间内拿到了锁，则返回true。\n\n- lockInterruptibly()  \n比较特殊，当通过这个方法去获取锁时，如果线程正在等待获取锁，则这个线程能够响应中断，即中断线程的等待状态。也就使说，当两个线程同时通过lock.lockInterruptibly()想获取某个锁时，假若此时线程A获取到了锁，而线程B只有等待，那么对线程B调用threadB.interrupt()方法能够中断线程B的等待过程。  \n注意，当一个线程获取了锁之后，是不会被interrupt()方法中断的。  \n因此当通过lockInterruptibly()方法获取某个锁时，如果不能获取到，只有进行等待的情况下，是可以响应中断的。  \n而用synchronized修饰的话，当一个线程处于等待某个锁的状态，是无法被中断的，只有一直等待下去。  \n\n#### ReentrantLock\n直接使用lock接口的话，我们需要实现很多方法，不太方便，ReentrantLock是唯一实现了Lock接口的类，并且ReentrantLock提供了更多的方法，ReentrantLock，意思是“可重入锁”。\n- lock()的正确使用方法\n```java\npackage cn.itcast_01_mythread.thread.lock;\nimport java.util.ArrayList;\nimport java.util.concurrent.locks.Lock;\nimport java.util.concurrent.locks.ReentrantLock;\npublic class MyLockTest {\n\tprivate static ArrayList<Integer> arrayList = new ArrayList<Integer>();\n\tstatic Lock lock = new ReentrantLock(); // 注意这个地方\n\tpublic static <E> void main(String[] args) {\n\t\tnew Thread() {\n\t\t\tpublic void run() {\n\t\t\t\tThread thread = Thread.currentThread();\n\t\t\t\tlock.lock();\n\t\t\t\ttry {\n\t\t\t\t\tSystem.out.println(thread.getName() + \"得到了锁\");\n\t\t\t\t\tfor (int i = 0; i < 5; i++) {\n\t\t\t\t\t\tarrayList.add(i);\n\t\t\t\t\t}\n\t\t\t\t} catch (Exception e) {\n\t\t\t\t\t// TODO: handle exception\n\t\t\t\t} finally {\n\t\t\t\t\tSystem.out.println(thread.getName() + \"释放了锁\");\n\t\t\t\t\tlock.unlock();\n\t\t\t\t}\n\t\t\t};\n\t\t}.start();\n\t\t\n\t\tnew Thread() {\n\t\t\tpublic void run() {\n\t\t\t\tThread thread = Thread.currentThread();\n\t\t\t\tlock.lock();\n\t\t\t\ttry {\n\t\t\t\t\tSystem.out.println(thread.getName() + \"得到了锁\");\n\t\t\t\t\tfor (int i = 0; i < 5; i++) {\n\t\t\t\t\t\tarrayList.add(i);\n\t\t\t\t\t}\n\t\t\t\t} catch (Exception e) {\n\t\t\t\t\t// TODO: handle exception\n\t\t\t\t} finally {\n\t\t\t\t\tSystem.out.println(thread.getName() + \"释放了锁\");\n\t\t\t\t\tlock.unlock();\n\t\t\t\t}\n\n\t\t\t};\n\t\t}.start();\n\t}\n}\n```\n- tryLock()的使用方法\n```java\npackage cn.itcast_01_mythread.thread.lock;\nimport java.util.ArrayList;\nimport java.util.concurrent.locks.Lock;\nimport java.util.concurrent.locks.ReentrantLock;\n/**\n * 观察现象：一个线程获得锁后，另一个线程取不到锁，不会一直等待\n * @author\n *\n */\npublic class MyTryLock {\n\tprivate static ArrayList<Integer> arrayList = new ArrayList<Integer>();\n\tstatic Lock lock = new ReentrantLock(); // 注意这个地方\n\tpublic static void main(String[] args) {\n\t\tnew Thread() {\n\t\t\tpublic void run() {\n\t\t\t\tThread thread = Thread.currentThread();\n\t\t\t\tboolean tryLock = lock.tryLock();\n\t\t\t\tSystem.out.println(thread.getName()+\" \"+tryLock);\n\t\t\t\tif (tryLock) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tSystem.out.println(thread.getName() + \"得到了锁\");\n\t\t\t\t\t\tfor (int i = 0; i < 5; i++) {\n\t\t\t\t\t\t\tarrayList.add(i);\n\t\t\t\t\t\t}\n\t\t\t\t\t} catch (Exception e) {\n\t\t\t\t\t\t// TODO: handle exception\n\t\t\t\t\t} finally {\n\t\t\t\t\t\tSystem.out.println(thread.getName() + \"释放了锁\");\n\t\t\t\t\t\tlock.unlock();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\t\t}.start();\n\n\t\tnew Thread() {\n\t\t\tpublic void run() {\n\t\t\t\tThread thread = Thread.currentThread();\n\t\t\t\tboolean tryLock = lock.tryLock();\n\t\t\t\tSystem.out.println(thread.getName()+\" \"+tryLock);\n\t\t\t\tif (tryLock) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tSystem.out.println(thread.getName() + \"得到了锁\");\n\t\t\t\t\t\tfor (int i = 0; i < 5; i++) {\n\t\t\t\t\t\t\tarrayList.add(i);\n\t\t\t\t\t\t}\n\t\t\t\t\t} catch (Exception e) {\n\t\t\t\t\t\t// TODO: handle exception\n\t\t\t\t\t} finally {\n\t\t\t\t\t\tSystem.out.println(thread.getName() + \"释放了锁\");\n\t\t\t\t\t\tlock.unlock();\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t};\n\t\t}.start();\n\t}\n}\n```\n- lockInterruptibly()响应中断的使用方法：\n```java\npackage cn.itcast_01_mythread.thread.lock;\nimport java.util.concurrent.locks.Lock;\nimport java.util.concurrent.locks.ReentrantLock;\n/**\n * 观察现象：如果thread-0得到了锁，阻塞。。。thread-1尝试获取锁，如果拿不到，则可以被中断等待\n * @author\n *\n */\npublic class MyInterruptibly {\n\t private Lock lock = new ReentrantLock();  \n\t    public static void main(String[] args)  {\n\t    \tMyInterruptibly test = new MyInterruptibly();\n\t        MyThread thread0 = new MyThread(test);\n\t        MyThread thread1 = new MyThread(test);\n\t        thread0.start();\n\t        thread1.start();\n\t         \n\t        try {\n\t            Thread.sleep(2000);\n\t        } catch (InterruptedException e) {\n\t            e.printStackTrace();\n\t        }\n\t        thread1.interrupt();\n\t        System.out.println(\"=====================\");\n\t    }  \n\t     \n\t    public void insert(Thread thread) throws InterruptedException{\n\t        lock.lockInterruptibly();   //注意，如果需要正确中断等待锁的线程，必须将获取锁放在外面，然后将InterruptedException抛出\n\t        try {  \n\t            System.out.println(thread.getName()+\"得到了锁\");\n\t            long startTime = System.currentTimeMillis();\n\t            for(    ;     ;) {\n\t                if(System.currentTimeMillis() - startTime >= Integer.MAX_VALUE)\n\t                    break;\n\t                //插入数据\n\t            }\n\t        }\n\t        finally {\n\t            System.out.println(Thread.currentThread().getName()+\"执行finally\");\n\t            lock.unlock();\n\t            System.out.println(thread.getName()+\"释放了锁\");\n\t        }  \n\t    }\n\t}\n\t \n\tclass MyThread extends Thread {\n\t    private MyInterruptibly test = null;\n\t    public MyThread(MyInterruptibly test) {\n\t        this.test = test;\n\t    }\n\t    @Override\n\t    public void run() {\n\t         \n\t        try {\n\t            test.insert(Thread.currentThread());\n\t        } catch (Exception e) {\n\t            System.out.println(Thread.currentThread().getName()+\"被中断\");\n\t        }\n\t    }\n}\n```\n#### ReadWriteLock\nReadWriteLock也是一个接口，在它里面只定义了两个方法：\n```java\npublic interface ReadWriteLock {\n    /**\n     * Returns the lock used for reading.\n     *\n     * @return the lock used for reading.\n     */\n    Lock readLock();\n \n    /**\n     * Returns the lock used for writing.\n     *\n     * @return the lock used for writing.\n     */\n    Lock writeLock();\n}\n```\n一个用来获取读锁，一个用来获取写锁。也就是说将文件的读写操作分开，分成2个锁来分配给线程，从而使得多个线程可以同时进行读操作。下面的ReentrantReadWriteLock实现了ReadWriteLock接口。\n#### ReentrantReadWriteLock\nReentrantReadWriteLock里面提供了很多丰富的方法，不过最主要的有两个方法：readLock()和writeLock()用来获取读锁和写锁。\n\nReentrantReadWriteLock具体用法\n\n假如有多个线程要同时进行读操作的话，先看一下synchronized达到的效果\n```java\npackage cn.itcast_01_mythread.thread.lock;\n/**\n * 一个线程又要读又要写，用synchronize来实现的话，读写操作都只能锁住后一个线程一个线程地进行\n * @author\n *\n */\npublic class MySynchronizedReadWrite {\n    \n    public static void main(String[] args)  {\n        final MySynchronizedReadWrite test = new MySynchronizedReadWrite();\n         \n        new Thread(){\n            public void run() {\n                test.get(Thread.currentThread());\n            };\n        }.start();\n         \n        new Thread(){\n            public void run() {\n                test.get(Thread.currentThread());\n            };\n        }.start();\n         \n    }  \n     \n    public synchronized void get(Thread thread) {\n        long start = System.currentTimeMillis();\n        int i=0;\n        while(System.currentTimeMillis() - start <= 1) {\n        \ti++;\n        \tif(i%4==0){\n            System.out.println(thread.getName()+\"正在进行写操作\");\n        \t}else {\n        \t\tSystem.out.println(thread.getName()+\"正在进行读操作\");\t\n\t\t\t}\n        }\n        System.out.println(thread.getName()+\"读写操作完毕\");\n    }\n}\n```\n改成用读写锁的话：\n```java\npackage cn.itcast_01_mythread.thread.lock;\nimport java.util.concurrent.locks.ReentrantReadWriteLock;\n/**\n * 使用读写锁，可以实现读写分离锁定，读操作并发进行，写操作锁定单个线程\n * \n * 如果有一个线程已经占用了读锁，则此时其他线程如果要申请写锁，则申请写锁的线程会一直等待释放读锁。\n * 如果有一个线程已经占用了写锁，则此时其他线程如果申请写锁或者读锁，则申请的线程会一直等待释放写锁。\n * @author\n *\n */\npublic class MyReentrantReadWriteLock {\n\t private ReentrantReadWriteLock rwl = new ReentrantReadWriteLock();\n     \n\t    public static void main(String[] args)  {\n\t        final MyReentrantReadWriteLock test = new MyReentrantReadWriteLock();\n\t         \n\t        new Thread(){\n\t            public void run() {\n\t                test.get(Thread.currentThread());\n\t                test.write(Thread.currentThread());\n\t            };\n\t        }.start();\n\t         \n\t        new Thread(){\n\t            public void run() {\n\t                test.get(Thread.currentThread());\n\t                test.write(Thread.currentThread());\n\t            };\n\t        }.start();\n\t    }  \n\t    \n\t    /**\n\t     * 读操作,用读锁来锁定\n\t     * @param thread\n\t     */\n\t    public void get(Thread thread) {\n\t        rwl.readLock().lock();\n\t        try {\n\t            long start = System.currentTimeMillis();\n\t             \n\t            while(System.currentTimeMillis() - start <= 1) {\n\t                System.out.println(thread.getName()+\"正在进行读操作\");\n\t            }\n\t            System.out.println(thread.getName()+\"读操作完毕\");\n\t        } finally {\n\t            rwl.readLock().unlock();\n\t        }\n\t    }\n\n\t    /**\n\t     * 写操作，用写锁来锁定\n\t     * @param thread\n\t     */\n\t    public void write(Thread thread) {\n\t        rwl.writeLock().lock();;\n\t        try {\n\t            long start = System.currentTimeMillis();\n\t            while(System.currentTimeMillis() - start <= 1) {\n\t                System.out.println(thread.getName()+\"正在进行写操作\");\n\t            }\n\t            System.out.println(thread.getName()+\"写操作完毕\");\n\t        } finally {\n\t            rwl.writeLock().unlock();\n\t        }\n\t    }\n}\n\n```\n> 注意：\n- 不过要注意的是，如果有一个线程已经占用了读锁，则此时其他线程如果要申请写锁，则申请写锁的线程会一直等待释放读锁。\n- 如果有一个线程已经占用了写锁，则此时其他线程如果申请写锁或者读锁，则申请的线程会一直等待释放写锁。\n\n\n## Lock和synchronized的选择\n1. Lock是一个接口，而synchronized是Java中的关键字，synchronized是内置的语言实现；\n2. synchronized在发生异常时，会自动释放线程占有的锁，因此不会导致死锁现象发生；而Lock在发生异常时，如果没有主动通过unLock()去释放锁，则很可能造成死锁现象，因此使用Lock时需要在finally块中释放锁；\n3. Lock可以让等待锁的线程响应中断，而synchronized却不行，使用synchronized时，等待的线程会一直等待下去，不能够响应中断；\n4. 通过Lock可以知道有没有成功获取锁，而synchronized却无法办到。\n5. Lock可以提高多个线程进行读操作的效率。\n\n在性能上来说，如果竞争资源不激烈，两者的性能是差不多的，而当竞争资源非常激烈时（即有大量线程同时竞争），此时Lock的性能要远远优于synchronized。所以说，在具体使用时要根据适当情况选择。\n\n# java并发包\n## java并发包介绍\nJDK5.0 以后的版本都引入了高级并发特性，大多数的特性在java.util.concurrent 包中，是专门用于多线程发编程的，充分利用了现代多处理器和多核心系统的功能以编写大规模并发应用程序。主要包含<font color=\"red\">原子量、并发集合、同步器、</font>可重入锁，并对线程池的构造提供了强力的支持。\n\n### 线程池\n#### 创建方式\n五种创建方式\n##### Single Thread Executor \n只有一个线程的线程池，因此所有提交的任务是顺序执行  \n```Executors.newSingleThreadExecutor()```\n\n##### Cached Thread Pool \n线程池里有很多线程需要同时执行，老的可用线程将被新的任务触发重新执行，<font color=\"red\">如果线程超过60秒内没执行，那么将被终止并从池中删除</font>  \n```Executors.newCachedThreadPool()```\n\n##### Fixed Thread Pool \n\n<font color=\"red\">拥有固定线程数的线程池，如果没有任务执行，那么线程会一直等待</font>  \n```Executors.newFixedThreadPool(4)```  \n在构造函数中的参数4是线程池的大小，你可以随意设置，也可以和cpu的核数量保持一致，获取cpu的核数量  \n```int cpuNums = Runtime.getRuntime().availableProcessors();```\n\n##### Scheduled Thread Pool \n用来调度即将执行的任务的线程池，可能是不是直接执行, 每隔多久执行一次... 策略型的  \n```Executors.newScheduledThreadPool()```\n\n##### Single Thread Scheduled Pool \n只有一个线程，用来调度任务在指定时间执行\n```Executors.newSingleThreadScheduledExecutor()```\n### 线程池的使用\n提交 Runnable ，任务完成后 Future 对象返回 null   \n调用excute,提交任务, 匿名Runable重写run方法, run方法里是业务逻辑\n```java\npackage cn.itcast_01_mythread.pool;\nimport java.util.concurrent.ExecutorService;\nimport java.util.concurrent.Executors;\npublic class ThreadPoolWithRunable {\n\t/**\n\t * 通过线程池执行线程\n\t * @param args\n\t */\n\tpublic static void main(String[] args) {\n\t\t//创建一个线程池\n\t\tExecutorService pool = Executors.newCachedThreadPool();\n\t\tfor(int i = 1; i < 5; i++){\n\t\t\tpool.execute(new Runnable() {\n\t\t\t\t@Override\n\t\t\t\tpublic void run() {\n\t\t\t\t\tSystem.out.println(\"thread name: \" + Thread.currentThread().getName());\n\t\t\t\t\ttry {\n\t\t\t\t\t\tThread.sleep(1000);\n\t\t\t\t\t} catch (InterruptedException e) {\n\t\t\t\t\t\te.printStackTrace();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\tpool.shutdown();\n\t}\n}\n```\n\n提交 Callable，该方法返回一个 Future 实例表示任务的状态  \n调用submit提交任务, 匿名Callable,重写call方法, 有返回值, 获取返回值会阻塞,一直要等到线程任务返回结果  \n```java\npackage cn.itcast_01_mythread.pool;\n\nimport java.util.ArrayList;\nimport java.util.List;\nimport java.util.concurrent.Callable;\nimport java.util.concurrent.ExecutionException;\nimport java.util.concurrent.ExecutorService;\nimport java.util.concurrent.Executors;\nimport java.util.concurrent.Future;\n/**\n * callable 跟runnable的区别：\n * runnable的run方法不会有任何返回结果，所以主线程无法获得任务线程的返回值\n * \n * callable的call方法可以返回结果，但是主线程在获取时是被阻塞，需要等待任务线程返回才能拿到结果\n * @author\n *\n */\npublic class ThreadPoolWithcallable {\n\n\tpublic static void main(String[] args) throws InterruptedException, ExecutionException {\n\t\tExecutorService pool = Executors.newFixedThreadPool(4); \n\t\t\n\t\tfor(int i = 0; i < 10; i++){\n\t\t\tFuture<String> submit = pool.submit(new Callable<String>(){\n\t\t\t\t@Override\n\t\t\t\tpublic String call() throws Exception {\n\t\t\t\t\t//System.out.println(\"a\");\n\t\t\t\t\tThread.sleep(5000);\n\t\t\t\t\treturn \"b--\"+Thread.currentThread().getName();\n\t\t\t\t}\t\t\t   \n\t\t\t   });\n\t\t\t//从Future中get结果，这个方法是会被阻塞的，一直要等到线程任务返回结果\n\t\t\tSystem.out.println(submit.get());\n\t\t} \n\t\t\tpool.shutdown();\n\n\t}\n\n}\n```\n\n## java并发包消息队列及在开源软件中的应用\n### BlockingQueue\n也是java.util.concurrent下的主要用来<font color=\"red\">控制线程同步的工具</font>。  \n主要的方法是：put、take一对阻塞存取；add、poll一对非阻塞存取。  \n- 插入:\n\t1. add(anObject):把anObject加到BlockingQueue里,即如果BlockingQueue可以容纳,则返回true,否则抛出异常,不好\n\t1. offer(anObject):表示如果可能的话,将anObject加到BlockingQueue里,即如果BlockingQueue可以容纳,则返回true,否则返回false.\n\t1. put(anObject):把anObject加到BlockingQueue里,如果BlockQueue没有空间,则调用此方法的线程被阻断直到BlockingQueue里面有空间再继续, 有阻塞, 放不进去就等待\n- 读取：\n\t1. poll(time):取走BlockingQueue里排在首位的对象,若不能立即取出,则可以等time参数规定的时间,取不到时返回null; 取不到返回null\n\t1. take():取走BlockingQueue里排在首位的对象,若BlockingQueue为空,阻断进入等待状态直到Blocking有新的对象被加入为止; <font color=\"red\">阻塞, 取不到就一直等</font>\n- 其他\n\t1. int remainingCapacity();返回队列剩余的容量，在队列插入和获取的时候，<font color=\"red\">不要瞎搞，数据可能不准, 不能保证数据的准确性</font>\n\t2. boolean remove(Object o); 从队列移除元素，如果存在，即移除一个或者更多，队列改\t变了返回true\n\t3. public boolean contains(Object o); 查看队列是否存在这个元素，存在返回true\n\t4. int drainTo(Collection<? super E> c); //移除此队列中所有可用的元素,并将它们添加到给定 collection 中。<font color=\"red\">取出放到集合中</font>\n\t5. int drainTo(Collection<? super E> c, int maxElements); 和上面方法的区别在于，指定了移动的数量;取出指定个数放到集合\n\nBlockingQueue有四个具体的实现类,常用的两种实现类为：\n\n### ArrayBlockingQueue\n一个由数组支持的有界阻塞队列，规定大小的BlockingQueue,其构造函数必须带一个int参数来指明其大小.其所含的对象是以FIFO(先入先出)顺序排序的。\n\n### LinkedBlockingQueue\n大小不定的BlockingQueue,若其构造函数带一个规定大小的参数,生成的BlockingQueue有大小限制,若不带大小参数,所生成的BlockingQueue的大小由Integer.MAX_VALUE来决定.其所含的对象是以FIFO(先入先出)顺序排序的。 \nLinkedBlockingQueue 可以指定容量，也可以不指定，不指定的话，默认最大是Integer.MAX_VALUE,其中主要用到put和take方法，put方法在队列满的时候会阻塞直到有队列成员被消费，take方法在队列空的时候会阻塞，直到有队列成员被放进来。\n\n### LinkedBlockingQueue和ArrayBlockingQueue区别\n\nLinkedBlockingQueue和ArrayBlockingQueue比较起来,它们背后所用的数据结构不一样,导致LinkedBlockingQueue的数据吞吐量要大于ArrayBlockingQueue,但在线程数量很大时其性能的可预见性低于ArrayBlockingQueue.\n\n生产者消费者的示例代码：\n```java\npackage cn.itcast_02_blockingqueue.main;\nimport java.util.concurrent.BlockingQueue;\nimport java.util.concurrent.LinkedBlockingQueue;\nimport cn.itcast_02_blockingqueue.consumer.Consumer;\nimport cn.itcast_02_blockingqueue.producer.Producer;\npublic class Test {\n\tpublic static void main(String[] args) throws Exception {\n\t\tBlockingQueue<String> queue = new LinkedBlockingQueue<String>(2);\n\t\t// BlockingQueue<String> queue = new LinkedBlockingQueue<String>();\n\t\t// 不设置的话，LinkedBlockingQueue默认大小为Integer.MAX_VALUE\n\t\t// BlockingQueue<String> queue = new ArrayBlockingQueue<String>(2);\n\t\tConsumer consumer = new Consumer(queue);\n\t\tProducer producer = new Producer(queue);\n\t\tfor (int i = 0; i < 3; i++) {\n\t\t\tnew Thread(producer, \"Producer\" + (i + 1)).start();\n\t\t}\n\t\tfor (int i = 0; i < 5; i++) {\n\t\t\tnew Thread(consumer, \"Consumer\" + (i + 1)).start();\n\t\t}\n\t\tnew Thread(producer, \"Producer\" + (5)).start();\n\t}\n}\n\n=====================================================================\npackage cn.itcast_02_blockingqueue.main;\nimport java.util.concurrent.BlockingQueue;\nimport java.util.concurrent.LinkedBlockingQueue;\npublic class TestBlockingQueue {\n\tpublic static void main(String[] args) {\n\t\tBlockingQueue<String> queue = new LinkedBlockingQueue<String>(2);\n\t\t// BlockingQueue<String> queue = new LinkedBlockingQueue<String>();\n\t\t// 不设置的话，LinkedBlockingQueue默认大小为Integer.MAX_VALUE\n\t\t// BlockingQueue<String> queue = new ArrayBlockingQueue<String>(2);\n\t\tTestBlockingQueueConsumer consumer = new TestBlockingQueueConsumer(queue);\n\t\tTestBlockingQueueProducer producer = new TestBlockingQueueProducer(queue);\n\t\tfor (int i = 0; i < 3; i++) {\n\t\t\tnew Thread(producer, \"Producer\" + (i + 1)).start();\n\t\t}\n\t\tfor (int i = 0; i < 5; i++) {\n\t\t\tnew Thread(consumer, \"Consumer\" + (i + 1)).start();\n\t\t}\n\t\tnew Thread(producer, \"Producer\" + (5)).start();\n\t}\n}\n=====================================================================\npackage cn.itcast_02_blockingqueue.main;\nimport java.util.Random;\nimport java.util.concurrent.BlockingQueue;\npublic class TestBlockingQueueConsumer implements Runnable{  \n    BlockingQueue<String> queue; \n    Random random = new Random();\n    public TestBlockingQueueConsumer(BlockingQueue<String> queue){  \n        this.queue = queue;  \n    }        \n    @Override  \n    public void run() {  \n        try {  \n        \tThread.sleep(random.nextInt(10));\n        \tSystem.out.println(Thread.currentThread().getName()+ \"trying...\");\n            String temp = queue.take();//如果队列为空，会阻塞当前线程  \n            System.out.println(Thread.currentThread().getName() + \" get a job \" +temp);  \n        } catch (InterruptedException e) {  \n            e.printStackTrace();  \n        }  \n    }  \n}\n=====================================================================\npackage cn.itcast_02_blockingqueue.main;\nimport java.util.Random;\nimport java.util.concurrent.BlockingQueue;\npublic class TestBlockingQueueProducer implements Runnable {\n\tBlockingQueue<String> queue;\n\tRandom random = new Random();\n\tpublic TestBlockingQueueProducer(BlockingQueue<String> queue) {\n\t\tthis.queue = queue;\n\t}\n\t@Override\n\tpublic void run() {\n\t\tfor (int i = 0; i < 10; i++) {\n\t\t\ttry {\n\t\t\t\tThread.sleep(random.nextInt(10));\n\t\t\t\tString task = Thread.currentThread().getName() + \" made a product \" + i;\n\t\t\t\tSystem.out.println(task);\n\t\t\t\tqueue.put(task);\n\t\t\t} catch (InterruptedException e) {\n\t\t\t\te.printStackTrace();\n\t\t\t}\n\t\t}\n\t}\n\n}\n\n=====================================================================\npackage cn.itcast_02_blockingqueue.producer;\nimport java.util.concurrent.BlockingQueue;\npublic class Producer implements Runnable {  \n    BlockingQueue<String> queue;    \n    public Producer(BlockingQueue<String> queue) {  \n        this.queue = queue;  \n    }    \n    @Override  \n    public void run() {  \n        try {  \n            \n            System.out.println(\"I have made a product:\"  \n                    + Thread.currentThread().getName()); \n            String temp = \"A Product, 生产线程：\"  \n                    + Thread.currentThread().getName();  \n            queue.put(temp);//如果队列是满的话，会阻塞当前线程  \n        } catch (InterruptedException e) {  \n            e.printStackTrace();  \n        }  \n    }    \n}  \n=====================================================================\npackage cn.itcast_02_blockingqueue.consumer;\nimport java.util.concurrent.BlockingQueue;\npublic class Consumer implements Runnable{  \n    BlockingQueue<String> queue; \n    public Consumer(BlockingQueue<String> queue){  \n        this.queue = queue;  \n    }        \n    @Override  \n    public void run() {  \n        try {  \n        \tString consumer = Thread.currentThread().getName();\n        \tSystem.out.println(consumer);  \n            String temp = queue.take();//如果队列为空，会阻塞当前线程  \n            System.out.println(consumer+\"get a product:\"+temp);  \n        } catch (InterruptedException e) {  \n            e.printStackTrace();  \n        }  \n    }  \n}  \n\n\n```\n#  java并发编程的一些总结\n## 不应用线程池的缺点\n有些开发者图省事，遇到需要多线程处理的地方，直接new Thread(...).start()，对于一般场景是没问题的，但如果是在并发请求很高的情况下，就会有些隐患：\n- 新建线程的开销。线程虽然比进程要轻量许多，但对于JVM来说，新建一个线程的代价还是挺大的，决不同于新建一个对象\n- 资源消耗量。没有一个池来限制线程的数量，会导致线程的数量直接取决于应用的并发量，这样有潜在的线程数据巨大的可能，那么资源消耗量将是巨大的\n- 稳定性。当线程数量超过系统资源所能承受的程度，稳定性就会成问题\n## 制定执行策略\n在每个需要多线程处理的地方，不管并发量有多大，需要考虑线程的执行策略\n- 任务以什么顺序执行\n- 可以有多少个任务并发执行\n- 可以有多少个任务进入等待执行队列\n- 系统过载的时候，应该放弃哪些任务？如何通知到应用程序？\n- 一个任务的执行前后应该做什么处理\n\n## 线程池的类型\n不管是通过Executors创建线程池，还是通过Spring来管理，都得清楚知道有哪几种线程池：\n- FixedThreadPool：定长线程池，提交任务时创建线程，直到池的最大容量，如果有线程非预期结束，会补充新线程\n- CachedThreadPool：可变线程池，它犹如一个弹簧，如果没有任务需求时，它回收空闲线程，如果需求增加，则按需增加线程，不对池的大小做限制\n- SingleThreadExecutor：单线程。处理不过来的任务会进入FIFO队列等待执行\n- SecheduledThreadPool：周期性线程池。支持执行周期性线程任务\n其实，这些不同类型的线程池都是通过构建一个ThreadPoolExecutor来完成的，所不同的是corePoolSize,maximumPoolSize,keepAliveTime,unit,workQueue,threadFactory这么几个参数。具体可以参见JDK DOC。\n\n## 线程池饱和策略\n由以上线程池类型可知，除了CachedThreadPool其他线程池都有饱和的可能，当饱和以后就需要相应的策略处理请求线程的任务，比如，达到上限时通过ThreadPoolExecutor.setRejectedExecutionHandler方法设置一个拒绝任务的策略，JDK提供了AbortPolicy、CallerRunsPolicy、DiscardPolicy、DiscardOldestPolicy几种策略，具体差异可见JDK DOC\n\n## 线程无依赖性\n<font color=\"red\">多线程任务设计上尽量使得各任务是独立无依赖的</font>，所谓依赖性可两个方面：\n- 线程之间的依赖性。如果线程有依赖可能会造成死锁或饥饿\n- 调用者与线程的依赖性。调用者得监视线程的完成情况，影响可并发量\n当然，在有些业务里确实需要一定的依赖性，比如调用者需要得到线程完成后结果，传统的Thread是不便完成的，因为run方法无返回值，只能通过一些共享的变量来传递结果，但在Executor框架里可以通过Future和Callable实现需要有返回值的任务，当然线程的异步性导致需要有相应机制来保证调用者能等待任务完成，关于Future和Callable的用法前文已讲解；\n","source":"_posts/大数据/大数据0401-java多线程并发.md","raw":"---\ntitle: 大数据0401-java多线程并发\ncategories: 学习\ntags:\n  - 大数据\n  - java\ntoc: true\ndate: 2017-12-01 22:59:38\nscaffolds:\n---\n\n内容包含\n\n1. 掌握多线程\n1. 掌握并发包下的队列\n\n做个笔记，方便查看\n<!-- more -->\n# java多线程增强\n\n## 进程介绍\n不管是我们开发的应用程序，还是我们运行的其他的应用程序，都需要先把程序安装在本地的硬盘上。然后找到这个程序的启动文件，启动程序的时候，其实是电脑把当前的这个程序加载到内存中，在<font color=\"red\">内存中需要给当前的程序分配一段独立的运行空间</font>。这片空间就专门负责当前这个程序的运行。  \n\n不同的应用程序运行的过程中都需要在内存中分配自己独立的运行空间，彼此之间不会相互的影响。我们把每个独立应用程序在内存的独立空间称为当前应用程序运行的一个进程。  \n\n进程：它是内存中的一段独立的空间，可以负责当前应用程序的运行。当前这个进程负责调度当前程序中的所有运行细节。\n\n## 线程介绍\n在一个进程中，每个独立的功能都需要独立的去运行，这时又需要把当前这个进程划分成多个运行区域，每个独立的小区域（小单元）称为一个线程。\n\n线程：它是位于进程中，负责当前进程中的某个具备独立运行资格的空间。  \n进程是负责整个程序的运行，而线程是程序中具体的某个独立功能的运行。一个进程中至少应该有一个线程。\n\n## 多线程介绍\n多线程：<font color=\"red\">在一个进程中，我们同时开启多个线程，让多个线程同时去完成某些任务（功能）。\n(比如后台服务系统，就可以用多个线程同时响应多个客户的请求)</font>  \n多线程的目的：提高程序的运行效率。\n\n## 多线程运行的原理\n\ncpu在线程中做时间片的切换。\n\n其实真正电脑中的程序的运行不是同时在运行的。CPU负责程序的运行，而CPU在运行程序的过程中某个时刻点上，它其实只能运行一个程序。而不是多个程序。而CPU它可以在多个程序之间进行高速的切换。而切换频率和速度太快，导致人的肉眼看不到。  \n每个程序就是进程， 而每个进程中会有多个线程，而CPU是在这些线程之间进行切换。  \n了解了CPU对一个任务的执行过程，我们就必须知道，多线程可以提高程序的运行效率，但不能无限制的开线程。  \n\n## 实现线程的两种方式\n### 继承Thread的方式  \n```java\npackage cn.itcast_01_mythread.thread.testThread;\nimport java.util.Random;\npublic class MyThreadWithExtends extends Thread {\n\tString flag;\n\tpublic MyThreadWithExtends(String flag){\n\t\tthis.flag = flag;\n\t}\n\t@Override\n\tpublic void run() {\n\t\tString tname = Thread.currentThread().getName();\n\t\tSystem.out.println(tname+\"线程的run方法被调用……\");\n\t\tRandom random = new Random();\n\t\tfor(int i=0;i<20;i++){\n\t\t\ttry {\n\t\t\t\tThread.sleep(random.nextInt(10)*100);\n\t\t\t\tSystem.out.println(tname+ \"....\"+ flag);\n\t\t\t} catch (InterruptedException e) {\n\t\t\t\te.printStackTrace();\n\t\t\t}\n\t\t}\n\t}\n\n\tpublic static void main(String[] args) {\n\t\tThread thread1 = new MyThreadWithExtends(\"a\");\n\t\tThread thread2 = new MyThreadWithExtends(\"b\");\n\t\tthread1.start();\n\t\tthread2.start();\n\t\t/**\n\t\t * 如果是调用thread的run方法，则只是一个普通的方法调用，不会开启新的线程\n\t\t */\n//\t\tthread1.run();\n//\t\tthread2.run();\n\t}\n}\n```\n### 声明实现 Runnable 接口的方式  \n```java\npackage cn.itcast_01_mythread.thread.testThread;\npublic class MyThreadWithImpliment implements Runnable {\n\tint x;\n\tpublic MyThreadWithImpliment(int x) {\n\t\tthis.x = x;\n\t}\n\t@Override\n\tpublic void run() {\n\t\tString name = Thread.currentThread().getName();\n\t\tSystem.out.println(\"线程\" + name + \"的run方法被调用……\");\n\t\tfor (int i = 0; i < 10; i++) {\n\t\t\tSystem.out.println(x);\n\t\t\ttry {\n\t\t\t\tThread.sleep(100);\n\t\t\t\t\n\t\t\t} catch (InterruptedException e) {\n\t\t\t\te.printStackTrace();\n\t\t\t}\n\t\t}\n\t}\n\tpublic static void main(String[] args) {\n\t\tThread thread1 = new Thread(new MyThreadWithImpliment(1), \"thread-1\");\n\t\tThread thread2 = new Thread(new MyThreadWithImpliment(2), \"thread-2\");\n\t\t thread1.start();\n\t\t thread2.start();\n\t\t// 注意调用run和调用start的区别,直接调用run，则都运行在main线程中\n//\t\tthread1.run();\n//\t\tthread2.run();\n\t}\n}\n```\n#  java同步关键词解释\n##  synchronized\n### 加同步格式：\n```\nsynchronized( 需要一个任意的对象（锁） ){\n\t代码块中放操作共享数据的代码。\n}\n```\n```java\npackage cn.itcast_01_mythread.thread.testThread;\npublic class MySynchronized {\n\tpublic static void main(String[] args) {\n\t\tfinal MySynchronized mySynchronized = new MySynchronized();\n\t\tfinal MySynchronized mySynchronized2 = new MySynchronized();\n\t\tnew Thread(\"thread1\") {\n\t\t\tpublic void run() {\n\t\t\t\tsynchronized (mySynchronized) {\n\t\t\t\ttry {\n\t\t\t\t\tSystem.out.println(this.getName()+\" start\");\n\t\t\t\t\tint i =1/0;   //如果发生异常，jvm会将锁释放\n\t\t\t\t\tThread.sleep(5000);\n\t\t\t\t\tSystem.out.println(this.getName()+\"醒了\");\n\t\t\t\t\tSystem.out.println(this.getName()+\" end\");\n\t\t\t\t} catch (InterruptedException e) {\n\t\t\t\t\te.printStackTrace();\n\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}.start();\n\t\tnew Thread(\"thread2\") {\n\t\t\tpublic void run() {\n\t\t\t\tsynchronized (mySynchronized) {         //争抢同一把锁时，线程1没释放之前，线程2只能等待\n//\t\t\t\t\tsynchronized (mySynchronized2) {    //如果不是一把锁，可以看到两句话同时打印\n\t\t\t\t\tSystem.out.println(this.getName()+\" start\");\n\t\t\t\t\tSystem.out.println(this.getName()+\" end\");\n\t\t\t\t\t\n\t\t\t\t}\n\t\t\t}\n\t\t}.start();\n\t}\n}\n```\n### synchronized的缺陷\nsynchronized是java中的一个关键字，也就是说是Java语言内置的特性。  \n如果一个代码块被synchronized修饰了，当一个线程获取了对应的锁，并执行该代码块时，其他线程便只能一直等待，等待获取锁的线程释放锁，而这里获取锁的线程释放锁只会有两种情况：\n1. 获取锁的线程执行完了该代码块，然后线程释放对锁的占有；\n2. 线程执行发生异常，此时JVM会让线程自动释放锁。\n\n例子1：  \n如果这个获取锁的线程由于要等待IO或者其他原因（比如调用sleep方法）被阻塞了，但是又没有释放锁，其他线程便只能干巴巴地等待，试想一下，这多么影响程序执行效率。\n因此就需要有一种机制<font color=\"red\">可以不让等待的线程一直无期限地等待下去（比如只等待一定的时间或者能够响应中断），通过Lock就可以办到。</font>\n\n例子2：  \n当有多个线程读写文件时，读操作和写操作会发生冲突现象，写操作和写操作会发生冲突现象，但是读操作和读操作不会发生冲突现象。  \n但是采用synchronized关键字来实现同步的话，就会导致一个问题：  \n如果多个线程都只是进行读操作，当一个线程在进行读操作时，其他线程只能等待无法进行读操作。  \n \n因此就需要一种机制来使得多个线程都只是进行读操作时，线程之间不会发生冲突，通过Lock就可以办到。  \n另外，通过Lock可以知道线程有没有成功获取到锁。这个是synchronized无法办到的。  \n总的来说，也就是说Lock提供了比synchronized更多的功能。  \n\n## lock\n###  lock和synchronized的区别\n1. Lock不是Java语言内置的，synchronized是Java语言的关键字，因此是内置特性。Lock是一个类，通过这个类可以实现同步访问；\n2. Lock和synchronized有一点非常大的不同，采用synchronized不需要用户去手动释放锁，当synchronized方法或者synchronized代码块执行完之后，系统会自动让线程释放对锁的占用；而Lock则必须要用户去手动释放锁，如果没有主动释放锁，就有可能导致出现死锁现象。\n### java.util.concurrent.locks包下常用的类\n#### Lock         \n首先要说明的就是Lock，通过查看Lock的源码可知，Lock是一个接口：\n```java\npublic interface Lock {\n    void lock();\n    void lockInterruptibly() throws InterruptedException;\n    boolean tryLock();\n    boolean tryLock(long time, TimeUnit unit) throws InterruptedException;\n    void unlock();\n}\n```\n获取锁：lock()，lockInterruptibly()， tryLock()，tryLock(long time, TimeUnit unit)  \n释放锁：unlock()\n\n区别： \n- lock()  \n平常使用得最多的一个方法，就是用来获取锁。如果锁已被其他线程获取，则进行等待。  \n由于在前面讲到如果采用Lock，必须主动去释放锁，并且在发生异常时，不会自动释放锁。因此一般来说，使用Lock必须在try{}catch{}块中进行，并且将释放锁的操作放在finally块中进行，以保证锁一定被被释放，防止死锁的发生。\n\n- tryLock()  \n有返回值的，它表示用来尝试获取锁，如果获取成功，则返回true，如果获取失败（即锁已被其他线程获取），则返回false，也就说这个方法无论如何都会立即返回。在拿不到锁时不会一直在那等待。\n\n- tryLock(long time, TimeUnit unit)  \n和tryLock()方法是类似的，只不过区别在于这个方法在拿不到锁时会等待一定的时间，在时间期限之内如果还拿不到锁，就返回false。如果如果一开始拿到锁或者在等待期间内拿到了锁，则返回true。\n\n- lockInterruptibly()  \n比较特殊，当通过这个方法去获取锁时，如果线程正在等待获取锁，则这个线程能够响应中断，即中断线程的等待状态。也就使说，当两个线程同时通过lock.lockInterruptibly()想获取某个锁时，假若此时线程A获取到了锁，而线程B只有等待，那么对线程B调用threadB.interrupt()方法能够中断线程B的等待过程。  \n注意，当一个线程获取了锁之后，是不会被interrupt()方法中断的。  \n因此当通过lockInterruptibly()方法获取某个锁时，如果不能获取到，只有进行等待的情况下，是可以响应中断的。  \n而用synchronized修饰的话，当一个线程处于等待某个锁的状态，是无法被中断的，只有一直等待下去。  \n\n#### ReentrantLock\n直接使用lock接口的话，我们需要实现很多方法，不太方便，ReentrantLock是唯一实现了Lock接口的类，并且ReentrantLock提供了更多的方法，ReentrantLock，意思是“可重入锁”。\n- lock()的正确使用方法\n```java\npackage cn.itcast_01_mythread.thread.lock;\nimport java.util.ArrayList;\nimport java.util.concurrent.locks.Lock;\nimport java.util.concurrent.locks.ReentrantLock;\npublic class MyLockTest {\n\tprivate static ArrayList<Integer> arrayList = new ArrayList<Integer>();\n\tstatic Lock lock = new ReentrantLock(); // 注意这个地方\n\tpublic static <E> void main(String[] args) {\n\t\tnew Thread() {\n\t\t\tpublic void run() {\n\t\t\t\tThread thread = Thread.currentThread();\n\t\t\t\tlock.lock();\n\t\t\t\ttry {\n\t\t\t\t\tSystem.out.println(thread.getName() + \"得到了锁\");\n\t\t\t\t\tfor (int i = 0; i < 5; i++) {\n\t\t\t\t\t\tarrayList.add(i);\n\t\t\t\t\t}\n\t\t\t\t} catch (Exception e) {\n\t\t\t\t\t// TODO: handle exception\n\t\t\t\t} finally {\n\t\t\t\t\tSystem.out.println(thread.getName() + \"释放了锁\");\n\t\t\t\t\tlock.unlock();\n\t\t\t\t}\n\t\t\t};\n\t\t}.start();\n\t\t\n\t\tnew Thread() {\n\t\t\tpublic void run() {\n\t\t\t\tThread thread = Thread.currentThread();\n\t\t\t\tlock.lock();\n\t\t\t\ttry {\n\t\t\t\t\tSystem.out.println(thread.getName() + \"得到了锁\");\n\t\t\t\t\tfor (int i = 0; i < 5; i++) {\n\t\t\t\t\t\tarrayList.add(i);\n\t\t\t\t\t}\n\t\t\t\t} catch (Exception e) {\n\t\t\t\t\t// TODO: handle exception\n\t\t\t\t} finally {\n\t\t\t\t\tSystem.out.println(thread.getName() + \"释放了锁\");\n\t\t\t\t\tlock.unlock();\n\t\t\t\t}\n\n\t\t\t};\n\t\t}.start();\n\t}\n}\n```\n- tryLock()的使用方法\n```java\npackage cn.itcast_01_mythread.thread.lock;\nimport java.util.ArrayList;\nimport java.util.concurrent.locks.Lock;\nimport java.util.concurrent.locks.ReentrantLock;\n/**\n * 观察现象：一个线程获得锁后，另一个线程取不到锁，不会一直等待\n * @author\n *\n */\npublic class MyTryLock {\n\tprivate static ArrayList<Integer> arrayList = new ArrayList<Integer>();\n\tstatic Lock lock = new ReentrantLock(); // 注意这个地方\n\tpublic static void main(String[] args) {\n\t\tnew Thread() {\n\t\t\tpublic void run() {\n\t\t\t\tThread thread = Thread.currentThread();\n\t\t\t\tboolean tryLock = lock.tryLock();\n\t\t\t\tSystem.out.println(thread.getName()+\" \"+tryLock);\n\t\t\t\tif (tryLock) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tSystem.out.println(thread.getName() + \"得到了锁\");\n\t\t\t\t\t\tfor (int i = 0; i < 5; i++) {\n\t\t\t\t\t\t\tarrayList.add(i);\n\t\t\t\t\t\t}\n\t\t\t\t\t} catch (Exception e) {\n\t\t\t\t\t\t// TODO: handle exception\n\t\t\t\t\t} finally {\n\t\t\t\t\t\tSystem.out.println(thread.getName() + \"释放了锁\");\n\t\t\t\t\t\tlock.unlock();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\t\t}.start();\n\n\t\tnew Thread() {\n\t\t\tpublic void run() {\n\t\t\t\tThread thread = Thread.currentThread();\n\t\t\t\tboolean tryLock = lock.tryLock();\n\t\t\t\tSystem.out.println(thread.getName()+\" \"+tryLock);\n\t\t\t\tif (tryLock) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tSystem.out.println(thread.getName() + \"得到了锁\");\n\t\t\t\t\t\tfor (int i = 0; i < 5; i++) {\n\t\t\t\t\t\t\tarrayList.add(i);\n\t\t\t\t\t\t}\n\t\t\t\t\t} catch (Exception e) {\n\t\t\t\t\t\t// TODO: handle exception\n\t\t\t\t\t} finally {\n\t\t\t\t\t\tSystem.out.println(thread.getName() + \"释放了锁\");\n\t\t\t\t\t\tlock.unlock();\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t};\n\t\t}.start();\n\t}\n}\n```\n- lockInterruptibly()响应中断的使用方法：\n```java\npackage cn.itcast_01_mythread.thread.lock;\nimport java.util.concurrent.locks.Lock;\nimport java.util.concurrent.locks.ReentrantLock;\n/**\n * 观察现象：如果thread-0得到了锁，阻塞。。。thread-1尝试获取锁，如果拿不到，则可以被中断等待\n * @author\n *\n */\npublic class MyInterruptibly {\n\t private Lock lock = new ReentrantLock();  \n\t    public static void main(String[] args)  {\n\t    \tMyInterruptibly test = new MyInterruptibly();\n\t        MyThread thread0 = new MyThread(test);\n\t        MyThread thread1 = new MyThread(test);\n\t        thread0.start();\n\t        thread1.start();\n\t         \n\t        try {\n\t            Thread.sleep(2000);\n\t        } catch (InterruptedException e) {\n\t            e.printStackTrace();\n\t        }\n\t        thread1.interrupt();\n\t        System.out.println(\"=====================\");\n\t    }  \n\t     \n\t    public void insert(Thread thread) throws InterruptedException{\n\t        lock.lockInterruptibly();   //注意，如果需要正确中断等待锁的线程，必须将获取锁放在外面，然后将InterruptedException抛出\n\t        try {  \n\t            System.out.println(thread.getName()+\"得到了锁\");\n\t            long startTime = System.currentTimeMillis();\n\t            for(    ;     ;) {\n\t                if(System.currentTimeMillis() - startTime >= Integer.MAX_VALUE)\n\t                    break;\n\t                //插入数据\n\t            }\n\t        }\n\t        finally {\n\t            System.out.println(Thread.currentThread().getName()+\"执行finally\");\n\t            lock.unlock();\n\t            System.out.println(thread.getName()+\"释放了锁\");\n\t        }  \n\t    }\n\t}\n\t \n\tclass MyThread extends Thread {\n\t    private MyInterruptibly test = null;\n\t    public MyThread(MyInterruptibly test) {\n\t        this.test = test;\n\t    }\n\t    @Override\n\t    public void run() {\n\t         \n\t        try {\n\t            test.insert(Thread.currentThread());\n\t        } catch (Exception e) {\n\t            System.out.println(Thread.currentThread().getName()+\"被中断\");\n\t        }\n\t    }\n}\n```\n#### ReadWriteLock\nReadWriteLock也是一个接口，在它里面只定义了两个方法：\n```java\npublic interface ReadWriteLock {\n    /**\n     * Returns the lock used for reading.\n     *\n     * @return the lock used for reading.\n     */\n    Lock readLock();\n \n    /**\n     * Returns the lock used for writing.\n     *\n     * @return the lock used for writing.\n     */\n    Lock writeLock();\n}\n```\n一个用来获取读锁，一个用来获取写锁。也就是说将文件的读写操作分开，分成2个锁来分配给线程，从而使得多个线程可以同时进行读操作。下面的ReentrantReadWriteLock实现了ReadWriteLock接口。\n#### ReentrantReadWriteLock\nReentrantReadWriteLock里面提供了很多丰富的方法，不过最主要的有两个方法：readLock()和writeLock()用来获取读锁和写锁。\n\nReentrantReadWriteLock具体用法\n\n假如有多个线程要同时进行读操作的话，先看一下synchronized达到的效果\n```java\npackage cn.itcast_01_mythread.thread.lock;\n/**\n * 一个线程又要读又要写，用synchronize来实现的话，读写操作都只能锁住后一个线程一个线程地进行\n * @author\n *\n */\npublic class MySynchronizedReadWrite {\n    \n    public static void main(String[] args)  {\n        final MySynchronizedReadWrite test = new MySynchronizedReadWrite();\n         \n        new Thread(){\n            public void run() {\n                test.get(Thread.currentThread());\n            };\n        }.start();\n         \n        new Thread(){\n            public void run() {\n                test.get(Thread.currentThread());\n            };\n        }.start();\n         \n    }  \n     \n    public synchronized void get(Thread thread) {\n        long start = System.currentTimeMillis();\n        int i=0;\n        while(System.currentTimeMillis() - start <= 1) {\n        \ti++;\n        \tif(i%4==0){\n            System.out.println(thread.getName()+\"正在进行写操作\");\n        \t}else {\n        \t\tSystem.out.println(thread.getName()+\"正在进行读操作\");\t\n\t\t\t}\n        }\n        System.out.println(thread.getName()+\"读写操作完毕\");\n    }\n}\n```\n改成用读写锁的话：\n```java\npackage cn.itcast_01_mythread.thread.lock;\nimport java.util.concurrent.locks.ReentrantReadWriteLock;\n/**\n * 使用读写锁，可以实现读写分离锁定，读操作并发进行，写操作锁定单个线程\n * \n * 如果有一个线程已经占用了读锁，则此时其他线程如果要申请写锁，则申请写锁的线程会一直等待释放读锁。\n * 如果有一个线程已经占用了写锁，则此时其他线程如果申请写锁或者读锁，则申请的线程会一直等待释放写锁。\n * @author\n *\n */\npublic class MyReentrantReadWriteLock {\n\t private ReentrantReadWriteLock rwl = new ReentrantReadWriteLock();\n     \n\t    public static void main(String[] args)  {\n\t        final MyReentrantReadWriteLock test = new MyReentrantReadWriteLock();\n\t         \n\t        new Thread(){\n\t            public void run() {\n\t                test.get(Thread.currentThread());\n\t                test.write(Thread.currentThread());\n\t            };\n\t        }.start();\n\t         \n\t        new Thread(){\n\t            public void run() {\n\t                test.get(Thread.currentThread());\n\t                test.write(Thread.currentThread());\n\t            };\n\t        }.start();\n\t    }  \n\t    \n\t    /**\n\t     * 读操作,用读锁来锁定\n\t     * @param thread\n\t     */\n\t    public void get(Thread thread) {\n\t        rwl.readLock().lock();\n\t        try {\n\t            long start = System.currentTimeMillis();\n\t             \n\t            while(System.currentTimeMillis() - start <= 1) {\n\t                System.out.println(thread.getName()+\"正在进行读操作\");\n\t            }\n\t            System.out.println(thread.getName()+\"读操作完毕\");\n\t        } finally {\n\t            rwl.readLock().unlock();\n\t        }\n\t    }\n\n\t    /**\n\t     * 写操作，用写锁来锁定\n\t     * @param thread\n\t     */\n\t    public void write(Thread thread) {\n\t        rwl.writeLock().lock();;\n\t        try {\n\t            long start = System.currentTimeMillis();\n\t            while(System.currentTimeMillis() - start <= 1) {\n\t                System.out.println(thread.getName()+\"正在进行写操作\");\n\t            }\n\t            System.out.println(thread.getName()+\"写操作完毕\");\n\t        } finally {\n\t            rwl.writeLock().unlock();\n\t        }\n\t    }\n}\n\n```\n> 注意：\n- 不过要注意的是，如果有一个线程已经占用了读锁，则此时其他线程如果要申请写锁，则申请写锁的线程会一直等待释放读锁。\n- 如果有一个线程已经占用了写锁，则此时其他线程如果申请写锁或者读锁，则申请的线程会一直等待释放写锁。\n\n\n## Lock和synchronized的选择\n1. Lock是一个接口，而synchronized是Java中的关键字，synchronized是内置的语言实现；\n2. synchronized在发生异常时，会自动释放线程占有的锁，因此不会导致死锁现象发生；而Lock在发生异常时，如果没有主动通过unLock()去释放锁，则很可能造成死锁现象，因此使用Lock时需要在finally块中释放锁；\n3. Lock可以让等待锁的线程响应中断，而synchronized却不行，使用synchronized时，等待的线程会一直等待下去，不能够响应中断；\n4. 通过Lock可以知道有没有成功获取锁，而synchronized却无法办到。\n5. Lock可以提高多个线程进行读操作的效率。\n\n在性能上来说，如果竞争资源不激烈，两者的性能是差不多的，而当竞争资源非常激烈时（即有大量线程同时竞争），此时Lock的性能要远远优于synchronized。所以说，在具体使用时要根据适当情况选择。\n\n# java并发包\n## java并发包介绍\nJDK5.0 以后的版本都引入了高级并发特性，大多数的特性在java.util.concurrent 包中，是专门用于多线程发编程的，充分利用了现代多处理器和多核心系统的功能以编写大规模并发应用程序。主要包含<font color=\"red\">原子量、并发集合、同步器、</font>可重入锁，并对线程池的构造提供了强力的支持。\n\n### 线程池\n#### 创建方式\n五种创建方式\n##### Single Thread Executor \n只有一个线程的线程池，因此所有提交的任务是顺序执行  \n```Executors.newSingleThreadExecutor()```\n\n##### Cached Thread Pool \n线程池里有很多线程需要同时执行，老的可用线程将被新的任务触发重新执行，<font color=\"red\">如果线程超过60秒内没执行，那么将被终止并从池中删除</font>  \n```Executors.newCachedThreadPool()```\n\n##### Fixed Thread Pool \n\n<font color=\"red\">拥有固定线程数的线程池，如果没有任务执行，那么线程会一直等待</font>  \n```Executors.newFixedThreadPool(4)```  \n在构造函数中的参数4是线程池的大小，你可以随意设置，也可以和cpu的核数量保持一致，获取cpu的核数量  \n```int cpuNums = Runtime.getRuntime().availableProcessors();```\n\n##### Scheduled Thread Pool \n用来调度即将执行的任务的线程池，可能是不是直接执行, 每隔多久执行一次... 策略型的  \n```Executors.newScheduledThreadPool()```\n\n##### Single Thread Scheduled Pool \n只有一个线程，用来调度任务在指定时间执行\n```Executors.newSingleThreadScheduledExecutor()```\n### 线程池的使用\n提交 Runnable ，任务完成后 Future 对象返回 null   \n调用excute,提交任务, 匿名Runable重写run方法, run方法里是业务逻辑\n```java\npackage cn.itcast_01_mythread.pool;\nimport java.util.concurrent.ExecutorService;\nimport java.util.concurrent.Executors;\npublic class ThreadPoolWithRunable {\n\t/**\n\t * 通过线程池执行线程\n\t * @param args\n\t */\n\tpublic static void main(String[] args) {\n\t\t//创建一个线程池\n\t\tExecutorService pool = Executors.newCachedThreadPool();\n\t\tfor(int i = 1; i < 5; i++){\n\t\t\tpool.execute(new Runnable() {\n\t\t\t\t@Override\n\t\t\t\tpublic void run() {\n\t\t\t\t\tSystem.out.println(\"thread name: \" + Thread.currentThread().getName());\n\t\t\t\t\ttry {\n\t\t\t\t\t\tThread.sleep(1000);\n\t\t\t\t\t} catch (InterruptedException e) {\n\t\t\t\t\t\te.printStackTrace();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\tpool.shutdown();\n\t}\n}\n```\n\n提交 Callable，该方法返回一个 Future 实例表示任务的状态  \n调用submit提交任务, 匿名Callable,重写call方法, 有返回值, 获取返回值会阻塞,一直要等到线程任务返回结果  \n```java\npackage cn.itcast_01_mythread.pool;\n\nimport java.util.ArrayList;\nimport java.util.List;\nimport java.util.concurrent.Callable;\nimport java.util.concurrent.ExecutionException;\nimport java.util.concurrent.ExecutorService;\nimport java.util.concurrent.Executors;\nimport java.util.concurrent.Future;\n/**\n * callable 跟runnable的区别：\n * runnable的run方法不会有任何返回结果，所以主线程无法获得任务线程的返回值\n * \n * callable的call方法可以返回结果，但是主线程在获取时是被阻塞，需要等待任务线程返回才能拿到结果\n * @author\n *\n */\npublic class ThreadPoolWithcallable {\n\n\tpublic static void main(String[] args) throws InterruptedException, ExecutionException {\n\t\tExecutorService pool = Executors.newFixedThreadPool(4); \n\t\t\n\t\tfor(int i = 0; i < 10; i++){\n\t\t\tFuture<String> submit = pool.submit(new Callable<String>(){\n\t\t\t\t@Override\n\t\t\t\tpublic String call() throws Exception {\n\t\t\t\t\t//System.out.println(\"a\");\n\t\t\t\t\tThread.sleep(5000);\n\t\t\t\t\treturn \"b--\"+Thread.currentThread().getName();\n\t\t\t\t}\t\t\t   \n\t\t\t   });\n\t\t\t//从Future中get结果，这个方法是会被阻塞的，一直要等到线程任务返回结果\n\t\t\tSystem.out.println(submit.get());\n\t\t} \n\t\t\tpool.shutdown();\n\n\t}\n\n}\n```\n\n## java并发包消息队列及在开源软件中的应用\n### BlockingQueue\n也是java.util.concurrent下的主要用来<font color=\"red\">控制线程同步的工具</font>。  \n主要的方法是：put、take一对阻塞存取；add、poll一对非阻塞存取。  \n- 插入:\n\t1. add(anObject):把anObject加到BlockingQueue里,即如果BlockingQueue可以容纳,则返回true,否则抛出异常,不好\n\t1. offer(anObject):表示如果可能的话,将anObject加到BlockingQueue里,即如果BlockingQueue可以容纳,则返回true,否则返回false.\n\t1. put(anObject):把anObject加到BlockingQueue里,如果BlockQueue没有空间,则调用此方法的线程被阻断直到BlockingQueue里面有空间再继续, 有阻塞, 放不进去就等待\n- 读取：\n\t1. poll(time):取走BlockingQueue里排在首位的对象,若不能立即取出,则可以等time参数规定的时间,取不到时返回null; 取不到返回null\n\t1. take():取走BlockingQueue里排在首位的对象,若BlockingQueue为空,阻断进入等待状态直到Blocking有新的对象被加入为止; <font color=\"red\">阻塞, 取不到就一直等</font>\n- 其他\n\t1. int remainingCapacity();返回队列剩余的容量，在队列插入和获取的时候，<font color=\"red\">不要瞎搞，数据可能不准, 不能保证数据的准确性</font>\n\t2. boolean remove(Object o); 从队列移除元素，如果存在，即移除一个或者更多，队列改\t变了返回true\n\t3. public boolean contains(Object o); 查看队列是否存在这个元素，存在返回true\n\t4. int drainTo(Collection<? super E> c); //移除此队列中所有可用的元素,并将它们添加到给定 collection 中。<font color=\"red\">取出放到集合中</font>\n\t5. int drainTo(Collection<? super E> c, int maxElements); 和上面方法的区别在于，指定了移动的数量;取出指定个数放到集合\n\nBlockingQueue有四个具体的实现类,常用的两种实现类为：\n\n### ArrayBlockingQueue\n一个由数组支持的有界阻塞队列，规定大小的BlockingQueue,其构造函数必须带一个int参数来指明其大小.其所含的对象是以FIFO(先入先出)顺序排序的。\n\n### LinkedBlockingQueue\n大小不定的BlockingQueue,若其构造函数带一个规定大小的参数,生成的BlockingQueue有大小限制,若不带大小参数,所生成的BlockingQueue的大小由Integer.MAX_VALUE来决定.其所含的对象是以FIFO(先入先出)顺序排序的。 \nLinkedBlockingQueue 可以指定容量，也可以不指定，不指定的话，默认最大是Integer.MAX_VALUE,其中主要用到put和take方法，put方法在队列满的时候会阻塞直到有队列成员被消费，take方法在队列空的时候会阻塞，直到有队列成员被放进来。\n\n### LinkedBlockingQueue和ArrayBlockingQueue区别\n\nLinkedBlockingQueue和ArrayBlockingQueue比较起来,它们背后所用的数据结构不一样,导致LinkedBlockingQueue的数据吞吐量要大于ArrayBlockingQueue,但在线程数量很大时其性能的可预见性低于ArrayBlockingQueue.\n\n生产者消费者的示例代码：\n```java\npackage cn.itcast_02_blockingqueue.main;\nimport java.util.concurrent.BlockingQueue;\nimport java.util.concurrent.LinkedBlockingQueue;\nimport cn.itcast_02_blockingqueue.consumer.Consumer;\nimport cn.itcast_02_blockingqueue.producer.Producer;\npublic class Test {\n\tpublic static void main(String[] args) throws Exception {\n\t\tBlockingQueue<String> queue = new LinkedBlockingQueue<String>(2);\n\t\t// BlockingQueue<String> queue = new LinkedBlockingQueue<String>();\n\t\t// 不设置的话，LinkedBlockingQueue默认大小为Integer.MAX_VALUE\n\t\t// BlockingQueue<String> queue = new ArrayBlockingQueue<String>(2);\n\t\tConsumer consumer = new Consumer(queue);\n\t\tProducer producer = new Producer(queue);\n\t\tfor (int i = 0; i < 3; i++) {\n\t\t\tnew Thread(producer, \"Producer\" + (i + 1)).start();\n\t\t}\n\t\tfor (int i = 0; i < 5; i++) {\n\t\t\tnew Thread(consumer, \"Consumer\" + (i + 1)).start();\n\t\t}\n\t\tnew Thread(producer, \"Producer\" + (5)).start();\n\t}\n}\n\n=====================================================================\npackage cn.itcast_02_blockingqueue.main;\nimport java.util.concurrent.BlockingQueue;\nimport java.util.concurrent.LinkedBlockingQueue;\npublic class TestBlockingQueue {\n\tpublic static void main(String[] args) {\n\t\tBlockingQueue<String> queue = new LinkedBlockingQueue<String>(2);\n\t\t// BlockingQueue<String> queue = new LinkedBlockingQueue<String>();\n\t\t// 不设置的话，LinkedBlockingQueue默认大小为Integer.MAX_VALUE\n\t\t// BlockingQueue<String> queue = new ArrayBlockingQueue<String>(2);\n\t\tTestBlockingQueueConsumer consumer = new TestBlockingQueueConsumer(queue);\n\t\tTestBlockingQueueProducer producer = new TestBlockingQueueProducer(queue);\n\t\tfor (int i = 0; i < 3; i++) {\n\t\t\tnew Thread(producer, \"Producer\" + (i + 1)).start();\n\t\t}\n\t\tfor (int i = 0; i < 5; i++) {\n\t\t\tnew Thread(consumer, \"Consumer\" + (i + 1)).start();\n\t\t}\n\t\tnew Thread(producer, \"Producer\" + (5)).start();\n\t}\n}\n=====================================================================\npackage cn.itcast_02_blockingqueue.main;\nimport java.util.Random;\nimport java.util.concurrent.BlockingQueue;\npublic class TestBlockingQueueConsumer implements Runnable{  \n    BlockingQueue<String> queue; \n    Random random = new Random();\n    public TestBlockingQueueConsumer(BlockingQueue<String> queue){  \n        this.queue = queue;  \n    }        \n    @Override  \n    public void run() {  \n        try {  \n        \tThread.sleep(random.nextInt(10));\n        \tSystem.out.println(Thread.currentThread().getName()+ \"trying...\");\n            String temp = queue.take();//如果队列为空，会阻塞当前线程  \n            System.out.println(Thread.currentThread().getName() + \" get a job \" +temp);  \n        } catch (InterruptedException e) {  \n            e.printStackTrace();  \n        }  \n    }  \n}\n=====================================================================\npackage cn.itcast_02_blockingqueue.main;\nimport java.util.Random;\nimport java.util.concurrent.BlockingQueue;\npublic class TestBlockingQueueProducer implements Runnable {\n\tBlockingQueue<String> queue;\n\tRandom random = new Random();\n\tpublic TestBlockingQueueProducer(BlockingQueue<String> queue) {\n\t\tthis.queue = queue;\n\t}\n\t@Override\n\tpublic void run() {\n\t\tfor (int i = 0; i < 10; i++) {\n\t\t\ttry {\n\t\t\t\tThread.sleep(random.nextInt(10));\n\t\t\t\tString task = Thread.currentThread().getName() + \" made a product \" + i;\n\t\t\t\tSystem.out.println(task);\n\t\t\t\tqueue.put(task);\n\t\t\t} catch (InterruptedException e) {\n\t\t\t\te.printStackTrace();\n\t\t\t}\n\t\t}\n\t}\n\n}\n\n=====================================================================\npackage cn.itcast_02_blockingqueue.producer;\nimport java.util.concurrent.BlockingQueue;\npublic class Producer implements Runnable {  \n    BlockingQueue<String> queue;    \n    public Producer(BlockingQueue<String> queue) {  \n        this.queue = queue;  \n    }    \n    @Override  \n    public void run() {  \n        try {  \n            \n            System.out.println(\"I have made a product:\"  \n                    + Thread.currentThread().getName()); \n            String temp = \"A Product, 生产线程：\"  \n                    + Thread.currentThread().getName();  \n            queue.put(temp);//如果队列是满的话，会阻塞当前线程  \n        } catch (InterruptedException e) {  \n            e.printStackTrace();  \n        }  \n    }    \n}  \n=====================================================================\npackage cn.itcast_02_blockingqueue.consumer;\nimport java.util.concurrent.BlockingQueue;\npublic class Consumer implements Runnable{  \n    BlockingQueue<String> queue; \n    public Consumer(BlockingQueue<String> queue){  \n        this.queue = queue;  \n    }        \n    @Override  \n    public void run() {  \n        try {  \n        \tString consumer = Thread.currentThread().getName();\n        \tSystem.out.println(consumer);  \n            String temp = queue.take();//如果队列为空，会阻塞当前线程  \n            System.out.println(consumer+\"get a product:\"+temp);  \n        } catch (InterruptedException e) {  \n            e.printStackTrace();  \n        }  \n    }  \n}  \n\n\n```\n#  java并发编程的一些总结\n## 不应用线程池的缺点\n有些开发者图省事，遇到需要多线程处理的地方，直接new Thread(...).start()，对于一般场景是没问题的，但如果是在并发请求很高的情况下，就会有些隐患：\n- 新建线程的开销。线程虽然比进程要轻量许多，但对于JVM来说，新建一个线程的代价还是挺大的，决不同于新建一个对象\n- 资源消耗量。没有一个池来限制线程的数量，会导致线程的数量直接取决于应用的并发量，这样有潜在的线程数据巨大的可能，那么资源消耗量将是巨大的\n- 稳定性。当线程数量超过系统资源所能承受的程度，稳定性就会成问题\n## 制定执行策略\n在每个需要多线程处理的地方，不管并发量有多大，需要考虑线程的执行策略\n- 任务以什么顺序执行\n- 可以有多少个任务并发执行\n- 可以有多少个任务进入等待执行队列\n- 系统过载的时候，应该放弃哪些任务？如何通知到应用程序？\n- 一个任务的执行前后应该做什么处理\n\n## 线程池的类型\n不管是通过Executors创建线程池，还是通过Spring来管理，都得清楚知道有哪几种线程池：\n- FixedThreadPool：定长线程池，提交任务时创建线程，直到池的最大容量，如果有线程非预期结束，会补充新线程\n- CachedThreadPool：可变线程池，它犹如一个弹簧，如果没有任务需求时，它回收空闲线程，如果需求增加，则按需增加线程，不对池的大小做限制\n- SingleThreadExecutor：单线程。处理不过来的任务会进入FIFO队列等待执行\n- SecheduledThreadPool：周期性线程池。支持执行周期性线程任务\n其实，这些不同类型的线程池都是通过构建一个ThreadPoolExecutor来完成的，所不同的是corePoolSize,maximumPoolSize,keepAliveTime,unit,workQueue,threadFactory这么几个参数。具体可以参见JDK DOC。\n\n## 线程池饱和策略\n由以上线程池类型可知，除了CachedThreadPool其他线程池都有饱和的可能，当饱和以后就需要相应的策略处理请求线程的任务，比如，达到上限时通过ThreadPoolExecutor.setRejectedExecutionHandler方法设置一个拒绝任务的策略，JDK提供了AbortPolicy、CallerRunsPolicy、DiscardPolicy、DiscardOldestPolicy几种策略，具体差异可见JDK DOC\n\n## 线程无依赖性\n<font color=\"red\">多线程任务设计上尽量使得各任务是独立无依赖的</font>，所谓依赖性可两个方面：\n- 线程之间的依赖性。如果线程有依赖可能会造成死锁或饥饿\n- 调用者与线程的依赖性。调用者得监视线程的完成情况，影响可并发量\n当然，在有些业务里确实需要一定的依赖性，比如调用者需要得到线程完成后结果，传统的Thread是不便完成的，因为run方法无返回值，只能通过一些共享的变量来传递结果，但在Executor框架里可以通过Future和Callable实现需要有返回值的任务，当然线程的异步性导致需要有相应机制来保证调用者能等待任务完成，关于Future和Callable的用法前文已讲解；\n","slug":"大数据/大数据0401-java多线程并发","published":1,"updated":"2017-12-03T08:23:15.948Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjcsq4ljb003kx4vfwmk7czz2","content":"<p>内容包含</p>\n<ol>\n<li>掌握多线程</li>\n<li>掌握并发包下的队列</li>\n</ol>\n<p>做个笔记，方便查看<br><a id=\"more\"></a></p>\n<h1 id=\"java多线程增强\"><a href=\"#java多线程增强\" class=\"headerlink\" title=\"java多线程增强\"></a>java多线程增强</h1><h2 id=\"进程介绍\"><a href=\"#进程介绍\" class=\"headerlink\" title=\"进程介绍\"></a>进程介绍</h2><p>不管是我们开发的应用程序，还是我们运行的其他的应用程序，都需要先把程序安装在本地的硬盘上。然后找到这个程序的启动文件，启动程序的时候，其实是电脑把当前的这个程序加载到内存中，在<font color=\"red\">内存中需要给当前的程序分配一段独立的运行空间</font>。这片空间就专门负责当前这个程序的运行。  </p>\n<p>不同的应用程序运行的过程中都需要在内存中分配自己独立的运行空间，彼此之间不会相互的影响。我们把每个独立应用程序在内存的独立空间称为当前应用程序运行的一个进程。  </p>\n<p>进程：它是内存中的一段独立的空间，可以负责当前应用程序的运行。当前这个进程负责调度当前程序中的所有运行细节。</p>\n<h2 id=\"线程介绍\"><a href=\"#线程介绍\" class=\"headerlink\" title=\"线程介绍\"></a>线程介绍</h2><p>在一个进程中，每个独立的功能都需要独立的去运行，这时又需要把当前这个进程划分成多个运行区域，每个独立的小区域（小单元）称为一个线程。</p>\n<p>线程：它是位于进程中，负责当前进程中的某个具备独立运行资格的空间。<br>进程是负责整个程序的运行，而线程是程序中具体的某个独立功能的运行。一个进程中至少应该有一个线程。</p>\n<h2 id=\"多线程介绍\"><a href=\"#多线程介绍\" class=\"headerlink\" title=\"多线程介绍\"></a>多线程介绍</h2><p>多线程：<font color=\"red\">在一个进程中，我们同时开启多个线程，让多个线程同时去完成某些任务（功能）。<br>(比如后台服务系统，就可以用多个线程同时响应多个客户的请求)</font><br>多线程的目的：提高程序的运行效率。</p>\n<h2 id=\"多线程运行的原理\"><a href=\"#多线程运行的原理\" class=\"headerlink\" title=\"多线程运行的原理\"></a>多线程运行的原理</h2><p>cpu在线程中做时间片的切换。</p>\n<p>其实真正电脑中的程序的运行不是同时在运行的。CPU负责程序的运行，而CPU在运行程序的过程中某个时刻点上，它其实只能运行一个程序。而不是多个程序。而CPU它可以在多个程序之间进行高速的切换。而切换频率和速度太快，导致人的肉眼看不到。<br>每个程序就是进程， 而每个进程中会有多个线程，而CPU是在这些线程之间进行切换。<br>了解了CPU对一个任务的执行过程，我们就必须知道，多线程可以提高程序的运行效率，但不能无限制的开线程。  </p>\n<h2 id=\"实现线程的两种方式\"><a href=\"#实现线程的两种方式\" class=\"headerlink\" title=\"实现线程的两种方式\"></a>实现线程的两种方式</h2><h3 id=\"继承Thread的方式\"><a href=\"#继承Thread的方式\" class=\"headerlink\" title=\"继承Thread的方式\"></a>继承Thread的方式</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">package</span> cn.itcast_01_mythread.thread.testThread;</div><div class=\"line\"><span class=\"keyword\">import</span> java.util.Random;</div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MyThreadWithExtends</span> <span class=\"keyword\">extends</span> <span class=\"title\">Thread</span> </span>&#123;</div><div class=\"line\">\tString flag;</div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">MyThreadWithExtends</span><span class=\"params\">(String flag)</span></span>&#123;</div><div class=\"line\">\t\t<span class=\"keyword\">this</span>.flag = flag;</div><div class=\"line\">\t&#125;</div><div class=\"line\">\t<span class=\"meta\">@Override</span></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">\t\tString tname = Thread.currentThread().getName();</div><div class=\"line\">\t\tSystem.out.println(tname+<span class=\"string\">\"线程的run方法被调用……\"</span>);</div><div class=\"line\">\t\tRandom random = <span class=\"keyword\">new</span> Random();</div><div class=\"line\">\t\t<span class=\"keyword\">for</span>(<span class=\"keyword\">int</span> i=<span class=\"number\">0</span>;i&lt;<span class=\"number\">20</span>;i++)&#123;</div><div class=\"line\">\t\t\t<span class=\"keyword\">try</span> &#123;</div><div class=\"line\">\t\t\t\tThread.sleep(random.nextInt(<span class=\"number\">10</span>)*<span class=\"number\">100</span>);</div><div class=\"line\">\t\t\t\tSystem.out.println(tname+ <span class=\"string\">\"....\"</span>+ flag);</div><div class=\"line\">\t\t\t&#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</div><div class=\"line\">\t\t\t\te.printStackTrace();</div><div class=\"line\">\t\t\t&#125;</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t&#125;</div><div class=\"line\"></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</div><div class=\"line\">\t\tThread thread1 = <span class=\"keyword\">new</span> MyThreadWithExtends(<span class=\"string\">\"a\"</span>);</div><div class=\"line\">\t\tThread thread2 = <span class=\"keyword\">new</span> MyThreadWithExtends(<span class=\"string\">\"b\"</span>);</div><div class=\"line\">\t\tthread1.start();</div><div class=\"line\">\t\tthread2.start();</div><div class=\"line\">\t\t<span class=\"comment\">/**</span></div><div class=\"line\"><span class=\"comment\">\t\t * 如果是调用thread的run方法，则只是一个普通的方法调用，不会开启新的线程</span></div><div class=\"line\"><span class=\"comment\">\t\t */</span></div><div class=\"line\"><span class=\"comment\">//\t\tthread1.run();</span></div><div class=\"line\"><span class=\"comment\">//\t\tthread2.run();</span></div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h3 id=\"声明实现-Runnable-接口的方式\"><a href=\"#声明实现-Runnable-接口的方式\" class=\"headerlink\" title=\"声明实现 Runnable 接口的方式\"></a>声明实现 Runnable 接口的方式</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">package</span> cn.itcast_01_mythread.thread.testThread;</div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MyThreadWithImpliment</span> <span class=\"keyword\">implements</span> <span class=\"title\">Runnable</span> </span>&#123;</div><div class=\"line\">\t<span class=\"keyword\">int</span> x;</div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">MyThreadWithImpliment</span><span class=\"params\">(<span class=\"keyword\">int</span> x)</span> </span>&#123;</div><div class=\"line\">\t\t<span class=\"keyword\">this</span>.x = x;</div><div class=\"line\">\t&#125;</div><div class=\"line\">\t<span class=\"meta\">@Override</span></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">\t\tString name = Thread.currentThread().getName();</div><div class=\"line\">\t\tSystem.out.println(<span class=\"string\">\"线程\"</span> + name + <span class=\"string\">\"的run方法被调用……\"</span>);</div><div class=\"line\">\t\t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">10</span>; i++) &#123;</div><div class=\"line\">\t\t\tSystem.out.println(x);</div><div class=\"line\">\t\t\t<span class=\"keyword\">try</span> &#123;</div><div class=\"line\">\t\t\t\tThread.sleep(<span class=\"number\">100</span>);</div><div class=\"line\">\t\t\t\t</div><div class=\"line\">\t\t\t&#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</div><div class=\"line\">\t\t\t\te.printStackTrace();</div><div class=\"line\">\t\t\t&#125;</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t&#125;</div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</div><div class=\"line\">\t\tThread thread1 = <span class=\"keyword\">new</span> Thread(<span class=\"keyword\">new</span> MyThreadWithImpliment(<span class=\"number\">1</span>), <span class=\"string\">\"thread-1\"</span>);</div><div class=\"line\">\t\tThread thread2 = <span class=\"keyword\">new</span> Thread(<span class=\"keyword\">new</span> MyThreadWithImpliment(<span class=\"number\">2</span>), <span class=\"string\">\"thread-2\"</span>);</div><div class=\"line\">\t\t thread1.start();</div><div class=\"line\">\t\t thread2.start();</div><div class=\"line\">\t\t<span class=\"comment\">// 注意调用run和调用start的区别,直接调用run，则都运行在main线程中</span></div><div class=\"line\"><span class=\"comment\">//\t\tthread1.run();</span></div><div class=\"line\"><span class=\"comment\">//\t\tthread2.run();</span></div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h1 id=\"java同步关键词解释\"><a href=\"#java同步关键词解释\" class=\"headerlink\" title=\"java同步关键词解释\"></a>java同步关键词解释</h1><h2 id=\"synchronized\"><a href=\"#synchronized\" class=\"headerlink\" title=\"synchronized\"></a>synchronized</h2><h3 id=\"加同步格式：\"><a href=\"#加同步格式：\" class=\"headerlink\" title=\"加同步格式：\"></a>加同步格式：</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\">synchronized( 需要一个任意的对象（锁） )&#123;</div><div class=\"line\">\t代码块中放操作共享数据的代码。</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">package</span> cn.itcast_01_mythread.thread.testThread;</div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MySynchronized</span> </span>&#123;</div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</div><div class=\"line\">\t\t<span class=\"keyword\">final</span> MySynchronized mySynchronized = <span class=\"keyword\">new</span> MySynchronized();</div><div class=\"line\">\t\t<span class=\"keyword\">final</span> MySynchronized mySynchronized2 = <span class=\"keyword\">new</span> MySynchronized();</div><div class=\"line\">\t\t<span class=\"keyword\">new</span> Thread(<span class=\"string\">\"thread1\"</span>) &#123;</div><div class=\"line\">\t\t\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">\t\t\t\t<span class=\"keyword\">synchronized</span> (mySynchronized) &#123;</div><div class=\"line\">\t\t\t\t<span class=\"keyword\">try</span> &#123;</div><div class=\"line\">\t\t\t\t\tSystem.out.println(<span class=\"keyword\">this</span>.getName()+<span class=\"string\">\" start\"</span>);</div><div class=\"line\">\t\t\t\t\t<span class=\"keyword\">int</span> i =<span class=\"number\">1</span>/<span class=\"number\">0</span>;   <span class=\"comment\">//如果发生异常，jvm会将锁释放</span></div><div class=\"line\">\t\t\t\t\tThread.sleep(<span class=\"number\">5000</span>);</div><div class=\"line\">\t\t\t\t\tSystem.out.println(<span class=\"keyword\">this</span>.getName()+<span class=\"string\">\"醒了\"</span>);</div><div class=\"line\">\t\t\t\t\tSystem.out.println(<span class=\"keyword\">this</span>.getName()+<span class=\"string\">\" end\"</span>);</div><div class=\"line\">\t\t\t\t&#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</div><div class=\"line\">\t\t\t\t\te.printStackTrace();</div><div class=\"line\">\t\t\t\t&#125;</div><div class=\"line\">\t\t\t\t&#125;</div><div class=\"line\">\t\t\t&#125;</div><div class=\"line\">\t\t&#125;.start();</div><div class=\"line\">\t\t<span class=\"keyword\">new</span> Thread(<span class=\"string\">\"thread2\"</span>) &#123;</div><div class=\"line\">\t\t\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">\t\t\t\t<span class=\"keyword\">synchronized</span> (mySynchronized) &#123;         <span class=\"comment\">//争抢同一把锁时，线程1没释放之前，线程2只能等待</span></div><div class=\"line\"><span class=\"comment\">//\t\t\t\t\tsynchronized (mySynchronized2) &#123;    //如果不是一把锁，可以看到两句话同时打印</span></div><div class=\"line\">\t\t\t\t\tSystem.out.println(<span class=\"keyword\">this</span>.getName()+<span class=\"string\">\" start\"</span>);</div><div class=\"line\">\t\t\t\t\tSystem.out.println(<span class=\"keyword\">this</span>.getName()+<span class=\"string\">\" end\"</span>);</div><div class=\"line\">\t\t\t\t\t</div><div class=\"line\">\t\t\t\t&#125;</div><div class=\"line\">\t\t\t&#125;</div><div class=\"line\">\t\t&#125;.start();</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h3 id=\"synchronized的缺陷\"><a href=\"#synchronized的缺陷\" class=\"headerlink\" title=\"synchronized的缺陷\"></a>synchronized的缺陷</h3><p>synchronized是java中的一个关键字，也就是说是Java语言内置的特性。<br>如果一个代码块被synchronized修饰了，当一个线程获取了对应的锁，并执行该代码块时，其他线程便只能一直等待，等待获取锁的线程释放锁，而这里获取锁的线程释放锁只会有两种情况：</p>\n<ol>\n<li>获取锁的线程执行完了该代码块，然后线程释放对锁的占有；</li>\n<li>线程执行发生异常，此时JVM会让线程自动释放锁。</li>\n</ol>\n<p>例子1：<br>如果这个获取锁的线程由于要等待IO或者其他原因（比如调用sleep方法）被阻塞了，但是又没有释放锁，其他线程便只能干巴巴地等待，试想一下，这多么影响程序执行效率。<br>因此就需要有一种机制<font color=\"red\">可以不让等待的线程一直无期限地等待下去（比如只等待一定的时间或者能够响应中断），通过Lock就可以办到。</font></p>\n<p>例子2：<br>当有多个线程读写文件时，读操作和写操作会发生冲突现象，写操作和写操作会发生冲突现象，但是读操作和读操作不会发生冲突现象。<br>但是采用synchronized关键字来实现同步的话，就会导致一个问题：<br>如果多个线程都只是进行读操作，当一个线程在进行读操作时，其他线程只能等待无法进行读操作。  </p>\n<p>因此就需要一种机制来使得多个线程都只是进行读操作时，线程之间不会发生冲突，通过Lock就可以办到。<br>另外，通过Lock可以知道线程有没有成功获取到锁。这个是synchronized无法办到的。<br>总的来说，也就是说Lock提供了比synchronized更多的功能。  </p>\n<h2 id=\"lock\"><a href=\"#lock\" class=\"headerlink\" title=\"lock\"></a>lock</h2><h3 id=\"lock和synchronized的区别\"><a href=\"#lock和synchronized的区别\" class=\"headerlink\" title=\"lock和synchronized的区别\"></a>lock和synchronized的区别</h3><ol>\n<li>Lock不是Java语言内置的，synchronized是Java语言的关键字，因此是内置特性。Lock是一个类，通过这个类可以实现同步访问；</li>\n<li>Lock和synchronized有一点非常大的不同，采用synchronized不需要用户去手动释放锁，当synchronized方法或者synchronized代码块执行完之后，系统会自动让线程释放对锁的占用；而Lock则必须要用户去手动释放锁，如果没有主动释放锁，就有可能导致出现死锁现象。<h3 id=\"java-util-concurrent-locks包下常用的类\"><a href=\"#java-util-concurrent-locks包下常用的类\" class=\"headerlink\" title=\"java.util.concurrent.locks包下常用的类\"></a>java.util.concurrent.locks包下常用的类</h3><h4 id=\"Lock\"><a href=\"#Lock\" class=\"headerlink\" title=\"Lock\"></a>Lock</h4>首先要说明的就是Lock，通过查看Lock的源码可知，Lock是一个接口：<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">Lock</span> </span>&#123;</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">lock</span><span class=\"params\">()</span></span>;</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">lockInterruptibly</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> InterruptedException</span>;</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">boolean</span> <span class=\"title\">tryLock</span><span class=\"params\">()</span></span>;</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">boolean</span> <span class=\"title\">tryLock</span><span class=\"params\">(<span class=\"keyword\">long</span> time, TimeUnit unit)</span> <span class=\"keyword\">throws</span> InterruptedException</span>;</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">unlock</span><span class=\"params\">()</span></span>;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n</li>\n</ol>\n<p>获取锁：lock()，lockInterruptibly()， tryLock()，tryLock(long time, TimeUnit unit)<br>释放锁：unlock()</p>\n<p>区别： </p>\n<ul>\n<li><p>lock()<br>平常使用得最多的一个方法，就是用来获取锁。如果锁已被其他线程获取，则进行等待。<br>由于在前面讲到如果采用Lock，必须主动去释放锁，并且在发生异常时，不会自动释放锁。因此一般来说，使用Lock必须在try{}catch{}块中进行，并且将释放锁的操作放在finally块中进行，以保证锁一定被被释放，防止死锁的发生。</p>\n</li>\n<li><p>tryLock()<br>有返回值的，它表示用来尝试获取锁，如果获取成功，则返回true，如果获取失败（即锁已被其他线程获取），则返回false，也就说这个方法无论如何都会立即返回。在拿不到锁时不会一直在那等待。</p>\n</li>\n<li><p>tryLock(long time, TimeUnit unit)<br>和tryLock()方法是类似的，只不过区别在于这个方法在拿不到锁时会等待一定的时间，在时间期限之内如果还拿不到锁，就返回false。如果如果一开始拿到锁或者在等待期间内拿到了锁，则返回true。</p>\n</li>\n<li><p>lockInterruptibly()<br>比较特殊，当通过这个方法去获取锁时，如果线程正在等待获取锁，则这个线程能够响应中断，即中断线程的等待状态。也就使说，当两个线程同时通过lock.lockInterruptibly()想获取某个锁时，假若此时线程A获取到了锁，而线程B只有等待，那么对线程B调用threadB.interrupt()方法能够中断线程B的等待过程。<br>注意，当一个线程获取了锁之后，是不会被interrupt()方法中断的。<br>因此当通过lockInterruptibly()方法获取某个锁时，如果不能获取到，只有进行等待的情况下，是可以响应中断的。<br>而用synchronized修饰的话，当一个线程处于等待某个锁的状态，是无法被中断的，只有一直等待下去。  </p>\n</li>\n</ul>\n<h4 id=\"ReentrantLock\"><a href=\"#ReentrantLock\" class=\"headerlink\" title=\"ReentrantLock\"></a>ReentrantLock</h4><p>直接使用lock接口的话，我们需要实现很多方法，不太方便，ReentrantLock是唯一实现了Lock接口的类，并且ReentrantLock提供了更多的方法，ReentrantLock，意思是“可重入锁”。</p>\n<ul>\n<li><p>lock()的正确使用方法</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">package</span> cn.itcast_01_mythread.thread.lock;</div><div class=\"line\"><span class=\"keyword\">import</span> java.util.ArrayList;</div><div class=\"line\"><span class=\"keyword\">import</span> java.util.concurrent.locks.Lock;</div><div class=\"line\"><span class=\"keyword\">import</span> java.util.concurrent.locks.ReentrantLock;</div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MyLockTest</span> </span>&#123;</div><div class=\"line\">\t<span class=\"keyword\">private</span> <span class=\"keyword\">static</span> ArrayList&lt;Integer&gt; arrayList = <span class=\"keyword\">new</span> ArrayList&lt;Integer&gt;();</div><div class=\"line\">\t<span class=\"keyword\">static</span> Lock lock = <span class=\"keyword\">new</span> ReentrantLock(); <span class=\"comment\">// 注意这个地方</span></div><div class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"keyword\">static</span> &lt;E&gt; <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</div><div class=\"line\">\t\t<span class=\"keyword\">new</span> Thread() &#123;</div><div class=\"line\">\t\t\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">\t\t\t\tThread thread = Thread.currentThread();</div><div class=\"line\">\t\t\t\tlock.lock();</div><div class=\"line\">\t\t\t\t<span class=\"keyword\">try</span> &#123;</div><div class=\"line\">\t\t\t\t\tSystem.out.println(thread.getName() + <span class=\"string\">\"得到了锁\"</span>);</div><div class=\"line\">\t\t\t\t\t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">5</span>; i++) &#123;</div><div class=\"line\">\t\t\t\t\t\tarrayList.add(i);</div><div class=\"line\">\t\t\t\t\t&#125;</div><div class=\"line\">\t\t\t\t&#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</div><div class=\"line\">\t\t\t\t\t<span class=\"comment\">// <span class=\"doctag\">TODO:</span> handle exception</span></div><div class=\"line\">\t\t\t\t&#125; <span class=\"keyword\">finally</span> &#123;</div><div class=\"line\">\t\t\t\t\tSystem.out.println(thread.getName() + <span class=\"string\">\"释放了锁\"</span>);</div><div class=\"line\">\t\t\t\t\tlock.unlock();</div><div class=\"line\">\t\t\t\t&#125;</div><div class=\"line\">\t\t\t&#125;;</div><div class=\"line\">\t\t&#125;.start();</div><div class=\"line\">\t\t</div><div class=\"line\">\t\t<span class=\"keyword\">new</span> Thread() &#123;</div><div class=\"line\">\t\t\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">\t\t\t\tThread thread = Thread.currentThread();</div><div class=\"line\">\t\t\t\tlock.lock();</div><div class=\"line\">\t\t\t\t<span class=\"keyword\">try</span> &#123;</div><div class=\"line\">\t\t\t\t\tSystem.out.println(thread.getName() + <span class=\"string\">\"得到了锁\"</span>);</div><div class=\"line\">\t\t\t\t\t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">5</span>; i++) &#123;</div><div class=\"line\">\t\t\t\t\t\tarrayList.add(i);</div><div class=\"line\">\t\t\t\t\t&#125;</div><div class=\"line\">\t\t\t\t&#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</div><div class=\"line\">\t\t\t\t\t<span class=\"comment\">// <span class=\"doctag\">TODO:</span> handle exception</span></div><div class=\"line\">\t\t\t\t&#125; <span class=\"keyword\">finally</span> &#123;</div><div class=\"line\">\t\t\t\t\tSystem.out.println(thread.getName() + <span class=\"string\">\"释放了锁\"</span>);</div><div class=\"line\">\t\t\t\t\tlock.unlock();</div><div class=\"line\">\t\t\t\t&#125;</div><div class=\"line\"></div><div class=\"line\">\t\t\t&#125;;</div><div class=\"line\">\t\t&#125;.start();</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n</li>\n<li><p>tryLock()的使用方法</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">package</span> cn.itcast_01_mythread.thread.lock;</div><div class=\"line\"><span class=\"keyword\">import</span> java.util.ArrayList;</div><div class=\"line\"><span class=\"keyword\">import</span> java.util.concurrent.locks.Lock;</div><div class=\"line\"><span class=\"keyword\">import</span> java.util.concurrent.locks.ReentrantLock;</div><div class=\"line\"><span class=\"comment\">/**</span></div><div class=\"line\"><span class=\"comment\"> * 观察现象：一个线程获得锁后，另一个线程取不到锁，不会一直等待</span></div><div class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span></span></div><div class=\"line\"><span class=\"comment\"> *</span></div><div class=\"line\"><span class=\"comment\"> */</span></div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MyTryLock</span> </span>&#123;</div><div class=\"line\">\t<span class=\"keyword\">private</span> <span class=\"keyword\">static</span> ArrayList&lt;Integer&gt; arrayList = <span class=\"keyword\">new</span> ArrayList&lt;Integer&gt;();</div><div class=\"line\">\t<span class=\"keyword\">static</span> Lock lock = <span class=\"keyword\">new</span> ReentrantLock(); <span class=\"comment\">// 注意这个地方</span></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</div><div class=\"line\">\t\t<span class=\"keyword\">new</span> Thread() &#123;</div><div class=\"line\">\t\t\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">\t\t\t\tThread thread = Thread.currentThread();</div><div class=\"line\">\t\t\t\t<span class=\"keyword\">boolean</span> tryLock = lock.tryLock();</div><div class=\"line\">\t\t\t\tSystem.out.println(thread.getName()+<span class=\"string\">\" \"</span>+tryLock);</div><div class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> (tryLock) &#123;</div><div class=\"line\">\t\t\t\t\t<span class=\"keyword\">try</span> &#123;</div><div class=\"line\">\t\t\t\t\t\tSystem.out.println(thread.getName() + <span class=\"string\">\"得到了锁\"</span>);</div><div class=\"line\">\t\t\t\t\t\t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">5</span>; i++) &#123;</div><div class=\"line\">\t\t\t\t\t\t\tarrayList.add(i);</div><div class=\"line\">\t\t\t\t\t\t&#125;</div><div class=\"line\">\t\t\t\t\t&#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</div><div class=\"line\">\t\t\t\t\t\t<span class=\"comment\">// <span class=\"doctag\">TODO:</span> handle exception</span></div><div class=\"line\">\t\t\t\t\t&#125; <span class=\"keyword\">finally</span> &#123;</div><div class=\"line\">\t\t\t\t\t\tSystem.out.println(thread.getName() + <span class=\"string\">\"释放了锁\"</span>);</div><div class=\"line\">\t\t\t\t\t\tlock.unlock();</div><div class=\"line\">\t\t\t\t\t&#125;</div><div class=\"line\">\t\t\t\t&#125;</div><div class=\"line\">\t\t\t&#125;;</div><div class=\"line\">\t\t&#125;.start();</div><div class=\"line\"></div><div class=\"line\">\t\t<span class=\"keyword\">new</span> Thread() &#123;</div><div class=\"line\">\t\t\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">\t\t\t\tThread thread = Thread.currentThread();</div><div class=\"line\">\t\t\t\t<span class=\"keyword\">boolean</span> tryLock = lock.tryLock();</div><div class=\"line\">\t\t\t\tSystem.out.println(thread.getName()+<span class=\"string\">\" \"</span>+tryLock);</div><div class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> (tryLock) &#123;</div><div class=\"line\">\t\t\t\t\t<span class=\"keyword\">try</span> &#123;</div><div class=\"line\">\t\t\t\t\t\tSystem.out.println(thread.getName() + <span class=\"string\">\"得到了锁\"</span>);</div><div class=\"line\">\t\t\t\t\t\t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">5</span>; i++) &#123;</div><div class=\"line\">\t\t\t\t\t\t\tarrayList.add(i);</div><div class=\"line\">\t\t\t\t\t\t&#125;</div><div class=\"line\">\t\t\t\t\t&#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</div><div class=\"line\">\t\t\t\t\t\t<span class=\"comment\">// <span class=\"doctag\">TODO:</span> handle exception</span></div><div class=\"line\">\t\t\t\t\t&#125; <span class=\"keyword\">finally</span> &#123;</div><div class=\"line\">\t\t\t\t\t\tSystem.out.println(thread.getName() + <span class=\"string\">\"释放了锁\"</span>);</div><div class=\"line\">\t\t\t\t\t\tlock.unlock();</div><div class=\"line\">\t\t\t\t\t&#125;</div><div class=\"line\">\t\t\t\t&#125;</div><div class=\"line\"></div><div class=\"line\">\t\t\t&#125;;</div><div class=\"line\">\t\t&#125;.start();</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n</li>\n<li><p>lockInterruptibly()响应中断的使用方法：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">package</span> cn.itcast_01_mythread.thread.lock;</div><div class=\"line\"><span class=\"keyword\">import</span> java.util.concurrent.locks.Lock;</div><div class=\"line\"><span class=\"keyword\">import</span> java.util.concurrent.locks.ReentrantLock;</div><div class=\"line\"><span class=\"comment\">/**</span></div><div class=\"line\"><span class=\"comment\"> * 观察现象：如果thread-0得到了锁，阻塞。。。thread-1尝试获取锁，如果拿不到，则可以被中断等待</span></div><div class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span></span></div><div class=\"line\"><span class=\"comment\"> *</span></div><div class=\"line\"><span class=\"comment\"> */</span></div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MyInterruptibly</span> </span>&#123;</div><div class=\"line\">\t <span class=\"keyword\">private</span> Lock lock = <span class=\"keyword\">new</span> ReentrantLock();  </div><div class=\"line\">\t    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span>  </span>&#123;</div><div class=\"line\">\t    \tMyInterruptibly test = <span class=\"keyword\">new</span> MyInterruptibly();</div><div class=\"line\">\t        MyThread thread0 = <span class=\"keyword\">new</span> MyThread(test);</div><div class=\"line\">\t        MyThread thread1 = <span class=\"keyword\">new</span> MyThread(test);</div><div class=\"line\">\t        thread0.start();</div><div class=\"line\">\t        thread1.start();</div><div class=\"line\">\t         </div><div class=\"line\">\t        <span class=\"keyword\">try</span> &#123;</div><div class=\"line\">\t            Thread.sleep(<span class=\"number\">2000</span>);</div><div class=\"line\">\t        &#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</div><div class=\"line\">\t            e.printStackTrace();</div><div class=\"line\">\t        &#125;</div><div class=\"line\">\t        thread1.interrupt();</div><div class=\"line\">\t        System.out.println(<span class=\"string\">\"=====================\"</span>);</div><div class=\"line\">\t    &#125;  </div><div class=\"line\">\t     </div><div class=\"line\">\t    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">insert</span><span class=\"params\">(Thread thread)</span> <span class=\"keyword\">throws</span> InterruptedException</span>&#123;</div><div class=\"line\">\t        lock.lockInterruptibly();   <span class=\"comment\">//注意，如果需要正确中断等待锁的线程，必须将获取锁放在外面，然后将InterruptedException抛出</span></div><div class=\"line\">\t        <span class=\"keyword\">try</span> &#123;  </div><div class=\"line\">\t            System.out.println(thread.getName()+<span class=\"string\">\"得到了锁\"</span>);</div><div class=\"line\">\t            <span class=\"keyword\">long</span> startTime = System.currentTimeMillis();</div><div class=\"line\">\t            <span class=\"keyword\">for</span>(    ;     ;) &#123;</div><div class=\"line\">\t                <span class=\"keyword\">if</span>(System.currentTimeMillis() - startTime &gt;= Integer.MAX_VALUE)</div><div class=\"line\">\t                    <span class=\"keyword\">break</span>;</div><div class=\"line\">\t                <span class=\"comment\">//插入数据</span></div><div class=\"line\">\t            &#125;</div><div class=\"line\">\t        &#125;</div><div class=\"line\">\t        <span class=\"keyword\">finally</span> &#123;</div><div class=\"line\">\t            System.out.println(Thread.currentThread().getName()+<span class=\"string\">\"执行finally\"</span>);</div><div class=\"line\">\t            lock.unlock();</div><div class=\"line\">\t            System.out.println(thread.getName()+<span class=\"string\">\"释放了锁\"</span>);</div><div class=\"line\">\t        &#125;  </div><div class=\"line\">\t    &#125;</div><div class=\"line\">\t&#125;</div><div class=\"line\">\t </div><div class=\"line\">\t<span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MyThread</span> <span class=\"keyword\">extends</span> <span class=\"title\">Thread</span> </span>&#123;</div><div class=\"line\">\t    <span class=\"keyword\">private</span> MyInterruptibly test = <span class=\"keyword\">null</span>;</div><div class=\"line\">\t    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">MyThread</span><span class=\"params\">(MyInterruptibly test)</span> </span>&#123;</div><div class=\"line\">\t        <span class=\"keyword\">this</span>.test = test;</div><div class=\"line\">\t    &#125;</div><div class=\"line\">\t    <span class=\"meta\">@Override</span></div><div class=\"line\">\t    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">\t         </div><div class=\"line\">\t        <span class=\"keyword\">try</span> &#123;</div><div class=\"line\">\t            test.insert(Thread.currentThread());</div><div class=\"line\">\t        &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</div><div class=\"line\">\t            System.out.println(Thread.currentThread().getName()+<span class=\"string\">\"被中断\"</span>);</div><div class=\"line\">\t        &#125;</div><div class=\"line\">\t    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n</li>\n</ul>\n<h4 id=\"ReadWriteLock\"><a href=\"#ReadWriteLock\" class=\"headerlink\" title=\"ReadWriteLock\"></a>ReadWriteLock</h4><p>ReadWriteLock也是一个接口，在它里面只定义了两个方法：<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">ReadWriteLock</span> </span>&#123;</div><div class=\"line\">    <span class=\"comment\">/**</span></div><div class=\"line\"><span class=\"comment\">     * Returns the lock used for reading.</span></div><div class=\"line\"><span class=\"comment\">     *</span></div><div class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> the lock used for reading.</span></div><div class=\"line\"><span class=\"comment\">     */</span></div><div class=\"line\">    <span class=\"function\">Lock <span class=\"title\">readLock</span><span class=\"params\">()</span></span>;</div><div class=\"line\"> </div><div class=\"line\">    <span class=\"comment\">/**</span></div><div class=\"line\"><span class=\"comment\">     * Returns the lock used for writing.</span></div><div class=\"line\"><span class=\"comment\">     *</span></div><div class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> the lock used for writing.</span></div><div class=\"line\"><span class=\"comment\">     */</span></div><div class=\"line\">    <span class=\"function\">Lock <span class=\"title\">writeLock</span><span class=\"params\">()</span></span>;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>一个用来获取读锁，一个用来获取写锁。也就是说将文件的读写操作分开，分成2个锁来分配给线程，从而使得多个线程可以同时进行读操作。下面的ReentrantReadWriteLock实现了ReadWriteLock接口。</p>\n<h4 id=\"ReentrantReadWriteLock\"><a href=\"#ReentrantReadWriteLock\" class=\"headerlink\" title=\"ReentrantReadWriteLock\"></a>ReentrantReadWriteLock</h4><p>ReentrantReadWriteLock里面提供了很多丰富的方法，不过最主要的有两个方法：readLock()和writeLock()用来获取读锁和写锁。</p>\n<p>ReentrantReadWriteLock具体用法</p>\n<p>假如有多个线程要同时进行读操作的话，先看一下synchronized达到的效果<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">package</span> cn.itcast_01_mythread.thread.lock;</div><div class=\"line\"><span class=\"comment\">/**</span></div><div class=\"line\"><span class=\"comment\"> * 一个线程又要读又要写，用synchronize来实现的话，读写操作都只能锁住后一个线程一个线程地进行</span></div><div class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span></span></div><div class=\"line\"><span class=\"comment\"> *</span></div><div class=\"line\"><span class=\"comment\"> */</span></div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MySynchronizedReadWrite</span> </span>&#123;</div><div class=\"line\">    </div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span>  </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">final</span> MySynchronizedReadWrite test = <span class=\"keyword\">new</span> MySynchronizedReadWrite();</div><div class=\"line\">         </div><div class=\"line\">        <span class=\"keyword\">new</span> Thread()&#123;</div><div class=\"line\">            <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">                test.get(Thread.currentThread());</div><div class=\"line\">            &#125;;</div><div class=\"line\">        &#125;.start();</div><div class=\"line\">         </div><div class=\"line\">        <span class=\"keyword\">new</span> Thread()&#123;</div><div class=\"line\">            <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">                test.get(Thread.currentThread());</div><div class=\"line\">            &#125;;</div><div class=\"line\">        &#125;.start();</div><div class=\"line\">         </div><div class=\"line\">    &#125;  </div><div class=\"line\">     </div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">synchronized</span> <span class=\"keyword\">void</span> <span class=\"title\">get</span><span class=\"params\">(Thread thread)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">long</span> start = System.currentTimeMillis();</div><div class=\"line\">        <span class=\"keyword\">int</span> i=<span class=\"number\">0</span>;</div><div class=\"line\">        <span class=\"keyword\">while</span>(System.currentTimeMillis() - start &lt;= <span class=\"number\">1</span>) &#123;</div><div class=\"line\">        \ti++;</div><div class=\"line\">        \t<span class=\"keyword\">if</span>(i%<span class=\"number\">4</span>==<span class=\"number\">0</span>)&#123;</div><div class=\"line\">            System.out.println(thread.getName()+<span class=\"string\">\"正在进行写操作\"</span>);</div><div class=\"line\">        \t&#125;<span class=\"keyword\">else</span> &#123;</div><div class=\"line\">        \t\tSystem.out.println(thread.getName()+<span class=\"string\">\"正在进行读操作\"</span>);\t</div><div class=\"line\">\t\t\t&#125;</div><div class=\"line\">        &#125;</div><div class=\"line\">        System.out.println(thread.getName()+<span class=\"string\">\"读写操作完毕\"</span>);</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>改成用读写锁的话：<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">package</span> cn.itcast_01_mythread.thread.lock;</div><div class=\"line\"><span class=\"keyword\">import</span> java.util.concurrent.locks.ReentrantReadWriteLock;</div><div class=\"line\"><span class=\"comment\">/**</span></div><div class=\"line\"><span class=\"comment\"> * 使用读写锁，可以实现读写分离锁定，读操作并发进行，写操作锁定单个线程</span></div><div class=\"line\"><span class=\"comment\"> * </span></div><div class=\"line\"><span class=\"comment\"> * 如果有一个线程已经占用了读锁，则此时其他线程如果要申请写锁，则申请写锁的线程会一直等待释放读锁。</span></div><div class=\"line\"><span class=\"comment\"> * 如果有一个线程已经占用了写锁，则此时其他线程如果申请写锁或者读锁，则申请的线程会一直等待释放写锁。</span></div><div class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span></span></div><div class=\"line\"><span class=\"comment\"> *</span></div><div class=\"line\"><span class=\"comment\"> */</span></div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MyReentrantReadWriteLock</span> </span>&#123;</div><div class=\"line\">\t <span class=\"keyword\">private</span> ReentrantReadWriteLock rwl = <span class=\"keyword\">new</span> ReentrantReadWriteLock();</div><div class=\"line\">     </div><div class=\"line\">\t    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span>  </span>&#123;</div><div class=\"line\">\t        <span class=\"keyword\">final</span> MyReentrantReadWriteLock test = <span class=\"keyword\">new</span> MyReentrantReadWriteLock();</div><div class=\"line\">\t         </div><div class=\"line\">\t        <span class=\"keyword\">new</span> Thread()&#123;</div><div class=\"line\">\t            <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">\t                test.get(Thread.currentThread());</div><div class=\"line\">\t                test.write(Thread.currentThread());</div><div class=\"line\">\t            &#125;;</div><div class=\"line\">\t        &#125;.start();</div><div class=\"line\">\t         </div><div class=\"line\">\t        <span class=\"keyword\">new</span> Thread()&#123;</div><div class=\"line\">\t            <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">\t                test.get(Thread.currentThread());</div><div class=\"line\">\t                test.write(Thread.currentThread());</div><div class=\"line\">\t            &#125;;</div><div class=\"line\">\t        &#125;.start();</div><div class=\"line\">\t    &#125;  </div><div class=\"line\">\t    </div><div class=\"line\">\t    <span class=\"comment\">/**</span></div><div class=\"line\"><span class=\"comment\">\t     * 读操作,用读锁来锁定</span></div><div class=\"line\"><span class=\"comment\">\t     * <span class=\"doctag\">@param</span> thread</span></div><div class=\"line\"><span class=\"comment\">\t     */</span></div><div class=\"line\">\t    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">get</span><span class=\"params\">(Thread thread)</span> </span>&#123;</div><div class=\"line\">\t        rwl.readLock().lock();</div><div class=\"line\">\t        <span class=\"keyword\">try</span> &#123;</div><div class=\"line\">\t            <span class=\"keyword\">long</span> start = System.currentTimeMillis();</div><div class=\"line\">\t             </div><div class=\"line\">\t            <span class=\"keyword\">while</span>(System.currentTimeMillis() - start &lt;= <span class=\"number\">1</span>) &#123;</div><div class=\"line\">\t                System.out.println(thread.getName()+<span class=\"string\">\"正在进行读操作\"</span>);</div><div class=\"line\">\t            &#125;</div><div class=\"line\">\t            System.out.println(thread.getName()+<span class=\"string\">\"读操作完毕\"</span>);</div><div class=\"line\">\t        &#125; <span class=\"keyword\">finally</span> &#123;</div><div class=\"line\">\t            rwl.readLock().unlock();</div><div class=\"line\">\t        &#125;</div><div class=\"line\">\t    &#125;</div><div class=\"line\"></div><div class=\"line\">\t    <span class=\"comment\">/**</span></div><div class=\"line\"><span class=\"comment\">\t     * 写操作，用写锁来锁定</span></div><div class=\"line\"><span class=\"comment\">\t     * <span class=\"doctag\">@param</span> thread</span></div><div class=\"line\"><span class=\"comment\">\t     */</span></div><div class=\"line\">\t    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">write</span><span class=\"params\">(Thread thread)</span> </span>&#123;</div><div class=\"line\">\t        rwl.writeLock().lock();;</div><div class=\"line\">\t        <span class=\"keyword\">try</span> &#123;</div><div class=\"line\">\t            <span class=\"keyword\">long</span> start = System.currentTimeMillis();</div><div class=\"line\">\t            <span class=\"keyword\">while</span>(System.currentTimeMillis() - start &lt;= <span class=\"number\">1</span>) &#123;</div><div class=\"line\">\t                System.out.println(thread.getName()+<span class=\"string\">\"正在进行写操作\"</span>);</div><div class=\"line\">\t            &#125;</div><div class=\"line\">\t            System.out.println(thread.getName()+<span class=\"string\">\"写操作完毕\"</span>);</div><div class=\"line\">\t        &#125; <span class=\"keyword\">finally</span> &#123;</div><div class=\"line\">\t            rwl.writeLock().unlock();</div><div class=\"line\">\t        &#125;</div><div class=\"line\">\t    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<blockquote>\n<p>注意：</p>\n<ul>\n<li>不过要注意的是，如果有一个线程已经占用了读锁，则此时其他线程如果要申请写锁，则申请写锁的线程会一直等待释放读锁。</li>\n<li>如果有一个线程已经占用了写锁，则此时其他线程如果申请写锁或者读锁，则申请的线程会一直等待释放写锁。</li>\n</ul>\n</blockquote>\n<h2 id=\"Lock和synchronized的选择\"><a href=\"#Lock和synchronized的选择\" class=\"headerlink\" title=\"Lock和synchronized的选择\"></a>Lock和synchronized的选择</h2><ol>\n<li>Lock是一个接口，而synchronized是Java中的关键字，synchronized是内置的语言实现；</li>\n<li>synchronized在发生异常时，会自动释放线程占有的锁，因此不会导致死锁现象发生；而Lock在发生异常时，如果没有主动通过unLock()去释放锁，则很可能造成死锁现象，因此使用Lock时需要在finally块中释放锁；</li>\n<li>Lock可以让等待锁的线程响应中断，而synchronized却不行，使用synchronized时，等待的线程会一直等待下去，不能够响应中断；</li>\n<li>通过Lock可以知道有没有成功获取锁，而synchronized却无法办到。</li>\n<li>Lock可以提高多个线程进行读操作的效率。</li>\n</ol>\n<p>在性能上来说，如果竞争资源不激烈，两者的性能是差不多的，而当竞争资源非常激烈时（即有大量线程同时竞争），此时Lock的性能要远远优于synchronized。所以说，在具体使用时要根据适当情况选择。</p>\n<h1 id=\"java并发包\"><a href=\"#java并发包\" class=\"headerlink\" title=\"java并发包\"></a>java并发包</h1><h2 id=\"java并发包介绍\"><a href=\"#java并发包介绍\" class=\"headerlink\" title=\"java并发包介绍\"></a>java并发包介绍</h2><p>JDK5.0 以后的版本都引入了高级并发特性，大多数的特性在java.util.concurrent 包中，是专门用于多线程发编程的，充分利用了现代多处理器和多核心系统的功能以编写大规模并发应用程序。主要包含<font color=\"red\">原子量、并发集合、同步器、</font>可重入锁，并对线程池的构造提供了强力的支持。</p>\n<h3 id=\"线程池\"><a href=\"#线程池\" class=\"headerlink\" title=\"线程池\"></a>线程池</h3><h4 id=\"创建方式\"><a href=\"#创建方式\" class=\"headerlink\" title=\"创建方式\"></a>创建方式</h4><p>五种创建方式</p>\n<h5 id=\"Single-Thread-Executor\"><a href=\"#Single-Thread-Executor\" class=\"headerlink\" title=\"Single Thread Executor\"></a>Single Thread Executor</h5><p>只有一个线程的线程池，因此所有提交的任务是顺序执行<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\"></div><div class=\"line\">##### Cached Thread Pool </div><div class=\"line\">线程池里有很多线程需要同时执行，老的可用线程将被新的任务触发重新执行，&lt;font color=&quot;red&quot;&gt;如果线程超过60秒内没执行，那么将被终止并从池中删除&lt;/font&gt;  </div><div class=\"line\">```Executors.newCachedThreadPool()</div></pre></td></tr></table></figure></p>\n<h5 id=\"Fixed-Thread-Pool\"><a href=\"#Fixed-Thread-Pool\" class=\"headerlink\" title=\"Fixed Thread Pool\"></a>Fixed Thread Pool</h5><p><font color=\"red\">拥有固定线程数的线程池，如果没有任务执行，那么线程会一直等待</font><br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\">在构造函数中的参数4是线程池的大小，你可以随意设置，也可以和cpu的核数量保持一致，获取cpu的核数量  </div><div class=\"line\">```int cpuNums = Runtime.getRuntime().availableProcessors();</div></pre></td></tr></table></figure></p>\n<h5 id=\"Scheduled-Thread-Pool\"><a href=\"#Scheduled-Thread-Pool\" class=\"headerlink\" title=\"Scheduled Thread Pool\"></a>Scheduled Thread Pool</h5><p>用来调度即将执行的任务的线程池，可能是不是直接执行, 每隔多久执行一次… 策略型的<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\"></div><div class=\"line\">##### Single Thread Scheduled Pool </div><div class=\"line\">只有一个线程，用来调度任务在指定时间执行</div><div class=\"line\">```Executors.newSingleThreadScheduledExecutor()</div></pre></td></tr></table></figure></p>\n<h3 id=\"线程池的使用\"><a href=\"#线程池的使用\" class=\"headerlink\" title=\"线程池的使用\"></a>线程池的使用</h3><p>提交 Runnable ，任务完成后 Future 对象返回 null<br>调用excute,提交任务, 匿名Runable重写run方法, run方法里是业务逻辑<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">package</span> cn.itcast_01_mythread.pool;</div><div class=\"line\"><span class=\"keyword\">import</span> java.util.concurrent.ExecutorService;</div><div class=\"line\"><span class=\"keyword\">import</span> java.util.concurrent.Executors;</div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ThreadPoolWithRunable</span> </span>&#123;</div><div class=\"line\">\t<span class=\"comment\">/**</span></div><div class=\"line\"><span class=\"comment\">\t * 通过线程池执行线程</span></div><div class=\"line\"><span class=\"comment\">\t * <span class=\"doctag\">@param</span> args</span></div><div class=\"line\"><span class=\"comment\">\t */</span></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</div><div class=\"line\">\t\t<span class=\"comment\">//创建一个线程池</span></div><div class=\"line\">\t\tExecutorService pool = Executors.newCachedThreadPool();</div><div class=\"line\">\t\t<span class=\"keyword\">for</span>(<span class=\"keyword\">int</span> i = <span class=\"number\">1</span>; i &lt; <span class=\"number\">5</span>; i++)&#123;</div><div class=\"line\">\t\t\tpool.execute(<span class=\"keyword\">new</span> Runnable() &#123;</div><div class=\"line\">\t\t\t\t<span class=\"meta\">@Override</span></div><div class=\"line\">\t\t\t\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">\t\t\t\t\tSystem.out.println(<span class=\"string\">\"thread name: \"</span> + Thread.currentThread().getName());</div><div class=\"line\">\t\t\t\t\t<span class=\"keyword\">try</span> &#123;</div><div class=\"line\">\t\t\t\t\t\tThread.sleep(<span class=\"number\">1000</span>);</div><div class=\"line\">\t\t\t\t\t&#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</div><div class=\"line\">\t\t\t\t\t\te.printStackTrace();</div><div class=\"line\">\t\t\t\t\t&#125;</div><div class=\"line\">\t\t\t\t&#125;</div><div class=\"line\">\t\t\t&#125;);</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t\tpool.shutdown();</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>提交 Callable，该方法返回一个 Future 实例表示任务的状态<br>调用submit提交任务, 匿名Callable,重写call方法, 有返回值, 获取返回值会阻塞,一直要等到线程任务返回结果<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">package</span> cn.itcast_01_mythread.pool;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">import</span> java.util.ArrayList;</div><div class=\"line\"><span class=\"keyword\">import</span> java.util.List;</div><div class=\"line\"><span class=\"keyword\">import</span> java.util.concurrent.Callable;</div><div class=\"line\"><span class=\"keyword\">import</span> java.util.concurrent.ExecutionException;</div><div class=\"line\"><span class=\"keyword\">import</span> java.util.concurrent.ExecutorService;</div><div class=\"line\"><span class=\"keyword\">import</span> java.util.concurrent.Executors;</div><div class=\"line\"><span class=\"keyword\">import</span> java.util.concurrent.Future;</div><div class=\"line\"><span class=\"comment\">/**</span></div><div class=\"line\"><span class=\"comment\"> * callable 跟runnable的区别：</span></div><div class=\"line\"><span class=\"comment\"> * runnable的run方法不会有任何返回结果，所以主线程无法获得任务线程的返回值</span></div><div class=\"line\"><span class=\"comment\"> * </span></div><div class=\"line\"><span class=\"comment\"> * callable的call方法可以返回结果，但是主线程在获取时是被阻塞，需要等待任务线程返回才能拿到结果</span></div><div class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span></span></div><div class=\"line\"><span class=\"comment\"> *</span></div><div class=\"line\"><span class=\"comment\"> */</span></div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ThreadPoolWithcallable</span> </span>&#123;</div><div class=\"line\"></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> InterruptedException, ExecutionException </span>&#123;</div><div class=\"line\">\t\tExecutorService pool = Executors.newFixedThreadPool(<span class=\"number\">4</span>); </div><div class=\"line\">\t\t</div><div class=\"line\">\t\t<span class=\"keyword\">for</span>(<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">10</span>; i++)&#123;</div><div class=\"line\">\t\t\tFuture&lt;String&gt; submit = pool.submit(<span class=\"keyword\">new</span> Callable&lt;String&gt;()&#123;</div><div class=\"line\">\t\t\t\t<span class=\"meta\">@Override</span></div><div class=\"line\">\t\t\t\t<span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">call</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</div><div class=\"line\">\t\t\t\t\t<span class=\"comment\">//System.out.println(\"a\");</span></div><div class=\"line\">\t\t\t\t\tThread.sleep(<span class=\"number\">5000</span>);</div><div class=\"line\">\t\t\t\t\t<span class=\"keyword\">return</span> <span class=\"string\">\"b--\"</span>+Thread.currentThread().getName();</div><div class=\"line\">\t\t\t\t&#125;\t\t\t   </div><div class=\"line\">\t\t\t   &#125;);</div><div class=\"line\">\t\t\t<span class=\"comment\">//从Future中get结果，这个方法是会被阻塞的，一直要等到线程任务返回结果</span></div><div class=\"line\">\t\t\tSystem.out.println(submit.get());</div><div class=\"line\">\t\t&#125; </div><div class=\"line\">\t\t\tpool.shutdown();</div><div class=\"line\"></div><div class=\"line\">\t&#125;</div><div class=\"line\"></div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<h2 id=\"java并发包消息队列及在开源软件中的应用\"><a href=\"#java并发包消息队列及在开源软件中的应用\" class=\"headerlink\" title=\"java并发包消息队列及在开源软件中的应用\"></a>java并发包消息队列及在开源软件中的应用</h2><h3 id=\"BlockingQueue\"><a href=\"#BlockingQueue\" class=\"headerlink\" title=\"BlockingQueue\"></a>BlockingQueue</h3><p>也是java.util.concurrent下的主要用来<font color=\"red\">控制线程同步的工具</font>。<br>主要的方法是：put、take一对阻塞存取；add、poll一对非阻塞存取。  </p>\n<ul>\n<li>插入:<ol>\n<li>add(anObject):把anObject加到BlockingQueue里,即如果BlockingQueue可以容纳,则返回true,否则抛出异常,不好</li>\n<li>offer(anObject):表示如果可能的话,将anObject加到BlockingQueue里,即如果BlockingQueue可以容纳,则返回true,否则返回false.</li>\n<li>put(anObject):把anObject加到BlockingQueue里,如果BlockQueue没有空间,则调用此方法的线程被阻断直到BlockingQueue里面有空间再继续, 有阻塞, 放不进去就等待</li>\n</ol>\n</li>\n<li>读取：<ol>\n<li>poll(time):取走BlockingQueue里排在首位的对象,若不能立即取出,则可以等time参数规定的时间,取不到时返回null; 取不到返回null</li>\n<li>take():取走BlockingQueue里排在首位的对象,若BlockingQueue为空,阻断进入等待状态直到Blocking有新的对象被加入为止; <font color=\"red\">阻塞, 取不到就一直等</font></li>\n</ol>\n</li>\n<li>其他<ol>\n<li>int remainingCapacity();返回队列剩余的容量，在队列插入和获取的时候，<font color=\"red\">不要瞎搞，数据可能不准, 不能保证数据的准确性</font></li>\n<li>boolean remove(Object o); 从队列移除元素，如果存在，即移除一个或者更多，队列改    变了返回true</li>\n<li>public boolean contains(Object o); 查看队列是否存在这个元素，存在返回true</li>\n<li>int drainTo(Collection&lt;? super E&gt; c); //移除此队列中所有可用的元素,并将它们添加到给定 collection 中。<font color=\"red\">取出放到集合中</font></li>\n<li>int drainTo(Collection&lt;? super E&gt; c, int maxElements); 和上面方法的区别在于，指定了移动的数量;取出指定个数放到集合</li>\n</ol>\n</li>\n</ul>\n<p>BlockingQueue有四个具体的实现类,常用的两种实现类为：</p>\n<h3 id=\"ArrayBlockingQueue\"><a href=\"#ArrayBlockingQueue\" class=\"headerlink\" title=\"ArrayBlockingQueue\"></a>ArrayBlockingQueue</h3><p>一个由数组支持的有界阻塞队列，规定大小的BlockingQueue,其构造函数必须带一个int参数来指明其大小.其所含的对象是以FIFO(先入先出)顺序排序的。</p>\n<h3 id=\"LinkedBlockingQueue\"><a href=\"#LinkedBlockingQueue\" class=\"headerlink\" title=\"LinkedBlockingQueue\"></a>LinkedBlockingQueue</h3><p>大小不定的BlockingQueue,若其构造函数带一个规定大小的参数,生成的BlockingQueue有大小限制,若不带大小参数,所生成的BlockingQueue的大小由Integer.MAX_VALUE来决定.其所含的对象是以FIFO(先入先出)顺序排序的。<br>LinkedBlockingQueue 可以指定容量，也可以不指定，不指定的话，默认最大是Integer.MAX_VALUE,其中主要用到put和take方法，put方法在队列满的时候会阻塞直到有队列成员被消费，take方法在队列空的时候会阻塞，直到有队列成员被放进来。</p>\n<h3 id=\"LinkedBlockingQueue和ArrayBlockingQueue区别\"><a href=\"#LinkedBlockingQueue和ArrayBlockingQueue区别\" class=\"headerlink\" title=\"LinkedBlockingQueue和ArrayBlockingQueue区别\"></a>LinkedBlockingQueue和ArrayBlockingQueue区别</h3><p>LinkedBlockingQueue和ArrayBlockingQueue比较起来,它们背后所用的数据结构不一样,导致LinkedBlockingQueue的数据吞吐量要大于ArrayBlockingQueue,但在线程数量很大时其性能的可预见性低于ArrayBlockingQueue.</p>\n<p>生产者消费者的示例代码：<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div><div class=\"line\">87</div><div class=\"line\">88</div><div class=\"line\">89</div><div class=\"line\">90</div><div class=\"line\">91</div><div class=\"line\">92</div><div class=\"line\">93</div><div class=\"line\">94</div><div class=\"line\">95</div><div class=\"line\">96</div><div class=\"line\">97</div><div class=\"line\">98</div><div class=\"line\">99</div><div class=\"line\">100</div><div class=\"line\">101</div><div class=\"line\">102</div><div class=\"line\">103</div><div class=\"line\">104</div><div class=\"line\">105</div><div class=\"line\">106</div><div class=\"line\">107</div><div class=\"line\">108</div><div class=\"line\">109</div><div class=\"line\">110</div><div class=\"line\">111</div><div class=\"line\">112</div><div class=\"line\">113</div><div class=\"line\">114</div><div class=\"line\">115</div><div class=\"line\">116</div><div class=\"line\">117</div><div class=\"line\">118</div><div class=\"line\">119</div><div class=\"line\">120</div><div class=\"line\">121</div><div class=\"line\">122</div><div class=\"line\">123</div><div class=\"line\">124</div><div class=\"line\">125</div><div class=\"line\">126</div><div class=\"line\">127</div><div class=\"line\">128</div><div class=\"line\">129</div><div class=\"line\">130</div><div class=\"line\">131</div><div class=\"line\">132</div><div class=\"line\">133</div><div class=\"line\">134</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">package</span> cn.itcast_02_blockingqueue.main;</div><div class=\"line\"><span class=\"keyword\">import</span> java.util.concurrent.BlockingQueue;</div><div class=\"line\"><span class=\"keyword\">import</span> java.util.concurrent.LinkedBlockingQueue;</div><div class=\"line\"><span class=\"keyword\">import</span> cn.itcast_02_blockingqueue.consumer.Consumer;</div><div class=\"line\"><span class=\"keyword\">import</span> cn.itcast_02_blockingqueue.producer.Producer;</div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Test</span> </span>&#123;</div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</div><div class=\"line\">\t\tBlockingQueue&lt;String&gt; queue = <span class=\"keyword\">new</span> LinkedBlockingQueue&lt;String&gt;(<span class=\"number\">2</span>);</div><div class=\"line\">\t\t<span class=\"comment\">// BlockingQueue&lt;String&gt; queue = new LinkedBlockingQueue&lt;String&gt;();</span></div><div class=\"line\">\t\t<span class=\"comment\">// 不设置的话，LinkedBlockingQueue默认大小为Integer.MAX_VALUE</span></div><div class=\"line\">\t\t<span class=\"comment\">// BlockingQueue&lt;String&gt; queue = new ArrayBlockingQueue&lt;String&gt;(2);</span></div><div class=\"line\">\t\tConsumer consumer = <span class=\"keyword\">new</span> Consumer(queue);</div><div class=\"line\">\t\tProducer producer = <span class=\"keyword\">new</span> Producer(queue);</div><div class=\"line\">\t\t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">3</span>; i++) &#123;</div><div class=\"line\">\t\t\t<span class=\"keyword\">new</span> Thread(producer, <span class=\"string\">\"Producer\"</span> + (i + <span class=\"number\">1</span>)).start();</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t\t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">5</span>; i++) &#123;</div><div class=\"line\">\t\t\t<span class=\"keyword\">new</span> Thread(consumer, <span class=\"string\">\"Consumer\"</span> + (i + <span class=\"number\">1</span>)).start();</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t\t<span class=\"keyword\">new</span> Thread(producer, <span class=\"string\">\"Producer\"</span> + (<span class=\"number\">5</span>)).start();</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\">=====================================================================</div><div class=\"line\"><span class=\"keyword\">package</span> cn.itcast_02_blockingqueue.main;</div><div class=\"line\"><span class=\"keyword\">import</span> java.util.concurrent.BlockingQueue;</div><div class=\"line\"><span class=\"keyword\">import</span> java.util.concurrent.LinkedBlockingQueue;</div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">TestBlockingQueue</span> </span>&#123;</div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</div><div class=\"line\">\t\tBlockingQueue&lt;String&gt; queue = <span class=\"keyword\">new</span> LinkedBlockingQueue&lt;String&gt;(<span class=\"number\">2</span>);</div><div class=\"line\">\t\t<span class=\"comment\">// BlockingQueue&lt;String&gt; queue = new LinkedBlockingQueue&lt;String&gt;();</span></div><div class=\"line\">\t\t<span class=\"comment\">// 不设置的话，LinkedBlockingQueue默认大小为Integer.MAX_VALUE</span></div><div class=\"line\">\t\t<span class=\"comment\">// BlockingQueue&lt;String&gt; queue = new ArrayBlockingQueue&lt;String&gt;(2);</span></div><div class=\"line\">\t\tTestBlockingQueueConsumer consumer = <span class=\"keyword\">new</span> TestBlockingQueueConsumer(queue);</div><div class=\"line\">\t\tTestBlockingQueueProducer producer = <span class=\"keyword\">new</span> TestBlockingQueueProducer(queue);</div><div class=\"line\">\t\t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">3</span>; i++) &#123;</div><div class=\"line\">\t\t\t<span class=\"keyword\">new</span> Thread(producer, <span class=\"string\">\"Producer\"</span> + (i + <span class=\"number\">1</span>)).start();</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t\t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">5</span>; i++) &#123;</div><div class=\"line\">\t\t\t<span class=\"keyword\">new</span> Thread(consumer, <span class=\"string\">\"Consumer\"</span> + (i + <span class=\"number\">1</span>)).start();</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t\t<span class=\"keyword\">new</span> Thread(producer, <span class=\"string\">\"Producer\"</span> + (<span class=\"number\">5</span>)).start();</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div><div class=\"line\">=====================================================================</div><div class=\"line\"><span class=\"keyword\">package</span> cn.itcast_02_blockingqueue.main;</div><div class=\"line\"><span class=\"keyword\">import</span> java.util.Random;</div><div class=\"line\"><span class=\"keyword\">import</span> java.util.concurrent.BlockingQueue;</div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">TestBlockingQueueConsumer</span> <span class=\"keyword\">implements</span> <span class=\"title\">Runnable</span></span>&#123;  </div><div class=\"line\">    BlockingQueue&lt;String&gt; queue; </div><div class=\"line\">    Random random = <span class=\"keyword\">new</span> Random();</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">TestBlockingQueueConsumer</span><span class=\"params\">(BlockingQueue&lt;String&gt; queue)</span></span>&#123;  </div><div class=\"line\">        <span class=\"keyword\">this</span>.queue = queue;  </div><div class=\"line\">    &#125;        </div><div class=\"line\">    <span class=\"meta\">@Override</span>  </div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;  </div><div class=\"line\">        <span class=\"keyword\">try</span> &#123;  </div><div class=\"line\">        \tThread.sleep(random.nextInt(<span class=\"number\">10</span>));</div><div class=\"line\">        \tSystem.out.println(Thread.currentThread().getName()+ <span class=\"string\">\"trying...\"</span>);</div><div class=\"line\">            String temp = queue.take();<span class=\"comment\">//如果队列为空，会阻塞当前线程  </span></div><div class=\"line\">            System.out.println(Thread.currentThread().getName() + <span class=\"string\">\" get a job \"</span> +temp);  </div><div class=\"line\">        &#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;  </div><div class=\"line\">            e.printStackTrace();  </div><div class=\"line\">        &#125;  </div><div class=\"line\">    &#125;  </div><div class=\"line\">&#125;</div><div class=\"line\">=====================================================================</div><div class=\"line\"><span class=\"keyword\">package</span> cn.itcast_02_blockingqueue.main;</div><div class=\"line\"><span class=\"keyword\">import</span> java.util.Random;</div><div class=\"line\"><span class=\"keyword\">import</span> java.util.concurrent.BlockingQueue;</div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">TestBlockingQueueProducer</span> <span class=\"keyword\">implements</span> <span class=\"title\">Runnable</span> </span>&#123;</div><div class=\"line\">\tBlockingQueue&lt;String&gt; queue;</div><div class=\"line\">\tRandom random = <span class=\"keyword\">new</span> Random();</div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">TestBlockingQueueProducer</span><span class=\"params\">(BlockingQueue&lt;String&gt; queue)</span> </span>&#123;</div><div class=\"line\">\t\t<span class=\"keyword\">this</span>.queue = queue;</div><div class=\"line\">\t&#125;</div><div class=\"line\">\t<span class=\"meta\">@Override</span></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">\t\t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">10</span>; i++) &#123;</div><div class=\"line\">\t\t\t<span class=\"keyword\">try</span> &#123;</div><div class=\"line\">\t\t\t\tThread.sleep(random.nextInt(<span class=\"number\">10</span>));</div><div class=\"line\">\t\t\t\tString task = Thread.currentThread().getName() + <span class=\"string\">\" made a product \"</span> + i;</div><div class=\"line\">\t\t\t\tSystem.out.println(task);</div><div class=\"line\">\t\t\t\tqueue.put(task);</div><div class=\"line\">\t\t\t&#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</div><div class=\"line\">\t\t\t\te.printStackTrace();</div><div class=\"line\">\t\t\t&#125;</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t&#125;</div><div class=\"line\"></div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\">=====================================================================</div><div class=\"line\"><span class=\"keyword\">package</span> cn.itcast_02_blockingqueue.producer;</div><div class=\"line\"><span class=\"keyword\">import</span> java.util.concurrent.BlockingQueue;</div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Producer</span> <span class=\"keyword\">implements</span> <span class=\"title\">Runnable</span> </span>&#123;  </div><div class=\"line\">    BlockingQueue&lt;String&gt; queue;    </div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">Producer</span><span class=\"params\">(BlockingQueue&lt;String&gt; queue)</span> </span>&#123;  </div><div class=\"line\">        <span class=\"keyword\">this</span>.queue = queue;  </div><div class=\"line\">    &#125;    </div><div class=\"line\">    <span class=\"meta\">@Override</span>  </div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;  </div><div class=\"line\">        <span class=\"keyword\">try</span> &#123;  </div><div class=\"line\">            </div><div class=\"line\">            System.out.println(<span class=\"string\">\"I have made a product:\"</span>  </div><div class=\"line\">                    + Thread.currentThread().getName()); </div><div class=\"line\">            String temp = <span class=\"string\">\"A Product, 生产线程：\"</span>  </div><div class=\"line\">                    + Thread.currentThread().getName();  </div><div class=\"line\">            queue.put(temp);<span class=\"comment\">//如果队列是满的话，会阻塞当前线程  </span></div><div class=\"line\">        &#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;  </div><div class=\"line\">            e.printStackTrace();  </div><div class=\"line\">        &#125;  </div><div class=\"line\">    &#125;    </div><div class=\"line\">&#125;  </div><div class=\"line\">=====================================================================</div><div class=\"line\"><span class=\"keyword\">package</span> cn.itcast_02_blockingqueue.consumer;</div><div class=\"line\"><span class=\"keyword\">import</span> java.util.concurrent.BlockingQueue;</div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Consumer</span> <span class=\"keyword\">implements</span> <span class=\"title\">Runnable</span></span>&#123;  </div><div class=\"line\">    BlockingQueue&lt;String&gt; queue; </div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">Consumer</span><span class=\"params\">(BlockingQueue&lt;String&gt; queue)</span></span>&#123;  </div><div class=\"line\">        <span class=\"keyword\">this</span>.queue = queue;  </div><div class=\"line\">    &#125;        </div><div class=\"line\">    <span class=\"meta\">@Override</span>  </div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;  </div><div class=\"line\">        <span class=\"keyword\">try</span> &#123;  </div><div class=\"line\">        \tString consumer = Thread.currentThread().getName();</div><div class=\"line\">        \tSystem.out.println(consumer);  </div><div class=\"line\">            String temp = queue.take();<span class=\"comment\">//如果队列为空，会阻塞当前线程  </span></div><div class=\"line\">            System.out.println(consumer+<span class=\"string\">\"get a product:\"</span>+temp);  </div><div class=\"line\">        &#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;  </div><div class=\"line\">            e.printStackTrace();  </div><div class=\"line\">        &#125;  </div><div class=\"line\">    &#125;  </div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<h1 id=\"java并发编程的一些总结\"><a href=\"#java并发编程的一些总结\" class=\"headerlink\" title=\"java并发编程的一些总结\"></a>java并发编程的一些总结</h1><h2 id=\"不应用线程池的缺点\"><a href=\"#不应用线程池的缺点\" class=\"headerlink\" title=\"不应用线程池的缺点\"></a>不应用线程池的缺点</h2><p>有些开发者图省事，遇到需要多线程处理的地方，直接new Thread(…).start()，对于一般场景是没问题的，但如果是在并发请求很高的情况下，就会有些隐患：</p>\n<ul>\n<li>新建线程的开销。线程虽然比进程要轻量许多，但对于JVM来说，新建一个线程的代价还是挺大的，决不同于新建一个对象</li>\n<li>资源消耗量。没有一个池来限制线程的数量，会导致线程的数量直接取决于应用的并发量，这样有潜在的线程数据巨大的可能，那么资源消耗量将是巨大的</li>\n<li>稳定性。当线程数量超过系统资源所能承受的程度，稳定性就会成问题<h2 id=\"制定执行策略\"><a href=\"#制定执行策略\" class=\"headerlink\" title=\"制定执行策略\"></a>制定执行策略</h2>在每个需要多线程处理的地方，不管并发量有多大，需要考虑线程的执行策略</li>\n<li>任务以什么顺序执行</li>\n<li>可以有多少个任务并发执行</li>\n<li>可以有多少个任务进入等待执行队列</li>\n<li>系统过载的时候，应该放弃哪些任务？如何通知到应用程序？</li>\n<li>一个任务的执行前后应该做什么处理</li>\n</ul>\n<h2 id=\"线程池的类型\"><a href=\"#线程池的类型\" class=\"headerlink\" title=\"线程池的类型\"></a>线程池的类型</h2><p>不管是通过Executors创建线程池，还是通过Spring来管理，都得清楚知道有哪几种线程池：</p>\n<ul>\n<li>FixedThreadPool：定长线程池，提交任务时创建线程，直到池的最大容量，如果有线程非预期结束，会补充新线程</li>\n<li>CachedThreadPool：可变线程池，它犹如一个弹簧，如果没有任务需求时，它回收空闲线程，如果需求增加，则按需增加线程，不对池的大小做限制</li>\n<li>SingleThreadExecutor：单线程。处理不过来的任务会进入FIFO队列等待执行</li>\n<li>SecheduledThreadPool：周期性线程池。支持执行周期性线程任务<br>其实，这些不同类型的线程池都是通过构建一个ThreadPoolExecutor来完成的，所不同的是corePoolSize,maximumPoolSize,keepAliveTime,unit,workQueue,threadFactory这么几个参数。具体可以参见JDK DOC。</li>\n</ul>\n<h2 id=\"线程池饱和策略\"><a href=\"#线程池饱和策略\" class=\"headerlink\" title=\"线程池饱和策略\"></a>线程池饱和策略</h2><p>由以上线程池类型可知，除了CachedThreadPool其他线程池都有饱和的可能，当饱和以后就需要相应的策略处理请求线程的任务，比如，达到上限时通过ThreadPoolExecutor.setRejectedExecutionHandler方法设置一个拒绝任务的策略，JDK提供了AbortPolicy、CallerRunsPolicy、DiscardPolicy、DiscardOldestPolicy几种策略，具体差异可见JDK DOC</p>\n<h2 id=\"线程无依赖性\"><a href=\"#线程无依赖性\" class=\"headerlink\" title=\"线程无依赖性\"></a>线程无依赖性</h2><p><font color=\"red\">多线程任务设计上尽量使得各任务是独立无依赖的</font>，所谓依赖性可两个方面：</p>\n<ul>\n<li>线程之间的依赖性。如果线程有依赖可能会造成死锁或饥饿</li>\n<li>调用者与线程的依赖性。调用者得监视线程的完成情况，影响可并发量<br>当然，在有些业务里确实需要一定的依赖性，比如调用者需要得到线程完成后结果，传统的Thread是不便完成的，因为run方法无返回值，只能通过一些共享的变量来传递结果，但在Executor框架里可以通过Future和Callable实现需要有返回值的任务，当然线程的异步性导致需要有相应机制来保证调用者能等待任务完成，关于Future和Callable的用法前文已讲解；</li>\n</ul>\n","site":{"data":{}},"excerpt":"<p>内容包含</p>\n<ol>\n<li>掌握多线程</li>\n<li>掌握并发包下的队列</li>\n</ol>\n<p>做个笔记，方便查看<br>","more":"</p>\n<h1 id=\"java多线程增强\"><a href=\"#java多线程增强\" class=\"headerlink\" title=\"java多线程增强\"></a>java多线程增强</h1><h2 id=\"进程介绍\"><a href=\"#进程介绍\" class=\"headerlink\" title=\"进程介绍\"></a>进程介绍</h2><p>不管是我们开发的应用程序，还是我们运行的其他的应用程序，都需要先把程序安装在本地的硬盘上。然后找到这个程序的启动文件，启动程序的时候，其实是电脑把当前的这个程序加载到内存中，在<font color=\"red\">内存中需要给当前的程序分配一段独立的运行空间</font>。这片空间就专门负责当前这个程序的运行。  </p>\n<p>不同的应用程序运行的过程中都需要在内存中分配自己独立的运行空间，彼此之间不会相互的影响。我们把每个独立应用程序在内存的独立空间称为当前应用程序运行的一个进程。  </p>\n<p>进程：它是内存中的一段独立的空间，可以负责当前应用程序的运行。当前这个进程负责调度当前程序中的所有运行细节。</p>\n<h2 id=\"线程介绍\"><a href=\"#线程介绍\" class=\"headerlink\" title=\"线程介绍\"></a>线程介绍</h2><p>在一个进程中，每个独立的功能都需要独立的去运行，这时又需要把当前这个进程划分成多个运行区域，每个独立的小区域（小单元）称为一个线程。</p>\n<p>线程：它是位于进程中，负责当前进程中的某个具备独立运行资格的空间。<br>进程是负责整个程序的运行，而线程是程序中具体的某个独立功能的运行。一个进程中至少应该有一个线程。</p>\n<h2 id=\"多线程介绍\"><a href=\"#多线程介绍\" class=\"headerlink\" title=\"多线程介绍\"></a>多线程介绍</h2><p>多线程：<font color=\"red\">在一个进程中，我们同时开启多个线程，让多个线程同时去完成某些任务（功能）。<br>(比如后台服务系统，就可以用多个线程同时响应多个客户的请求)</font><br>多线程的目的：提高程序的运行效率。</p>\n<h2 id=\"多线程运行的原理\"><a href=\"#多线程运行的原理\" class=\"headerlink\" title=\"多线程运行的原理\"></a>多线程运行的原理</h2><p>cpu在线程中做时间片的切换。</p>\n<p>其实真正电脑中的程序的运行不是同时在运行的。CPU负责程序的运行，而CPU在运行程序的过程中某个时刻点上，它其实只能运行一个程序。而不是多个程序。而CPU它可以在多个程序之间进行高速的切换。而切换频率和速度太快，导致人的肉眼看不到。<br>每个程序就是进程， 而每个进程中会有多个线程，而CPU是在这些线程之间进行切换。<br>了解了CPU对一个任务的执行过程，我们就必须知道，多线程可以提高程序的运行效率，但不能无限制的开线程。  </p>\n<h2 id=\"实现线程的两种方式\"><a href=\"#实现线程的两种方式\" class=\"headerlink\" title=\"实现线程的两种方式\"></a>实现线程的两种方式</h2><h3 id=\"继承Thread的方式\"><a href=\"#继承Thread的方式\" class=\"headerlink\" title=\"继承Thread的方式\"></a>继承Thread的方式</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">package</span> cn.itcast_01_mythread.thread.testThread;</div><div class=\"line\"><span class=\"keyword\">import</span> java.util.Random;</div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MyThreadWithExtends</span> <span class=\"keyword\">extends</span> <span class=\"title\">Thread</span> </span>&#123;</div><div class=\"line\">\tString flag;</div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">MyThreadWithExtends</span><span class=\"params\">(String flag)</span></span>&#123;</div><div class=\"line\">\t\t<span class=\"keyword\">this</span>.flag = flag;</div><div class=\"line\">\t&#125;</div><div class=\"line\">\t<span class=\"meta\">@Override</span></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">\t\tString tname = Thread.currentThread().getName();</div><div class=\"line\">\t\tSystem.out.println(tname+<span class=\"string\">\"线程的run方法被调用……\"</span>);</div><div class=\"line\">\t\tRandom random = <span class=\"keyword\">new</span> Random();</div><div class=\"line\">\t\t<span class=\"keyword\">for</span>(<span class=\"keyword\">int</span> i=<span class=\"number\">0</span>;i&lt;<span class=\"number\">20</span>;i++)&#123;</div><div class=\"line\">\t\t\t<span class=\"keyword\">try</span> &#123;</div><div class=\"line\">\t\t\t\tThread.sleep(random.nextInt(<span class=\"number\">10</span>)*<span class=\"number\">100</span>);</div><div class=\"line\">\t\t\t\tSystem.out.println(tname+ <span class=\"string\">\"....\"</span>+ flag);</div><div class=\"line\">\t\t\t&#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</div><div class=\"line\">\t\t\t\te.printStackTrace();</div><div class=\"line\">\t\t\t&#125;</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t&#125;</div><div class=\"line\"></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</div><div class=\"line\">\t\tThread thread1 = <span class=\"keyword\">new</span> MyThreadWithExtends(<span class=\"string\">\"a\"</span>);</div><div class=\"line\">\t\tThread thread2 = <span class=\"keyword\">new</span> MyThreadWithExtends(<span class=\"string\">\"b\"</span>);</div><div class=\"line\">\t\tthread1.start();</div><div class=\"line\">\t\tthread2.start();</div><div class=\"line\">\t\t<span class=\"comment\">/**</span></div><div class=\"line\"><span class=\"comment\">\t\t * 如果是调用thread的run方法，则只是一个普通的方法调用，不会开启新的线程</span></div><div class=\"line\"><span class=\"comment\">\t\t */</span></div><div class=\"line\"><span class=\"comment\">//\t\tthread1.run();</span></div><div class=\"line\"><span class=\"comment\">//\t\tthread2.run();</span></div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h3 id=\"声明实现-Runnable-接口的方式\"><a href=\"#声明实现-Runnable-接口的方式\" class=\"headerlink\" title=\"声明实现 Runnable 接口的方式\"></a>声明实现 Runnable 接口的方式</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">package</span> cn.itcast_01_mythread.thread.testThread;</div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MyThreadWithImpliment</span> <span class=\"keyword\">implements</span> <span class=\"title\">Runnable</span> </span>&#123;</div><div class=\"line\">\t<span class=\"keyword\">int</span> x;</div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">MyThreadWithImpliment</span><span class=\"params\">(<span class=\"keyword\">int</span> x)</span> </span>&#123;</div><div class=\"line\">\t\t<span class=\"keyword\">this</span>.x = x;</div><div class=\"line\">\t&#125;</div><div class=\"line\">\t<span class=\"meta\">@Override</span></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">\t\tString name = Thread.currentThread().getName();</div><div class=\"line\">\t\tSystem.out.println(<span class=\"string\">\"线程\"</span> + name + <span class=\"string\">\"的run方法被调用……\"</span>);</div><div class=\"line\">\t\t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">10</span>; i++) &#123;</div><div class=\"line\">\t\t\tSystem.out.println(x);</div><div class=\"line\">\t\t\t<span class=\"keyword\">try</span> &#123;</div><div class=\"line\">\t\t\t\tThread.sleep(<span class=\"number\">100</span>);</div><div class=\"line\">\t\t\t\t</div><div class=\"line\">\t\t\t&#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</div><div class=\"line\">\t\t\t\te.printStackTrace();</div><div class=\"line\">\t\t\t&#125;</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t&#125;</div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</div><div class=\"line\">\t\tThread thread1 = <span class=\"keyword\">new</span> Thread(<span class=\"keyword\">new</span> MyThreadWithImpliment(<span class=\"number\">1</span>), <span class=\"string\">\"thread-1\"</span>);</div><div class=\"line\">\t\tThread thread2 = <span class=\"keyword\">new</span> Thread(<span class=\"keyword\">new</span> MyThreadWithImpliment(<span class=\"number\">2</span>), <span class=\"string\">\"thread-2\"</span>);</div><div class=\"line\">\t\t thread1.start();</div><div class=\"line\">\t\t thread2.start();</div><div class=\"line\">\t\t<span class=\"comment\">// 注意调用run和调用start的区别,直接调用run，则都运行在main线程中</span></div><div class=\"line\"><span class=\"comment\">//\t\tthread1.run();</span></div><div class=\"line\"><span class=\"comment\">//\t\tthread2.run();</span></div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h1 id=\"java同步关键词解释\"><a href=\"#java同步关键词解释\" class=\"headerlink\" title=\"java同步关键词解释\"></a>java同步关键词解释</h1><h2 id=\"synchronized\"><a href=\"#synchronized\" class=\"headerlink\" title=\"synchronized\"></a>synchronized</h2><h3 id=\"加同步格式：\"><a href=\"#加同步格式：\" class=\"headerlink\" title=\"加同步格式：\"></a>加同步格式：</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\">synchronized( 需要一个任意的对象（锁） )&#123;</div><div class=\"line\">\t代码块中放操作共享数据的代码。</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">package</span> cn.itcast_01_mythread.thread.testThread;</div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MySynchronized</span> </span>&#123;</div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</div><div class=\"line\">\t\t<span class=\"keyword\">final</span> MySynchronized mySynchronized = <span class=\"keyword\">new</span> MySynchronized();</div><div class=\"line\">\t\t<span class=\"keyword\">final</span> MySynchronized mySynchronized2 = <span class=\"keyword\">new</span> MySynchronized();</div><div class=\"line\">\t\t<span class=\"keyword\">new</span> Thread(<span class=\"string\">\"thread1\"</span>) &#123;</div><div class=\"line\">\t\t\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">\t\t\t\t<span class=\"keyword\">synchronized</span> (mySynchronized) &#123;</div><div class=\"line\">\t\t\t\t<span class=\"keyword\">try</span> &#123;</div><div class=\"line\">\t\t\t\t\tSystem.out.println(<span class=\"keyword\">this</span>.getName()+<span class=\"string\">\" start\"</span>);</div><div class=\"line\">\t\t\t\t\t<span class=\"keyword\">int</span> i =<span class=\"number\">1</span>/<span class=\"number\">0</span>;   <span class=\"comment\">//如果发生异常，jvm会将锁释放</span></div><div class=\"line\">\t\t\t\t\tThread.sleep(<span class=\"number\">5000</span>);</div><div class=\"line\">\t\t\t\t\tSystem.out.println(<span class=\"keyword\">this</span>.getName()+<span class=\"string\">\"醒了\"</span>);</div><div class=\"line\">\t\t\t\t\tSystem.out.println(<span class=\"keyword\">this</span>.getName()+<span class=\"string\">\" end\"</span>);</div><div class=\"line\">\t\t\t\t&#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</div><div class=\"line\">\t\t\t\t\te.printStackTrace();</div><div class=\"line\">\t\t\t\t&#125;</div><div class=\"line\">\t\t\t\t&#125;</div><div class=\"line\">\t\t\t&#125;</div><div class=\"line\">\t\t&#125;.start();</div><div class=\"line\">\t\t<span class=\"keyword\">new</span> Thread(<span class=\"string\">\"thread2\"</span>) &#123;</div><div class=\"line\">\t\t\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">\t\t\t\t<span class=\"keyword\">synchronized</span> (mySynchronized) &#123;         <span class=\"comment\">//争抢同一把锁时，线程1没释放之前，线程2只能等待</span></div><div class=\"line\"><span class=\"comment\">//\t\t\t\t\tsynchronized (mySynchronized2) &#123;    //如果不是一把锁，可以看到两句话同时打印</span></div><div class=\"line\">\t\t\t\t\tSystem.out.println(<span class=\"keyword\">this</span>.getName()+<span class=\"string\">\" start\"</span>);</div><div class=\"line\">\t\t\t\t\tSystem.out.println(<span class=\"keyword\">this</span>.getName()+<span class=\"string\">\" end\"</span>);</div><div class=\"line\">\t\t\t\t\t</div><div class=\"line\">\t\t\t\t&#125;</div><div class=\"line\">\t\t\t&#125;</div><div class=\"line\">\t\t&#125;.start();</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h3 id=\"synchronized的缺陷\"><a href=\"#synchronized的缺陷\" class=\"headerlink\" title=\"synchronized的缺陷\"></a>synchronized的缺陷</h3><p>synchronized是java中的一个关键字，也就是说是Java语言内置的特性。<br>如果一个代码块被synchronized修饰了，当一个线程获取了对应的锁，并执行该代码块时，其他线程便只能一直等待，等待获取锁的线程释放锁，而这里获取锁的线程释放锁只会有两种情况：</p>\n<ol>\n<li>获取锁的线程执行完了该代码块，然后线程释放对锁的占有；</li>\n<li>线程执行发生异常，此时JVM会让线程自动释放锁。</li>\n</ol>\n<p>例子1：<br>如果这个获取锁的线程由于要等待IO或者其他原因（比如调用sleep方法）被阻塞了，但是又没有释放锁，其他线程便只能干巴巴地等待，试想一下，这多么影响程序执行效率。<br>因此就需要有一种机制<font color=\"red\">可以不让等待的线程一直无期限地等待下去（比如只等待一定的时间或者能够响应中断），通过Lock就可以办到。</font></p>\n<p>例子2：<br>当有多个线程读写文件时，读操作和写操作会发生冲突现象，写操作和写操作会发生冲突现象，但是读操作和读操作不会发生冲突现象。<br>但是采用synchronized关键字来实现同步的话，就会导致一个问题：<br>如果多个线程都只是进行读操作，当一个线程在进行读操作时，其他线程只能等待无法进行读操作。  </p>\n<p>因此就需要一种机制来使得多个线程都只是进行读操作时，线程之间不会发生冲突，通过Lock就可以办到。<br>另外，通过Lock可以知道线程有没有成功获取到锁。这个是synchronized无法办到的。<br>总的来说，也就是说Lock提供了比synchronized更多的功能。  </p>\n<h2 id=\"lock\"><a href=\"#lock\" class=\"headerlink\" title=\"lock\"></a>lock</h2><h3 id=\"lock和synchronized的区别\"><a href=\"#lock和synchronized的区别\" class=\"headerlink\" title=\"lock和synchronized的区别\"></a>lock和synchronized的区别</h3><ol>\n<li>Lock不是Java语言内置的，synchronized是Java语言的关键字，因此是内置特性。Lock是一个类，通过这个类可以实现同步访问；</li>\n<li>Lock和synchronized有一点非常大的不同，采用synchronized不需要用户去手动释放锁，当synchronized方法或者synchronized代码块执行完之后，系统会自动让线程释放对锁的占用；而Lock则必须要用户去手动释放锁，如果没有主动释放锁，就有可能导致出现死锁现象。<h3 id=\"java-util-concurrent-locks包下常用的类\"><a href=\"#java-util-concurrent-locks包下常用的类\" class=\"headerlink\" title=\"java.util.concurrent.locks包下常用的类\"></a>java.util.concurrent.locks包下常用的类</h3><h4 id=\"Lock\"><a href=\"#Lock\" class=\"headerlink\" title=\"Lock\"></a>Lock</h4>首先要说明的就是Lock，通过查看Lock的源码可知，Lock是一个接口：<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">Lock</span> </span>&#123;</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">lock</span><span class=\"params\">()</span></span>;</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">lockInterruptibly</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> InterruptedException</span>;</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">boolean</span> <span class=\"title\">tryLock</span><span class=\"params\">()</span></span>;</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">boolean</span> <span class=\"title\">tryLock</span><span class=\"params\">(<span class=\"keyword\">long</span> time, TimeUnit unit)</span> <span class=\"keyword\">throws</span> InterruptedException</span>;</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">unlock</span><span class=\"params\">()</span></span>;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n</li>\n</ol>\n<p>获取锁：lock()，lockInterruptibly()， tryLock()，tryLock(long time, TimeUnit unit)<br>释放锁：unlock()</p>\n<p>区别： </p>\n<ul>\n<li><p>lock()<br>平常使用得最多的一个方法，就是用来获取锁。如果锁已被其他线程获取，则进行等待。<br>由于在前面讲到如果采用Lock，必须主动去释放锁，并且在发生异常时，不会自动释放锁。因此一般来说，使用Lock必须在try{}catch{}块中进行，并且将释放锁的操作放在finally块中进行，以保证锁一定被被释放，防止死锁的发生。</p>\n</li>\n<li><p>tryLock()<br>有返回值的，它表示用来尝试获取锁，如果获取成功，则返回true，如果获取失败（即锁已被其他线程获取），则返回false，也就说这个方法无论如何都会立即返回。在拿不到锁时不会一直在那等待。</p>\n</li>\n<li><p>tryLock(long time, TimeUnit unit)<br>和tryLock()方法是类似的，只不过区别在于这个方法在拿不到锁时会等待一定的时间，在时间期限之内如果还拿不到锁，就返回false。如果如果一开始拿到锁或者在等待期间内拿到了锁，则返回true。</p>\n</li>\n<li><p>lockInterruptibly()<br>比较特殊，当通过这个方法去获取锁时，如果线程正在等待获取锁，则这个线程能够响应中断，即中断线程的等待状态。也就使说，当两个线程同时通过lock.lockInterruptibly()想获取某个锁时，假若此时线程A获取到了锁，而线程B只有等待，那么对线程B调用threadB.interrupt()方法能够中断线程B的等待过程。<br>注意，当一个线程获取了锁之后，是不会被interrupt()方法中断的。<br>因此当通过lockInterruptibly()方法获取某个锁时，如果不能获取到，只有进行等待的情况下，是可以响应中断的。<br>而用synchronized修饰的话，当一个线程处于等待某个锁的状态，是无法被中断的，只有一直等待下去。  </p>\n</li>\n</ul>\n<h4 id=\"ReentrantLock\"><a href=\"#ReentrantLock\" class=\"headerlink\" title=\"ReentrantLock\"></a>ReentrantLock</h4><p>直接使用lock接口的话，我们需要实现很多方法，不太方便，ReentrantLock是唯一实现了Lock接口的类，并且ReentrantLock提供了更多的方法，ReentrantLock，意思是“可重入锁”。</p>\n<ul>\n<li><p>lock()的正确使用方法</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">package</span> cn.itcast_01_mythread.thread.lock;</div><div class=\"line\"><span class=\"keyword\">import</span> java.util.ArrayList;</div><div class=\"line\"><span class=\"keyword\">import</span> java.util.concurrent.locks.Lock;</div><div class=\"line\"><span class=\"keyword\">import</span> java.util.concurrent.locks.ReentrantLock;</div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MyLockTest</span> </span>&#123;</div><div class=\"line\">\t<span class=\"keyword\">private</span> <span class=\"keyword\">static</span> ArrayList&lt;Integer&gt; arrayList = <span class=\"keyword\">new</span> ArrayList&lt;Integer&gt;();</div><div class=\"line\">\t<span class=\"keyword\">static</span> Lock lock = <span class=\"keyword\">new</span> ReentrantLock(); <span class=\"comment\">// 注意这个地方</span></div><div class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"keyword\">static</span> &lt;E&gt; <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</div><div class=\"line\">\t\t<span class=\"keyword\">new</span> Thread() &#123;</div><div class=\"line\">\t\t\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">\t\t\t\tThread thread = Thread.currentThread();</div><div class=\"line\">\t\t\t\tlock.lock();</div><div class=\"line\">\t\t\t\t<span class=\"keyword\">try</span> &#123;</div><div class=\"line\">\t\t\t\t\tSystem.out.println(thread.getName() + <span class=\"string\">\"得到了锁\"</span>);</div><div class=\"line\">\t\t\t\t\t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">5</span>; i++) &#123;</div><div class=\"line\">\t\t\t\t\t\tarrayList.add(i);</div><div class=\"line\">\t\t\t\t\t&#125;</div><div class=\"line\">\t\t\t\t&#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</div><div class=\"line\">\t\t\t\t\t<span class=\"comment\">// <span class=\"doctag\">TODO:</span> handle exception</span></div><div class=\"line\">\t\t\t\t&#125; <span class=\"keyword\">finally</span> &#123;</div><div class=\"line\">\t\t\t\t\tSystem.out.println(thread.getName() + <span class=\"string\">\"释放了锁\"</span>);</div><div class=\"line\">\t\t\t\t\tlock.unlock();</div><div class=\"line\">\t\t\t\t&#125;</div><div class=\"line\">\t\t\t&#125;;</div><div class=\"line\">\t\t&#125;.start();</div><div class=\"line\">\t\t</div><div class=\"line\">\t\t<span class=\"keyword\">new</span> Thread() &#123;</div><div class=\"line\">\t\t\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">\t\t\t\tThread thread = Thread.currentThread();</div><div class=\"line\">\t\t\t\tlock.lock();</div><div class=\"line\">\t\t\t\t<span class=\"keyword\">try</span> &#123;</div><div class=\"line\">\t\t\t\t\tSystem.out.println(thread.getName() + <span class=\"string\">\"得到了锁\"</span>);</div><div class=\"line\">\t\t\t\t\t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">5</span>; i++) &#123;</div><div class=\"line\">\t\t\t\t\t\tarrayList.add(i);</div><div class=\"line\">\t\t\t\t\t&#125;</div><div class=\"line\">\t\t\t\t&#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</div><div class=\"line\">\t\t\t\t\t<span class=\"comment\">// <span class=\"doctag\">TODO:</span> handle exception</span></div><div class=\"line\">\t\t\t\t&#125; <span class=\"keyword\">finally</span> &#123;</div><div class=\"line\">\t\t\t\t\tSystem.out.println(thread.getName() + <span class=\"string\">\"释放了锁\"</span>);</div><div class=\"line\">\t\t\t\t\tlock.unlock();</div><div class=\"line\">\t\t\t\t&#125;</div><div class=\"line\"></div><div class=\"line\">\t\t\t&#125;;</div><div class=\"line\">\t\t&#125;.start();</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n</li>\n<li><p>tryLock()的使用方法</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">package</span> cn.itcast_01_mythread.thread.lock;</div><div class=\"line\"><span class=\"keyword\">import</span> java.util.ArrayList;</div><div class=\"line\"><span class=\"keyword\">import</span> java.util.concurrent.locks.Lock;</div><div class=\"line\"><span class=\"keyword\">import</span> java.util.concurrent.locks.ReentrantLock;</div><div class=\"line\"><span class=\"comment\">/**</span></div><div class=\"line\"><span class=\"comment\"> * 观察现象：一个线程获得锁后，另一个线程取不到锁，不会一直等待</span></div><div class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span></span></div><div class=\"line\"><span class=\"comment\"> *</span></div><div class=\"line\"><span class=\"comment\"> */</span></div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MyTryLock</span> </span>&#123;</div><div class=\"line\">\t<span class=\"keyword\">private</span> <span class=\"keyword\">static</span> ArrayList&lt;Integer&gt; arrayList = <span class=\"keyword\">new</span> ArrayList&lt;Integer&gt;();</div><div class=\"line\">\t<span class=\"keyword\">static</span> Lock lock = <span class=\"keyword\">new</span> ReentrantLock(); <span class=\"comment\">// 注意这个地方</span></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</div><div class=\"line\">\t\t<span class=\"keyword\">new</span> Thread() &#123;</div><div class=\"line\">\t\t\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">\t\t\t\tThread thread = Thread.currentThread();</div><div class=\"line\">\t\t\t\t<span class=\"keyword\">boolean</span> tryLock = lock.tryLock();</div><div class=\"line\">\t\t\t\tSystem.out.println(thread.getName()+<span class=\"string\">\" \"</span>+tryLock);</div><div class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> (tryLock) &#123;</div><div class=\"line\">\t\t\t\t\t<span class=\"keyword\">try</span> &#123;</div><div class=\"line\">\t\t\t\t\t\tSystem.out.println(thread.getName() + <span class=\"string\">\"得到了锁\"</span>);</div><div class=\"line\">\t\t\t\t\t\t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">5</span>; i++) &#123;</div><div class=\"line\">\t\t\t\t\t\t\tarrayList.add(i);</div><div class=\"line\">\t\t\t\t\t\t&#125;</div><div class=\"line\">\t\t\t\t\t&#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</div><div class=\"line\">\t\t\t\t\t\t<span class=\"comment\">// <span class=\"doctag\">TODO:</span> handle exception</span></div><div class=\"line\">\t\t\t\t\t&#125; <span class=\"keyword\">finally</span> &#123;</div><div class=\"line\">\t\t\t\t\t\tSystem.out.println(thread.getName() + <span class=\"string\">\"释放了锁\"</span>);</div><div class=\"line\">\t\t\t\t\t\tlock.unlock();</div><div class=\"line\">\t\t\t\t\t&#125;</div><div class=\"line\">\t\t\t\t&#125;</div><div class=\"line\">\t\t\t&#125;;</div><div class=\"line\">\t\t&#125;.start();</div><div class=\"line\"></div><div class=\"line\">\t\t<span class=\"keyword\">new</span> Thread() &#123;</div><div class=\"line\">\t\t\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">\t\t\t\tThread thread = Thread.currentThread();</div><div class=\"line\">\t\t\t\t<span class=\"keyword\">boolean</span> tryLock = lock.tryLock();</div><div class=\"line\">\t\t\t\tSystem.out.println(thread.getName()+<span class=\"string\">\" \"</span>+tryLock);</div><div class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> (tryLock) &#123;</div><div class=\"line\">\t\t\t\t\t<span class=\"keyword\">try</span> &#123;</div><div class=\"line\">\t\t\t\t\t\tSystem.out.println(thread.getName() + <span class=\"string\">\"得到了锁\"</span>);</div><div class=\"line\">\t\t\t\t\t\t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">5</span>; i++) &#123;</div><div class=\"line\">\t\t\t\t\t\t\tarrayList.add(i);</div><div class=\"line\">\t\t\t\t\t\t&#125;</div><div class=\"line\">\t\t\t\t\t&#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</div><div class=\"line\">\t\t\t\t\t\t<span class=\"comment\">// <span class=\"doctag\">TODO:</span> handle exception</span></div><div class=\"line\">\t\t\t\t\t&#125; <span class=\"keyword\">finally</span> &#123;</div><div class=\"line\">\t\t\t\t\t\tSystem.out.println(thread.getName() + <span class=\"string\">\"释放了锁\"</span>);</div><div class=\"line\">\t\t\t\t\t\tlock.unlock();</div><div class=\"line\">\t\t\t\t\t&#125;</div><div class=\"line\">\t\t\t\t&#125;</div><div class=\"line\"></div><div class=\"line\">\t\t\t&#125;;</div><div class=\"line\">\t\t&#125;.start();</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n</li>\n<li><p>lockInterruptibly()响应中断的使用方法：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">package</span> cn.itcast_01_mythread.thread.lock;</div><div class=\"line\"><span class=\"keyword\">import</span> java.util.concurrent.locks.Lock;</div><div class=\"line\"><span class=\"keyword\">import</span> java.util.concurrent.locks.ReentrantLock;</div><div class=\"line\"><span class=\"comment\">/**</span></div><div class=\"line\"><span class=\"comment\"> * 观察现象：如果thread-0得到了锁，阻塞。。。thread-1尝试获取锁，如果拿不到，则可以被中断等待</span></div><div class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span></span></div><div class=\"line\"><span class=\"comment\"> *</span></div><div class=\"line\"><span class=\"comment\"> */</span></div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MyInterruptibly</span> </span>&#123;</div><div class=\"line\">\t <span class=\"keyword\">private</span> Lock lock = <span class=\"keyword\">new</span> ReentrantLock();  </div><div class=\"line\">\t    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span>  </span>&#123;</div><div class=\"line\">\t    \tMyInterruptibly test = <span class=\"keyword\">new</span> MyInterruptibly();</div><div class=\"line\">\t        MyThread thread0 = <span class=\"keyword\">new</span> MyThread(test);</div><div class=\"line\">\t        MyThread thread1 = <span class=\"keyword\">new</span> MyThread(test);</div><div class=\"line\">\t        thread0.start();</div><div class=\"line\">\t        thread1.start();</div><div class=\"line\">\t         </div><div class=\"line\">\t        <span class=\"keyword\">try</span> &#123;</div><div class=\"line\">\t            Thread.sleep(<span class=\"number\">2000</span>);</div><div class=\"line\">\t        &#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</div><div class=\"line\">\t            e.printStackTrace();</div><div class=\"line\">\t        &#125;</div><div class=\"line\">\t        thread1.interrupt();</div><div class=\"line\">\t        System.out.println(<span class=\"string\">\"=====================\"</span>);</div><div class=\"line\">\t    &#125;  </div><div class=\"line\">\t     </div><div class=\"line\">\t    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">insert</span><span class=\"params\">(Thread thread)</span> <span class=\"keyword\">throws</span> InterruptedException</span>&#123;</div><div class=\"line\">\t        lock.lockInterruptibly();   <span class=\"comment\">//注意，如果需要正确中断等待锁的线程，必须将获取锁放在外面，然后将InterruptedException抛出</span></div><div class=\"line\">\t        <span class=\"keyword\">try</span> &#123;  </div><div class=\"line\">\t            System.out.println(thread.getName()+<span class=\"string\">\"得到了锁\"</span>);</div><div class=\"line\">\t            <span class=\"keyword\">long</span> startTime = System.currentTimeMillis();</div><div class=\"line\">\t            <span class=\"keyword\">for</span>(    ;     ;) &#123;</div><div class=\"line\">\t                <span class=\"keyword\">if</span>(System.currentTimeMillis() - startTime &gt;= Integer.MAX_VALUE)</div><div class=\"line\">\t                    <span class=\"keyword\">break</span>;</div><div class=\"line\">\t                <span class=\"comment\">//插入数据</span></div><div class=\"line\">\t            &#125;</div><div class=\"line\">\t        &#125;</div><div class=\"line\">\t        <span class=\"keyword\">finally</span> &#123;</div><div class=\"line\">\t            System.out.println(Thread.currentThread().getName()+<span class=\"string\">\"执行finally\"</span>);</div><div class=\"line\">\t            lock.unlock();</div><div class=\"line\">\t            System.out.println(thread.getName()+<span class=\"string\">\"释放了锁\"</span>);</div><div class=\"line\">\t        &#125;  </div><div class=\"line\">\t    &#125;</div><div class=\"line\">\t&#125;</div><div class=\"line\">\t </div><div class=\"line\">\t<span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MyThread</span> <span class=\"keyword\">extends</span> <span class=\"title\">Thread</span> </span>&#123;</div><div class=\"line\">\t    <span class=\"keyword\">private</span> MyInterruptibly test = <span class=\"keyword\">null</span>;</div><div class=\"line\">\t    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">MyThread</span><span class=\"params\">(MyInterruptibly test)</span> </span>&#123;</div><div class=\"line\">\t        <span class=\"keyword\">this</span>.test = test;</div><div class=\"line\">\t    &#125;</div><div class=\"line\">\t    <span class=\"meta\">@Override</span></div><div class=\"line\">\t    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">\t         </div><div class=\"line\">\t        <span class=\"keyword\">try</span> &#123;</div><div class=\"line\">\t            test.insert(Thread.currentThread());</div><div class=\"line\">\t        &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</div><div class=\"line\">\t            System.out.println(Thread.currentThread().getName()+<span class=\"string\">\"被中断\"</span>);</div><div class=\"line\">\t        &#125;</div><div class=\"line\">\t    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n</li>\n</ul>\n<h4 id=\"ReadWriteLock\"><a href=\"#ReadWriteLock\" class=\"headerlink\" title=\"ReadWriteLock\"></a>ReadWriteLock</h4><p>ReadWriteLock也是一个接口，在它里面只定义了两个方法：<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">ReadWriteLock</span> </span>&#123;</div><div class=\"line\">    <span class=\"comment\">/**</span></div><div class=\"line\"><span class=\"comment\">     * Returns the lock used for reading.</span></div><div class=\"line\"><span class=\"comment\">     *</span></div><div class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> the lock used for reading.</span></div><div class=\"line\"><span class=\"comment\">     */</span></div><div class=\"line\">    <span class=\"function\">Lock <span class=\"title\">readLock</span><span class=\"params\">()</span></span>;</div><div class=\"line\"> </div><div class=\"line\">    <span class=\"comment\">/**</span></div><div class=\"line\"><span class=\"comment\">     * Returns the lock used for writing.</span></div><div class=\"line\"><span class=\"comment\">     *</span></div><div class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> the lock used for writing.</span></div><div class=\"line\"><span class=\"comment\">     */</span></div><div class=\"line\">    <span class=\"function\">Lock <span class=\"title\">writeLock</span><span class=\"params\">()</span></span>;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>一个用来获取读锁，一个用来获取写锁。也就是说将文件的读写操作分开，分成2个锁来分配给线程，从而使得多个线程可以同时进行读操作。下面的ReentrantReadWriteLock实现了ReadWriteLock接口。</p>\n<h4 id=\"ReentrantReadWriteLock\"><a href=\"#ReentrantReadWriteLock\" class=\"headerlink\" title=\"ReentrantReadWriteLock\"></a>ReentrantReadWriteLock</h4><p>ReentrantReadWriteLock里面提供了很多丰富的方法，不过最主要的有两个方法：readLock()和writeLock()用来获取读锁和写锁。</p>\n<p>ReentrantReadWriteLock具体用法</p>\n<p>假如有多个线程要同时进行读操作的话，先看一下synchronized达到的效果<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">package</span> cn.itcast_01_mythread.thread.lock;</div><div class=\"line\"><span class=\"comment\">/**</span></div><div class=\"line\"><span class=\"comment\"> * 一个线程又要读又要写，用synchronize来实现的话，读写操作都只能锁住后一个线程一个线程地进行</span></div><div class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span></span></div><div class=\"line\"><span class=\"comment\"> *</span></div><div class=\"line\"><span class=\"comment\"> */</span></div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MySynchronizedReadWrite</span> </span>&#123;</div><div class=\"line\">    </div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span>  </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">final</span> MySynchronizedReadWrite test = <span class=\"keyword\">new</span> MySynchronizedReadWrite();</div><div class=\"line\">         </div><div class=\"line\">        <span class=\"keyword\">new</span> Thread()&#123;</div><div class=\"line\">            <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">                test.get(Thread.currentThread());</div><div class=\"line\">            &#125;;</div><div class=\"line\">        &#125;.start();</div><div class=\"line\">         </div><div class=\"line\">        <span class=\"keyword\">new</span> Thread()&#123;</div><div class=\"line\">            <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">                test.get(Thread.currentThread());</div><div class=\"line\">            &#125;;</div><div class=\"line\">        &#125;.start();</div><div class=\"line\">         </div><div class=\"line\">    &#125;  </div><div class=\"line\">     </div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">synchronized</span> <span class=\"keyword\">void</span> <span class=\"title\">get</span><span class=\"params\">(Thread thread)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">long</span> start = System.currentTimeMillis();</div><div class=\"line\">        <span class=\"keyword\">int</span> i=<span class=\"number\">0</span>;</div><div class=\"line\">        <span class=\"keyword\">while</span>(System.currentTimeMillis() - start &lt;= <span class=\"number\">1</span>) &#123;</div><div class=\"line\">        \ti++;</div><div class=\"line\">        \t<span class=\"keyword\">if</span>(i%<span class=\"number\">4</span>==<span class=\"number\">0</span>)&#123;</div><div class=\"line\">            System.out.println(thread.getName()+<span class=\"string\">\"正在进行写操作\"</span>);</div><div class=\"line\">        \t&#125;<span class=\"keyword\">else</span> &#123;</div><div class=\"line\">        \t\tSystem.out.println(thread.getName()+<span class=\"string\">\"正在进行读操作\"</span>);\t</div><div class=\"line\">\t\t\t&#125;</div><div class=\"line\">        &#125;</div><div class=\"line\">        System.out.println(thread.getName()+<span class=\"string\">\"读写操作完毕\"</span>);</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>改成用读写锁的话：<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">package</span> cn.itcast_01_mythread.thread.lock;</div><div class=\"line\"><span class=\"keyword\">import</span> java.util.concurrent.locks.ReentrantReadWriteLock;</div><div class=\"line\"><span class=\"comment\">/**</span></div><div class=\"line\"><span class=\"comment\"> * 使用读写锁，可以实现读写分离锁定，读操作并发进行，写操作锁定单个线程</span></div><div class=\"line\"><span class=\"comment\"> * </span></div><div class=\"line\"><span class=\"comment\"> * 如果有一个线程已经占用了读锁，则此时其他线程如果要申请写锁，则申请写锁的线程会一直等待释放读锁。</span></div><div class=\"line\"><span class=\"comment\"> * 如果有一个线程已经占用了写锁，则此时其他线程如果申请写锁或者读锁，则申请的线程会一直等待释放写锁。</span></div><div class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span></span></div><div class=\"line\"><span class=\"comment\"> *</span></div><div class=\"line\"><span class=\"comment\"> */</span></div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MyReentrantReadWriteLock</span> </span>&#123;</div><div class=\"line\">\t <span class=\"keyword\">private</span> ReentrantReadWriteLock rwl = <span class=\"keyword\">new</span> ReentrantReadWriteLock();</div><div class=\"line\">     </div><div class=\"line\">\t    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span>  </span>&#123;</div><div class=\"line\">\t        <span class=\"keyword\">final</span> MyReentrantReadWriteLock test = <span class=\"keyword\">new</span> MyReentrantReadWriteLock();</div><div class=\"line\">\t         </div><div class=\"line\">\t        <span class=\"keyword\">new</span> Thread()&#123;</div><div class=\"line\">\t            <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">\t                test.get(Thread.currentThread());</div><div class=\"line\">\t                test.write(Thread.currentThread());</div><div class=\"line\">\t            &#125;;</div><div class=\"line\">\t        &#125;.start();</div><div class=\"line\">\t         </div><div class=\"line\">\t        <span class=\"keyword\">new</span> Thread()&#123;</div><div class=\"line\">\t            <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">\t                test.get(Thread.currentThread());</div><div class=\"line\">\t                test.write(Thread.currentThread());</div><div class=\"line\">\t            &#125;;</div><div class=\"line\">\t        &#125;.start();</div><div class=\"line\">\t    &#125;  </div><div class=\"line\">\t    </div><div class=\"line\">\t    <span class=\"comment\">/**</span></div><div class=\"line\"><span class=\"comment\">\t     * 读操作,用读锁来锁定</span></div><div class=\"line\"><span class=\"comment\">\t     * <span class=\"doctag\">@param</span> thread</span></div><div class=\"line\"><span class=\"comment\">\t     */</span></div><div class=\"line\">\t    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">get</span><span class=\"params\">(Thread thread)</span> </span>&#123;</div><div class=\"line\">\t        rwl.readLock().lock();</div><div class=\"line\">\t        <span class=\"keyword\">try</span> &#123;</div><div class=\"line\">\t            <span class=\"keyword\">long</span> start = System.currentTimeMillis();</div><div class=\"line\">\t             </div><div class=\"line\">\t            <span class=\"keyword\">while</span>(System.currentTimeMillis() - start &lt;= <span class=\"number\">1</span>) &#123;</div><div class=\"line\">\t                System.out.println(thread.getName()+<span class=\"string\">\"正在进行读操作\"</span>);</div><div class=\"line\">\t            &#125;</div><div class=\"line\">\t            System.out.println(thread.getName()+<span class=\"string\">\"读操作完毕\"</span>);</div><div class=\"line\">\t        &#125; <span class=\"keyword\">finally</span> &#123;</div><div class=\"line\">\t            rwl.readLock().unlock();</div><div class=\"line\">\t        &#125;</div><div class=\"line\">\t    &#125;</div><div class=\"line\"></div><div class=\"line\">\t    <span class=\"comment\">/**</span></div><div class=\"line\"><span class=\"comment\">\t     * 写操作，用写锁来锁定</span></div><div class=\"line\"><span class=\"comment\">\t     * <span class=\"doctag\">@param</span> thread</span></div><div class=\"line\"><span class=\"comment\">\t     */</span></div><div class=\"line\">\t    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">write</span><span class=\"params\">(Thread thread)</span> </span>&#123;</div><div class=\"line\">\t        rwl.writeLock().lock();;</div><div class=\"line\">\t        <span class=\"keyword\">try</span> &#123;</div><div class=\"line\">\t            <span class=\"keyword\">long</span> start = System.currentTimeMillis();</div><div class=\"line\">\t            <span class=\"keyword\">while</span>(System.currentTimeMillis() - start &lt;= <span class=\"number\">1</span>) &#123;</div><div class=\"line\">\t                System.out.println(thread.getName()+<span class=\"string\">\"正在进行写操作\"</span>);</div><div class=\"line\">\t            &#125;</div><div class=\"line\">\t            System.out.println(thread.getName()+<span class=\"string\">\"写操作完毕\"</span>);</div><div class=\"line\">\t        &#125; <span class=\"keyword\">finally</span> &#123;</div><div class=\"line\">\t            rwl.writeLock().unlock();</div><div class=\"line\">\t        &#125;</div><div class=\"line\">\t    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<blockquote>\n<p>注意：</p>\n<ul>\n<li>不过要注意的是，如果有一个线程已经占用了读锁，则此时其他线程如果要申请写锁，则申请写锁的线程会一直等待释放读锁。</li>\n<li>如果有一个线程已经占用了写锁，则此时其他线程如果申请写锁或者读锁，则申请的线程会一直等待释放写锁。</li>\n</ul>\n</blockquote>\n<h2 id=\"Lock和synchronized的选择\"><a href=\"#Lock和synchronized的选择\" class=\"headerlink\" title=\"Lock和synchronized的选择\"></a>Lock和synchronized的选择</h2><ol>\n<li>Lock是一个接口，而synchronized是Java中的关键字，synchronized是内置的语言实现；</li>\n<li>synchronized在发生异常时，会自动释放线程占有的锁，因此不会导致死锁现象发生；而Lock在发生异常时，如果没有主动通过unLock()去释放锁，则很可能造成死锁现象，因此使用Lock时需要在finally块中释放锁；</li>\n<li>Lock可以让等待锁的线程响应中断，而synchronized却不行，使用synchronized时，等待的线程会一直等待下去，不能够响应中断；</li>\n<li>通过Lock可以知道有没有成功获取锁，而synchronized却无法办到。</li>\n<li>Lock可以提高多个线程进行读操作的效率。</li>\n</ol>\n<p>在性能上来说，如果竞争资源不激烈，两者的性能是差不多的，而当竞争资源非常激烈时（即有大量线程同时竞争），此时Lock的性能要远远优于synchronized。所以说，在具体使用时要根据适当情况选择。</p>\n<h1 id=\"java并发包\"><a href=\"#java并发包\" class=\"headerlink\" title=\"java并发包\"></a>java并发包</h1><h2 id=\"java并发包介绍\"><a href=\"#java并发包介绍\" class=\"headerlink\" title=\"java并发包介绍\"></a>java并发包介绍</h2><p>JDK5.0 以后的版本都引入了高级并发特性，大多数的特性在java.util.concurrent 包中，是专门用于多线程发编程的，充分利用了现代多处理器和多核心系统的功能以编写大规模并发应用程序。主要包含<font color=\"red\">原子量、并发集合、同步器、</font>可重入锁，并对线程池的构造提供了强力的支持。</p>\n<h3 id=\"线程池\"><a href=\"#线程池\" class=\"headerlink\" title=\"线程池\"></a>线程池</h3><h4 id=\"创建方式\"><a href=\"#创建方式\" class=\"headerlink\" title=\"创建方式\"></a>创建方式</h4><p>五种创建方式</p>\n<h5 id=\"Single-Thread-Executor\"><a href=\"#Single-Thread-Executor\" class=\"headerlink\" title=\"Single Thread Executor\"></a>Single Thread Executor</h5><p>只有一个线程的线程池，因此所有提交的任务是顺序执行<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\"></div><div class=\"line\">##### Cached Thread Pool </div><div class=\"line\">线程池里有很多线程需要同时执行，老的可用线程将被新的任务触发重新执行，&lt;font color=&quot;red&quot;&gt;如果线程超过60秒内没执行，那么将被终止并从池中删除&lt;/font&gt;  </div><div class=\"line\">```Executors.newCachedThreadPool()</div></pre></td></tr></table></figure></p>\n<h5 id=\"Fixed-Thread-Pool\"><a href=\"#Fixed-Thread-Pool\" class=\"headerlink\" title=\"Fixed Thread Pool\"></a>Fixed Thread Pool</h5><p><font color=\"red\">拥有固定线程数的线程池，如果没有任务执行，那么线程会一直等待</font><br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\">在构造函数中的参数4是线程池的大小，你可以随意设置，也可以和cpu的核数量保持一致，获取cpu的核数量  </div><div class=\"line\">```int cpuNums = Runtime.getRuntime().availableProcessors();</div></pre></td></tr></table></figure></p>\n<h5 id=\"Scheduled-Thread-Pool\"><a href=\"#Scheduled-Thread-Pool\" class=\"headerlink\" title=\"Scheduled Thread Pool\"></a>Scheduled Thread Pool</h5><p>用来调度即将执行的任务的线程池，可能是不是直接执行, 每隔多久执行一次… 策略型的<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\"></div><div class=\"line\">##### Single Thread Scheduled Pool </div><div class=\"line\">只有一个线程，用来调度任务在指定时间执行</div><div class=\"line\">```Executors.newSingleThreadScheduledExecutor()</div></pre></td></tr></table></figure></p>\n<h3 id=\"线程池的使用\"><a href=\"#线程池的使用\" class=\"headerlink\" title=\"线程池的使用\"></a>线程池的使用</h3><p>提交 Runnable ，任务完成后 Future 对象返回 null<br>调用excute,提交任务, 匿名Runable重写run方法, run方法里是业务逻辑<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">package</span> cn.itcast_01_mythread.pool;</div><div class=\"line\"><span class=\"keyword\">import</span> java.util.concurrent.ExecutorService;</div><div class=\"line\"><span class=\"keyword\">import</span> java.util.concurrent.Executors;</div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ThreadPoolWithRunable</span> </span>&#123;</div><div class=\"line\">\t<span class=\"comment\">/**</span></div><div class=\"line\"><span class=\"comment\">\t * 通过线程池执行线程</span></div><div class=\"line\"><span class=\"comment\">\t * <span class=\"doctag\">@param</span> args</span></div><div class=\"line\"><span class=\"comment\">\t */</span></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</div><div class=\"line\">\t\t<span class=\"comment\">//创建一个线程池</span></div><div class=\"line\">\t\tExecutorService pool = Executors.newCachedThreadPool();</div><div class=\"line\">\t\t<span class=\"keyword\">for</span>(<span class=\"keyword\">int</span> i = <span class=\"number\">1</span>; i &lt; <span class=\"number\">5</span>; i++)&#123;</div><div class=\"line\">\t\t\tpool.execute(<span class=\"keyword\">new</span> Runnable() &#123;</div><div class=\"line\">\t\t\t\t<span class=\"meta\">@Override</span></div><div class=\"line\">\t\t\t\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">\t\t\t\t\tSystem.out.println(<span class=\"string\">\"thread name: \"</span> + Thread.currentThread().getName());</div><div class=\"line\">\t\t\t\t\t<span class=\"keyword\">try</span> &#123;</div><div class=\"line\">\t\t\t\t\t\tThread.sleep(<span class=\"number\">1000</span>);</div><div class=\"line\">\t\t\t\t\t&#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</div><div class=\"line\">\t\t\t\t\t\te.printStackTrace();</div><div class=\"line\">\t\t\t\t\t&#125;</div><div class=\"line\">\t\t\t\t&#125;</div><div class=\"line\">\t\t\t&#125;);</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t\tpool.shutdown();</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>提交 Callable，该方法返回一个 Future 实例表示任务的状态<br>调用submit提交任务, 匿名Callable,重写call方法, 有返回值, 获取返回值会阻塞,一直要等到线程任务返回结果<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">package</span> cn.itcast_01_mythread.pool;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">import</span> java.util.ArrayList;</div><div class=\"line\"><span class=\"keyword\">import</span> java.util.List;</div><div class=\"line\"><span class=\"keyword\">import</span> java.util.concurrent.Callable;</div><div class=\"line\"><span class=\"keyword\">import</span> java.util.concurrent.ExecutionException;</div><div class=\"line\"><span class=\"keyword\">import</span> java.util.concurrent.ExecutorService;</div><div class=\"line\"><span class=\"keyword\">import</span> java.util.concurrent.Executors;</div><div class=\"line\"><span class=\"keyword\">import</span> java.util.concurrent.Future;</div><div class=\"line\"><span class=\"comment\">/**</span></div><div class=\"line\"><span class=\"comment\"> * callable 跟runnable的区别：</span></div><div class=\"line\"><span class=\"comment\"> * runnable的run方法不会有任何返回结果，所以主线程无法获得任务线程的返回值</span></div><div class=\"line\"><span class=\"comment\"> * </span></div><div class=\"line\"><span class=\"comment\"> * callable的call方法可以返回结果，但是主线程在获取时是被阻塞，需要等待任务线程返回才能拿到结果</span></div><div class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span></span></div><div class=\"line\"><span class=\"comment\"> *</span></div><div class=\"line\"><span class=\"comment\"> */</span></div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ThreadPoolWithcallable</span> </span>&#123;</div><div class=\"line\"></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> InterruptedException, ExecutionException </span>&#123;</div><div class=\"line\">\t\tExecutorService pool = Executors.newFixedThreadPool(<span class=\"number\">4</span>); </div><div class=\"line\">\t\t</div><div class=\"line\">\t\t<span class=\"keyword\">for</span>(<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">10</span>; i++)&#123;</div><div class=\"line\">\t\t\tFuture&lt;String&gt; submit = pool.submit(<span class=\"keyword\">new</span> Callable&lt;String&gt;()&#123;</div><div class=\"line\">\t\t\t\t<span class=\"meta\">@Override</span></div><div class=\"line\">\t\t\t\t<span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">call</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</div><div class=\"line\">\t\t\t\t\t<span class=\"comment\">//System.out.println(\"a\");</span></div><div class=\"line\">\t\t\t\t\tThread.sleep(<span class=\"number\">5000</span>);</div><div class=\"line\">\t\t\t\t\t<span class=\"keyword\">return</span> <span class=\"string\">\"b--\"</span>+Thread.currentThread().getName();</div><div class=\"line\">\t\t\t\t&#125;\t\t\t   </div><div class=\"line\">\t\t\t   &#125;);</div><div class=\"line\">\t\t\t<span class=\"comment\">//从Future中get结果，这个方法是会被阻塞的，一直要等到线程任务返回结果</span></div><div class=\"line\">\t\t\tSystem.out.println(submit.get());</div><div class=\"line\">\t\t&#125; </div><div class=\"line\">\t\t\tpool.shutdown();</div><div class=\"line\"></div><div class=\"line\">\t&#125;</div><div class=\"line\"></div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<h2 id=\"java并发包消息队列及在开源软件中的应用\"><a href=\"#java并发包消息队列及在开源软件中的应用\" class=\"headerlink\" title=\"java并发包消息队列及在开源软件中的应用\"></a>java并发包消息队列及在开源软件中的应用</h2><h3 id=\"BlockingQueue\"><a href=\"#BlockingQueue\" class=\"headerlink\" title=\"BlockingQueue\"></a>BlockingQueue</h3><p>也是java.util.concurrent下的主要用来<font color=\"red\">控制线程同步的工具</font>。<br>主要的方法是：put、take一对阻塞存取；add、poll一对非阻塞存取。  </p>\n<ul>\n<li>插入:<ol>\n<li>add(anObject):把anObject加到BlockingQueue里,即如果BlockingQueue可以容纳,则返回true,否则抛出异常,不好</li>\n<li>offer(anObject):表示如果可能的话,将anObject加到BlockingQueue里,即如果BlockingQueue可以容纳,则返回true,否则返回false.</li>\n<li>put(anObject):把anObject加到BlockingQueue里,如果BlockQueue没有空间,则调用此方法的线程被阻断直到BlockingQueue里面有空间再继续, 有阻塞, 放不进去就等待</li>\n</ol>\n</li>\n<li>读取：<ol>\n<li>poll(time):取走BlockingQueue里排在首位的对象,若不能立即取出,则可以等time参数规定的时间,取不到时返回null; 取不到返回null</li>\n<li>take():取走BlockingQueue里排在首位的对象,若BlockingQueue为空,阻断进入等待状态直到Blocking有新的对象被加入为止; <font color=\"red\">阻塞, 取不到就一直等</font></li>\n</ol>\n</li>\n<li>其他<ol>\n<li>int remainingCapacity();返回队列剩余的容量，在队列插入和获取的时候，<font color=\"red\">不要瞎搞，数据可能不准, 不能保证数据的准确性</font></li>\n<li>boolean remove(Object o); 从队列移除元素，如果存在，即移除一个或者更多，队列改    变了返回true</li>\n<li>public boolean contains(Object o); 查看队列是否存在这个元素，存在返回true</li>\n<li>int drainTo(Collection&lt;? super E&gt; c); //移除此队列中所有可用的元素,并将它们添加到给定 collection 中。<font color=\"red\">取出放到集合中</font></li>\n<li>int drainTo(Collection&lt;? super E&gt; c, int maxElements); 和上面方法的区别在于，指定了移动的数量;取出指定个数放到集合</li>\n</ol>\n</li>\n</ul>\n<p>BlockingQueue有四个具体的实现类,常用的两种实现类为：</p>\n<h3 id=\"ArrayBlockingQueue\"><a href=\"#ArrayBlockingQueue\" class=\"headerlink\" title=\"ArrayBlockingQueue\"></a>ArrayBlockingQueue</h3><p>一个由数组支持的有界阻塞队列，规定大小的BlockingQueue,其构造函数必须带一个int参数来指明其大小.其所含的对象是以FIFO(先入先出)顺序排序的。</p>\n<h3 id=\"LinkedBlockingQueue\"><a href=\"#LinkedBlockingQueue\" class=\"headerlink\" title=\"LinkedBlockingQueue\"></a>LinkedBlockingQueue</h3><p>大小不定的BlockingQueue,若其构造函数带一个规定大小的参数,生成的BlockingQueue有大小限制,若不带大小参数,所生成的BlockingQueue的大小由Integer.MAX_VALUE来决定.其所含的对象是以FIFO(先入先出)顺序排序的。<br>LinkedBlockingQueue 可以指定容量，也可以不指定，不指定的话，默认最大是Integer.MAX_VALUE,其中主要用到put和take方法，put方法在队列满的时候会阻塞直到有队列成员被消费，take方法在队列空的时候会阻塞，直到有队列成员被放进来。</p>\n<h3 id=\"LinkedBlockingQueue和ArrayBlockingQueue区别\"><a href=\"#LinkedBlockingQueue和ArrayBlockingQueue区别\" class=\"headerlink\" title=\"LinkedBlockingQueue和ArrayBlockingQueue区别\"></a>LinkedBlockingQueue和ArrayBlockingQueue区别</h3><p>LinkedBlockingQueue和ArrayBlockingQueue比较起来,它们背后所用的数据结构不一样,导致LinkedBlockingQueue的数据吞吐量要大于ArrayBlockingQueue,但在线程数量很大时其性能的可预见性低于ArrayBlockingQueue.</p>\n<p>生产者消费者的示例代码：<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div><div class=\"line\">87</div><div class=\"line\">88</div><div class=\"line\">89</div><div class=\"line\">90</div><div class=\"line\">91</div><div class=\"line\">92</div><div class=\"line\">93</div><div class=\"line\">94</div><div class=\"line\">95</div><div class=\"line\">96</div><div class=\"line\">97</div><div class=\"line\">98</div><div class=\"line\">99</div><div class=\"line\">100</div><div class=\"line\">101</div><div class=\"line\">102</div><div class=\"line\">103</div><div class=\"line\">104</div><div class=\"line\">105</div><div class=\"line\">106</div><div class=\"line\">107</div><div class=\"line\">108</div><div class=\"line\">109</div><div class=\"line\">110</div><div class=\"line\">111</div><div class=\"line\">112</div><div class=\"line\">113</div><div class=\"line\">114</div><div class=\"line\">115</div><div class=\"line\">116</div><div class=\"line\">117</div><div class=\"line\">118</div><div class=\"line\">119</div><div class=\"line\">120</div><div class=\"line\">121</div><div class=\"line\">122</div><div class=\"line\">123</div><div class=\"line\">124</div><div class=\"line\">125</div><div class=\"line\">126</div><div class=\"line\">127</div><div class=\"line\">128</div><div class=\"line\">129</div><div class=\"line\">130</div><div class=\"line\">131</div><div class=\"line\">132</div><div class=\"line\">133</div><div class=\"line\">134</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">package</span> cn.itcast_02_blockingqueue.main;</div><div class=\"line\"><span class=\"keyword\">import</span> java.util.concurrent.BlockingQueue;</div><div class=\"line\"><span class=\"keyword\">import</span> java.util.concurrent.LinkedBlockingQueue;</div><div class=\"line\"><span class=\"keyword\">import</span> cn.itcast_02_blockingqueue.consumer.Consumer;</div><div class=\"line\"><span class=\"keyword\">import</span> cn.itcast_02_blockingqueue.producer.Producer;</div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Test</span> </span>&#123;</div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</div><div class=\"line\">\t\tBlockingQueue&lt;String&gt; queue = <span class=\"keyword\">new</span> LinkedBlockingQueue&lt;String&gt;(<span class=\"number\">2</span>);</div><div class=\"line\">\t\t<span class=\"comment\">// BlockingQueue&lt;String&gt; queue = new LinkedBlockingQueue&lt;String&gt;();</span></div><div class=\"line\">\t\t<span class=\"comment\">// 不设置的话，LinkedBlockingQueue默认大小为Integer.MAX_VALUE</span></div><div class=\"line\">\t\t<span class=\"comment\">// BlockingQueue&lt;String&gt; queue = new ArrayBlockingQueue&lt;String&gt;(2);</span></div><div class=\"line\">\t\tConsumer consumer = <span class=\"keyword\">new</span> Consumer(queue);</div><div class=\"line\">\t\tProducer producer = <span class=\"keyword\">new</span> Producer(queue);</div><div class=\"line\">\t\t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">3</span>; i++) &#123;</div><div class=\"line\">\t\t\t<span class=\"keyword\">new</span> Thread(producer, <span class=\"string\">\"Producer\"</span> + (i + <span class=\"number\">1</span>)).start();</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t\t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">5</span>; i++) &#123;</div><div class=\"line\">\t\t\t<span class=\"keyword\">new</span> Thread(consumer, <span class=\"string\">\"Consumer\"</span> + (i + <span class=\"number\">1</span>)).start();</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t\t<span class=\"keyword\">new</span> Thread(producer, <span class=\"string\">\"Producer\"</span> + (<span class=\"number\">5</span>)).start();</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\">=====================================================================</div><div class=\"line\"><span class=\"keyword\">package</span> cn.itcast_02_blockingqueue.main;</div><div class=\"line\"><span class=\"keyword\">import</span> java.util.concurrent.BlockingQueue;</div><div class=\"line\"><span class=\"keyword\">import</span> java.util.concurrent.LinkedBlockingQueue;</div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">TestBlockingQueue</span> </span>&#123;</div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</div><div class=\"line\">\t\tBlockingQueue&lt;String&gt; queue = <span class=\"keyword\">new</span> LinkedBlockingQueue&lt;String&gt;(<span class=\"number\">2</span>);</div><div class=\"line\">\t\t<span class=\"comment\">// BlockingQueue&lt;String&gt; queue = new LinkedBlockingQueue&lt;String&gt;();</span></div><div class=\"line\">\t\t<span class=\"comment\">// 不设置的话，LinkedBlockingQueue默认大小为Integer.MAX_VALUE</span></div><div class=\"line\">\t\t<span class=\"comment\">// BlockingQueue&lt;String&gt; queue = new ArrayBlockingQueue&lt;String&gt;(2);</span></div><div class=\"line\">\t\tTestBlockingQueueConsumer consumer = <span class=\"keyword\">new</span> TestBlockingQueueConsumer(queue);</div><div class=\"line\">\t\tTestBlockingQueueProducer producer = <span class=\"keyword\">new</span> TestBlockingQueueProducer(queue);</div><div class=\"line\">\t\t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">3</span>; i++) &#123;</div><div class=\"line\">\t\t\t<span class=\"keyword\">new</span> Thread(producer, <span class=\"string\">\"Producer\"</span> + (i + <span class=\"number\">1</span>)).start();</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t\t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">5</span>; i++) &#123;</div><div class=\"line\">\t\t\t<span class=\"keyword\">new</span> Thread(consumer, <span class=\"string\">\"Consumer\"</span> + (i + <span class=\"number\">1</span>)).start();</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t\t<span class=\"keyword\">new</span> Thread(producer, <span class=\"string\">\"Producer\"</span> + (<span class=\"number\">5</span>)).start();</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div><div class=\"line\">=====================================================================</div><div class=\"line\"><span class=\"keyword\">package</span> cn.itcast_02_blockingqueue.main;</div><div class=\"line\"><span class=\"keyword\">import</span> java.util.Random;</div><div class=\"line\"><span class=\"keyword\">import</span> java.util.concurrent.BlockingQueue;</div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">TestBlockingQueueConsumer</span> <span class=\"keyword\">implements</span> <span class=\"title\">Runnable</span></span>&#123;  </div><div class=\"line\">    BlockingQueue&lt;String&gt; queue; </div><div class=\"line\">    Random random = <span class=\"keyword\">new</span> Random();</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">TestBlockingQueueConsumer</span><span class=\"params\">(BlockingQueue&lt;String&gt; queue)</span></span>&#123;  </div><div class=\"line\">        <span class=\"keyword\">this</span>.queue = queue;  </div><div class=\"line\">    &#125;        </div><div class=\"line\">    <span class=\"meta\">@Override</span>  </div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;  </div><div class=\"line\">        <span class=\"keyword\">try</span> &#123;  </div><div class=\"line\">        \tThread.sleep(random.nextInt(<span class=\"number\">10</span>));</div><div class=\"line\">        \tSystem.out.println(Thread.currentThread().getName()+ <span class=\"string\">\"trying...\"</span>);</div><div class=\"line\">            String temp = queue.take();<span class=\"comment\">//如果队列为空，会阻塞当前线程  </span></div><div class=\"line\">            System.out.println(Thread.currentThread().getName() + <span class=\"string\">\" get a job \"</span> +temp);  </div><div class=\"line\">        &#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;  </div><div class=\"line\">            e.printStackTrace();  </div><div class=\"line\">        &#125;  </div><div class=\"line\">    &#125;  </div><div class=\"line\">&#125;</div><div class=\"line\">=====================================================================</div><div class=\"line\"><span class=\"keyword\">package</span> cn.itcast_02_blockingqueue.main;</div><div class=\"line\"><span class=\"keyword\">import</span> java.util.Random;</div><div class=\"line\"><span class=\"keyword\">import</span> java.util.concurrent.BlockingQueue;</div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">TestBlockingQueueProducer</span> <span class=\"keyword\">implements</span> <span class=\"title\">Runnable</span> </span>&#123;</div><div class=\"line\">\tBlockingQueue&lt;String&gt; queue;</div><div class=\"line\">\tRandom random = <span class=\"keyword\">new</span> Random();</div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">TestBlockingQueueProducer</span><span class=\"params\">(BlockingQueue&lt;String&gt; queue)</span> </span>&#123;</div><div class=\"line\">\t\t<span class=\"keyword\">this</span>.queue = queue;</div><div class=\"line\">\t&#125;</div><div class=\"line\">\t<span class=\"meta\">@Override</span></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">\t\t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">10</span>; i++) &#123;</div><div class=\"line\">\t\t\t<span class=\"keyword\">try</span> &#123;</div><div class=\"line\">\t\t\t\tThread.sleep(random.nextInt(<span class=\"number\">10</span>));</div><div class=\"line\">\t\t\t\tString task = Thread.currentThread().getName() + <span class=\"string\">\" made a product \"</span> + i;</div><div class=\"line\">\t\t\t\tSystem.out.println(task);</div><div class=\"line\">\t\t\t\tqueue.put(task);</div><div class=\"line\">\t\t\t&#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</div><div class=\"line\">\t\t\t\te.printStackTrace();</div><div class=\"line\">\t\t\t&#125;</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t&#125;</div><div class=\"line\"></div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\">=====================================================================</div><div class=\"line\"><span class=\"keyword\">package</span> cn.itcast_02_blockingqueue.producer;</div><div class=\"line\"><span class=\"keyword\">import</span> java.util.concurrent.BlockingQueue;</div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Producer</span> <span class=\"keyword\">implements</span> <span class=\"title\">Runnable</span> </span>&#123;  </div><div class=\"line\">    BlockingQueue&lt;String&gt; queue;    </div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">Producer</span><span class=\"params\">(BlockingQueue&lt;String&gt; queue)</span> </span>&#123;  </div><div class=\"line\">        <span class=\"keyword\">this</span>.queue = queue;  </div><div class=\"line\">    &#125;    </div><div class=\"line\">    <span class=\"meta\">@Override</span>  </div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;  </div><div class=\"line\">        <span class=\"keyword\">try</span> &#123;  </div><div class=\"line\">            </div><div class=\"line\">            System.out.println(<span class=\"string\">\"I have made a product:\"</span>  </div><div class=\"line\">                    + Thread.currentThread().getName()); </div><div class=\"line\">            String temp = <span class=\"string\">\"A Product, 生产线程：\"</span>  </div><div class=\"line\">                    + Thread.currentThread().getName();  </div><div class=\"line\">            queue.put(temp);<span class=\"comment\">//如果队列是满的话，会阻塞当前线程  </span></div><div class=\"line\">        &#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;  </div><div class=\"line\">            e.printStackTrace();  </div><div class=\"line\">        &#125;  </div><div class=\"line\">    &#125;    </div><div class=\"line\">&#125;  </div><div class=\"line\">=====================================================================</div><div class=\"line\"><span class=\"keyword\">package</span> cn.itcast_02_blockingqueue.consumer;</div><div class=\"line\"><span class=\"keyword\">import</span> java.util.concurrent.BlockingQueue;</div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Consumer</span> <span class=\"keyword\">implements</span> <span class=\"title\">Runnable</span></span>&#123;  </div><div class=\"line\">    BlockingQueue&lt;String&gt; queue; </div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">Consumer</span><span class=\"params\">(BlockingQueue&lt;String&gt; queue)</span></span>&#123;  </div><div class=\"line\">        <span class=\"keyword\">this</span>.queue = queue;  </div><div class=\"line\">    &#125;        </div><div class=\"line\">    <span class=\"meta\">@Override</span>  </div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;  </div><div class=\"line\">        <span class=\"keyword\">try</span> &#123;  </div><div class=\"line\">        \tString consumer = Thread.currentThread().getName();</div><div class=\"line\">        \tSystem.out.println(consumer);  </div><div class=\"line\">            String temp = queue.take();<span class=\"comment\">//如果队列为空，会阻塞当前线程  </span></div><div class=\"line\">            System.out.println(consumer+<span class=\"string\">\"get a product:\"</span>+temp);  </div><div class=\"line\">        &#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;  </div><div class=\"line\">            e.printStackTrace();  </div><div class=\"line\">        &#125;  </div><div class=\"line\">    &#125;  </div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<h1 id=\"java并发编程的一些总结\"><a href=\"#java并发编程的一些总结\" class=\"headerlink\" title=\"java并发编程的一些总结\"></a>java并发编程的一些总结</h1><h2 id=\"不应用线程池的缺点\"><a href=\"#不应用线程池的缺点\" class=\"headerlink\" title=\"不应用线程池的缺点\"></a>不应用线程池的缺点</h2><p>有些开发者图省事，遇到需要多线程处理的地方，直接new Thread(…).start()，对于一般场景是没问题的，但如果是在并发请求很高的情况下，就会有些隐患：</p>\n<ul>\n<li>新建线程的开销。线程虽然比进程要轻量许多，但对于JVM来说，新建一个线程的代价还是挺大的，决不同于新建一个对象</li>\n<li>资源消耗量。没有一个池来限制线程的数量，会导致线程的数量直接取决于应用的并发量，这样有潜在的线程数据巨大的可能，那么资源消耗量将是巨大的</li>\n<li>稳定性。当线程数量超过系统资源所能承受的程度，稳定性就会成问题<h2 id=\"制定执行策略\"><a href=\"#制定执行策略\" class=\"headerlink\" title=\"制定执行策略\"></a>制定执行策略</h2>在每个需要多线程处理的地方，不管并发量有多大，需要考虑线程的执行策略</li>\n<li>任务以什么顺序执行</li>\n<li>可以有多少个任务并发执行</li>\n<li>可以有多少个任务进入等待执行队列</li>\n<li>系统过载的时候，应该放弃哪些任务？如何通知到应用程序？</li>\n<li>一个任务的执行前后应该做什么处理</li>\n</ul>\n<h2 id=\"线程池的类型\"><a href=\"#线程池的类型\" class=\"headerlink\" title=\"线程池的类型\"></a>线程池的类型</h2><p>不管是通过Executors创建线程池，还是通过Spring来管理，都得清楚知道有哪几种线程池：</p>\n<ul>\n<li>FixedThreadPool：定长线程池，提交任务时创建线程，直到池的最大容量，如果有线程非预期结束，会补充新线程</li>\n<li>CachedThreadPool：可变线程池，它犹如一个弹簧，如果没有任务需求时，它回收空闲线程，如果需求增加，则按需增加线程，不对池的大小做限制</li>\n<li>SingleThreadExecutor：单线程。处理不过来的任务会进入FIFO队列等待执行</li>\n<li>SecheduledThreadPool：周期性线程池。支持执行周期性线程任务<br>其实，这些不同类型的线程池都是通过构建一个ThreadPoolExecutor来完成的，所不同的是corePoolSize,maximumPoolSize,keepAliveTime,unit,workQueue,threadFactory这么几个参数。具体可以参见JDK DOC。</li>\n</ul>\n<h2 id=\"线程池饱和策略\"><a href=\"#线程池饱和策略\" class=\"headerlink\" title=\"线程池饱和策略\"></a>线程池饱和策略</h2><p>由以上线程池类型可知，除了CachedThreadPool其他线程池都有饱和的可能，当饱和以后就需要相应的策略处理请求线程的任务，比如，达到上限时通过ThreadPoolExecutor.setRejectedExecutionHandler方法设置一个拒绝任务的策略，JDK提供了AbortPolicy、CallerRunsPolicy、DiscardPolicy、DiscardOldestPolicy几种策略，具体差异可见JDK DOC</p>\n<h2 id=\"线程无依赖性\"><a href=\"#线程无依赖性\" class=\"headerlink\" title=\"线程无依赖性\"></a>线程无依赖性</h2><p><font color=\"red\">多线程任务设计上尽量使得各任务是独立无依赖的</font>，所谓依赖性可两个方面：</p>\n<ul>\n<li>线程之间的依赖性。如果线程有依赖可能会造成死锁或饥饿</li>\n<li>调用者与线程的依赖性。调用者得监视线程的完成情况，影响可并发量<br>当然，在有些业务里确实需要一定的依赖性，比如调用者需要得到线程完成后结果，传统的Thread是不便完成的，因为run方法无返回值，只能通过一些共享的变量来传递结果，但在Executor框架里可以通过Future和Callable实现需要有返回值的任务，当然线程的异步性导致需要有相应机制来保证调用者能等待任务完成，关于Future和Callable的用法前文已讲解；</li>\n</ul>"},{"title":"大数据0402-JMS activeMQ","toc":true,"date":"2017-12-03T06:57:03.000Z","scaffolds":null,"_content":"\n#  java JMS技术\n##  什么是JMS\nJMS即Java<font color=\"red\">消息服务（Java Message Service）</font>应用程序接口是一个Java平台中关于面向消息中间件（MOM）的API，用于在两个应用程序之间，或分布式系统中发送消息，进行异步通信。Java消息服务是一个与具体平台无关的API，绝大多数MOM提供商都对JMS提供支持。  \nJMS是一种与厂商无关的 API，用来访问消息收发系统消息。它类似于JDBC(Java Database Connectivity)：这里，JDBC 是可以用来访问许多不同关系数据库的 API，而 JMS 则提供同样与厂商无关的访问方法，以访问消息收发服务。许多厂商都支持 JMS，包括 IBM 的 MQSeries、BEA的 Weblogic JMS service和 Progress 的 SonicMQ，这只是几个例子。 JMS 使您能够通过消息收发服务（有时称为消息中介程序或路由器）从一个 JMS 客户机向另一个 JMS客户机发送消息。消息是 JMS 中的一种类型对象，由两部分组成：报头和消息主体。报头由路由信息以及有关该消息的元数据组成。消息主体则携带着应用程序的数据或有效负载。根据有效负载的类型来划分，可以将消息分为几种类型，它们分别携带：简单文本(TextMessage)、可序列化的对象 (ObjectMessage)、属性集合 (MapMessage)、字节流 (BytesMessage)、原始值流 (StreamMessage)，还有无有效负载的消息 (Message)。\n##  JMS规范\n###  专业技术规范\nJMS（Java Messaging Service）是Java平台上有关面向消息中间件(MOM)的技术规范，它便于消息系统中的Java应用程序进行消息交换,并且通过提供标准的产生、发送、接收消息的接口简化企业应用的开发，翻译为Java消息服务。\n###  体系架构\nJMS由以下元素组成。\n- JMS提供者provider：连接面向消息中间件的，JMS接口的一个实现。提供者可以是Java平台的JMS实现，也可以是非Java平台的面向消息中间件的适配器。\n- JMS客户：生产或消费基于消息的Java的应用程序或对象。\n- JMS生产者：创建并发送消息的JMS客户。\n- JMS消费者：接收消息的JMS客户。\n- JMS消息：包括可以在JMS客户之间传递的数据的对象\n- JMS队列：一个容纳那些被发送的等待阅读的消息的区域。与队列名字所暗示的意思不同，消息的接受顺序并不一定要与消息的发送顺序相同。一旦一个消息被阅读，该消息将被从队列中移走。\n- JMS主题：一种支持发送消息给多个订阅者的机制。\n\n###  Java消息服务应用程序结构支持两种模型\n####  点对点或队列模型\n在点对点或队列模型下，一个生产者向一个特定的队列发布消息，一个消费者从该队列中读取消息。这里，生产者知道消费者的队列，并直接将消息发送到消费者的队列。    \n![201712315592](http://ovasdkxqr.bkt.clouddn.com/image/blog/201712315592.png)\n这种模式被概括为：  \n- 只有一个消费者将获得消息\n- 生产者不需要在接收者消费该消息期间处于运行状态，接收者也同样不需要在消息发送时处于运行状态。\n- 每一个成功处理的消息都由接收者签收\n\n#### 发布者/订阅者模型\n发布者/订阅者模型支持向一个特定的消息主题发布消息。0或多个订阅者可能对接收来自特定消息主题的消息感兴趣。在这种模型下，发布者和订阅者彼此不知道对方。这种模式好比是匿名公告板。    \n![2017123155942](http://ovasdkxqr.bkt.clouddn.com/image/blog/2017123155942.png)\n这种模式被概括为：\n- 多个消费者可以获得消息\n- 在发布者和订阅者之间存在时间依赖性。发布者需要建立一个订阅（subscription），以便客户能够订阅。订阅者必须保持持续的活动状态以接收消息，除非订阅者建立了持久的订阅。在那种情况下，在订阅者未连接时发布的消息将在订阅者重新连接时重新发布。\n\n# 代码演示\n## 下载ActiveMQ\n去官方网站下载：http://activemq.apache.org/\n\n## 运行ActiveMQ\n解压缩apache-activemq-5.5.1-bin.zip，\n修改配置文件activeMQ.xml，将0.0.0.0修改为localhost\n```xml\n    <transportConnectors>\n       <transportConnector name=\"openwire\" uri=\"tcp://localhost:61616\"/>\n       <transportConnector name=\"ssl\"     uri=\"ssl://localhost:61617\"/>\n       <transportConnector name=\"stomp\"   uri=\"stomp://localhost:61613\"/>\n       <transportConnector uri=\"http://localhost:8081\"/>\n       <transportConnector uri=\"udp://localhost:61618\"/>\n```\n\n然后双击apache-activemq-5.5.1\\bin\\activemq.bat运行ActiveMQ程序。  \n启动ActiveMQ以后，登陆：http://localhost:8161/admin/，创建一个Queue，命名为FirstQueue。  \n\n#  运行代码\n##  常用的JMS实现\n要使用Java消息服务，你必须要有一个JMS提供者，管理会话和队列。既有开源的提供者也有专有的提供者。  \n开源的提供者包括：\n- Apache ActiveMQ\n- JBoss 社区所研发的 HornetQ\n- Joram\n- Coridan的MantaRay\n- The OpenJMS Group的OpenJMS\n- 专有的提供者包括：\n- BEA的BEA WebLogic Server JMS\n- TIBCO Software的EMS\n- GigaSpaces Technologies的GigaSpaces\n- Softwired 2006的iBus\n- IONA Technologies的IONA JMS\n- SeeBeyond的IQManager（2005年8月被Sun Microsystems并购）\n- webMethods的JMS+ -\n- my-channels的Nirvana\n- Sonic Software的SonicMQ\n- SwiftMQ的SwiftMQ\n- IBM的WebSphere MQ\n\n```java\npackage cn.itcast_03_mq.topic;\nimport javax.jms.Connection;      \nimport javax.jms.DeliveryMode;      \nimport javax.jms.Destination;      \nimport javax.jms.JMSException;      \nimport javax.jms.MessageProducer;      \nimport javax.jms.Session;      \nimport javax.jms.TextMessage;      \n     \nimport org.apache.activemq.ActiveMQConnection;      \nimport org.apache.activemq.ActiveMQConnectionFactory;      \n     \npublic class ProducerTool {        \n    private String user = ActiveMQConnection.DEFAULT_USER;         \n    private String password = ActiveMQConnection.DEFAULT_PASSWORD;       \n    private String url = ActiveMQConnection.DEFAULT_BROKER_URL;       \n    private String subject = \"mytopic\";      \n    private Destination destination = null;      \n    private Connection connection = null;      \n    private Session session = null;      \n    private MessageProducer producer = null;\n    // 初始化      \n    private void initialize() throws JMSException, Exception {      \n        ActiveMQConnectionFactory connectionFactory = new ActiveMQConnectionFactory(      \n                user, password, url);      \n        connection = connectionFactory.createConnection();      \n        session = connection.createSession(false, Session.AUTO_ACKNOWLEDGE);      \n        destination = session.createTopic(subject);      \n        producer = session.createProducer(destination);      \n        producer.setDeliveryMode(DeliveryMode.NON_PERSISTENT);      \n    }\n    // 发送消息      \n    public void produceMessage(String message) throws JMSException, Exception {      \n        initialize();      \n        TextMessage msg = session.createTextMessage(message);      \n        connection.start();      \n        System.out.println(\"Producer:->Sending message: \" + message);      \n        producer.send(msg);      \n        System.out.println(\"Producer:->Message sent complete!\");      \n    }\n    // 关闭连接      \n    public void close() throws JMSException {      \n        System.out.println(\"Producer:->Closing connection\");      \n        if (producer != null)      \n            producer.close();      \n        if (session != null)      \n            session.close();      \n        if (connection != null)      \n            connection.close();      \n    }      \n}        \n\n----------------------------------------------------------\npackage cn.itcast_03_mq.topic;\nimport java.util.Random;\n\nimport javax.jms.JMSException;      \n\npublic class ProducerTest {      \n     \n    /**    \n     * @param args    \n     */     \n    public static void main(String[] args) throws JMSException, Exception {      \n        ProducerTool producer = new ProducerTool(); \n        Random random = new Random();\n        for(int i=0;i<20;i++){\n        \t\n        \tThread.sleep(random.nextInt(10)*1000);\n        \t\n        \tproducer.produceMessage(\"Hello, world!--\"+i);      \n        \tproducer.close();\n        }\n        \n    }      \n}      \n\n----------------------------------------------------------\npackage cn.itcast_03_mq.topic;\nimport javax.jms.Connection;      \nimport javax.jms.Destination;      \nimport javax.jms.ExceptionListener;\nimport javax.jms.JMSException;      \nimport javax.jms.MessageConsumer;      \nimport javax.jms.Session;      \nimport javax.jms.MessageListener;      \nimport javax.jms.Message;      \nimport javax.jms.TextMessage;      \n     \nimport org.apache.activemq.ActiveMQConnection;      \nimport org.apache.activemq.ActiveMQConnectionFactory;      \n     \npublic class ConsumerTool implements MessageListener,ExceptionListener {      \n    private String user = ActiveMQConnection.DEFAULT_USER;      \n    private String password = ActiveMQConnection.DEFAULT_PASSWORD;      \n    private String url =ActiveMQConnection.DEFAULT_BROKER_URL;      \n    private String subject = \"mytopic\";      \n    private Destination destination = null;      \n    private Connection connection = null;      \n    private Session session = null;      \n    private MessageConsumer consumer = null;  \n    public static Boolean isconnection=false;\n    // 初始化      \n    private void initialize() throws JMSException, Exception {      \n        ActiveMQConnectionFactory connectionFactory = new ActiveMQConnectionFactory(      \n                user, password, url);      \n        connection = connectionFactory.createConnection();      \n        session = connection.createSession(false, Session.AUTO_ACKNOWLEDGE);      \n        destination = session.createTopic(subject);      \n        consumer = session.createConsumer(destination);     \n    }      \n     \n    // 消费消息      \n    public void consumeMessage() throws JMSException, Exception {      \n        initialize();      \n        connection.start();\n        consumer.setMessageListener(this);    \n        connection.setExceptionListener(this);\n        isconnection=true;\n        System.out.println(\"Consumer:->Begin listening...\");      \n        // 开始监听  \n        // Message message = consumer.receive();      \n    }\n    // 关闭连接      \n    public void close() throws JMSException {      \n        System.out.println(\"Consumer:->Closing connection\");      \n        if (consumer != null)      \n            consumer.close();      \n        if (session != null)      \n            session.close();      \n        if (connection != null)      \n            connection.close();      \n    }\n    // 消息处理函数      \n    public void onMessage(Message message) {      \n        try {      \n            if (message instanceof TextMessage) {      \n                TextMessage txtMsg = (TextMessage) message;      \n                String msg = txtMsg.getText();      \n                System.out.println(\"Consumer:->Received: \" + msg);      \n            } else {      \n                System.out.println(\"Consumer:->Received: \" + message);      \n            }      \n        } catch (JMSException e) {      \n            // TODO Auto-generated catch block      \n            e.printStackTrace();      \n        }      \n    }\n\n\tpublic void onException(JMSException arg0) {\n\t\tisconnection=false;\n\t}      \n}      \n----------------------------------------------------------     \npackage cn.itcast_03_mq.topic;\n\nimport javax.jms.JMSException;\n\npublic class ConsumerTest implements Runnable {\n\tstatic Thread t1 = null;\n\n\t/**\n\t * @param args\n\t * @throws InterruptedException\n\t * @throws InterruptedException\n\t * @throws JMSException\n\t * @throws InterruptedException\n\t */\n\tpublic static void main(String[] args) throws InterruptedException {\n\n\t\tt1 = new Thread(new ConsumerTest());\n\t\tt1.setDaemon(false);\n\t\tt1.start();\n\t\t/**\n\t\t * 如果发生异常，则重启consumer\n\t\t */\n\t\t/*while (true) {\n\t\t\tSystem.out.println(t1.isAlive());\n\t\t\tif (!t1.isAlive()) {\n\t\t\t\tt1 = new Thread(new ConsumerTest());\n\t\t\t\tt1.start();\n\t\t\t\tSystem.out.println(\"重新启动\");\n\t\t\t}\n\t\t\tThread.sleep(5000);\n\t\t}*/\n\t\t// 延时500毫秒之后停止接受消息\n\t\t// Thread.sleep(500);\n\t\t// consumer.close();\n\t}\n\n\tpublic void run() {\n\t\ttry {\n\t\t\tConsumerTool consumer = new ConsumerTool();\n\t\t\tconsumer.consumeMessage();\n\t\t\twhile (ConsumerTool.isconnection) {\t\n\t\t\t}\n\t\t} catch (Exception e) {\n\t\t}\n\n\t}\n}\n\n```","source":"_posts/大数据/大数据0402-JMS activeMQ.md","raw":"---\ntitle: 大数据0402-JMS activeMQ\ncategories: 学习\ntags:\n  - 大数据\n  - JMS\n  - activeMQ\n  - java\ntoc: true\ndate: 2017-12-03 14:57:03\nscaffolds:\n---\n\n#  java JMS技术\n##  什么是JMS\nJMS即Java<font color=\"red\">消息服务（Java Message Service）</font>应用程序接口是一个Java平台中关于面向消息中间件（MOM）的API，用于在两个应用程序之间，或分布式系统中发送消息，进行异步通信。Java消息服务是一个与具体平台无关的API，绝大多数MOM提供商都对JMS提供支持。  \nJMS是一种与厂商无关的 API，用来访问消息收发系统消息。它类似于JDBC(Java Database Connectivity)：这里，JDBC 是可以用来访问许多不同关系数据库的 API，而 JMS 则提供同样与厂商无关的访问方法，以访问消息收发服务。许多厂商都支持 JMS，包括 IBM 的 MQSeries、BEA的 Weblogic JMS service和 Progress 的 SonicMQ，这只是几个例子。 JMS 使您能够通过消息收发服务（有时称为消息中介程序或路由器）从一个 JMS 客户机向另一个 JMS客户机发送消息。消息是 JMS 中的一种类型对象，由两部分组成：报头和消息主体。报头由路由信息以及有关该消息的元数据组成。消息主体则携带着应用程序的数据或有效负载。根据有效负载的类型来划分，可以将消息分为几种类型，它们分别携带：简单文本(TextMessage)、可序列化的对象 (ObjectMessage)、属性集合 (MapMessage)、字节流 (BytesMessage)、原始值流 (StreamMessage)，还有无有效负载的消息 (Message)。\n##  JMS规范\n###  专业技术规范\nJMS（Java Messaging Service）是Java平台上有关面向消息中间件(MOM)的技术规范，它便于消息系统中的Java应用程序进行消息交换,并且通过提供标准的产生、发送、接收消息的接口简化企业应用的开发，翻译为Java消息服务。\n###  体系架构\nJMS由以下元素组成。\n- JMS提供者provider：连接面向消息中间件的，JMS接口的一个实现。提供者可以是Java平台的JMS实现，也可以是非Java平台的面向消息中间件的适配器。\n- JMS客户：生产或消费基于消息的Java的应用程序或对象。\n- JMS生产者：创建并发送消息的JMS客户。\n- JMS消费者：接收消息的JMS客户。\n- JMS消息：包括可以在JMS客户之间传递的数据的对象\n- JMS队列：一个容纳那些被发送的等待阅读的消息的区域。与队列名字所暗示的意思不同，消息的接受顺序并不一定要与消息的发送顺序相同。一旦一个消息被阅读，该消息将被从队列中移走。\n- JMS主题：一种支持发送消息给多个订阅者的机制。\n\n###  Java消息服务应用程序结构支持两种模型\n####  点对点或队列模型\n在点对点或队列模型下，一个生产者向一个特定的队列发布消息，一个消费者从该队列中读取消息。这里，生产者知道消费者的队列，并直接将消息发送到消费者的队列。    \n![201712315592](http://ovasdkxqr.bkt.clouddn.com/image/blog/201712315592.png)\n这种模式被概括为：  \n- 只有一个消费者将获得消息\n- 生产者不需要在接收者消费该消息期间处于运行状态，接收者也同样不需要在消息发送时处于运行状态。\n- 每一个成功处理的消息都由接收者签收\n\n#### 发布者/订阅者模型\n发布者/订阅者模型支持向一个特定的消息主题发布消息。0或多个订阅者可能对接收来自特定消息主题的消息感兴趣。在这种模型下，发布者和订阅者彼此不知道对方。这种模式好比是匿名公告板。    \n![2017123155942](http://ovasdkxqr.bkt.clouddn.com/image/blog/2017123155942.png)\n这种模式被概括为：\n- 多个消费者可以获得消息\n- 在发布者和订阅者之间存在时间依赖性。发布者需要建立一个订阅（subscription），以便客户能够订阅。订阅者必须保持持续的活动状态以接收消息，除非订阅者建立了持久的订阅。在那种情况下，在订阅者未连接时发布的消息将在订阅者重新连接时重新发布。\n\n# 代码演示\n## 下载ActiveMQ\n去官方网站下载：http://activemq.apache.org/\n\n## 运行ActiveMQ\n解压缩apache-activemq-5.5.1-bin.zip，\n修改配置文件activeMQ.xml，将0.0.0.0修改为localhost\n```xml\n    <transportConnectors>\n       <transportConnector name=\"openwire\" uri=\"tcp://localhost:61616\"/>\n       <transportConnector name=\"ssl\"     uri=\"ssl://localhost:61617\"/>\n       <transportConnector name=\"stomp\"   uri=\"stomp://localhost:61613\"/>\n       <transportConnector uri=\"http://localhost:8081\"/>\n       <transportConnector uri=\"udp://localhost:61618\"/>\n```\n\n然后双击apache-activemq-5.5.1\\bin\\activemq.bat运行ActiveMQ程序。  \n启动ActiveMQ以后，登陆：http://localhost:8161/admin/，创建一个Queue，命名为FirstQueue。  \n\n#  运行代码\n##  常用的JMS实现\n要使用Java消息服务，你必须要有一个JMS提供者，管理会话和队列。既有开源的提供者也有专有的提供者。  \n开源的提供者包括：\n- Apache ActiveMQ\n- JBoss 社区所研发的 HornetQ\n- Joram\n- Coridan的MantaRay\n- The OpenJMS Group的OpenJMS\n- 专有的提供者包括：\n- BEA的BEA WebLogic Server JMS\n- TIBCO Software的EMS\n- GigaSpaces Technologies的GigaSpaces\n- Softwired 2006的iBus\n- IONA Technologies的IONA JMS\n- SeeBeyond的IQManager（2005年8月被Sun Microsystems并购）\n- webMethods的JMS+ -\n- my-channels的Nirvana\n- Sonic Software的SonicMQ\n- SwiftMQ的SwiftMQ\n- IBM的WebSphere MQ\n\n```java\npackage cn.itcast_03_mq.topic;\nimport javax.jms.Connection;      \nimport javax.jms.DeliveryMode;      \nimport javax.jms.Destination;      \nimport javax.jms.JMSException;      \nimport javax.jms.MessageProducer;      \nimport javax.jms.Session;      \nimport javax.jms.TextMessage;      \n     \nimport org.apache.activemq.ActiveMQConnection;      \nimport org.apache.activemq.ActiveMQConnectionFactory;      \n     \npublic class ProducerTool {        \n    private String user = ActiveMQConnection.DEFAULT_USER;         \n    private String password = ActiveMQConnection.DEFAULT_PASSWORD;       \n    private String url = ActiveMQConnection.DEFAULT_BROKER_URL;       \n    private String subject = \"mytopic\";      \n    private Destination destination = null;      \n    private Connection connection = null;      \n    private Session session = null;      \n    private MessageProducer producer = null;\n    // 初始化      \n    private void initialize() throws JMSException, Exception {      \n        ActiveMQConnectionFactory connectionFactory = new ActiveMQConnectionFactory(      \n                user, password, url);      \n        connection = connectionFactory.createConnection();      \n        session = connection.createSession(false, Session.AUTO_ACKNOWLEDGE);      \n        destination = session.createTopic(subject);      \n        producer = session.createProducer(destination);      \n        producer.setDeliveryMode(DeliveryMode.NON_PERSISTENT);      \n    }\n    // 发送消息      \n    public void produceMessage(String message) throws JMSException, Exception {      \n        initialize();      \n        TextMessage msg = session.createTextMessage(message);      \n        connection.start();      \n        System.out.println(\"Producer:->Sending message: \" + message);      \n        producer.send(msg);      \n        System.out.println(\"Producer:->Message sent complete!\");      \n    }\n    // 关闭连接      \n    public void close() throws JMSException {      \n        System.out.println(\"Producer:->Closing connection\");      \n        if (producer != null)      \n            producer.close();      \n        if (session != null)      \n            session.close();      \n        if (connection != null)      \n            connection.close();      \n    }      \n}        \n\n----------------------------------------------------------\npackage cn.itcast_03_mq.topic;\nimport java.util.Random;\n\nimport javax.jms.JMSException;      \n\npublic class ProducerTest {      \n     \n    /**    \n     * @param args    \n     */     \n    public static void main(String[] args) throws JMSException, Exception {      \n        ProducerTool producer = new ProducerTool(); \n        Random random = new Random();\n        for(int i=0;i<20;i++){\n        \t\n        \tThread.sleep(random.nextInt(10)*1000);\n        \t\n        \tproducer.produceMessage(\"Hello, world!--\"+i);      \n        \tproducer.close();\n        }\n        \n    }      \n}      \n\n----------------------------------------------------------\npackage cn.itcast_03_mq.topic;\nimport javax.jms.Connection;      \nimport javax.jms.Destination;      \nimport javax.jms.ExceptionListener;\nimport javax.jms.JMSException;      \nimport javax.jms.MessageConsumer;      \nimport javax.jms.Session;      \nimport javax.jms.MessageListener;      \nimport javax.jms.Message;      \nimport javax.jms.TextMessage;      \n     \nimport org.apache.activemq.ActiveMQConnection;      \nimport org.apache.activemq.ActiveMQConnectionFactory;      \n     \npublic class ConsumerTool implements MessageListener,ExceptionListener {      \n    private String user = ActiveMQConnection.DEFAULT_USER;      \n    private String password = ActiveMQConnection.DEFAULT_PASSWORD;      \n    private String url =ActiveMQConnection.DEFAULT_BROKER_URL;      \n    private String subject = \"mytopic\";      \n    private Destination destination = null;      \n    private Connection connection = null;      \n    private Session session = null;      \n    private MessageConsumer consumer = null;  \n    public static Boolean isconnection=false;\n    // 初始化      \n    private void initialize() throws JMSException, Exception {      \n        ActiveMQConnectionFactory connectionFactory = new ActiveMQConnectionFactory(      \n                user, password, url);      \n        connection = connectionFactory.createConnection();      \n        session = connection.createSession(false, Session.AUTO_ACKNOWLEDGE);      \n        destination = session.createTopic(subject);      \n        consumer = session.createConsumer(destination);     \n    }      \n     \n    // 消费消息      \n    public void consumeMessage() throws JMSException, Exception {      \n        initialize();      \n        connection.start();\n        consumer.setMessageListener(this);    \n        connection.setExceptionListener(this);\n        isconnection=true;\n        System.out.println(\"Consumer:->Begin listening...\");      \n        // 开始监听  \n        // Message message = consumer.receive();      \n    }\n    // 关闭连接      \n    public void close() throws JMSException {      \n        System.out.println(\"Consumer:->Closing connection\");      \n        if (consumer != null)      \n            consumer.close();      \n        if (session != null)      \n            session.close();      \n        if (connection != null)      \n            connection.close();      \n    }\n    // 消息处理函数      \n    public void onMessage(Message message) {      \n        try {      \n            if (message instanceof TextMessage) {      \n                TextMessage txtMsg = (TextMessage) message;      \n                String msg = txtMsg.getText();      \n                System.out.println(\"Consumer:->Received: \" + msg);      \n            } else {      \n                System.out.println(\"Consumer:->Received: \" + message);      \n            }      \n        } catch (JMSException e) {      \n            // TODO Auto-generated catch block      \n            e.printStackTrace();      \n        }      \n    }\n\n\tpublic void onException(JMSException arg0) {\n\t\tisconnection=false;\n\t}      \n}      \n----------------------------------------------------------     \npackage cn.itcast_03_mq.topic;\n\nimport javax.jms.JMSException;\n\npublic class ConsumerTest implements Runnable {\n\tstatic Thread t1 = null;\n\n\t/**\n\t * @param args\n\t * @throws InterruptedException\n\t * @throws InterruptedException\n\t * @throws JMSException\n\t * @throws InterruptedException\n\t */\n\tpublic static void main(String[] args) throws InterruptedException {\n\n\t\tt1 = new Thread(new ConsumerTest());\n\t\tt1.setDaemon(false);\n\t\tt1.start();\n\t\t/**\n\t\t * 如果发生异常，则重启consumer\n\t\t */\n\t\t/*while (true) {\n\t\t\tSystem.out.println(t1.isAlive());\n\t\t\tif (!t1.isAlive()) {\n\t\t\t\tt1 = new Thread(new ConsumerTest());\n\t\t\t\tt1.start();\n\t\t\t\tSystem.out.println(\"重新启动\");\n\t\t\t}\n\t\t\tThread.sleep(5000);\n\t\t}*/\n\t\t// 延时500毫秒之后停止接受消息\n\t\t// Thread.sleep(500);\n\t\t// consumer.close();\n\t}\n\n\tpublic void run() {\n\t\ttry {\n\t\t\tConsumerTool consumer = new ConsumerTool();\n\t\t\tconsumer.consumeMessage();\n\t\t\twhile (ConsumerTool.isconnection) {\t\n\t\t\t}\n\t\t} catch (Exception e) {\n\t\t}\n\n\t}\n}\n\n```","slug":"大数据/大数据0402-JMS activeMQ","published":1,"updated":"2017-12-03T10:30:08.487Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjcsq4ljg003mx4vfjkm7pejj","content":"<h1 id=\"java-JMS技术\"><a href=\"#java-JMS技术\" class=\"headerlink\" title=\"java JMS技术\"></a>java JMS技术</h1><h2 id=\"什么是JMS\"><a href=\"#什么是JMS\" class=\"headerlink\" title=\"什么是JMS\"></a>什么是JMS</h2><p>JMS即Java<font color=\"red\">消息服务（Java Message Service）</font>应用程序接口是一个Java平台中关于面向消息中间件（MOM）的API，用于在两个应用程序之间，或分布式系统中发送消息，进行异步通信。Java消息服务是一个与具体平台无关的API，绝大多数MOM提供商都对JMS提供支持。<br>JMS是一种与厂商无关的 API，用来访问消息收发系统消息。它类似于JDBC(Java Database Connectivity)：这里，JDBC 是可以用来访问许多不同关系数据库的 API，而 JMS 则提供同样与厂商无关的访问方法，以访问消息收发服务。许多厂商都支持 JMS，包括 IBM 的 MQSeries、BEA的 Weblogic JMS service和 Progress 的 SonicMQ，这只是几个例子。 JMS 使您能够通过消息收发服务（有时称为消息中介程序或路由器）从一个 JMS 客户机向另一个 JMS客户机发送消息。消息是 JMS 中的一种类型对象，由两部分组成：报头和消息主体。报头由路由信息以及有关该消息的元数据组成。消息主体则携带着应用程序的数据或有效负载。根据有效负载的类型来划分，可以将消息分为几种类型，它们分别携带：简单文本(TextMessage)、可序列化的对象 (ObjectMessage)、属性集合 (MapMessage)、字节流 (BytesMessage)、原始值流 (StreamMessage)，还有无有效负载的消息 (Message)。</p>\n<h2 id=\"JMS规范\"><a href=\"#JMS规范\" class=\"headerlink\" title=\"JMS规范\"></a>JMS规范</h2><h3 id=\"专业技术规范\"><a href=\"#专业技术规范\" class=\"headerlink\" title=\"专业技术规范\"></a>专业技术规范</h3><p>JMS（Java Messaging Service）是Java平台上有关面向消息中间件(MOM)的技术规范，它便于消息系统中的Java应用程序进行消息交换,并且通过提供标准的产生、发送、接收消息的接口简化企业应用的开发，翻译为Java消息服务。</p>\n<h3 id=\"体系架构\"><a href=\"#体系架构\" class=\"headerlink\" title=\"体系架构\"></a>体系架构</h3><p>JMS由以下元素组成。</p>\n<ul>\n<li>JMS提供者provider：连接面向消息中间件的，JMS接口的一个实现。提供者可以是Java平台的JMS实现，也可以是非Java平台的面向消息中间件的适配器。</li>\n<li>JMS客户：生产或消费基于消息的Java的应用程序或对象。</li>\n<li>JMS生产者：创建并发送消息的JMS客户。</li>\n<li>JMS消费者：接收消息的JMS客户。</li>\n<li>JMS消息：包括可以在JMS客户之间传递的数据的对象</li>\n<li>JMS队列：一个容纳那些被发送的等待阅读的消息的区域。与队列名字所暗示的意思不同，消息的接受顺序并不一定要与消息的发送顺序相同。一旦一个消息被阅读，该消息将被从队列中移走。</li>\n<li>JMS主题：一种支持发送消息给多个订阅者的机制。</li>\n</ul>\n<h3 id=\"Java消息服务应用程序结构支持两种模型\"><a href=\"#Java消息服务应用程序结构支持两种模型\" class=\"headerlink\" title=\"Java消息服务应用程序结构支持两种模型\"></a>Java消息服务应用程序结构支持两种模型</h3><h4 id=\"点对点或队列模型\"><a href=\"#点对点或队列模型\" class=\"headerlink\" title=\"点对点或队列模型\"></a>点对点或队列模型</h4><p>在点对点或队列模型下，一个生产者向一个特定的队列发布消息，一个消费者从该队列中读取消息。这里，生产者知道消费者的队列，并直接将消息发送到消费者的队列。<br><img src=\"http://ovasdkxqr.bkt.clouddn.com/image/blog/201712315592.png\" alt=\"201712315592\"><br>这种模式被概括为：  </p>\n<ul>\n<li>只有一个消费者将获得消息</li>\n<li>生产者不需要在接收者消费该消息期间处于运行状态，接收者也同样不需要在消息发送时处于运行状态。</li>\n<li>每一个成功处理的消息都由接收者签收</li>\n</ul>\n<h4 id=\"发布者-订阅者模型\"><a href=\"#发布者-订阅者模型\" class=\"headerlink\" title=\"发布者/订阅者模型\"></a>发布者/订阅者模型</h4><p>发布者/订阅者模型支持向一个特定的消息主题发布消息。0或多个订阅者可能对接收来自特定消息主题的消息感兴趣。在这种模型下，发布者和订阅者彼此不知道对方。这种模式好比是匿名公告板。<br><img src=\"http://ovasdkxqr.bkt.clouddn.com/image/blog/2017123155942.png\" alt=\"2017123155942\"><br>这种模式被概括为：</p>\n<ul>\n<li>多个消费者可以获得消息</li>\n<li>在发布者和订阅者之间存在时间依赖性。发布者需要建立一个订阅（subscription），以便客户能够订阅。订阅者必须保持持续的活动状态以接收消息，除非订阅者建立了持久的订阅。在那种情况下，在订阅者未连接时发布的消息将在订阅者重新连接时重新发布。</li>\n</ul>\n<h1 id=\"代码演示\"><a href=\"#代码演示\" class=\"headerlink\" title=\"代码演示\"></a>代码演示</h1><h2 id=\"下载ActiveMQ\"><a href=\"#下载ActiveMQ\" class=\"headerlink\" title=\"下载ActiveMQ\"></a>下载ActiveMQ</h2><p>去官方网站下载：<a href=\"http://activemq.apache.org/\" target=\"_blank\" rel=\"external\">http://activemq.apache.org/</a></p>\n<h2 id=\"运行ActiveMQ\"><a href=\"#运行ActiveMQ\" class=\"headerlink\" title=\"运行ActiveMQ\"></a>运行ActiveMQ</h2><p>解压缩apache-activemq-5.5.1-bin.zip，<br>修改配置文件activeMQ.xml，将0.0.0.0修改为localhost<br><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">transportConnectors</span>&gt;</span></div><div class=\"line\">   <span class=\"tag\">&lt;<span class=\"name\">transportConnector</span> <span class=\"attr\">name</span>=<span class=\"string\">\"openwire\"</span> <span class=\"attr\">uri</span>=<span class=\"string\">\"tcp://localhost:61616\"</span>/&gt;</span></div><div class=\"line\">   <span class=\"tag\">&lt;<span class=\"name\">transportConnector</span> <span class=\"attr\">name</span>=<span class=\"string\">\"ssl\"</span>     <span class=\"attr\">uri</span>=<span class=\"string\">\"ssl://localhost:61617\"</span>/&gt;</span></div><div class=\"line\">   <span class=\"tag\">&lt;<span class=\"name\">transportConnector</span> <span class=\"attr\">name</span>=<span class=\"string\">\"stomp\"</span>   <span class=\"attr\">uri</span>=<span class=\"string\">\"stomp://localhost:61613\"</span>/&gt;</span></div><div class=\"line\">   <span class=\"tag\">&lt;<span class=\"name\">transportConnector</span> <span class=\"attr\">uri</span>=<span class=\"string\">\"http://localhost:8081\"</span>/&gt;</span></div><div class=\"line\">   <span class=\"tag\">&lt;<span class=\"name\">transportConnector</span> <span class=\"attr\">uri</span>=<span class=\"string\">\"udp://localhost:61618\"</span>/&gt;</span></div></pre></td></tr></table></figure></p>\n<p>然后双击apache-activemq-5.5.1\\bin\\activemq.bat运行ActiveMQ程序。<br>启动ActiveMQ以后，登陆：<a href=\"http://localhost:8161/admin/，创建一个Queue，命名为FirstQueue。\" target=\"_blank\" rel=\"external\">http://localhost:8161/admin/，创建一个Queue，命名为FirstQueue。</a>  </p>\n<h1 id=\"运行代码\"><a href=\"#运行代码\" class=\"headerlink\" title=\"运行代码\"></a>运行代码</h1><h2 id=\"常用的JMS实现\"><a href=\"#常用的JMS实现\" class=\"headerlink\" title=\"常用的JMS实现\"></a>常用的JMS实现</h2><p>要使用Java消息服务，你必须要有一个JMS提供者，管理会话和队列。既有开源的提供者也有专有的提供者。<br>开源的提供者包括：</p>\n<ul>\n<li>Apache ActiveMQ</li>\n<li>JBoss 社区所研发的 HornetQ</li>\n<li>Joram</li>\n<li>Coridan的MantaRay</li>\n<li>The OpenJMS Group的OpenJMS</li>\n<li>专有的提供者包括：</li>\n<li>BEA的BEA WebLogic Server JMS</li>\n<li>TIBCO Software的EMS</li>\n<li>GigaSpaces Technologies的GigaSpaces</li>\n<li>Softwired 2006的iBus</li>\n<li>IONA Technologies的IONA JMS</li>\n<li>SeeBeyond的IQManager（2005年8月被Sun Microsystems并购）</li>\n<li>webMethods的JMS+ -</li>\n<li>my-channels的Nirvana</li>\n<li>Sonic Software的SonicMQ</li>\n<li>SwiftMQ的SwiftMQ</li>\n<li>IBM的WebSphere MQ</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div><div class=\"line\">87</div><div class=\"line\">88</div><div class=\"line\">89</div><div class=\"line\">90</div><div class=\"line\">91</div><div class=\"line\">92</div><div class=\"line\">93</div><div class=\"line\">94</div><div class=\"line\">95</div><div class=\"line\">96</div><div class=\"line\">97</div><div class=\"line\">98</div><div class=\"line\">99</div><div class=\"line\">100</div><div class=\"line\">101</div><div class=\"line\">102</div><div class=\"line\">103</div><div class=\"line\">104</div><div class=\"line\">105</div><div class=\"line\">106</div><div class=\"line\">107</div><div class=\"line\">108</div><div class=\"line\">109</div><div class=\"line\">110</div><div class=\"line\">111</div><div class=\"line\">112</div><div class=\"line\">113</div><div class=\"line\">114</div><div class=\"line\">115</div><div class=\"line\">116</div><div class=\"line\">117</div><div class=\"line\">118</div><div class=\"line\">119</div><div class=\"line\">120</div><div class=\"line\">121</div><div class=\"line\">122</div><div class=\"line\">123</div><div class=\"line\">124</div><div class=\"line\">125</div><div class=\"line\">126</div><div class=\"line\">127</div><div class=\"line\">128</div><div class=\"line\">129</div><div class=\"line\">130</div><div class=\"line\">131</div><div class=\"line\">132</div><div class=\"line\">133</div><div class=\"line\">134</div><div class=\"line\">135</div><div class=\"line\">136</div><div class=\"line\">137</div><div class=\"line\">138</div><div class=\"line\">139</div><div class=\"line\">140</div><div class=\"line\">141</div><div class=\"line\">142</div><div class=\"line\">143</div><div class=\"line\">144</div><div class=\"line\">145</div><div class=\"line\">146</div><div class=\"line\">147</div><div class=\"line\">148</div><div class=\"line\">149</div><div class=\"line\">150</div><div class=\"line\">151</div><div class=\"line\">152</div><div class=\"line\">153</div><div class=\"line\">154</div><div class=\"line\">155</div><div class=\"line\">156</div><div class=\"line\">157</div><div class=\"line\">158</div><div class=\"line\">159</div><div class=\"line\">160</div><div class=\"line\">161</div><div class=\"line\">162</div><div class=\"line\">163</div><div class=\"line\">164</div><div class=\"line\">165</div><div class=\"line\">166</div><div class=\"line\">167</div><div class=\"line\">168</div><div class=\"line\">169</div><div class=\"line\">170</div><div class=\"line\">171</div><div class=\"line\">172</div><div class=\"line\">173</div><div class=\"line\">174</div><div class=\"line\">175</div><div class=\"line\">176</div><div class=\"line\">177</div><div class=\"line\">178</div><div class=\"line\">179</div><div class=\"line\">180</div><div class=\"line\">181</div><div class=\"line\">182</div><div class=\"line\">183</div><div class=\"line\">184</div><div class=\"line\">185</div><div class=\"line\">186</div><div class=\"line\">187</div><div class=\"line\">188</div><div class=\"line\">189</div><div class=\"line\">190</div><div class=\"line\">191</div><div class=\"line\">192</div><div class=\"line\">193</div><div class=\"line\">194</div><div class=\"line\">195</div><div class=\"line\">196</div><div class=\"line\">197</div><div class=\"line\">198</div><div class=\"line\">199</div><div class=\"line\">200</div><div class=\"line\">201</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">package</span> cn.itcast_03_mq.topic;</div><div class=\"line\"><span class=\"keyword\">import</span> javax.jms.Connection;      </div><div class=\"line\"><span class=\"keyword\">import</span> javax.jms.DeliveryMode;      </div><div class=\"line\"><span class=\"keyword\">import</span> javax.jms.Destination;      </div><div class=\"line\"><span class=\"keyword\">import</span> javax.jms.JMSException;      </div><div class=\"line\"><span class=\"keyword\">import</span> javax.jms.MessageProducer;      </div><div class=\"line\"><span class=\"keyword\">import</span> javax.jms.Session;      </div><div class=\"line\"><span class=\"keyword\">import</span> javax.jms.TextMessage;      </div><div class=\"line\">     </div><div class=\"line\"><span class=\"keyword\">import</span> org.apache.activemq.ActiveMQConnection;      </div><div class=\"line\"><span class=\"keyword\">import</span> org.apache.activemq.ActiveMQConnectionFactory;      </div><div class=\"line\">     </div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ProducerTool</span> </span>&#123;        </div><div class=\"line\">    <span class=\"keyword\">private</span> String user = ActiveMQConnection.DEFAULT_USER;         </div><div class=\"line\">    <span class=\"keyword\">private</span> String password = ActiveMQConnection.DEFAULT_PASSWORD;       </div><div class=\"line\">    <span class=\"keyword\">private</span> String url = ActiveMQConnection.DEFAULT_BROKER_URL;       </div><div class=\"line\">    <span class=\"keyword\">private</span> String subject = <span class=\"string\">\"mytopic\"</span>;      </div><div class=\"line\">    <span class=\"keyword\">private</span> Destination destination = <span class=\"keyword\">null</span>;      </div><div class=\"line\">    <span class=\"keyword\">private</span> Connection connection = <span class=\"keyword\">null</span>;      </div><div class=\"line\">    <span class=\"keyword\">private</span> Session session = <span class=\"keyword\">null</span>;      </div><div class=\"line\">    <span class=\"keyword\">private</span> MessageProducer producer = <span class=\"keyword\">null</span>;</div><div class=\"line\">    <span class=\"comment\">// 初始化      </span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">initialize</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> JMSException, Exception </span>&#123;      </div><div class=\"line\">        ActiveMQConnectionFactory connectionFactory = <span class=\"keyword\">new</span> ActiveMQConnectionFactory(      </div><div class=\"line\">                user, password, url);      </div><div class=\"line\">        connection = connectionFactory.createConnection();      </div><div class=\"line\">        session = connection.createSession(<span class=\"keyword\">false</span>, Session.AUTO_ACKNOWLEDGE);      </div><div class=\"line\">        destination = session.createTopic(subject);      </div><div class=\"line\">        producer = session.createProducer(destination);      </div><div class=\"line\">        producer.setDeliveryMode(DeliveryMode.NON_PERSISTENT);      </div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"comment\">// 发送消息      </span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">produceMessage</span><span class=\"params\">(String message)</span> <span class=\"keyword\">throws</span> JMSException, Exception </span>&#123;      </div><div class=\"line\">        initialize();      </div><div class=\"line\">        TextMessage msg = session.createTextMessage(message);      </div><div class=\"line\">        connection.start();      </div><div class=\"line\">        System.out.println(<span class=\"string\">\"Producer:-&gt;Sending message: \"</span> + message);      </div><div class=\"line\">        producer.send(msg);      </div><div class=\"line\">        System.out.println(<span class=\"string\">\"Producer:-&gt;Message sent complete!\"</span>);      </div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"comment\">// 关闭连接      </span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">close</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> JMSException </span>&#123;      </div><div class=\"line\">        System.out.println(<span class=\"string\">\"Producer:-&gt;Closing connection\"</span>);      </div><div class=\"line\">        <span class=\"keyword\">if</span> (producer != <span class=\"keyword\">null</span>)      </div><div class=\"line\">            producer.close();      </div><div class=\"line\">        <span class=\"keyword\">if</span> (session != <span class=\"keyword\">null</span>)      </div><div class=\"line\">            session.close();      </div><div class=\"line\">        <span class=\"keyword\">if</span> (connection != <span class=\"keyword\">null</span>)      </div><div class=\"line\">            connection.close();      </div><div class=\"line\">    &#125;      </div><div class=\"line\">&#125;        </div><div class=\"line\"></div><div class=\"line\">----------------------------------------------------------</div><div class=\"line\"><span class=\"keyword\">package</span> cn.itcast_03_mq.topic;</div><div class=\"line\"><span class=\"keyword\">import</span> java.util.Random;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">import</span> javax.jms.JMSException;      </div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ProducerTest</span> </span>&#123;      </div><div class=\"line\">     </div><div class=\"line\">    <span class=\"comment\">/**    </span></div><div class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> args    </span></div><div class=\"line\"><span class=\"comment\">     */</span>     </div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> JMSException, Exception </span>&#123;      </div><div class=\"line\">        ProducerTool producer = <span class=\"keyword\">new</span> ProducerTool(); </div><div class=\"line\">        Random random = <span class=\"keyword\">new</span> Random();</div><div class=\"line\">        <span class=\"keyword\">for</span>(<span class=\"keyword\">int</span> i=<span class=\"number\">0</span>;i&lt;<span class=\"number\">20</span>;i++)&#123;</div><div class=\"line\">        \t</div><div class=\"line\">        \tThread.sleep(random.nextInt(<span class=\"number\">10</span>)*<span class=\"number\">1000</span>);</div><div class=\"line\">        \t</div><div class=\"line\">        \tproducer.produceMessage(<span class=\"string\">\"Hello, world!--\"</span>+i);      </div><div class=\"line\">        \tproducer.close();</div><div class=\"line\">        &#125;</div><div class=\"line\">        </div><div class=\"line\">    &#125;      </div><div class=\"line\">&#125;      </div><div class=\"line\"></div><div class=\"line\">----------------------------------------------------------</div><div class=\"line\"><span class=\"keyword\">package</span> cn.itcast_03_mq.topic;</div><div class=\"line\"><span class=\"keyword\">import</span> javax.jms.Connection;      </div><div class=\"line\"><span class=\"keyword\">import</span> javax.jms.Destination;      </div><div class=\"line\"><span class=\"keyword\">import</span> javax.jms.ExceptionListener;</div><div class=\"line\"><span class=\"keyword\">import</span> javax.jms.JMSException;      </div><div class=\"line\"><span class=\"keyword\">import</span> javax.jms.MessageConsumer;      </div><div class=\"line\"><span class=\"keyword\">import</span> javax.jms.Session;      </div><div class=\"line\"><span class=\"keyword\">import</span> javax.jms.MessageListener;      </div><div class=\"line\"><span class=\"keyword\">import</span> javax.jms.Message;      </div><div class=\"line\"><span class=\"keyword\">import</span> javax.jms.TextMessage;      </div><div class=\"line\">     </div><div class=\"line\"><span class=\"keyword\">import</span> org.apache.activemq.ActiveMQConnection;      </div><div class=\"line\"><span class=\"keyword\">import</span> org.apache.activemq.ActiveMQConnectionFactory;      </div><div class=\"line\">     </div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ConsumerTool</span> <span class=\"keyword\">implements</span> <span class=\"title\">MessageListener</span>,<span class=\"title\">ExceptionListener</span> </span>&#123;      </div><div class=\"line\">    <span class=\"keyword\">private</span> String user = ActiveMQConnection.DEFAULT_USER;      </div><div class=\"line\">    <span class=\"keyword\">private</span> String password = ActiveMQConnection.DEFAULT_PASSWORD;      </div><div class=\"line\">    <span class=\"keyword\">private</span> String url =ActiveMQConnection.DEFAULT_BROKER_URL;      </div><div class=\"line\">    <span class=\"keyword\">private</span> String subject = <span class=\"string\">\"mytopic\"</span>;      </div><div class=\"line\">    <span class=\"keyword\">private</span> Destination destination = <span class=\"keyword\">null</span>;      </div><div class=\"line\">    <span class=\"keyword\">private</span> Connection connection = <span class=\"keyword\">null</span>;      </div><div class=\"line\">    <span class=\"keyword\">private</span> Session session = <span class=\"keyword\">null</span>;      </div><div class=\"line\">    <span class=\"keyword\">private</span> MessageConsumer consumer = <span class=\"keyword\">null</span>;  </div><div class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> Boolean isconnection=<span class=\"keyword\">false</span>;</div><div class=\"line\">    <span class=\"comment\">// 初始化      </span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">initialize</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> JMSException, Exception </span>&#123;      </div><div class=\"line\">        ActiveMQConnectionFactory connectionFactory = <span class=\"keyword\">new</span> ActiveMQConnectionFactory(      </div><div class=\"line\">                user, password, url);      </div><div class=\"line\">        connection = connectionFactory.createConnection();      </div><div class=\"line\">        session = connection.createSession(<span class=\"keyword\">false</span>, Session.AUTO_ACKNOWLEDGE);      </div><div class=\"line\">        destination = session.createTopic(subject);      </div><div class=\"line\">        consumer = session.createConsumer(destination);     </div><div class=\"line\">    &#125;      </div><div class=\"line\">     </div><div class=\"line\">    <span class=\"comment\">// 消费消息      </span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">consumeMessage</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> JMSException, Exception </span>&#123;      </div><div class=\"line\">        initialize();      </div><div class=\"line\">        connection.start();</div><div class=\"line\">        consumer.setMessageListener(<span class=\"keyword\">this</span>);    </div><div class=\"line\">        connection.setExceptionListener(<span class=\"keyword\">this</span>);</div><div class=\"line\">        isconnection=<span class=\"keyword\">true</span>;</div><div class=\"line\">        System.out.println(<span class=\"string\">\"Consumer:-&gt;Begin listening...\"</span>);      </div><div class=\"line\">        <span class=\"comment\">// 开始监听  </span></div><div class=\"line\">        <span class=\"comment\">// Message message = consumer.receive();      </span></div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"comment\">// 关闭连接      </span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">close</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> JMSException </span>&#123;      </div><div class=\"line\">        System.out.println(<span class=\"string\">\"Consumer:-&gt;Closing connection\"</span>);      </div><div class=\"line\">        <span class=\"keyword\">if</span> (consumer != <span class=\"keyword\">null</span>)      </div><div class=\"line\">            consumer.close();      </div><div class=\"line\">        <span class=\"keyword\">if</span> (session != <span class=\"keyword\">null</span>)      </div><div class=\"line\">            session.close();      </div><div class=\"line\">        <span class=\"keyword\">if</span> (connection != <span class=\"keyword\">null</span>)      </div><div class=\"line\">            connection.close();      </div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"comment\">// 消息处理函数      </span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onMessage</span><span class=\"params\">(Message message)</span> </span>&#123;      </div><div class=\"line\">        <span class=\"keyword\">try</span> &#123;      </div><div class=\"line\">            <span class=\"keyword\">if</span> (message <span class=\"keyword\">instanceof</span> TextMessage) &#123;      </div><div class=\"line\">                TextMessage txtMsg = (TextMessage) message;      </div><div class=\"line\">                String msg = txtMsg.getText();      </div><div class=\"line\">                System.out.println(<span class=\"string\">\"Consumer:-&gt;Received: \"</span> + msg);      </div><div class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;      </div><div class=\"line\">                System.out.println(<span class=\"string\">\"Consumer:-&gt;Received: \"</span> + message);      </div><div class=\"line\">            &#125;      </div><div class=\"line\">        &#125; <span class=\"keyword\">catch</span> (JMSException e) &#123;      </div><div class=\"line\">            <span class=\"comment\">// TODO Auto-generated catch block      </span></div><div class=\"line\">            e.printStackTrace();      </div><div class=\"line\">        &#125;      </div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onException</span><span class=\"params\">(JMSException arg0)</span> </span>&#123;</div><div class=\"line\">\t\tisconnection=<span class=\"keyword\">false</span>;</div><div class=\"line\">\t&#125;      </div><div class=\"line\">&#125;      </div><div class=\"line\">----------------------------------------------------------     </div><div class=\"line\"><span class=\"keyword\">package</span> cn.itcast_03_mq.topic;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">import</span> javax.jms.JMSException;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ConsumerTest</span> <span class=\"keyword\">implements</span> <span class=\"title\">Runnable</span> </span>&#123;</div><div class=\"line\">\t<span class=\"keyword\">static</span> Thread t1 = <span class=\"keyword\">null</span>;</div><div class=\"line\"></div><div class=\"line\">\t<span class=\"comment\">/**</span></div><div class=\"line\"><span class=\"comment\">\t * <span class=\"doctag\">@param</span> args</span></div><div class=\"line\"><span class=\"comment\">\t * <span class=\"doctag\">@throws</span> InterruptedException</span></div><div class=\"line\"><span class=\"comment\">\t * <span class=\"doctag\">@throws</span> InterruptedException</span></div><div class=\"line\"><span class=\"comment\">\t * <span class=\"doctag\">@throws</span> JMSException</span></div><div class=\"line\"><span class=\"comment\">\t * <span class=\"doctag\">@throws</span> InterruptedException</span></div><div class=\"line\"><span class=\"comment\">\t */</span></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> InterruptedException </span>&#123;</div><div class=\"line\"></div><div class=\"line\">\t\tt1 = <span class=\"keyword\">new</span> Thread(<span class=\"keyword\">new</span> ConsumerTest());</div><div class=\"line\">\t\tt1.setDaemon(<span class=\"keyword\">false</span>);</div><div class=\"line\">\t\tt1.start();</div><div class=\"line\">\t\t<span class=\"comment\">/**</span></div><div class=\"line\"><span class=\"comment\">\t\t * 如果发生异常，则重启consumer</span></div><div class=\"line\"><span class=\"comment\">\t\t */</span></div><div class=\"line\">\t\t<span class=\"comment\">/*while (true) &#123;</span></div><div class=\"line\"><span class=\"comment\">\t\t\tSystem.out.println(t1.isAlive());</span></div><div class=\"line\"><span class=\"comment\">\t\t\tif (!t1.isAlive()) &#123;</span></div><div class=\"line\"><span class=\"comment\">\t\t\t\tt1 = new Thread(new ConsumerTest());</span></div><div class=\"line\"><span class=\"comment\">\t\t\t\tt1.start();</span></div><div class=\"line\"><span class=\"comment\">\t\t\t\tSystem.out.println(\"重新启动\");</span></div><div class=\"line\"><span class=\"comment\">\t\t\t&#125;</span></div><div class=\"line\"><span class=\"comment\">\t\t\tThread.sleep(5000);</span></div><div class=\"line\"><span class=\"comment\">\t\t&#125;*/</span></div><div class=\"line\">\t\t<span class=\"comment\">// 延时500毫秒之后停止接受消息</span></div><div class=\"line\">\t\t<span class=\"comment\">// Thread.sleep(500);</span></div><div class=\"line\">\t\t<span class=\"comment\">// consumer.close();</span></div><div class=\"line\">\t&#125;</div><div class=\"line\"></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">\t\t<span class=\"keyword\">try</span> &#123;</div><div class=\"line\">\t\t\tConsumerTool consumer = <span class=\"keyword\">new</span> ConsumerTool();</div><div class=\"line\">\t\t\tconsumer.consumeMessage();</div><div class=\"line\">\t\t\t<span class=\"keyword\">while</span> (ConsumerTool.isconnection) &#123;\t</div><div class=\"line\">\t\t\t&#125;</div><div class=\"line\">\t\t&#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</div><div class=\"line\">\t\t&#125;</div><div class=\"line\"></div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>","site":{"data":{}},"excerpt":"","more":"<h1 id=\"java-JMS技术\"><a href=\"#java-JMS技术\" class=\"headerlink\" title=\"java JMS技术\"></a>java JMS技术</h1><h2 id=\"什么是JMS\"><a href=\"#什么是JMS\" class=\"headerlink\" title=\"什么是JMS\"></a>什么是JMS</h2><p>JMS即Java<font color=\"red\">消息服务（Java Message Service）</font>应用程序接口是一个Java平台中关于面向消息中间件（MOM）的API，用于在两个应用程序之间，或分布式系统中发送消息，进行异步通信。Java消息服务是一个与具体平台无关的API，绝大多数MOM提供商都对JMS提供支持。<br>JMS是一种与厂商无关的 API，用来访问消息收发系统消息。它类似于JDBC(Java Database Connectivity)：这里，JDBC 是可以用来访问许多不同关系数据库的 API，而 JMS 则提供同样与厂商无关的访问方法，以访问消息收发服务。许多厂商都支持 JMS，包括 IBM 的 MQSeries、BEA的 Weblogic JMS service和 Progress 的 SonicMQ，这只是几个例子。 JMS 使您能够通过消息收发服务（有时称为消息中介程序或路由器）从一个 JMS 客户机向另一个 JMS客户机发送消息。消息是 JMS 中的一种类型对象，由两部分组成：报头和消息主体。报头由路由信息以及有关该消息的元数据组成。消息主体则携带着应用程序的数据或有效负载。根据有效负载的类型来划分，可以将消息分为几种类型，它们分别携带：简单文本(TextMessage)、可序列化的对象 (ObjectMessage)、属性集合 (MapMessage)、字节流 (BytesMessage)、原始值流 (StreamMessage)，还有无有效负载的消息 (Message)。</p>\n<h2 id=\"JMS规范\"><a href=\"#JMS规范\" class=\"headerlink\" title=\"JMS规范\"></a>JMS规范</h2><h3 id=\"专业技术规范\"><a href=\"#专业技术规范\" class=\"headerlink\" title=\"专业技术规范\"></a>专业技术规范</h3><p>JMS（Java Messaging Service）是Java平台上有关面向消息中间件(MOM)的技术规范，它便于消息系统中的Java应用程序进行消息交换,并且通过提供标准的产生、发送、接收消息的接口简化企业应用的开发，翻译为Java消息服务。</p>\n<h3 id=\"体系架构\"><a href=\"#体系架构\" class=\"headerlink\" title=\"体系架构\"></a>体系架构</h3><p>JMS由以下元素组成。</p>\n<ul>\n<li>JMS提供者provider：连接面向消息中间件的，JMS接口的一个实现。提供者可以是Java平台的JMS实现，也可以是非Java平台的面向消息中间件的适配器。</li>\n<li>JMS客户：生产或消费基于消息的Java的应用程序或对象。</li>\n<li>JMS生产者：创建并发送消息的JMS客户。</li>\n<li>JMS消费者：接收消息的JMS客户。</li>\n<li>JMS消息：包括可以在JMS客户之间传递的数据的对象</li>\n<li>JMS队列：一个容纳那些被发送的等待阅读的消息的区域。与队列名字所暗示的意思不同，消息的接受顺序并不一定要与消息的发送顺序相同。一旦一个消息被阅读，该消息将被从队列中移走。</li>\n<li>JMS主题：一种支持发送消息给多个订阅者的机制。</li>\n</ul>\n<h3 id=\"Java消息服务应用程序结构支持两种模型\"><a href=\"#Java消息服务应用程序结构支持两种模型\" class=\"headerlink\" title=\"Java消息服务应用程序结构支持两种模型\"></a>Java消息服务应用程序结构支持两种模型</h3><h4 id=\"点对点或队列模型\"><a href=\"#点对点或队列模型\" class=\"headerlink\" title=\"点对点或队列模型\"></a>点对点或队列模型</h4><p>在点对点或队列模型下，一个生产者向一个特定的队列发布消息，一个消费者从该队列中读取消息。这里，生产者知道消费者的队列，并直接将消息发送到消费者的队列。<br><img src=\"http://ovasdkxqr.bkt.clouddn.com/image/blog/201712315592.png\" alt=\"201712315592\"><br>这种模式被概括为：  </p>\n<ul>\n<li>只有一个消费者将获得消息</li>\n<li>生产者不需要在接收者消费该消息期间处于运行状态，接收者也同样不需要在消息发送时处于运行状态。</li>\n<li>每一个成功处理的消息都由接收者签收</li>\n</ul>\n<h4 id=\"发布者-订阅者模型\"><a href=\"#发布者-订阅者模型\" class=\"headerlink\" title=\"发布者/订阅者模型\"></a>发布者/订阅者模型</h4><p>发布者/订阅者模型支持向一个特定的消息主题发布消息。0或多个订阅者可能对接收来自特定消息主题的消息感兴趣。在这种模型下，发布者和订阅者彼此不知道对方。这种模式好比是匿名公告板。<br><img src=\"http://ovasdkxqr.bkt.clouddn.com/image/blog/2017123155942.png\" alt=\"2017123155942\"><br>这种模式被概括为：</p>\n<ul>\n<li>多个消费者可以获得消息</li>\n<li>在发布者和订阅者之间存在时间依赖性。发布者需要建立一个订阅（subscription），以便客户能够订阅。订阅者必须保持持续的活动状态以接收消息，除非订阅者建立了持久的订阅。在那种情况下，在订阅者未连接时发布的消息将在订阅者重新连接时重新发布。</li>\n</ul>\n<h1 id=\"代码演示\"><a href=\"#代码演示\" class=\"headerlink\" title=\"代码演示\"></a>代码演示</h1><h2 id=\"下载ActiveMQ\"><a href=\"#下载ActiveMQ\" class=\"headerlink\" title=\"下载ActiveMQ\"></a>下载ActiveMQ</h2><p>去官方网站下载：<a href=\"http://activemq.apache.org/\" target=\"_blank\" rel=\"external\">http://activemq.apache.org/</a></p>\n<h2 id=\"运行ActiveMQ\"><a href=\"#运行ActiveMQ\" class=\"headerlink\" title=\"运行ActiveMQ\"></a>运行ActiveMQ</h2><p>解压缩apache-activemq-5.5.1-bin.zip，<br>修改配置文件activeMQ.xml，将0.0.0.0修改为localhost<br><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">transportConnectors</span>&gt;</span></div><div class=\"line\">   <span class=\"tag\">&lt;<span class=\"name\">transportConnector</span> <span class=\"attr\">name</span>=<span class=\"string\">\"openwire\"</span> <span class=\"attr\">uri</span>=<span class=\"string\">\"tcp://localhost:61616\"</span>/&gt;</span></div><div class=\"line\">   <span class=\"tag\">&lt;<span class=\"name\">transportConnector</span> <span class=\"attr\">name</span>=<span class=\"string\">\"ssl\"</span>     <span class=\"attr\">uri</span>=<span class=\"string\">\"ssl://localhost:61617\"</span>/&gt;</span></div><div class=\"line\">   <span class=\"tag\">&lt;<span class=\"name\">transportConnector</span> <span class=\"attr\">name</span>=<span class=\"string\">\"stomp\"</span>   <span class=\"attr\">uri</span>=<span class=\"string\">\"stomp://localhost:61613\"</span>/&gt;</span></div><div class=\"line\">   <span class=\"tag\">&lt;<span class=\"name\">transportConnector</span> <span class=\"attr\">uri</span>=<span class=\"string\">\"http://localhost:8081\"</span>/&gt;</span></div><div class=\"line\">   <span class=\"tag\">&lt;<span class=\"name\">transportConnector</span> <span class=\"attr\">uri</span>=<span class=\"string\">\"udp://localhost:61618\"</span>/&gt;</span></div></pre></td></tr></table></figure></p>\n<p>然后双击apache-activemq-5.5.1\\bin\\activemq.bat运行ActiveMQ程序。<br>启动ActiveMQ以后，登陆：<a href=\"http://localhost:8161/admin/，创建一个Queue，命名为FirstQueue。\" target=\"_blank\" rel=\"external\">http://localhost:8161/admin/，创建一个Queue，命名为FirstQueue。</a>  </p>\n<h1 id=\"运行代码\"><a href=\"#运行代码\" class=\"headerlink\" title=\"运行代码\"></a>运行代码</h1><h2 id=\"常用的JMS实现\"><a href=\"#常用的JMS实现\" class=\"headerlink\" title=\"常用的JMS实现\"></a>常用的JMS实现</h2><p>要使用Java消息服务，你必须要有一个JMS提供者，管理会话和队列。既有开源的提供者也有专有的提供者。<br>开源的提供者包括：</p>\n<ul>\n<li>Apache ActiveMQ</li>\n<li>JBoss 社区所研发的 HornetQ</li>\n<li>Joram</li>\n<li>Coridan的MantaRay</li>\n<li>The OpenJMS Group的OpenJMS</li>\n<li>专有的提供者包括：</li>\n<li>BEA的BEA WebLogic Server JMS</li>\n<li>TIBCO Software的EMS</li>\n<li>GigaSpaces Technologies的GigaSpaces</li>\n<li>Softwired 2006的iBus</li>\n<li>IONA Technologies的IONA JMS</li>\n<li>SeeBeyond的IQManager（2005年8月被Sun Microsystems并购）</li>\n<li>webMethods的JMS+ -</li>\n<li>my-channels的Nirvana</li>\n<li>Sonic Software的SonicMQ</li>\n<li>SwiftMQ的SwiftMQ</li>\n<li>IBM的WebSphere MQ</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div><div class=\"line\">87</div><div class=\"line\">88</div><div class=\"line\">89</div><div class=\"line\">90</div><div class=\"line\">91</div><div class=\"line\">92</div><div class=\"line\">93</div><div class=\"line\">94</div><div class=\"line\">95</div><div class=\"line\">96</div><div class=\"line\">97</div><div class=\"line\">98</div><div class=\"line\">99</div><div class=\"line\">100</div><div class=\"line\">101</div><div class=\"line\">102</div><div class=\"line\">103</div><div class=\"line\">104</div><div class=\"line\">105</div><div class=\"line\">106</div><div class=\"line\">107</div><div class=\"line\">108</div><div class=\"line\">109</div><div class=\"line\">110</div><div class=\"line\">111</div><div class=\"line\">112</div><div class=\"line\">113</div><div class=\"line\">114</div><div class=\"line\">115</div><div class=\"line\">116</div><div class=\"line\">117</div><div class=\"line\">118</div><div class=\"line\">119</div><div class=\"line\">120</div><div class=\"line\">121</div><div class=\"line\">122</div><div class=\"line\">123</div><div class=\"line\">124</div><div class=\"line\">125</div><div class=\"line\">126</div><div class=\"line\">127</div><div class=\"line\">128</div><div class=\"line\">129</div><div class=\"line\">130</div><div class=\"line\">131</div><div class=\"line\">132</div><div class=\"line\">133</div><div class=\"line\">134</div><div class=\"line\">135</div><div class=\"line\">136</div><div class=\"line\">137</div><div class=\"line\">138</div><div class=\"line\">139</div><div class=\"line\">140</div><div class=\"line\">141</div><div class=\"line\">142</div><div class=\"line\">143</div><div class=\"line\">144</div><div class=\"line\">145</div><div class=\"line\">146</div><div class=\"line\">147</div><div class=\"line\">148</div><div class=\"line\">149</div><div class=\"line\">150</div><div class=\"line\">151</div><div class=\"line\">152</div><div class=\"line\">153</div><div class=\"line\">154</div><div class=\"line\">155</div><div class=\"line\">156</div><div class=\"line\">157</div><div class=\"line\">158</div><div class=\"line\">159</div><div class=\"line\">160</div><div class=\"line\">161</div><div class=\"line\">162</div><div class=\"line\">163</div><div class=\"line\">164</div><div class=\"line\">165</div><div class=\"line\">166</div><div class=\"line\">167</div><div class=\"line\">168</div><div class=\"line\">169</div><div class=\"line\">170</div><div class=\"line\">171</div><div class=\"line\">172</div><div class=\"line\">173</div><div class=\"line\">174</div><div class=\"line\">175</div><div class=\"line\">176</div><div class=\"line\">177</div><div class=\"line\">178</div><div class=\"line\">179</div><div class=\"line\">180</div><div class=\"line\">181</div><div class=\"line\">182</div><div class=\"line\">183</div><div class=\"line\">184</div><div class=\"line\">185</div><div class=\"line\">186</div><div class=\"line\">187</div><div class=\"line\">188</div><div class=\"line\">189</div><div class=\"line\">190</div><div class=\"line\">191</div><div class=\"line\">192</div><div class=\"line\">193</div><div class=\"line\">194</div><div class=\"line\">195</div><div class=\"line\">196</div><div class=\"line\">197</div><div class=\"line\">198</div><div class=\"line\">199</div><div class=\"line\">200</div><div class=\"line\">201</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">package</span> cn.itcast_03_mq.topic;</div><div class=\"line\"><span class=\"keyword\">import</span> javax.jms.Connection;      </div><div class=\"line\"><span class=\"keyword\">import</span> javax.jms.DeliveryMode;      </div><div class=\"line\"><span class=\"keyword\">import</span> javax.jms.Destination;      </div><div class=\"line\"><span class=\"keyword\">import</span> javax.jms.JMSException;      </div><div class=\"line\"><span class=\"keyword\">import</span> javax.jms.MessageProducer;      </div><div class=\"line\"><span class=\"keyword\">import</span> javax.jms.Session;      </div><div class=\"line\"><span class=\"keyword\">import</span> javax.jms.TextMessage;      </div><div class=\"line\">     </div><div class=\"line\"><span class=\"keyword\">import</span> org.apache.activemq.ActiveMQConnection;      </div><div class=\"line\"><span class=\"keyword\">import</span> org.apache.activemq.ActiveMQConnectionFactory;      </div><div class=\"line\">     </div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ProducerTool</span> </span>&#123;        </div><div class=\"line\">    <span class=\"keyword\">private</span> String user = ActiveMQConnection.DEFAULT_USER;         </div><div class=\"line\">    <span class=\"keyword\">private</span> String password = ActiveMQConnection.DEFAULT_PASSWORD;       </div><div class=\"line\">    <span class=\"keyword\">private</span> String url = ActiveMQConnection.DEFAULT_BROKER_URL;       </div><div class=\"line\">    <span class=\"keyword\">private</span> String subject = <span class=\"string\">\"mytopic\"</span>;      </div><div class=\"line\">    <span class=\"keyword\">private</span> Destination destination = <span class=\"keyword\">null</span>;      </div><div class=\"line\">    <span class=\"keyword\">private</span> Connection connection = <span class=\"keyword\">null</span>;      </div><div class=\"line\">    <span class=\"keyword\">private</span> Session session = <span class=\"keyword\">null</span>;      </div><div class=\"line\">    <span class=\"keyword\">private</span> MessageProducer producer = <span class=\"keyword\">null</span>;</div><div class=\"line\">    <span class=\"comment\">// 初始化      </span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">initialize</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> JMSException, Exception </span>&#123;      </div><div class=\"line\">        ActiveMQConnectionFactory connectionFactory = <span class=\"keyword\">new</span> ActiveMQConnectionFactory(      </div><div class=\"line\">                user, password, url);      </div><div class=\"line\">        connection = connectionFactory.createConnection();      </div><div class=\"line\">        session = connection.createSession(<span class=\"keyword\">false</span>, Session.AUTO_ACKNOWLEDGE);      </div><div class=\"line\">        destination = session.createTopic(subject);      </div><div class=\"line\">        producer = session.createProducer(destination);      </div><div class=\"line\">        producer.setDeliveryMode(DeliveryMode.NON_PERSISTENT);      </div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"comment\">// 发送消息      </span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">produceMessage</span><span class=\"params\">(String message)</span> <span class=\"keyword\">throws</span> JMSException, Exception </span>&#123;      </div><div class=\"line\">        initialize();      </div><div class=\"line\">        TextMessage msg = session.createTextMessage(message);      </div><div class=\"line\">        connection.start();      </div><div class=\"line\">        System.out.println(<span class=\"string\">\"Producer:-&gt;Sending message: \"</span> + message);      </div><div class=\"line\">        producer.send(msg);      </div><div class=\"line\">        System.out.println(<span class=\"string\">\"Producer:-&gt;Message sent complete!\"</span>);      </div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"comment\">// 关闭连接      </span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">close</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> JMSException </span>&#123;      </div><div class=\"line\">        System.out.println(<span class=\"string\">\"Producer:-&gt;Closing connection\"</span>);      </div><div class=\"line\">        <span class=\"keyword\">if</span> (producer != <span class=\"keyword\">null</span>)      </div><div class=\"line\">            producer.close();      </div><div class=\"line\">        <span class=\"keyword\">if</span> (session != <span class=\"keyword\">null</span>)      </div><div class=\"line\">            session.close();      </div><div class=\"line\">        <span class=\"keyword\">if</span> (connection != <span class=\"keyword\">null</span>)      </div><div class=\"line\">            connection.close();      </div><div class=\"line\">    &#125;      </div><div class=\"line\">&#125;        </div><div class=\"line\"></div><div class=\"line\">----------------------------------------------------------</div><div class=\"line\"><span class=\"keyword\">package</span> cn.itcast_03_mq.topic;</div><div class=\"line\"><span class=\"keyword\">import</span> java.util.Random;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">import</span> javax.jms.JMSException;      </div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ProducerTest</span> </span>&#123;      </div><div class=\"line\">     </div><div class=\"line\">    <span class=\"comment\">/**    </span></div><div class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> args    </span></div><div class=\"line\"><span class=\"comment\">     */</span>     </div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> JMSException, Exception </span>&#123;      </div><div class=\"line\">        ProducerTool producer = <span class=\"keyword\">new</span> ProducerTool(); </div><div class=\"line\">        Random random = <span class=\"keyword\">new</span> Random();</div><div class=\"line\">        <span class=\"keyword\">for</span>(<span class=\"keyword\">int</span> i=<span class=\"number\">0</span>;i&lt;<span class=\"number\">20</span>;i++)&#123;</div><div class=\"line\">        \t</div><div class=\"line\">        \tThread.sleep(random.nextInt(<span class=\"number\">10</span>)*<span class=\"number\">1000</span>);</div><div class=\"line\">        \t</div><div class=\"line\">        \tproducer.produceMessage(<span class=\"string\">\"Hello, world!--\"</span>+i);      </div><div class=\"line\">        \tproducer.close();</div><div class=\"line\">        &#125;</div><div class=\"line\">        </div><div class=\"line\">    &#125;      </div><div class=\"line\">&#125;      </div><div class=\"line\"></div><div class=\"line\">----------------------------------------------------------</div><div class=\"line\"><span class=\"keyword\">package</span> cn.itcast_03_mq.topic;</div><div class=\"line\"><span class=\"keyword\">import</span> javax.jms.Connection;      </div><div class=\"line\"><span class=\"keyword\">import</span> javax.jms.Destination;      </div><div class=\"line\"><span class=\"keyword\">import</span> javax.jms.ExceptionListener;</div><div class=\"line\"><span class=\"keyword\">import</span> javax.jms.JMSException;      </div><div class=\"line\"><span class=\"keyword\">import</span> javax.jms.MessageConsumer;      </div><div class=\"line\"><span class=\"keyword\">import</span> javax.jms.Session;      </div><div class=\"line\"><span class=\"keyword\">import</span> javax.jms.MessageListener;      </div><div class=\"line\"><span class=\"keyword\">import</span> javax.jms.Message;      </div><div class=\"line\"><span class=\"keyword\">import</span> javax.jms.TextMessage;      </div><div class=\"line\">     </div><div class=\"line\"><span class=\"keyword\">import</span> org.apache.activemq.ActiveMQConnection;      </div><div class=\"line\"><span class=\"keyword\">import</span> org.apache.activemq.ActiveMQConnectionFactory;      </div><div class=\"line\">     </div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ConsumerTool</span> <span class=\"keyword\">implements</span> <span class=\"title\">MessageListener</span>,<span class=\"title\">ExceptionListener</span> </span>&#123;      </div><div class=\"line\">    <span class=\"keyword\">private</span> String user = ActiveMQConnection.DEFAULT_USER;      </div><div class=\"line\">    <span class=\"keyword\">private</span> String password = ActiveMQConnection.DEFAULT_PASSWORD;      </div><div class=\"line\">    <span class=\"keyword\">private</span> String url =ActiveMQConnection.DEFAULT_BROKER_URL;      </div><div class=\"line\">    <span class=\"keyword\">private</span> String subject = <span class=\"string\">\"mytopic\"</span>;      </div><div class=\"line\">    <span class=\"keyword\">private</span> Destination destination = <span class=\"keyword\">null</span>;      </div><div class=\"line\">    <span class=\"keyword\">private</span> Connection connection = <span class=\"keyword\">null</span>;      </div><div class=\"line\">    <span class=\"keyword\">private</span> Session session = <span class=\"keyword\">null</span>;      </div><div class=\"line\">    <span class=\"keyword\">private</span> MessageConsumer consumer = <span class=\"keyword\">null</span>;  </div><div class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> Boolean isconnection=<span class=\"keyword\">false</span>;</div><div class=\"line\">    <span class=\"comment\">// 初始化      </span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">initialize</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> JMSException, Exception </span>&#123;      </div><div class=\"line\">        ActiveMQConnectionFactory connectionFactory = <span class=\"keyword\">new</span> ActiveMQConnectionFactory(      </div><div class=\"line\">                user, password, url);      </div><div class=\"line\">        connection = connectionFactory.createConnection();      </div><div class=\"line\">        session = connection.createSession(<span class=\"keyword\">false</span>, Session.AUTO_ACKNOWLEDGE);      </div><div class=\"line\">        destination = session.createTopic(subject);      </div><div class=\"line\">        consumer = session.createConsumer(destination);     </div><div class=\"line\">    &#125;      </div><div class=\"line\">     </div><div class=\"line\">    <span class=\"comment\">// 消费消息      </span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">consumeMessage</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> JMSException, Exception </span>&#123;      </div><div class=\"line\">        initialize();      </div><div class=\"line\">        connection.start();</div><div class=\"line\">        consumer.setMessageListener(<span class=\"keyword\">this</span>);    </div><div class=\"line\">        connection.setExceptionListener(<span class=\"keyword\">this</span>);</div><div class=\"line\">        isconnection=<span class=\"keyword\">true</span>;</div><div class=\"line\">        System.out.println(<span class=\"string\">\"Consumer:-&gt;Begin listening...\"</span>);      </div><div class=\"line\">        <span class=\"comment\">// 开始监听  </span></div><div class=\"line\">        <span class=\"comment\">// Message message = consumer.receive();      </span></div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"comment\">// 关闭连接      </span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">close</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> JMSException </span>&#123;      </div><div class=\"line\">        System.out.println(<span class=\"string\">\"Consumer:-&gt;Closing connection\"</span>);      </div><div class=\"line\">        <span class=\"keyword\">if</span> (consumer != <span class=\"keyword\">null</span>)      </div><div class=\"line\">            consumer.close();      </div><div class=\"line\">        <span class=\"keyword\">if</span> (session != <span class=\"keyword\">null</span>)      </div><div class=\"line\">            session.close();      </div><div class=\"line\">        <span class=\"keyword\">if</span> (connection != <span class=\"keyword\">null</span>)      </div><div class=\"line\">            connection.close();      </div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"comment\">// 消息处理函数      </span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onMessage</span><span class=\"params\">(Message message)</span> </span>&#123;      </div><div class=\"line\">        <span class=\"keyword\">try</span> &#123;      </div><div class=\"line\">            <span class=\"keyword\">if</span> (message <span class=\"keyword\">instanceof</span> TextMessage) &#123;      </div><div class=\"line\">                TextMessage txtMsg = (TextMessage) message;      </div><div class=\"line\">                String msg = txtMsg.getText();      </div><div class=\"line\">                System.out.println(<span class=\"string\">\"Consumer:-&gt;Received: \"</span> + msg);      </div><div class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;      </div><div class=\"line\">                System.out.println(<span class=\"string\">\"Consumer:-&gt;Received: \"</span> + message);      </div><div class=\"line\">            &#125;      </div><div class=\"line\">        &#125; <span class=\"keyword\">catch</span> (JMSException e) &#123;      </div><div class=\"line\">            <span class=\"comment\">// TODO Auto-generated catch block      </span></div><div class=\"line\">            e.printStackTrace();      </div><div class=\"line\">        &#125;      </div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onException</span><span class=\"params\">(JMSException arg0)</span> </span>&#123;</div><div class=\"line\">\t\tisconnection=<span class=\"keyword\">false</span>;</div><div class=\"line\">\t&#125;      </div><div class=\"line\">&#125;      </div><div class=\"line\">----------------------------------------------------------     </div><div class=\"line\"><span class=\"keyword\">package</span> cn.itcast_03_mq.topic;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">import</span> javax.jms.JMSException;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ConsumerTest</span> <span class=\"keyword\">implements</span> <span class=\"title\">Runnable</span> </span>&#123;</div><div class=\"line\">\t<span class=\"keyword\">static</span> Thread t1 = <span class=\"keyword\">null</span>;</div><div class=\"line\"></div><div class=\"line\">\t<span class=\"comment\">/**</span></div><div class=\"line\"><span class=\"comment\">\t * <span class=\"doctag\">@param</span> args</span></div><div class=\"line\"><span class=\"comment\">\t * <span class=\"doctag\">@throws</span> InterruptedException</span></div><div class=\"line\"><span class=\"comment\">\t * <span class=\"doctag\">@throws</span> InterruptedException</span></div><div class=\"line\"><span class=\"comment\">\t * <span class=\"doctag\">@throws</span> JMSException</span></div><div class=\"line\"><span class=\"comment\">\t * <span class=\"doctag\">@throws</span> InterruptedException</span></div><div class=\"line\"><span class=\"comment\">\t */</span></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> InterruptedException </span>&#123;</div><div class=\"line\"></div><div class=\"line\">\t\tt1 = <span class=\"keyword\">new</span> Thread(<span class=\"keyword\">new</span> ConsumerTest());</div><div class=\"line\">\t\tt1.setDaemon(<span class=\"keyword\">false</span>);</div><div class=\"line\">\t\tt1.start();</div><div class=\"line\">\t\t<span class=\"comment\">/**</span></div><div class=\"line\"><span class=\"comment\">\t\t * 如果发生异常，则重启consumer</span></div><div class=\"line\"><span class=\"comment\">\t\t */</span></div><div class=\"line\">\t\t<span class=\"comment\">/*while (true) &#123;</span></div><div class=\"line\"><span class=\"comment\">\t\t\tSystem.out.println(t1.isAlive());</span></div><div class=\"line\"><span class=\"comment\">\t\t\tif (!t1.isAlive()) &#123;</span></div><div class=\"line\"><span class=\"comment\">\t\t\t\tt1 = new Thread(new ConsumerTest());</span></div><div class=\"line\"><span class=\"comment\">\t\t\t\tt1.start();</span></div><div class=\"line\"><span class=\"comment\">\t\t\t\tSystem.out.println(\"重新启动\");</span></div><div class=\"line\"><span class=\"comment\">\t\t\t&#125;</span></div><div class=\"line\"><span class=\"comment\">\t\t\tThread.sleep(5000);</span></div><div class=\"line\"><span class=\"comment\">\t\t&#125;*/</span></div><div class=\"line\">\t\t<span class=\"comment\">// 延时500毫秒之后停止接受消息</span></div><div class=\"line\">\t\t<span class=\"comment\">// Thread.sleep(500);</span></div><div class=\"line\">\t\t<span class=\"comment\">// consumer.close();</span></div><div class=\"line\">\t&#125;</div><div class=\"line\"></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">\t\t<span class=\"keyword\">try</span> &#123;</div><div class=\"line\">\t\t\tConsumerTool consumer = <span class=\"keyword\">new</span> ConsumerTool();</div><div class=\"line\">\t\t\tconsumer.consumeMessage();</div><div class=\"line\">\t\t\t<span class=\"keyword\">while</span> (ConsumerTool.isconnection) &#123;\t</div><div class=\"line\">\t\t\t&#125;</div><div class=\"line\">\t\t&#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</div><div class=\"line\">\t\t&#125;</div><div class=\"line\"></div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>"},{"title":"大数据0403-java反射","toc":true,"date":"2017-12-03T08:34:00.000Z","scaffolds":null,"_content":"\n通过反射的方式可以获取class对象中的属性、方法、构造函数等:\n<!-- more -->\n```java\npackage cn.itcast_04_reflect;\n\nimport java.lang.reflect.Constructor;\nimport java.lang.reflect.Field;\nimport java.lang.reflect.Method;\nimport java.util.ArrayList;\nimport java.util.List;\n\nimport org.junit.Before;\nimport org.junit.Test;\n\npublic class MyReflect {\n\tpublic String className = null;\n\t@SuppressWarnings(\"rawtypes\")\n\tpublic Class personClass = null;\n\t/**\n\t * 反射Person类\n\t * @throws Exception \n\t */\n\t@Before\n\tpublic void init() throws Exception {\n\t\tclassName = \"cn.itcast_04_reflect.Person\";\n\t\tpersonClass = Class.forName(className);\n\t}\n\t/**\n\t *获取某个class文件对象\n\t */\n\t@Test\n\tpublic void getClassName() throws Exception {\n\t\tSystem.out.println(personClass);\n\t}\n\t/**\n\t *获取某个class文件对象的另一种方式\n\t */\n\t@Test\n\tpublic void getClassName2() throws Exception {\n\t\tSystem.out.println(Person.class);\n\t}\n\t/**\n\t *创建一个class文件表示的实例对象，底层会调用空参数的构造方法\n\t */\n\t@Test\n\tpublic void getNewInstance() throws Exception {\n\t\tSystem.out.println(personClass.newInstance());\n\t}\n\t/**\n\t *获取非私有的构造函数\n\t */\n\t@SuppressWarnings({ \"rawtypes\", \"unchecked\" })\n\t@Test\n\tpublic void getPublicConstructor() throws Exception {\n\t\tConstructor  constructor  = personClass.getConstructor(Long.class,String.class);\n\t\tPerson person = (Person)constructor.newInstance(100L,\"zhangsan\");\n\t\tSystem.out.println(person.getId());\n\t\tSystem.out.println(person.getName());\n\t}\n\t/**\n\t *获得私有的构造函数\n\t */\n\t@SuppressWarnings({ \"rawtypes\", \"unchecked\" })\n\t@Test\n\tpublic void getPrivateConstructor() throws Exception {\n\t\tConstructor con = personClass.getDeclaredConstructor(String.class);\n\t\tcon.setAccessible(true);//强制取消Java的权限检测\n\t\tPerson person2 = (Person)con.newInstance(\"zhangsan\");\n\t\tSystem.out.println(\"**\"+person2.getName());\n\t}\n\t/**\n\t *访问非私有的成员变量\n\t */\n\t@SuppressWarnings({ \"rawtypes\", \"unchecked\" })\n\t@Test\n\tpublic void getNotPrivateField() throws Exception {\n\t\tConstructor  constructor  = personClass.getConstructor(Long.class,String.class);\n\t\tObject obj = constructor.newInstance(100L,\"zhangsan\");\n\t\t\n\t\tField field = personClass.getField(\"name\");\n\t\tfield.set(obj, \"lisi\");\n\t\tSystem.out.println(field.get(obj));\n\t}\n\t/**\n\t *访问私有的成员变量\n\t */\n\t@SuppressWarnings({ \"rawtypes\", \"unchecked\" })\n\t@Test\n\tpublic void getPrivateField() throws Exception {\n\t\tConstructor  constructor  = personClass.getConstructor(Long.class);\n\t\tObject obj = constructor.newInstance(100L);\n\t\t\n\t\tField field2 = personClass.getDeclaredField(\"id\");\n\t\tfield2.setAccessible(true);//强制取消Java的权限检测\n\t\tfield2.set(obj,10000L);\n\t\tSystem.out.println(field2.get(obj));\n\t}\n\t/**\n\t *获取非私有的成员函数\n\t */\n\t@SuppressWarnings({ \"unchecked\" })\n\t@Test\n\tpublic void getNotPrivateMethod() throws Exception {\n\t\tSystem.out.println(personClass.getMethod(\"toString\"));\n\t\t\n\t\tObject obj = personClass.newInstance();//获取空参的构造函数\n\t\tMethod toStringMethod = personClass.getMethod(\"toString\");\n\t\tObject object = toStringMethod.invoke(obj);\n\t\tSystem.out.println(object);\n\t}\n\t/**\n\t *获取私有的成员函数\n\t */\n\t@SuppressWarnings(\"unchecked\")\n\t@Test\n\tpublic void getPrivateMethod() throws Exception {\n\t\tObject obj = personClass.newInstance();//获取空参的构造函数\n\t\tMethod method = personClass.getDeclaredMethod(\"getSomeThing\");\n\t\tmethod.setAccessible(true);\n\t\tObject value = method.invoke(obj);\n\t\tSystem.out.println(value);\n\n\t}\n\t/**\n\t *\n\t */\n\t@Test\n\tpublic void otherMethod() throws Exception {\n\t\t//当前加载这个class文件的那个类加载器对象\n\t\tSystem.out.println(personClass.getClassLoader());\n\t\t//获取某个类实现的所有接口\n\t\tClass[] interfaces = personClass.getInterfaces();\n\t\tfor (Class class1 : interfaces) {\n\t\t\tSystem.out.println(class1);\n\t\t}\n\t\t//反射当前这个类的直接父类\n\t\tSystem.out.println(personClass.getGenericSuperclass());\n\t\t/**\n\t\t * getResourceAsStream这个方法可以获取到一个输入流，这个输入流会关联到name所表示的那个文件上。\n\t\t */\n\t\t//path 不以’/'开头时默认是从此类所在的包下取资源，以’/'开头则是从ClassPath根下获取。其只是通过path构造一个绝对路径，最终还是由ClassLoader获取资源。\n\t\tSystem.out.println(personClass.getResourceAsStream(\"/log4j.properties\"));\n\t\tSystem.out.println(personClass.getResourceAsStream(\"log4j.properties\"));\n\t\t\n\t\t//判断当前的Class对象表示是否是数组\n\t\tSystem.out.println(personClass.isArray());\n\t\tSystem.out.println(new String[3].getClass().isArray());\n\t\t\n\t\t//判断当前的Class对象表示是否是枚举类\n\t\tSystem.out.println(personClass.isEnum());\n\t\tSystem.out.println(Class.forName(\"cn.itcast_04_reflect.City\").isEnum());\n\t\t\n\t\t//判断当前的Class对象表示是否是接口\n\t\tSystem.out.println(personClass.isInterface());\n\t\tSystem.out.println(Class.forName(\"cn.itcast_04_reflect.TestInterface\").isInterface());\n\t\t\n\t\t\n\t}\n\n}\n\n\n```","source":"_posts/大数据/大数据0403-java反射.md","raw":"---\ntitle: 大数据0403-java反射\ncategories: 学习\ntags:\n  - 大数据\n  - java\n  - 反射\ntoc: true\ndate: 2017-12-03 16:34:00\nscaffolds:\n---\n\n通过反射的方式可以获取class对象中的属性、方法、构造函数等:\n<!-- more -->\n```java\npackage cn.itcast_04_reflect;\n\nimport java.lang.reflect.Constructor;\nimport java.lang.reflect.Field;\nimport java.lang.reflect.Method;\nimport java.util.ArrayList;\nimport java.util.List;\n\nimport org.junit.Before;\nimport org.junit.Test;\n\npublic class MyReflect {\n\tpublic String className = null;\n\t@SuppressWarnings(\"rawtypes\")\n\tpublic Class personClass = null;\n\t/**\n\t * 反射Person类\n\t * @throws Exception \n\t */\n\t@Before\n\tpublic void init() throws Exception {\n\t\tclassName = \"cn.itcast_04_reflect.Person\";\n\t\tpersonClass = Class.forName(className);\n\t}\n\t/**\n\t *获取某个class文件对象\n\t */\n\t@Test\n\tpublic void getClassName() throws Exception {\n\t\tSystem.out.println(personClass);\n\t}\n\t/**\n\t *获取某个class文件对象的另一种方式\n\t */\n\t@Test\n\tpublic void getClassName2() throws Exception {\n\t\tSystem.out.println(Person.class);\n\t}\n\t/**\n\t *创建一个class文件表示的实例对象，底层会调用空参数的构造方法\n\t */\n\t@Test\n\tpublic void getNewInstance() throws Exception {\n\t\tSystem.out.println(personClass.newInstance());\n\t}\n\t/**\n\t *获取非私有的构造函数\n\t */\n\t@SuppressWarnings({ \"rawtypes\", \"unchecked\" })\n\t@Test\n\tpublic void getPublicConstructor() throws Exception {\n\t\tConstructor  constructor  = personClass.getConstructor(Long.class,String.class);\n\t\tPerson person = (Person)constructor.newInstance(100L,\"zhangsan\");\n\t\tSystem.out.println(person.getId());\n\t\tSystem.out.println(person.getName());\n\t}\n\t/**\n\t *获得私有的构造函数\n\t */\n\t@SuppressWarnings({ \"rawtypes\", \"unchecked\" })\n\t@Test\n\tpublic void getPrivateConstructor() throws Exception {\n\t\tConstructor con = personClass.getDeclaredConstructor(String.class);\n\t\tcon.setAccessible(true);//强制取消Java的权限检测\n\t\tPerson person2 = (Person)con.newInstance(\"zhangsan\");\n\t\tSystem.out.println(\"**\"+person2.getName());\n\t}\n\t/**\n\t *访问非私有的成员变量\n\t */\n\t@SuppressWarnings({ \"rawtypes\", \"unchecked\" })\n\t@Test\n\tpublic void getNotPrivateField() throws Exception {\n\t\tConstructor  constructor  = personClass.getConstructor(Long.class,String.class);\n\t\tObject obj = constructor.newInstance(100L,\"zhangsan\");\n\t\t\n\t\tField field = personClass.getField(\"name\");\n\t\tfield.set(obj, \"lisi\");\n\t\tSystem.out.println(field.get(obj));\n\t}\n\t/**\n\t *访问私有的成员变量\n\t */\n\t@SuppressWarnings({ \"rawtypes\", \"unchecked\" })\n\t@Test\n\tpublic void getPrivateField() throws Exception {\n\t\tConstructor  constructor  = personClass.getConstructor(Long.class);\n\t\tObject obj = constructor.newInstance(100L);\n\t\t\n\t\tField field2 = personClass.getDeclaredField(\"id\");\n\t\tfield2.setAccessible(true);//强制取消Java的权限检测\n\t\tfield2.set(obj,10000L);\n\t\tSystem.out.println(field2.get(obj));\n\t}\n\t/**\n\t *获取非私有的成员函数\n\t */\n\t@SuppressWarnings({ \"unchecked\" })\n\t@Test\n\tpublic void getNotPrivateMethod() throws Exception {\n\t\tSystem.out.println(personClass.getMethod(\"toString\"));\n\t\t\n\t\tObject obj = personClass.newInstance();//获取空参的构造函数\n\t\tMethod toStringMethod = personClass.getMethod(\"toString\");\n\t\tObject object = toStringMethod.invoke(obj);\n\t\tSystem.out.println(object);\n\t}\n\t/**\n\t *获取私有的成员函数\n\t */\n\t@SuppressWarnings(\"unchecked\")\n\t@Test\n\tpublic void getPrivateMethod() throws Exception {\n\t\tObject obj = personClass.newInstance();//获取空参的构造函数\n\t\tMethod method = personClass.getDeclaredMethod(\"getSomeThing\");\n\t\tmethod.setAccessible(true);\n\t\tObject value = method.invoke(obj);\n\t\tSystem.out.println(value);\n\n\t}\n\t/**\n\t *\n\t */\n\t@Test\n\tpublic void otherMethod() throws Exception {\n\t\t//当前加载这个class文件的那个类加载器对象\n\t\tSystem.out.println(personClass.getClassLoader());\n\t\t//获取某个类实现的所有接口\n\t\tClass[] interfaces = personClass.getInterfaces();\n\t\tfor (Class class1 : interfaces) {\n\t\t\tSystem.out.println(class1);\n\t\t}\n\t\t//反射当前这个类的直接父类\n\t\tSystem.out.println(personClass.getGenericSuperclass());\n\t\t/**\n\t\t * getResourceAsStream这个方法可以获取到一个输入流，这个输入流会关联到name所表示的那个文件上。\n\t\t */\n\t\t//path 不以’/'开头时默认是从此类所在的包下取资源，以’/'开头则是从ClassPath根下获取。其只是通过path构造一个绝对路径，最终还是由ClassLoader获取资源。\n\t\tSystem.out.println(personClass.getResourceAsStream(\"/log4j.properties\"));\n\t\tSystem.out.println(personClass.getResourceAsStream(\"log4j.properties\"));\n\t\t\n\t\t//判断当前的Class对象表示是否是数组\n\t\tSystem.out.println(personClass.isArray());\n\t\tSystem.out.println(new String[3].getClass().isArray());\n\t\t\n\t\t//判断当前的Class对象表示是否是枚举类\n\t\tSystem.out.println(personClass.isEnum());\n\t\tSystem.out.println(Class.forName(\"cn.itcast_04_reflect.City\").isEnum());\n\t\t\n\t\t//判断当前的Class对象表示是否是接口\n\t\tSystem.out.println(personClass.isInterface());\n\t\tSystem.out.println(Class.forName(\"cn.itcast_04_reflect.TestInterface\").isInterface());\n\t\t\n\t\t\n\t}\n\n}\n\n\n```","slug":"大数据/大数据0403-java反射","published":1,"updated":"2017-12-03T10:30:25.769Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjcsq4ljj003qx4vfq0rzn1tw","content":"<p>通过反射的方式可以获取class对象中的属性、方法、构造函数等:<br><a id=\"more\"></a><br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div><div class=\"line\">87</div><div class=\"line\">88</div><div class=\"line\">89</div><div class=\"line\">90</div><div class=\"line\">91</div><div class=\"line\">92</div><div class=\"line\">93</div><div class=\"line\">94</div><div class=\"line\">95</div><div class=\"line\">96</div><div class=\"line\">97</div><div class=\"line\">98</div><div class=\"line\">99</div><div class=\"line\">100</div><div class=\"line\">101</div><div class=\"line\">102</div><div class=\"line\">103</div><div class=\"line\">104</div><div class=\"line\">105</div><div class=\"line\">106</div><div class=\"line\">107</div><div class=\"line\">108</div><div class=\"line\">109</div><div class=\"line\">110</div><div class=\"line\">111</div><div class=\"line\">112</div><div class=\"line\">113</div><div class=\"line\">114</div><div class=\"line\">115</div><div class=\"line\">116</div><div class=\"line\">117</div><div class=\"line\">118</div><div class=\"line\">119</div><div class=\"line\">120</div><div class=\"line\">121</div><div class=\"line\">122</div><div class=\"line\">123</div><div class=\"line\">124</div><div class=\"line\">125</div><div class=\"line\">126</div><div class=\"line\">127</div><div class=\"line\">128</div><div class=\"line\">129</div><div class=\"line\">130</div><div class=\"line\">131</div><div class=\"line\">132</div><div class=\"line\">133</div><div class=\"line\">134</div><div class=\"line\">135</div><div class=\"line\">136</div><div class=\"line\">137</div><div class=\"line\">138</div><div class=\"line\">139</div><div class=\"line\">140</div><div class=\"line\">141</div><div class=\"line\">142</div><div class=\"line\">143</div><div class=\"line\">144</div><div class=\"line\">145</div><div class=\"line\">146</div><div class=\"line\">147</div><div class=\"line\">148</div><div class=\"line\">149</div><div class=\"line\">150</div><div class=\"line\">151</div><div class=\"line\">152</div><div class=\"line\">153</div><div class=\"line\">154</div><div class=\"line\">155</div><div class=\"line\">156</div><div class=\"line\">157</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">package</span> cn.itcast_04_reflect;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">import</span> java.lang.reflect.Constructor;</div><div class=\"line\"><span class=\"keyword\">import</span> java.lang.reflect.Field;</div><div class=\"line\"><span class=\"keyword\">import</span> java.lang.reflect.Method;</div><div class=\"line\"><span class=\"keyword\">import</span> java.util.ArrayList;</div><div class=\"line\"><span class=\"keyword\">import</span> java.util.List;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">import</span> org.junit.Before;</div><div class=\"line\"><span class=\"keyword\">import</span> org.junit.Test;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MyReflect</span> </span>&#123;</div><div class=\"line\">\t<span class=\"keyword\">public</span> String className = <span class=\"keyword\">null</span>;</div><div class=\"line\">\t<span class=\"meta\">@SuppressWarnings</span>(<span class=\"string\">\"rawtypes\"</span>)</div><div class=\"line\">\t<span class=\"keyword\">public</span> Class personClass = <span class=\"keyword\">null</span>;</div><div class=\"line\">\t<span class=\"comment\">/**</span></div><div class=\"line\"><span class=\"comment\">\t * 反射Person类</span></div><div class=\"line\"><span class=\"comment\">\t * <span class=\"doctag\">@throws</span> Exception </span></div><div class=\"line\"><span class=\"comment\">\t */</span></div><div class=\"line\">\t<span class=\"meta\">@Before</span></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">init</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</div><div class=\"line\">\t\tclassName = <span class=\"string\">\"cn.itcast_04_reflect.Person\"</span>;</div><div class=\"line\">\t\tpersonClass = Class.forName(className);</div><div class=\"line\">\t&#125;</div><div class=\"line\">\t<span class=\"comment\">/**</span></div><div class=\"line\"><span class=\"comment\">\t *获取某个class文件对象</span></div><div class=\"line\"><span class=\"comment\">\t */</span></div><div class=\"line\">\t<span class=\"meta\">@Test</span></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">getClassName</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</div><div class=\"line\">\t\tSystem.out.println(personClass);</div><div class=\"line\">\t&#125;</div><div class=\"line\">\t<span class=\"comment\">/**</span></div><div class=\"line\"><span class=\"comment\">\t *获取某个class文件对象的另一种方式</span></div><div class=\"line\"><span class=\"comment\">\t */</span></div><div class=\"line\">\t<span class=\"meta\">@Test</span></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">getClassName2</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</div><div class=\"line\">\t\tSystem.out.println(Person.class);</div><div class=\"line\">\t&#125;</div><div class=\"line\">\t<span class=\"comment\">/**</span></div><div class=\"line\"><span class=\"comment\">\t *创建一个class文件表示的实例对象，底层会调用空参数的构造方法</span></div><div class=\"line\"><span class=\"comment\">\t */</span></div><div class=\"line\">\t<span class=\"meta\">@Test</span></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">getNewInstance</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</div><div class=\"line\">\t\tSystem.out.println(personClass.newInstance());</div><div class=\"line\">\t&#125;</div><div class=\"line\">\t<span class=\"comment\">/**</span></div><div class=\"line\"><span class=\"comment\">\t *获取非私有的构造函数</span></div><div class=\"line\"><span class=\"comment\">\t */</span></div><div class=\"line\">\t<span class=\"meta\">@SuppressWarnings</span>(&#123; <span class=\"string\">\"rawtypes\"</span>, <span class=\"string\">\"unchecked\"</span> &#125;)</div><div class=\"line\">\t<span class=\"meta\">@Test</span></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">getPublicConstructor</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</div><div class=\"line\">\t\tConstructor  constructor  = personClass.getConstructor(Long.class,String.class);</div><div class=\"line\">\t\tPerson person = (Person)constructor.newInstance(<span class=\"number\">100L</span>,<span class=\"string\">\"zhangsan\"</span>);</div><div class=\"line\">\t\tSystem.out.println(person.getId());</div><div class=\"line\">\t\tSystem.out.println(person.getName());</div><div class=\"line\">\t&#125;</div><div class=\"line\">\t<span class=\"comment\">/**</span></div><div class=\"line\"><span class=\"comment\">\t *获得私有的构造函数</span></div><div class=\"line\"><span class=\"comment\">\t */</span></div><div class=\"line\">\t<span class=\"meta\">@SuppressWarnings</span>(&#123; <span class=\"string\">\"rawtypes\"</span>, <span class=\"string\">\"unchecked\"</span> &#125;)</div><div class=\"line\">\t<span class=\"meta\">@Test</span></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">getPrivateConstructor</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</div><div class=\"line\">\t\tConstructor con = personClass.getDeclaredConstructor(String.class);</div><div class=\"line\">\t\tcon.setAccessible(<span class=\"keyword\">true</span>);<span class=\"comment\">//强制取消Java的权限检测</span></div><div class=\"line\">\t\tPerson person2 = (Person)con.newInstance(<span class=\"string\">\"zhangsan\"</span>);</div><div class=\"line\">\t\tSystem.out.println(<span class=\"string\">\"**\"</span>+person2.getName());</div><div class=\"line\">\t&#125;</div><div class=\"line\">\t<span class=\"comment\">/**</span></div><div class=\"line\"><span class=\"comment\">\t *访问非私有的成员变量</span></div><div class=\"line\"><span class=\"comment\">\t */</span></div><div class=\"line\">\t<span class=\"meta\">@SuppressWarnings</span>(&#123; <span class=\"string\">\"rawtypes\"</span>, <span class=\"string\">\"unchecked\"</span> &#125;)</div><div class=\"line\">\t<span class=\"meta\">@Test</span></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">getNotPrivateField</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</div><div class=\"line\">\t\tConstructor  constructor  = personClass.getConstructor(Long.class,String.class);</div><div class=\"line\">\t\tObject obj = constructor.newInstance(<span class=\"number\">100L</span>,<span class=\"string\">\"zhangsan\"</span>);</div><div class=\"line\">\t\t</div><div class=\"line\">\t\tField field = personClass.getField(<span class=\"string\">\"name\"</span>);</div><div class=\"line\">\t\tfield.set(obj, <span class=\"string\">\"lisi\"</span>);</div><div class=\"line\">\t\tSystem.out.println(field.get(obj));</div><div class=\"line\">\t&#125;</div><div class=\"line\">\t<span class=\"comment\">/**</span></div><div class=\"line\"><span class=\"comment\">\t *访问私有的成员变量</span></div><div class=\"line\"><span class=\"comment\">\t */</span></div><div class=\"line\">\t<span class=\"meta\">@SuppressWarnings</span>(&#123; <span class=\"string\">\"rawtypes\"</span>, <span class=\"string\">\"unchecked\"</span> &#125;)</div><div class=\"line\">\t<span class=\"meta\">@Test</span></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">getPrivateField</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</div><div class=\"line\">\t\tConstructor  constructor  = personClass.getConstructor(Long.class);</div><div class=\"line\">\t\tObject obj = constructor.newInstance(<span class=\"number\">100L</span>);</div><div class=\"line\">\t\t</div><div class=\"line\">\t\tField field2 = personClass.getDeclaredField(<span class=\"string\">\"id\"</span>);</div><div class=\"line\">\t\tfield2.setAccessible(<span class=\"keyword\">true</span>);<span class=\"comment\">//强制取消Java的权限检测</span></div><div class=\"line\">\t\tfield2.set(obj,<span class=\"number\">10000L</span>);</div><div class=\"line\">\t\tSystem.out.println(field2.get(obj));</div><div class=\"line\">\t&#125;</div><div class=\"line\">\t<span class=\"comment\">/**</span></div><div class=\"line\"><span class=\"comment\">\t *获取非私有的成员函数</span></div><div class=\"line\"><span class=\"comment\">\t */</span></div><div class=\"line\">\t<span class=\"meta\">@SuppressWarnings</span>(&#123; <span class=\"string\">\"unchecked\"</span> &#125;)</div><div class=\"line\">\t<span class=\"meta\">@Test</span></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">getNotPrivateMethod</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</div><div class=\"line\">\t\tSystem.out.println(personClass.getMethod(<span class=\"string\">\"toString\"</span>));</div><div class=\"line\">\t\t</div><div class=\"line\">\t\tObject obj = personClass.newInstance();<span class=\"comment\">//获取空参的构造函数</span></div><div class=\"line\">\t\tMethod toStringMethod = personClass.getMethod(<span class=\"string\">\"toString\"</span>);</div><div class=\"line\">\t\tObject object = toStringMethod.invoke(obj);</div><div class=\"line\">\t\tSystem.out.println(object);</div><div class=\"line\">\t&#125;</div><div class=\"line\">\t<span class=\"comment\">/**</span></div><div class=\"line\"><span class=\"comment\">\t *获取私有的成员函数</span></div><div class=\"line\"><span class=\"comment\">\t */</span></div><div class=\"line\">\t<span class=\"meta\">@SuppressWarnings</span>(<span class=\"string\">\"unchecked\"</span>)</div><div class=\"line\">\t<span class=\"meta\">@Test</span></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">getPrivateMethod</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</div><div class=\"line\">\t\tObject obj = personClass.newInstance();<span class=\"comment\">//获取空参的构造函数</span></div><div class=\"line\">\t\tMethod method = personClass.getDeclaredMethod(<span class=\"string\">\"getSomeThing\"</span>);</div><div class=\"line\">\t\tmethod.setAccessible(<span class=\"keyword\">true</span>);</div><div class=\"line\">\t\tObject value = method.invoke(obj);</div><div class=\"line\">\t\tSystem.out.println(value);</div><div class=\"line\"></div><div class=\"line\">\t&#125;</div><div class=\"line\">\t<span class=\"comment\">/**</span></div><div class=\"line\"><span class=\"comment\">\t *</span></div><div class=\"line\"><span class=\"comment\">\t */</span></div><div class=\"line\">\t<span class=\"meta\">@Test</span></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">otherMethod</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</div><div class=\"line\">\t\t<span class=\"comment\">//当前加载这个class文件的那个类加载器对象</span></div><div class=\"line\">\t\tSystem.out.println(personClass.getClassLoader());</div><div class=\"line\">\t\t<span class=\"comment\">//获取某个类实现的所有接口</span></div><div class=\"line\">\t\tClass[] interfaces = personClass.getInterfaces();</div><div class=\"line\">\t\t<span class=\"keyword\">for</span> (Class class1 : interfaces) &#123;</div><div class=\"line\">\t\t\tSystem.out.println(class1);</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t\t<span class=\"comment\">//反射当前这个类的直接父类</span></div><div class=\"line\">\t\tSystem.out.println(personClass.getGenericSuperclass());</div><div class=\"line\">\t\t<span class=\"comment\">/**</span></div><div class=\"line\"><span class=\"comment\">\t\t * getResourceAsStream这个方法可以获取到一个输入流，这个输入流会关联到name所表示的那个文件上。</span></div><div class=\"line\"><span class=\"comment\">\t\t */</span></div><div class=\"line\">\t\t<span class=\"comment\">//path 不以’/'开头时默认是从此类所在的包下取资源，以’/'开头则是从ClassPath根下获取。其只是通过path构造一个绝对路径，最终还是由ClassLoader获取资源。</span></div><div class=\"line\">\t\tSystem.out.println(personClass.getResourceAsStream(<span class=\"string\">\"/log4j.properties\"</span>));</div><div class=\"line\">\t\tSystem.out.println(personClass.getResourceAsStream(<span class=\"string\">\"log4j.properties\"</span>));</div><div class=\"line\">\t\t</div><div class=\"line\">\t\t<span class=\"comment\">//判断当前的Class对象表示是否是数组</span></div><div class=\"line\">\t\tSystem.out.println(personClass.isArray());</div><div class=\"line\">\t\tSystem.out.println(<span class=\"keyword\">new</span> String[<span class=\"number\">3</span>].getClass().isArray());</div><div class=\"line\">\t\t</div><div class=\"line\">\t\t<span class=\"comment\">//判断当前的Class对象表示是否是枚举类</span></div><div class=\"line\">\t\tSystem.out.println(personClass.isEnum());</div><div class=\"line\">\t\tSystem.out.println(Class.forName(<span class=\"string\">\"cn.itcast_04_reflect.City\"</span>).isEnum());</div><div class=\"line\">\t\t</div><div class=\"line\">\t\t<span class=\"comment\">//判断当前的Class对象表示是否是接口</span></div><div class=\"line\">\t\tSystem.out.println(personClass.isInterface());</div><div class=\"line\">\t\tSystem.out.println(Class.forName(<span class=\"string\">\"cn.itcast_04_reflect.TestInterface\"</span>).isInterface());</div><div class=\"line\">\t\t</div><div class=\"line\">\t\t</div><div class=\"line\">\t&#125;</div><div class=\"line\"></div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n","site":{"data":{}},"excerpt":"<p>通过反射的方式可以获取class对象中的属性、方法、构造函数等:<br>","more":"<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div><div class=\"line\">87</div><div class=\"line\">88</div><div class=\"line\">89</div><div class=\"line\">90</div><div class=\"line\">91</div><div class=\"line\">92</div><div class=\"line\">93</div><div class=\"line\">94</div><div class=\"line\">95</div><div class=\"line\">96</div><div class=\"line\">97</div><div class=\"line\">98</div><div class=\"line\">99</div><div class=\"line\">100</div><div class=\"line\">101</div><div class=\"line\">102</div><div class=\"line\">103</div><div class=\"line\">104</div><div class=\"line\">105</div><div class=\"line\">106</div><div class=\"line\">107</div><div class=\"line\">108</div><div class=\"line\">109</div><div class=\"line\">110</div><div class=\"line\">111</div><div class=\"line\">112</div><div class=\"line\">113</div><div class=\"line\">114</div><div class=\"line\">115</div><div class=\"line\">116</div><div class=\"line\">117</div><div class=\"line\">118</div><div class=\"line\">119</div><div class=\"line\">120</div><div class=\"line\">121</div><div class=\"line\">122</div><div class=\"line\">123</div><div class=\"line\">124</div><div class=\"line\">125</div><div class=\"line\">126</div><div class=\"line\">127</div><div class=\"line\">128</div><div class=\"line\">129</div><div class=\"line\">130</div><div class=\"line\">131</div><div class=\"line\">132</div><div class=\"line\">133</div><div class=\"line\">134</div><div class=\"line\">135</div><div class=\"line\">136</div><div class=\"line\">137</div><div class=\"line\">138</div><div class=\"line\">139</div><div class=\"line\">140</div><div class=\"line\">141</div><div class=\"line\">142</div><div class=\"line\">143</div><div class=\"line\">144</div><div class=\"line\">145</div><div class=\"line\">146</div><div class=\"line\">147</div><div class=\"line\">148</div><div class=\"line\">149</div><div class=\"line\">150</div><div class=\"line\">151</div><div class=\"line\">152</div><div class=\"line\">153</div><div class=\"line\">154</div><div class=\"line\">155</div><div class=\"line\">156</div><div class=\"line\">157</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">package</span> cn.itcast_04_reflect;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">import</span> java.lang.reflect.Constructor;</div><div class=\"line\"><span class=\"keyword\">import</span> java.lang.reflect.Field;</div><div class=\"line\"><span class=\"keyword\">import</span> java.lang.reflect.Method;</div><div class=\"line\"><span class=\"keyword\">import</span> java.util.ArrayList;</div><div class=\"line\"><span class=\"keyword\">import</span> java.util.List;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">import</span> org.junit.Before;</div><div class=\"line\"><span class=\"keyword\">import</span> org.junit.Test;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MyReflect</span> </span>&#123;</div><div class=\"line\">\t<span class=\"keyword\">public</span> String className = <span class=\"keyword\">null</span>;</div><div class=\"line\">\t<span class=\"meta\">@SuppressWarnings</span>(<span class=\"string\">\"rawtypes\"</span>)</div><div class=\"line\">\t<span class=\"keyword\">public</span> Class personClass = <span class=\"keyword\">null</span>;</div><div class=\"line\">\t<span class=\"comment\">/**</span></div><div class=\"line\"><span class=\"comment\">\t * 反射Person类</span></div><div class=\"line\"><span class=\"comment\">\t * <span class=\"doctag\">@throws</span> Exception </span></div><div class=\"line\"><span class=\"comment\">\t */</span></div><div class=\"line\">\t<span class=\"meta\">@Before</span></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">init</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</div><div class=\"line\">\t\tclassName = <span class=\"string\">\"cn.itcast_04_reflect.Person\"</span>;</div><div class=\"line\">\t\tpersonClass = Class.forName(className);</div><div class=\"line\">\t&#125;</div><div class=\"line\">\t<span class=\"comment\">/**</span></div><div class=\"line\"><span class=\"comment\">\t *获取某个class文件对象</span></div><div class=\"line\"><span class=\"comment\">\t */</span></div><div class=\"line\">\t<span class=\"meta\">@Test</span></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">getClassName</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</div><div class=\"line\">\t\tSystem.out.println(personClass);</div><div class=\"line\">\t&#125;</div><div class=\"line\">\t<span class=\"comment\">/**</span></div><div class=\"line\"><span class=\"comment\">\t *获取某个class文件对象的另一种方式</span></div><div class=\"line\"><span class=\"comment\">\t */</span></div><div class=\"line\">\t<span class=\"meta\">@Test</span></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">getClassName2</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</div><div class=\"line\">\t\tSystem.out.println(Person.class);</div><div class=\"line\">\t&#125;</div><div class=\"line\">\t<span class=\"comment\">/**</span></div><div class=\"line\"><span class=\"comment\">\t *创建一个class文件表示的实例对象，底层会调用空参数的构造方法</span></div><div class=\"line\"><span class=\"comment\">\t */</span></div><div class=\"line\">\t<span class=\"meta\">@Test</span></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">getNewInstance</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</div><div class=\"line\">\t\tSystem.out.println(personClass.newInstance());</div><div class=\"line\">\t&#125;</div><div class=\"line\">\t<span class=\"comment\">/**</span></div><div class=\"line\"><span class=\"comment\">\t *获取非私有的构造函数</span></div><div class=\"line\"><span class=\"comment\">\t */</span></div><div class=\"line\">\t<span class=\"meta\">@SuppressWarnings</span>(&#123; <span class=\"string\">\"rawtypes\"</span>, <span class=\"string\">\"unchecked\"</span> &#125;)</div><div class=\"line\">\t<span class=\"meta\">@Test</span></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">getPublicConstructor</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</div><div class=\"line\">\t\tConstructor  constructor  = personClass.getConstructor(Long.class,String.class);</div><div class=\"line\">\t\tPerson person = (Person)constructor.newInstance(<span class=\"number\">100L</span>,<span class=\"string\">\"zhangsan\"</span>);</div><div class=\"line\">\t\tSystem.out.println(person.getId());</div><div class=\"line\">\t\tSystem.out.println(person.getName());</div><div class=\"line\">\t&#125;</div><div class=\"line\">\t<span class=\"comment\">/**</span></div><div class=\"line\"><span class=\"comment\">\t *获得私有的构造函数</span></div><div class=\"line\"><span class=\"comment\">\t */</span></div><div class=\"line\">\t<span class=\"meta\">@SuppressWarnings</span>(&#123; <span class=\"string\">\"rawtypes\"</span>, <span class=\"string\">\"unchecked\"</span> &#125;)</div><div class=\"line\">\t<span class=\"meta\">@Test</span></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">getPrivateConstructor</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</div><div class=\"line\">\t\tConstructor con = personClass.getDeclaredConstructor(String.class);</div><div class=\"line\">\t\tcon.setAccessible(<span class=\"keyword\">true</span>);<span class=\"comment\">//强制取消Java的权限检测</span></div><div class=\"line\">\t\tPerson person2 = (Person)con.newInstance(<span class=\"string\">\"zhangsan\"</span>);</div><div class=\"line\">\t\tSystem.out.println(<span class=\"string\">\"**\"</span>+person2.getName());</div><div class=\"line\">\t&#125;</div><div class=\"line\">\t<span class=\"comment\">/**</span></div><div class=\"line\"><span class=\"comment\">\t *访问非私有的成员变量</span></div><div class=\"line\"><span class=\"comment\">\t */</span></div><div class=\"line\">\t<span class=\"meta\">@SuppressWarnings</span>(&#123; <span class=\"string\">\"rawtypes\"</span>, <span class=\"string\">\"unchecked\"</span> &#125;)</div><div class=\"line\">\t<span class=\"meta\">@Test</span></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">getNotPrivateField</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</div><div class=\"line\">\t\tConstructor  constructor  = personClass.getConstructor(Long.class,String.class);</div><div class=\"line\">\t\tObject obj = constructor.newInstance(<span class=\"number\">100L</span>,<span class=\"string\">\"zhangsan\"</span>);</div><div class=\"line\">\t\t</div><div class=\"line\">\t\tField field = personClass.getField(<span class=\"string\">\"name\"</span>);</div><div class=\"line\">\t\tfield.set(obj, <span class=\"string\">\"lisi\"</span>);</div><div class=\"line\">\t\tSystem.out.println(field.get(obj));</div><div class=\"line\">\t&#125;</div><div class=\"line\">\t<span class=\"comment\">/**</span></div><div class=\"line\"><span class=\"comment\">\t *访问私有的成员变量</span></div><div class=\"line\"><span class=\"comment\">\t */</span></div><div class=\"line\">\t<span class=\"meta\">@SuppressWarnings</span>(&#123; <span class=\"string\">\"rawtypes\"</span>, <span class=\"string\">\"unchecked\"</span> &#125;)</div><div class=\"line\">\t<span class=\"meta\">@Test</span></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">getPrivateField</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</div><div class=\"line\">\t\tConstructor  constructor  = personClass.getConstructor(Long.class);</div><div class=\"line\">\t\tObject obj = constructor.newInstance(<span class=\"number\">100L</span>);</div><div class=\"line\">\t\t</div><div class=\"line\">\t\tField field2 = personClass.getDeclaredField(<span class=\"string\">\"id\"</span>);</div><div class=\"line\">\t\tfield2.setAccessible(<span class=\"keyword\">true</span>);<span class=\"comment\">//强制取消Java的权限检测</span></div><div class=\"line\">\t\tfield2.set(obj,<span class=\"number\">10000L</span>);</div><div class=\"line\">\t\tSystem.out.println(field2.get(obj));</div><div class=\"line\">\t&#125;</div><div class=\"line\">\t<span class=\"comment\">/**</span></div><div class=\"line\"><span class=\"comment\">\t *获取非私有的成员函数</span></div><div class=\"line\"><span class=\"comment\">\t */</span></div><div class=\"line\">\t<span class=\"meta\">@SuppressWarnings</span>(&#123; <span class=\"string\">\"unchecked\"</span> &#125;)</div><div class=\"line\">\t<span class=\"meta\">@Test</span></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">getNotPrivateMethod</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</div><div class=\"line\">\t\tSystem.out.println(personClass.getMethod(<span class=\"string\">\"toString\"</span>));</div><div class=\"line\">\t\t</div><div class=\"line\">\t\tObject obj = personClass.newInstance();<span class=\"comment\">//获取空参的构造函数</span></div><div class=\"line\">\t\tMethod toStringMethod = personClass.getMethod(<span class=\"string\">\"toString\"</span>);</div><div class=\"line\">\t\tObject object = toStringMethod.invoke(obj);</div><div class=\"line\">\t\tSystem.out.println(object);</div><div class=\"line\">\t&#125;</div><div class=\"line\">\t<span class=\"comment\">/**</span></div><div class=\"line\"><span class=\"comment\">\t *获取私有的成员函数</span></div><div class=\"line\"><span class=\"comment\">\t */</span></div><div class=\"line\">\t<span class=\"meta\">@SuppressWarnings</span>(<span class=\"string\">\"unchecked\"</span>)</div><div class=\"line\">\t<span class=\"meta\">@Test</span></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">getPrivateMethod</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</div><div class=\"line\">\t\tObject obj = personClass.newInstance();<span class=\"comment\">//获取空参的构造函数</span></div><div class=\"line\">\t\tMethod method = personClass.getDeclaredMethod(<span class=\"string\">\"getSomeThing\"</span>);</div><div class=\"line\">\t\tmethod.setAccessible(<span class=\"keyword\">true</span>);</div><div class=\"line\">\t\tObject value = method.invoke(obj);</div><div class=\"line\">\t\tSystem.out.println(value);</div><div class=\"line\"></div><div class=\"line\">\t&#125;</div><div class=\"line\">\t<span class=\"comment\">/**</span></div><div class=\"line\"><span class=\"comment\">\t *</span></div><div class=\"line\"><span class=\"comment\">\t */</span></div><div class=\"line\">\t<span class=\"meta\">@Test</span></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">otherMethod</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</div><div class=\"line\">\t\t<span class=\"comment\">//当前加载这个class文件的那个类加载器对象</span></div><div class=\"line\">\t\tSystem.out.println(personClass.getClassLoader());</div><div class=\"line\">\t\t<span class=\"comment\">//获取某个类实现的所有接口</span></div><div class=\"line\">\t\tClass[] interfaces = personClass.getInterfaces();</div><div class=\"line\">\t\t<span class=\"keyword\">for</span> (Class class1 : interfaces) &#123;</div><div class=\"line\">\t\t\tSystem.out.println(class1);</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t\t<span class=\"comment\">//反射当前这个类的直接父类</span></div><div class=\"line\">\t\tSystem.out.println(personClass.getGenericSuperclass());</div><div class=\"line\">\t\t<span class=\"comment\">/**</span></div><div class=\"line\"><span class=\"comment\">\t\t * getResourceAsStream这个方法可以获取到一个输入流，这个输入流会关联到name所表示的那个文件上。</span></div><div class=\"line\"><span class=\"comment\">\t\t */</span></div><div class=\"line\">\t\t<span class=\"comment\">//path 不以’/'开头时默认是从此类所在的包下取资源，以’/'开头则是从ClassPath根下获取。其只是通过path构造一个绝对路径，最终还是由ClassLoader获取资源。</span></div><div class=\"line\">\t\tSystem.out.println(personClass.getResourceAsStream(<span class=\"string\">\"/log4j.properties\"</span>));</div><div class=\"line\">\t\tSystem.out.println(personClass.getResourceAsStream(<span class=\"string\">\"log4j.properties\"</span>));</div><div class=\"line\">\t\t</div><div class=\"line\">\t\t<span class=\"comment\">//判断当前的Class对象表示是否是数组</span></div><div class=\"line\">\t\tSystem.out.println(personClass.isArray());</div><div class=\"line\">\t\tSystem.out.println(<span class=\"keyword\">new</span> String[<span class=\"number\">3</span>].getClass().isArray());</div><div class=\"line\">\t\t</div><div class=\"line\">\t\t<span class=\"comment\">//判断当前的Class对象表示是否是枚举类</span></div><div class=\"line\">\t\tSystem.out.println(personClass.isEnum());</div><div class=\"line\">\t\tSystem.out.println(Class.forName(<span class=\"string\">\"cn.itcast_04_reflect.City\"</span>).isEnum());</div><div class=\"line\">\t\t</div><div class=\"line\">\t\t<span class=\"comment\">//判断当前的Class对象表示是否是接口</span></div><div class=\"line\">\t\tSystem.out.println(personClass.isInterface());</div><div class=\"line\">\t\tSystem.out.println(Class.forName(<span class=\"string\">\"cn.itcast_04_reflect.TestInterface\"</span>).isInterface());</div><div class=\"line\">\t\t</div><div class=\"line\">\t\t</div><div class=\"line\">\t&#125;</div><div class=\"line\"></div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>"},{"title":"大数据0405-java-socket","toc":true,"date":"2017-12-03T15:14:47.000Z","scaffolds":null,"_content":"直接上代码吧\n<!-- more -->\n\n```java\npackage cn.itcast.bigdata.socket;\nimport java.net.InetSocketAddress;\nimport java.net.ServerSocket;\nimport java.net.Socket;\npublic class ServiceServer {\n\tpublic static void main(String[] args) throws Exception {\n\t\t// 创建一个serversocket，绑定到本机的8899端口上\n\t\tServerSocket server = new ServerSocket();\n\t\tserver.bind(new InetSocketAddress(\"localhost\", 8899));\n\t\t// 接受客户端的连接请求;accept是一个阻塞方法，会一直等待，到有客户端请求连接才返回\n\t\twhile (true) {\n\t\t\tSocket socket = server.accept();\n\t\t\tnew Thread(new ServiceServerTask(socket)).start();\n\t\t}\n\t}\n}\n======================\npackage cn.itcast.bigdata.socket;\nimport java.io.BufferedReader;\nimport java.io.InputStream;\nimport java.io.InputStreamReader;\nimport java.io.OutputStream;\nimport java.io.PrintWriter;\nimport java.net.Socket;\npublic class ServiceClient {\n\tpublic static void main(String[] args) throws Exception {\n\t\t/*ServiceIterface service = ProxyUtils.getProxy(ServiceIterface.class,\"methodA\",hostname,port);\n\t\tResult = service.methodA(parameters);*/\n\t\t// 向服务器发出请求建立连接\n\t\tSocket socket = new Socket(\"localhost\", 8899);\n\t\t// 从socket中获取输入输出流\n\t\tInputStream inputStream = socket.getInputStream();\n\t\tOutputStream outputStream = socket.getOutputStream();\n\t\tPrintWriter pw = new PrintWriter(outputStream);\n\t\tpw.println(\"hello\");\n\t\tpw.flush();\n\t\tBufferedReader br = new BufferedReader(new InputStreamReader(inputStream));\n\t\tString result = br.readLine();\n\t\tSystem.out.println(result);\n\t\tinputStream.close();\n\t\toutputStream.close();\n\t\tsocket.close();\n\t}\n}\n======================\npackage cn.itcast.bigdata.socket;\npublic class GetDataServiceImpl {\n\tpublic String getData(String param){\n\t\treturn \"ok-\"+param;\n\t}\n}\n=======================\npackage cn.itcast.bigdata.socket;\nimport java.io.BufferedReader;\nimport java.io.IOException;\nimport java.io.InputStream;\nimport java.io.InputStreamReader;\nimport java.io.OutputStream;\nimport java.io.PrintWriter;\nimport java.net.Socket;\npublic class ServiceServerTask implements Runnable{\n\tSocket socket ;\n\tInputStream in=null;\n\tOutputStream out = null;\n\tpublic ServiceServerTask(Socket socket) {\n\t\tthis.socket = socket;\n\t}\n\t//业务逻辑：跟客户端进行数据交互\n\t@Override\n\tpublic void run() {\n\t\t try {\n\t\t\t//从socket连接中获取到与client之间的网络通信输入输出流 \n\t\t\tin = socket.getInputStream();\n\t\t\tout = socket.getOutputStream();\n\t\t\tBufferedReader br = new BufferedReader(new InputStreamReader(in));\n\t\t\t//从网络通信输入流中读取客户端发送过来的数据\n\t\t\t//注意：socketinputstream的读数据的方法都是阻塞的 \n\t\t\tString param = br.readLine();\n\t\t\t/**\n\t\t\t * 作业：\n\t\t\t * 将以下业务调用逻辑写成更加通用的：可以根据客户端发过来的调用类名、调用方法名、调用该参数来灵活调用\n\t\t\t * \n\t\t\t * 《反射》\n\t\t\t * \n\t\t\t */\n\t\t\tGetDataServiceImpl getDataServiceImpl = new GetDataServiceImpl();\n\t\t\tString result = getDataServiceImpl.getData(param);\n\t\t\t//将调用结果写到sokect的输出流中，以发送给客户端\n\t\t\tPrintWriter pw = new PrintWriter(out);\n\t\t\tpw.println(result);\n\t\t\tpw.flush();\n\t\t} catch (IOException e) {\n\t\t\te.printStackTrace();\n\t\t}finally{\n\t\t\ttry {\n\t\t\t\tin.close();\n\t\t\t\tout.close();\n\t\t\t\tsocket.close();\n\t\t\t} catch (IOException e) {\n\t\t\t\te.printStackTrace();\n\t\t\t}\n\t\t}\n\t}\n}\n```\n","source":"_posts/大数据/大数据0405-java-socket.md","raw":"---\ntitle: 大数据0405-java-socket\ncategories: 学习\ntags:\n  - 大数据\n  - java\n  - socket\ntoc: true\ndate: 2017-12-03 23:14:47\nscaffolds:\n---\n直接上代码吧\n<!-- more -->\n\n```java\npackage cn.itcast.bigdata.socket;\nimport java.net.InetSocketAddress;\nimport java.net.ServerSocket;\nimport java.net.Socket;\npublic class ServiceServer {\n\tpublic static void main(String[] args) throws Exception {\n\t\t// 创建一个serversocket，绑定到本机的8899端口上\n\t\tServerSocket server = new ServerSocket();\n\t\tserver.bind(new InetSocketAddress(\"localhost\", 8899));\n\t\t// 接受客户端的连接请求;accept是一个阻塞方法，会一直等待，到有客户端请求连接才返回\n\t\twhile (true) {\n\t\t\tSocket socket = server.accept();\n\t\t\tnew Thread(new ServiceServerTask(socket)).start();\n\t\t}\n\t}\n}\n======================\npackage cn.itcast.bigdata.socket;\nimport java.io.BufferedReader;\nimport java.io.InputStream;\nimport java.io.InputStreamReader;\nimport java.io.OutputStream;\nimport java.io.PrintWriter;\nimport java.net.Socket;\npublic class ServiceClient {\n\tpublic static void main(String[] args) throws Exception {\n\t\t/*ServiceIterface service = ProxyUtils.getProxy(ServiceIterface.class,\"methodA\",hostname,port);\n\t\tResult = service.methodA(parameters);*/\n\t\t// 向服务器发出请求建立连接\n\t\tSocket socket = new Socket(\"localhost\", 8899);\n\t\t// 从socket中获取输入输出流\n\t\tInputStream inputStream = socket.getInputStream();\n\t\tOutputStream outputStream = socket.getOutputStream();\n\t\tPrintWriter pw = new PrintWriter(outputStream);\n\t\tpw.println(\"hello\");\n\t\tpw.flush();\n\t\tBufferedReader br = new BufferedReader(new InputStreamReader(inputStream));\n\t\tString result = br.readLine();\n\t\tSystem.out.println(result);\n\t\tinputStream.close();\n\t\toutputStream.close();\n\t\tsocket.close();\n\t}\n}\n======================\npackage cn.itcast.bigdata.socket;\npublic class GetDataServiceImpl {\n\tpublic String getData(String param){\n\t\treturn \"ok-\"+param;\n\t}\n}\n=======================\npackage cn.itcast.bigdata.socket;\nimport java.io.BufferedReader;\nimport java.io.IOException;\nimport java.io.InputStream;\nimport java.io.InputStreamReader;\nimport java.io.OutputStream;\nimport java.io.PrintWriter;\nimport java.net.Socket;\npublic class ServiceServerTask implements Runnable{\n\tSocket socket ;\n\tInputStream in=null;\n\tOutputStream out = null;\n\tpublic ServiceServerTask(Socket socket) {\n\t\tthis.socket = socket;\n\t}\n\t//业务逻辑：跟客户端进行数据交互\n\t@Override\n\tpublic void run() {\n\t\t try {\n\t\t\t//从socket连接中获取到与client之间的网络通信输入输出流 \n\t\t\tin = socket.getInputStream();\n\t\t\tout = socket.getOutputStream();\n\t\t\tBufferedReader br = new BufferedReader(new InputStreamReader(in));\n\t\t\t//从网络通信输入流中读取客户端发送过来的数据\n\t\t\t//注意：socketinputstream的读数据的方法都是阻塞的 \n\t\t\tString param = br.readLine();\n\t\t\t/**\n\t\t\t * 作业：\n\t\t\t * 将以下业务调用逻辑写成更加通用的：可以根据客户端发过来的调用类名、调用方法名、调用该参数来灵活调用\n\t\t\t * \n\t\t\t * 《反射》\n\t\t\t * \n\t\t\t */\n\t\t\tGetDataServiceImpl getDataServiceImpl = new GetDataServiceImpl();\n\t\t\tString result = getDataServiceImpl.getData(param);\n\t\t\t//将调用结果写到sokect的输出流中，以发送给客户端\n\t\t\tPrintWriter pw = new PrintWriter(out);\n\t\t\tpw.println(result);\n\t\t\tpw.flush();\n\t\t} catch (IOException e) {\n\t\t\te.printStackTrace();\n\t\t}finally{\n\t\t\ttry {\n\t\t\t\tin.close();\n\t\t\t\tout.close();\n\t\t\t\tsocket.close();\n\t\t\t} catch (IOException e) {\n\t\t\t\te.printStackTrace();\n\t\t\t}\n\t\t}\n\t}\n}\n```\n","slug":"大数据/大数据0405-java-socket","published":1,"updated":"2017-12-03T15:17:24.365Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjcsq4ljn003sx4vf8kd16nn5","content":"<p>直接上代码吧<br><a id=\"more\"></a></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div><div class=\"line\">87</div><div class=\"line\">88</div><div class=\"line\">89</div><div class=\"line\">90</div><div class=\"line\">91</div><div class=\"line\">92</div><div class=\"line\">93</div><div class=\"line\">94</div><div class=\"line\">95</div><div class=\"line\">96</div><div class=\"line\">97</div><div class=\"line\">98</div><div class=\"line\">99</div><div class=\"line\">100</div><div class=\"line\">101</div><div class=\"line\">102</div><div class=\"line\">103</div><div class=\"line\">104</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">package</span> cn.itcast.bigdata.socket;</div><div class=\"line\"><span class=\"keyword\">import</span> java.net.InetSocketAddress;</div><div class=\"line\"><span class=\"keyword\">import</span> java.net.ServerSocket;</div><div class=\"line\"><span class=\"keyword\">import</span> java.net.Socket;</div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ServiceServer</span> </span>&#123;</div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</div><div class=\"line\">\t\t<span class=\"comment\">// 创建一个serversocket，绑定到本机的8899端口上</span></div><div class=\"line\">\t\tServerSocket server = <span class=\"keyword\">new</span> ServerSocket();</div><div class=\"line\">\t\tserver.bind(<span class=\"keyword\">new</span> InetSocketAddress(<span class=\"string\">\"localhost\"</span>, <span class=\"number\">8899</span>));</div><div class=\"line\">\t\t<span class=\"comment\">// 接受客户端的连接请求;accept是一个阻塞方法，会一直等待，到有客户端请求连接才返回</span></div><div class=\"line\">\t\t<span class=\"keyword\">while</span> (<span class=\"keyword\">true</span>) &#123;</div><div class=\"line\">\t\t\tSocket socket = server.accept();</div><div class=\"line\">\t\t\t<span class=\"keyword\">new</span> Thread(<span class=\"keyword\">new</span> ServiceServerTask(socket)).start();</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div><div class=\"line\">======================</div><div class=\"line\"><span class=\"keyword\">package</span> cn.itcast.bigdata.socket;</div><div class=\"line\"><span class=\"keyword\">import</span> java.io.BufferedReader;</div><div class=\"line\"><span class=\"keyword\">import</span> java.io.InputStream;</div><div class=\"line\"><span class=\"keyword\">import</span> java.io.InputStreamReader;</div><div class=\"line\"><span class=\"keyword\">import</span> java.io.OutputStream;</div><div class=\"line\"><span class=\"keyword\">import</span> java.io.PrintWriter;</div><div class=\"line\"><span class=\"keyword\">import</span> java.net.Socket;</div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ServiceClient</span> </span>&#123;</div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</div><div class=\"line\">\t\t<span class=\"comment\">/*ServiceIterface service = ProxyUtils.getProxy(ServiceIterface.class,\"methodA\",hostname,port);</span></div><div class=\"line\"><span class=\"comment\">\t\tResult = service.methodA(parameters);*/</span></div><div class=\"line\">\t\t<span class=\"comment\">// 向服务器发出请求建立连接</span></div><div class=\"line\">\t\tSocket socket = <span class=\"keyword\">new</span> Socket(<span class=\"string\">\"localhost\"</span>, <span class=\"number\">8899</span>);</div><div class=\"line\">\t\t<span class=\"comment\">// 从socket中获取输入输出流</span></div><div class=\"line\">\t\tInputStream inputStream = socket.getInputStream();</div><div class=\"line\">\t\tOutputStream outputStream = socket.getOutputStream();</div><div class=\"line\">\t\tPrintWriter pw = <span class=\"keyword\">new</span> PrintWriter(outputStream);</div><div class=\"line\">\t\tpw.println(<span class=\"string\">\"hello\"</span>);</div><div class=\"line\">\t\tpw.flush();</div><div class=\"line\">\t\tBufferedReader br = <span class=\"keyword\">new</span> BufferedReader(<span class=\"keyword\">new</span> InputStreamReader(inputStream));</div><div class=\"line\">\t\tString result = br.readLine();</div><div class=\"line\">\t\tSystem.out.println(result);</div><div class=\"line\">\t\tinputStream.close();</div><div class=\"line\">\t\toutputStream.close();</div><div class=\"line\">\t\tsocket.close();</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div><div class=\"line\">======================</div><div class=\"line\"><span class=\"keyword\">package</span> cn.itcast.bigdata.socket;</div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">GetDataServiceImpl</span> </span>&#123;</div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">getData</span><span class=\"params\">(String param)</span></span>&#123;</div><div class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"string\">\"ok-\"</span>+param;</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div><div class=\"line\">=======================</div><div class=\"line\"><span class=\"keyword\">package</span> cn.itcast.bigdata.socket;</div><div class=\"line\"><span class=\"keyword\">import</span> java.io.BufferedReader;</div><div class=\"line\"><span class=\"keyword\">import</span> java.io.IOException;</div><div class=\"line\"><span class=\"keyword\">import</span> java.io.InputStream;</div><div class=\"line\"><span class=\"keyword\">import</span> java.io.InputStreamReader;</div><div class=\"line\"><span class=\"keyword\">import</span> java.io.OutputStream;</div><div class=\"line\"><span class=\"keyword\">import</span> java.io.PrintWriter;</div><div class=\"line\"><span class=\"keyword\">import</span> java.net.Socket;</div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ServiceServerTask</span> <span class=\"keyword\">implements</span> <span class=\"title\">Runnable</span></span>&#123;</div><div class=\"line\">\tSocket socket ;</div><div class=\"line\">\tInputStream in=<span class=\"keyword\">null</span>;</div><div class=\"line\">\tOutputStream out = <span class=\"keyword\">null</span>;</div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">ServiceServerTask</span><span class=\"params\">(Socket socket)</span> </span>&#123;</div><div class=\"line\">\t\t<span class=\"keyword\">this</span>.socket = socket;</div><div class=\"line\">\t&#125;</div><div class=\"line\">\t<span class=\"comment\">//业务逻辑：跟客户端进行数据交互</span></div><div class=\"line\">\t<span class=\"meta\">@Override</span></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">\t\t <span class=\"keyword\">try</span> &#123;</div><div class=\"line\">\t\t\t<span class=\"comment\">//从socket连接中获取到与client之间的网络通信输入输出流 </span></div><div class=\"line\">\t\t\tin = socket.getInputStream();</div><div class=\"line\">\t\t\tout = socket.getOutputStream();</div><div class=\"line\">\t\t\tBufferedReader br = <span class=\"keyword\">new</span> BufferedReader(<span class=\"keyword\">new</span> InputStreamReader(in));</div><div class=\"line\">\t\t\t<span class=\"comment\">//从网络通信输入流中读取客户端发送过来的数据</span></div><div class=\"line\">\t\t\t<span class=\"comment\">//注意：socketinputstream的读数据的方法都是阻塞的 </span></div><div class=\"line\">\t\t\tString param = br.readLine();</div><div class=\"line\">\t\t\t<span class=\"comment\">/**</span></div><div class=\"line\"><span class=\"comment\">\t\t\t * 作业：</span></div><div class=\"line\"><span class=\"comment\">\t\t\t * 将以下业务调用逻辑写成更加通用的：可以根据客户端发过来的调用类名、调用方法名、调用该参数来灵活调用</span></div><div class=\"line\"><span class=\"comment\">\t\t\t * </span></div><div class=\"line\"><span class=\"comment\">\t\t\t * 《反射》</span></div><div class=\"line\"><span class=\"comment\">\t\t\t * </span></div><div class=\"line\"><span class=\"comment\">\t\t\t */</span></div><div class=\"line\">\t\t\tGetDataServiceImpl getDataServiceImpl = <span class=\"keyword\">new</span> GetDataServiceImpl();</div><div class=\"line\">\t\t\tString result = getDataServiceImpl.getData(param);</div><div class=\"line\">\t\t\t<span class=\"comment\">//将调用结果写到sokect的输出流中，以发送给客户端</span></div><div class=\"line\">\t\t\tPrintWriter pw = <span class=\"keyword\">new</span> PrintWriter(out);</div><div class=\"line\">\t\t\tpw.println(result);</div><div class=\"line\">\t\t\tpw.flush();</div><div class=\"line\">\t\t&#125; <span class=\"keyword\">catch</span> (IOException e) &#123;</div><div class=\"line\">\t\t\te.printStackTrace();</div><div class=\"line\">\t\t&#125;<span class=\"keyword\">finally</span>&#123;</div><div class=\"line\">\t\t\t<span class=\"keyword\">try</span> &#123;</div><div class=\"line\">\t\t\t\tin.close();</div><div class=\"line\">\t\t\t\tout.close();</div><div class=\"line\">\t\t\t\tsocket.close();</div><div class=\"line\">\t\t\t&#125; <span class=\"keyword\">catch</span> (IOException e) &#123;</div><div class=\"line\">\t\t\t\te.printStackTrace();</div><div class=\"line\">\t\t\t&#125;</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n","site":{"data":{}},"excerpt":"<p>直接上代码吧<br>","more":"</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div><div class=\"line\">87</div><div class=\"line\">88</div><div class=\"line\">89</div><div class=\"line\">90</div><div class=\"line\">91</div><div class=\"line\">92</div><div class=\"line\">93</div><div class=\"line\">94</div><div class=\"line\">95</div><div class=\"line\">96</div><div class=\"line\">97</div><div class=\"line\">98</div><div class=\"line\">99</div><div class=\"line\">100</div><div class=\"line\">101</div><div class=\"line\">102</div><div class=\"line\">103</div><div class=\"line\">104</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">package</span> cn.itcast.bigdata.socket;</div><div class=\"line\"><span class=\"keyword\">import</span> java.net.InetSocketAddress;</div><div class=\"line\"><span class=\"keyword\">import</span> java.net.ServerSocket;</div><div class=\"line\"><span class=\"keyword\">import</span> java.net.Socket;</div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ServiceServer</span> </span>&#123;</div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</div><div class=\"line\">\t\t<span class=\"comment\">// 创建一个serversocket，绑定到本机的8899端口上</span></div><div class=\"line\">\t\tServerSocket server = <span class=\"keyword\">new</span> ServerSocket();</div><div class=\"line\">\t\tserver.bind(<span class=\"keyword\">new</span> InetSocketAddress(<span class=\"string\">\"localhost\"</span>, <span class=\"number\">8899</span>));</div><div class=\"line\">\t\t<span class=\"comment\">// 接受客户端的连接请求;accept是一个阻塞方法，会一直等待，到有客户端请求连接才返回</span></div><div class=\"line\">\t\t<span class=\"keyword\">while</span> (<span class=\"keyword\">true</span>) &#123;</div><div class=\"line\">\t\t\tSocket socket = server.accept();</div><div class=\"line\">\t\t\t<span class=\"keyword\">new</span> Thread(<span class=\"keyword\">new</span> ServiceServerTask(socket)).start();</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div><div class=\"line\">======================</div><div class=\"line\"><span class=\"keyword\">package</span> cn.itcast.bigdata.socket;</div><div class=\"line\"><span class=\"keyword\">import</span> java.io.BufferedReader;</div><div class=\"line\"><span class=\"keyword\">import</span> java.io.InputStream;</div><div class=\"line\"><span class=\"keyword\">import</span> java.io.InputStreamReader;</div><div class=\"line\"><span class=\"keyword\">import</span> java.io.OutputStream;</div><div class=\"line\"><span class=\"keyword\">import</span> java.io.PrintWriter;</div><div class=\"line\"><span class=\"keyword\">import</span> java.net.Socket;</div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ServiceClient</span> </span>&#123;</div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</div><div class=\"line\">\t\t<span class=\"comment\">/*ServiceIterface service = ProxyUtils.getProxy(ServiceIterface.class,\"methodA\",hostname,port);</span></div><div class=\"line\"><span class=\"comment\">\t\tResult = service.methodA(parameters);*/</span></div><div class=\"line\">\t\t<span class=\"comment\">// 向服务器发出请求建立连接</span></div><div class=\"line\">\t\tSocket socket = <span class=\"keyword\">new</span> Socket(<span class=\"string\">\"localhost\"</span>, <span class=\"number\">8899</span>);</div><div class=\"line\">\t\t<span class=\"comment\">// 从socket中获取输入输出流</span></div><div class=\"line\">\t\tInputStream inputStream = socket.getInputStream();</div><div class=\"line\">\t\tOutputStream outputStream = socket.getOutputStream();</div><div class=\"line\">\t\tPrintWriter pw = <span class=\"keyword\">new</span> PrintWriter(outputStream);</div><div class=\"line\">\t\tpw.println(<span class=\"string\">\"hello\"</span>);</div><div class=\"line\">\t\tpw.flush();</div><div class=\"line\">\t\tBufferedReader br = <span class=\"keyword\">new</span> BufferedReader(<span class=\"keyword\">new</span> InputStreamReader(inputStream));</div><div class=\"line\">\t\tString result = br.readLine();</div><div class=\"line\">\t\tSystem.out.println(result);</div><div class=\"line\">\t\tinputStream.close();</div><div class=\"line\">\t\toutputStream.close();</div><div class=\"line\">\t\tsocket.close();</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div><div class=\"line\">======================</div><div class=\"line\"><span class=\"keyword\">package</span> cn.itcast.bigdata.socket;</div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">GetDataServiceImpl</span> </span>&#123;</div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">getData</span><span class=\"params\">(String param)</span></span>&#123;</div><div class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"string\">\"ok-\"</span>+param;</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div><div class=\"line\">=======================</div><div class=\"line\"><span class=\"keyword\">package</span> cn.itcast.bigdata.socket;</div><div class=\"line\"><span class=\"keyword\">import</span> java.io.BufferedReader;</div><div class=\"line\"><span class=\"keyword\">import</span> java.io.IOException;</div><div class=\"line\"><span class=\"keyword\">import</span> java.io.InputStream;</div><div class=\"line\"><span class=\"keyword\">import</span> java.io.InputStreamReader;</div><div class=\"line\"><span class=\"keyword\">import</span> java.io.OutputStream;</div><div class=\"line\"><span class=\"keyword\">import</span> java.io.PrintWriter;</div><div class=\"line\"><span class=\"keyword\">import</span> java.net.Socket;</div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ServiceServerTask</span> <span class=\"keyword\">implements</span> <span class=\"title\">Runnable</span></span>&#123;</div><div class=\"line\">\tSocket socket ;</div><div class=\"line\">\tInputStream in=<span class=\"keyword\">null</span>;</div><div class=\"line\">\tOutputStream out = <span class=\"keyword\">null</span>;</div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">ServiceServerTask</span><span class=\"params\">(Socket socket)</span> </span>&#123;</div><div class=\"line\">\t\t<span class=\"keyword\">this</span>.socket = socket;</div><div class=\"line\">\t&#125;</div><div class=\"line\">\t<span class=\"comment\">//业务逻辑：跟客户端进行数据交互</span></div><div class=\"line\">\t<span class=\"meta\">@Override</span></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">\t\t <span class=\"keyword\">try</span> &#123;</div><div class=\"line\">\t\t\t<span class=\"comment\">//从socket连接中获取到与client之间的网络通信输入输出流 </span></div><div class=\"line\">\t\t\tin = socket.getInputStream();</div><div class=\"line\">\t\t\tout = socket.getOutputStream();</div><div class=\"line\">\t\t\tBufferedReader br = <span class=\"keyword\">new</span> BufferedReader(<span class=\"keyword\">new</span> InputStreamReader(in));</div><div class=\"line\">\t\t\t<span class=\"comment\">//从网络通信输入流中读取客户端发送过来的数据</span></div><div class=\"line\">\t\t\t<span class=\"comment\">//注意：socketinputstream的读数据的方法都是阻塞的 </span></div><div class=\"line\">\t\t\tString param = br.readLine();</div><div class=\"line\">\t\t\t<span class=\"comment\">/**</span></div><div class=\"line\"><span class=\"comment\">\t\t\t * 作业：</span></div><div class=\"line\"><span class=\"comment\">\t\t\t * 将以下业务调用逻辑写成更加通用的：可以根据客户端发过来的调用类名、调用方法名、调用该参数来灵活调用</span></div><div class=\"line\"><span class=\"comment\">\t\t\t * </span></div><div class=\"line\"><span class=\"comment\">\t\t\t * 《反射》</span></div><div class=\"line\"><span class=\"comment\">\t\t\t * </span></div><div class=\"line\"><span class=\"comment\">\t\t\t */</span></div><div class=\"line\">\t\t\tGetDataServiceImpl getDataServiceImpl = <span class=\"keyword\">new</span> GetDataServiceImpl();</div><div class=\"line\">\t\t\tString result = getDataServiceImpl.getData(param);</div><div class=\"line\">\t\t\t<span class=\"comment\">//将调用结果写到sokect的输出流中，以发送给客户端</span></div><div class=\"line\">\t\t\tPrintWriter pw = <span class=\"keyword\">new</span> PrintWriter(out);</div><div class=\"line\">\t\t\tpw.println(result);</div><div class=\"line\">\t\t\tpw.flush();</div><div class=\"line\">\t\t&#125; <span class=\"keyword\">catch</span> (IOException e) &#123;</div><div class=\"line\">\t\t\te.printStackTrace();</div><div class=\"line\">\t\t&#125;<span class=\"keyword\">finally</span>&#123;</div><div class=\"line\">\t\t\t<span class=\"keyword\">try</span> &#123;</div><div class=\"line\">\t\t\t\tin.close();</div><div class=\"line\">\t\t\t\tout.close();</div><div class=\"line\">\t\t\t\tsocket.close();</div><div class=\"line\">\t\t\t&#125; <span class=\"keyword\">catch</span> (IOException e) &#123;</div><div class=\"line\">\t\t\t\te.printStackTrace();</div><div class=\"line\">\t\t\t&#125;</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>"},{"title":"大数据0406-javaJVM技术","toc":true,"date":"2017-12-05T14:44:14.000Z","scaffolds":null,"_content":"\n# 监控工具的使用\n## jconsole\n\n可以分析jvm的内存使用情况和线程等信息。\n## 启动方式\n`JDK/bin` 目录下 `jconsole.exe`将自动搜索出本机运行的所有JVM进程，不需要用户使用jps来查询了，双击其中一个进程即可开始监控。也可以“远程连接服务器，进行远程虚拟机的监控。”\n\n![2017125231152](http://ovasdkxqr.bkt.clouddn.com/image/blog/2017125231152.png)\n\n![2017125231222](http://ovasdkxqr.bkt.clouddn.com/image/blog/2017125231222.png)\n\n##  jvisualvm\n提供了和jconsole的功能类似，提供了一大堆的插件。  \n插件中，Visual GC（可视化GC）还是比较好用的，可视化GC可以看到内存的具体使用情况。\n# java内存模型\n##  内存模型图解\nJava虚拟机在执行Java程序的过程中，会把它所管理的内存划分为若干个不同的数据区。这些区域有各自的用途，以及创建和销毁的时间，有的区域随着虚拟机进程的启动而存在，有的区域则依赖用户线程的启动和结束而建立和销毁，我们可以将这些区域统称为Java运行时数据区域。  \n如下图是一个内存模型的关系图（详情见图：内存划分.png）：\n![2017125231537](http://ovasdkxqr.bkt.clouddn.com/image/blog/2017125231537.png)\n\nJava虚拟机运行时数据区域被分为五个区域：`堆(Heap)、栈(Stack)、本地方法栈(Native Stack)、方法区(Method Area)、程序计数器(Program Count Register)`。\n![2017125232329](http://ovasdkxqr.bkt.clouddn.com/image/blog/2017125232329.png)\n## 堆（Heap）\n对于大多数应用来说，`Java Heap`是Java虚拟机管理的内存的最大一块，这块区域`随着虚拟机的启动而创建`。在实际的运用中，我们创建的`对象`和`数组`就是存放在堆里面。如果你听说线程安全的问题，就会很明确的知道Java Heap是一块`共享的区域`，操作共享区域的成员就有了锁和同步。  \n与Java Heap相关的还有Java的垃圾回收机制（GC）,Java Heap是垃圾回收器管理的主要区域。程序猿所熟悉的`新生代`、`老生代`、`永久代`的概念就是在堆里面，现在大多数的GC基本都采用了`分代收集算法`。如果再细致一点，Java Heap还有`Eden空间`，`From Survivor空间`,`To Survivor空间`等。  \nJava Heap可以处于物理上不连续的内存空间中，只要逻辑上是连续的即可。  \n![2017125233020](http://ovasdkxqr.bkt.clouddn.com/image/blog/2017125233020.png)\n\n## 栈（Stack）\n相对于Java Heap来讲，`Java Stack`是`线程私有`的，她的`生命周期与线程相同`。Java Stack描述的是Java方法执行时的内存模型，`每个方法执行时都会创建一个栈帧`（Stack Frame）用语存储局部变量表、操作数栈、动态链接、方法出口等信息。从下图从可以看到，每个线程在执行一个方法时，都意味着有一个栈帧在当前线程对应的栈帧中入栈和出栈。  \n![2017125233212](http://ovasdkxqr.bkt.clouddn.com/image/blog/2017125233212.png)\n\n图中可以看到每一个栈帧中都有局部变量表。局部变量表存放了编译期间的各种基本数据类型，对象引用等信息。\n\n##  本地方法栈（Native Stack）\n本地方法栈（Native Stack）与Java虚拟机站（Java Stack）所发挥的作用非常相似，他们之间的区别在于虚拟机栈为虚拟机栈执行java方法（也就是字节码）服务，而本地方法栈则为使用到Native方法服务。\n##  方法区（Method Area）\n方法区（Method Area）与堆（Java Heap）一样，是`各个线程共享的内存区域`，它用于存储虚拟机加载的`类信息`，`常量`，`静态变量`，`即时编译器编译后的代码`等数据。虽然Java虚拟机规范把方法区描述为堆的一个逻辑部分，但是她却有一个别名叫做非堆（Non-Heap）。分析下Java虚拟机规范，之所以把方法区描述为堆的一个逻辑部分，应该觉得她们都是存储数据的角度出发的。一个存储对象数据（堆），一个存储静态信息(方法区)。\n##  总结\n###  线程私有的数据区域有：\nJava虚拟机栈（Java Stack）  \n本地方法栈（Native Stack）  \n###  线程共有的数据区域有：\n堆（Java Heap）  \n方法区  \n# JVM参数列表\njava -Xmx3550m -Xms3550m -Xmn2g -Xss128k -XX:NewRatio=4 -XX:SurvivorRatio=4 -XX:MaxPermSize=16m  -XX:MaxTenuringThreshold=0\n`-Xmx3550m`：最大堆内存为3550M。  \n`-Xms3550m`：初始堆内存为3550m。  \n此值可以设置与-Xmx相同，以避免每次垃圾回收完成后JVM重新分配内存。  \n`-Xmn2g`：设置年轻代大小为2G。  \n整个堆大小=年轻代大小 + 年老代大小 + 持久代大小。持久代一般固定大小为64m，所以增大年轻代后，将会减小年老代大小。此值对系统性能影响较大，Sun官方推荐配置为整个堆的3/8。  \n`-Xss128k`：设置每个线程的堆栈大小。  \nJDK5.0以后每个线程堆栈大小为1M，在相同物理内存下，减小这个值能生成更多的线程。但是操作系统对一个进程内的线程数还是有限制的，不能无限生成，经验值在 3000~5000左右。   \n`-XX:NewRatio=4`:设置年轻代（包括Eden和两个Survivor区）与年老代的比值（除去持久代）。设置为4，则年轻代与年老代所占比值为1：4，年轻代占整个堆栈的1/5  \n`-XX:SurvivorRatio=4`：设置年轻代中Eden区与Survivor区的大小比值。  \n设置为4，则两个Survivor区与一个Eden区的比值为2:4，一个Survivor区占整个年轻代的1/6  \n`-XX:MaxPermSize=16m`:设置持久代大小为16m。  \n`-XX:MaxTenuringThreshold=0`：设置垃圾最大年龄。  \n如果设置为0的话，则年轻代对象不经过Survivor区，直 接进入年老代。对于年老代比较多的应用，可以提高效率。如果将此值设置为一个较大值，则年轻代对象会在Survivor区进行多次复制，这样可以增加对象 再年轻代的存活时间，增加在年轻代即被回收的概论。  \n\n收集器设置  \n-XX:+UseSerialGC:设置串行收集器  \n-XX:+UseParallelGC:设置并行收集器  \n-XX:+UseParalledlOldGC:设置并行年老代收集器  \n-XX:+UseConcMarkSweepGC:设置并发收集器  \n垃圾回收统计信息  \n-XX:+PrintGC  \n-XX:+PrintGCDetails  \n-XX:+PrintGCTimeStamps  \n-Xloggc:filename  \n并行收集器设置  \n-XX:ParallelGCThreads=n:设置并行收集器收集时使用的CPU数。并行收集线程数。  \n-XX:MaxGCPauseMillis=n:设置并行收集最大暂停时间  \n-XX:GCTimeRatio=n:设置垃圾回收时间占程序运行时间的百分比。公式为1/(1+n)  \n并发收集器设置  \n-XX:+CMSIncrementalMode:设置为增量模式。适用于单CPU情况。  \n-XX:ParallelGCThreads=n:设置并发收集器年轻代收集方式为并行收集时，使用的CPU数。并行收集线程数。  \n\n#  jvm案例演示\n## 内存\nJconsole的内存标签相当于可视化的jstat命令，用于监视收集器管理的虚拟机内存（java堆和永久代）的变化趋势。  \n我们通过下面的一段代码体验一下它的监视功能。运行时设置的虚拟机参数为：-Xms100m -Xmx100m -XX:+UseSerialGC，这段代码的作用是以64kb/50毫秒的速度往java堆内存中填充数据。  \n```java\npublic class TestMemory {\n\tstatic class OOMObject {\n\t\tpublic byte[] placeholder = new byte[64 * 1024];\n\t}\n\n\tpublic static void fillHeap(int num) throws Exception {\n\t\tArrayList<OOMObject> list = new ArrayList<OOMObject>();\n\t\tfor (int i = 0; i < num; i++) {\n\t\t\tThread.sleep(50);\n\t\t\tlist.add(new OOMObject());\n\t\t}\n\t\tSystem.gc();\n\t}\n\n\tpublic static void main(String[] args) throws Exception {\n\t\tfillHeap(1000);\n\t\tThread.sleep(500000);\n\t}\n}\n```\n![2017125234140](http://ovasdkxqr.bkt.clouddn.com/image/blog/2017125234140.png)\n\n从图中可以看出，运行轨迹成曲线增长，循环1000次后，虽然整个新生代Eden和Survivor区都基本上被清空了，但是老年代仍然保持峰值状态，这说明，填充的数据在GC后仍然存活，因为list的作用域没有结束。如果把System.gc();移到fillHeap(1000);后，就可以全部回收掉。\n\n## 线程\njconsole线程标签相当于可视化了jstack命令，遇到线程停顿时，可以使用这个也签进行监控分析。线程长时间停顿的主要原因有：等待外部资源（数据库连接等），死循环、锁等待。下面的代码将演示这几种情况：\n```java\npackage cn.java.jvm;\n\nimport java.io.BufferedReader;\nimport java.io.IOException;\nimport java.io.InputStreamReader;\n\npublic class TestThread {\n\t/**\n\t * 死循环演示\n\t * \n\t * @param args\n\t */\n\tpublic static void createBusyThread() {\n\t\tThread thread = new Thread(new Runnable() {\n\t\t\t@Override\n\t\t\tpublic void run() {\n\t\t\t\tSystem.out.println(\"createBusyThread\");\n\t\t\t\twhile (true)\n\t\t\t\t\t;\n\t\t\t}\n\t\t}, \"testBusyThread\");\n\t\tthread.start();\n\t}\n\n\t/**\n\t * 线程锁等待\n\t * \n\t * @param args\n\t */\n\tpublic static void createLockThread(final Object lock) {\n\t\tThread thread = new Thread(new Runnable() {\n\t\t\t@Override\n\t\t\tpublic void run() {\n\t\t\t\tSystem.out.println(\"createLockThread\");\n\t\t\t\tsynchronized (lock) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tlock.wait();\n\t\t\t\t\t} catch (InterruptedException e) {\n\t\t\t\t\t\te.printStackTrace();\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t}\n\t\t}, \"testLockThread\");\n\t\tthread.start();\n\t}\n\n\tpublic static void main(String[] args) throws Exception {\n\t\tBufferedReader br = new BufferedReader(new InputStreamReader(System.in));\n\t\tbr.readLine();\n\t\tcreateBusyThread();\n\t\tbr.readLine();\n\t\tObject object = new Object();\n\t\tcreateLockThread(object);\n\t}\n}\n```\nmain线程：追踪到需要键盘录入  \ntestBusyThread线程：线程阻塞在18行的while（true），直到线程切换，很耗性能  \ntestLockThread线程：出于waitting状态，等待notify  \n\n死锁：\n```java\npackage cn.java.jvm;\n\npublic class TestDeadThread implements Runnable {\n\tint a, b;\n\n\tpublic TestDeadThread(int a, int b) {\n\t\tthis.a = a;\n\t\tthis.b = b;\n\t}\n\n\t@Override\n\tpublic void run() {\n\t\tSystem.out.println(\"createDeadThread\");\n\t\tsynchronized (Integer.valueOf(a)) {\n\t\t\tsynchronized (Integer.valueOf(b)) {\n\t\t\t\tSystem.out.println(a + b);\n\t\t\t}\n\t\t}\n\t}\n\n\tpublic static void main(String[] args) {\n\t\tfor (int i = 0; i < 100; i++) {\n\t\t\tnew Thread(new TestDeadThread(1, 2)).start();\n\t\t\tnew Thread(new TestDeadThread(2, 1)).start();\n\t\t}\n\t}\n}\n\n\n```\n点击检查死锁，会出现死锁的详情。\n\n![2017125234810](http://ovasdkxqr.bkt.clouddn.com/image/blog/2017125234810.png)\n\n![2017125234928](http://ovasdkxqr.bkt.clouddn.com/image/blog/2017125234928.png)\n\nthread-5的锁被thread-10持有，相反亦是，造成死锁。\n","source":"_posts/大数据/大数据0406-javaJVM技术.md","raw":"---\ntitle: 大数据0406-javaJVM技术\ncategories: 学习\ntags:\n  - 大数据\n  - java\n  - JVM\ntoc: true\ndate: 2017-12-05 22:44:14\nscaffolds:\n---\n\n# 监控工具的使用\n## jconsole\n\n可以分析jvm的内存使用情况和线程等信息。\n## 启动方式\n`JDK/bin` 目录下 `jconsole.exe`将自动搜索出本机运行的所有JVM进程，不需要用户使用jps来查询了，双击其中一个进程即可开始监控。也可以“远程连接服务器，进行远程虚拟机的监控。”\n\n![2017125231152](http://ovasdkxqr.bkt.clouddn.com/image/blog/2017125231152.png)\n\n![2017125231222](http://ovasdkxqr.bkt.clouddn.com/image/blog/2017125231222.png)\n\n##  jvisualvm\n提供了和jconsole的功能类似，提供了一大堆的插件。  \n插件中，Visual GC（可视化GC）还是比较好用的，可视化GC可以看到内存的具体使用情况。\n# java内存模型\n##  内存模型图解\nJava虚拟机在执行Java程序的过程中，会把它所管理的内存划分为若干个不同的数据区。这些区域有各自的用途，以及创建和销毁的时间，有的区域随着虚拟机进程的启动而存在，有的区域则依赖用户线程的启动和结束而建立和销毁，我们可以将这些区域统称为Java运行时数据区域。  \n如下图是一个内存模型的关系图（详情见图：内存划分.png）：\n![2017125231537](http://ovasdkxqr.bkt.clouddn.com/image/blog/2017125231537.png)\n\nJava虚拟机运行时数据区域被分为五个区域：`堆(Heap)、栈(Stack)、本地方法栈(Native Stack)、方法区(Method Area)、程序计数器(Program Count Register)`。\n![2017125232329](http://ovasdkxqr.bkt.clouddn.com/image/blog/2017125232329.png)\n## 堆（Heap）\n对于大多数应用来说，`Java Heap`是Java虚拟机管理的内存的最大一块，这块区域`随着虚拟机的启动而创建`。在实际的运用中，我们创建的`对象`和`数组`就是存放在堆里面。如果你听说线程安全的问题，就会很明确的知道Java Heap是一块`共享的区域`，操作共享区域的成员就有了锁和同步。  \n与Java Heap相关的还有Java的垃圾回收机制（GC）,Java Heap是垃圾回收器管理的主要区域。程序猿所熟悉的`新生代`、`老生代`、`永久代`的概念就是在堆里面，现在大多数的GC基本都采用了`分代收集算法`。如果再细致一点，Java Heap还有`Eden空间`，`From Survivor空间`,`To Survivor空间`等。  \nJava Heap可以处于物理上不连续的内存空间中，只要逻辑上是连续的即可。  \n![2017125233020](http://ovasdkxqr.bkt.clouddn.com/image/blog/2017125233020.png)\n\n## 栈（Stack）\n相对于Java Heap来讲，`Java Stack`是`线程私有`的，她的`生命周期与线程相同`。Java Stack描述的是Java方法执行时的内存模型，`每个方法执行时都会创建一个栈帧`（Stack Frame）用语存储局部变量表、操作数栈、动态链接、方法出口等信息。从下图从可以看到，每个线程在执行一个方法时，都意味着有一个栈帧在当前线程对应的栈帧中入栈和出栈。  \n![2017125233212](http://ovasdkxqr.bkt.clouddn.com/image/blog/2017125233212.png)\n\n图中可以看到每一个栈帧中都有局部变量表。局部变量表存放了编译期间的各种基本数据类型，对象引用等信息。\n\n##  本地方法栈（Native Stack）\n本地方法栈（Native Stack）与Java虚拟机站（Java Stack）所发挥的作用非常相似，他们之间的区别在于虚拟机栈为虚拟机栈执行java方法（也就是字节码）服务，而本地方法栈则为使用到Native方法服务。\n##  方法区（Method Area）\n方法区（Method Area）与堆（Java Heap）一样，是`各个线程共享的内存区域`，它用于存储虚拟机加载的`类信息`，`常量`，`静态变量`，`即时编译器编译后的代码`等数据。虽然Java虚拟机规范把方法区描述为堆的一个逻辑部分，但是她却有一个别名叫做非堆（Non-Heap）。分析下Java虚拟机规范，之所以把方法区描述为堆的一个逻辑部分，应该觉得她们都是存储数据的角度出发的。一个存储对象数据（堆），一个存储静态信息(方法区)。\n##  总结\n###  线程私有的数据区域有：\nJava虚拟机栈（Java Stack）  \n本地方法栈（Native Stack）  \n###  线程共有的数据区域有：\n堆（Java Heap）  \n方法区  \n# JVM参数列表\njava -Xmx3550m -Xms3550m -Xmn2g -Xss128k -XX:NewRatio=4 -XX:SurvivorRatio=4 -XX:MaxPermSize=16m  -XX:MaxTenuringThreshold=0\n`-Xmx3550m`：最大堆内存为3550M。  \n`-Xms3550m`：初始堆内存为3550m。  \n此值可以设置与-Xmx相同，以避免每次垃圾回收完成后JVM重新分配内存。  \n`-Xmn2g`：设置年轻代大小为2G。  \n整个堆大小=年轻代大小 + 年老代大小 + 持久代大小。持久代一般固定大小为64m，所以增大年轻代后，将会减小年老代大小。此值对系统性能影响较大，Sun官方推荐配置为整个堆的3/8。  \n`-Xss128k`：设置每个线程的堆栈大小。  \nJDK5.0以后每个线程堆栈大小为1M，在相同物理内存下，减小这个值能生成更多的线程。但是操作系统对一个进程内的线程数还是有限制的，不能无限生成，经验值在 3000~5000左右。   \n`-XX:NewRatio=4`:设置年轻代（包括Eden和两个Survivor区）与年老代的比值（除去持久代）。设置为4，则年轻代与年老代所占比值为1：4，年轻代占整个堆栈的1/5  \n`-XX:SurvivorRatio=4`：设置年轻代中Eden区与Survivor区的大小比值。  \n设置为4，则两个Survivor区与一个Eden区的比值为2:4，一个Survivor区占整个年轻代的1/6  \n`-XX:MaxPermSize=16m`:设置持久代大小为16m。  \n`-XX:MaxTenuringThreshold=0`：设置垃圾最大年龄。  \n如果设置为0的话，则年轻代对象不经过Survivor区，直 接进入年老代。对于年老代比较多的应用，可以提高效率。如果将此值设置为一个较大值，则年轻代对象会在Survivor区进行多次复制，这样可以增加对象 再年轻代的存活时间，增加在年轻代即被回收的概论。  \n\n收集器设置  \n-XX:+UseSerialGC:设置串行收集器  \n-XX:+UseParallelGC:设置并行收集器  \n-XX:+UseParalledlOldGC:设置并行年老代收集器  \n-XX:+UseConcMarkSweepGC:设置并发收集器  \n垃圾回收统计信息  \n-XX:+PrintGC  \n-XX:+PrintGCDetails  \n-XX:+PrintGCTimeStamps  \n-Xloggc:filename  \n并行收集器设置  \n-XX:ParallelGCThreads=n:设置并行收集器收集时使用的CPU数。并行收集线程数。  \n-XX:MaxGCPauseMillis=n:设置并行收集最大暂停时间  \n-XX:GCTimeRatio=n:设置垃圾回收时间占程序运行时间的百分比。公式为1/(1+n)  \n并发收集器设置  \n-XX:+CMSIncrementalMode:设置为增量模式。适用于单CPU情况。  \n-XX:ParallelGCThreads=n:设置并发收集器年轻代收集方式为并行收集时，使用的CPU数。并行收集线程数。  \n\n#  jvm案例演示\n## 内存\nJconsole的内存标签相当于可视化的jstat命令，用于监视收集器管理的虚拟机内存（java堆和永久代）的变化趋势。  \n我们通过下面的一段代码体验一下它的监视功能。运行时设置的虚拟机参数为：-Xms100m -Xmx100m -XX:+UseSerialGC，这段代码的作用是以64kb/50毫秒的速度往java堆内存中填充数据。  \n```java\npublic class TestMemory {\n\tstatic class OOMObject {\n\t\tpublic byte[] placeholder = new byte[64 * 1024];\n\t}\n\n\tpublic static void fillHeap(int num) throws Exception {\n\t\tArrayList<OOMObject> list = new ArrayList<OOMObject>();\n\t\tfor (int i = 0; i < num; i++) {\n\t\t\tThread.sleep(50);\n\t\t\tlist.add(new OOMObject());\n\t\t}\n\t\tSystem.gc();\n\t}\n\n\tpublic static void main(String[] args) throws Exception {\n\t\tfillHeap(1000);\n\t\tThread.sleep(500000);\n\t}\n}\n```\n![2017125234140](http://ovasdkxqr.bkt.clouddn.com/image/blog/2017125234140.png)\n\n从图中可以看出，运行轨迹成曲线增长，循环1000次后，虽然整个新生代Eden和Survivor区都基本上被清空了，但是老年代仍然保持峰值状态，这说明，填充的数据在GC后仍然存活，因为list的作用域没有结束。如果把System.gc();移到fillHeap(1000);后，就可以全部回收掉。\n\n## 线程\njconsole线程标签相当于可视化了jstack命令，遇到线程停顿时，可以使用这个也签进行监控分析。线程长时间停顿的主要原因有：等待外部资源（数据库连接等），死循环、锁等待。下面的代码将演示这几种情况：\n```java\npackage cn.java.jvm;\n\nimport java.io.BufferedReader;\nimport java.io.IOException;\nimport java.io.InputStreamReader;\n\npublic class TestThread {\n\t/**\n\t * 死循环演示\n\t * \n\t * @param args\n\t */\n\tpublic static void createBusyThread() {\n\t\tThread thread = new Thread(new Runnable() {\n\t\t\t@Override\n\t\t\tpublic void run() {\n\t\t\t\tSystem.out.println(\"createBusyThread\");\n\t\t\t\twhile (true)\n\t\t\t\t\t;\n\t\t\t}\n\t\t}, \"testBusyThread\");\n\t\tthread.start();\n\t}\n\n\t/**\n\t * 线程锁等待\n\t * \n\t * @param args\n\t */\n\tpublic static void createLockThread(final Object lock) {\n\t\tThread thread = new Thread(new Runnable() {\n\t\t\t@Override\n\t\t\tpublic void run() {\n\t\t\t\tSystem.out.println(\"createLockThread\");\n\t\t\t\tsynchronized (lock) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tlock.wait();\n\t\t\t\t\t} catch (InterruptedException e) {\n\t\t\t\t\t\te.printStackTrace();\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t}\n\t\t}, \"testLockThread\");\n\t\tthread.start();\n\t}\n\n\tpublic static void main(String[] args) throws Exception {\n\t\tBufferedReader br = new BufferedReader(new InputStreamReader(System.in));\n\t\tbr.readLine();\n\t\tcreateBusyThread();\n\t\tbr.readLine();\n\t\tObject object = new Object();\n\t\tcreateLockThread(object);\n\t}\n}\n```\nmain线程：追踪到需要键盘录入  \ntestBusyThread线程：线程阻塞在18行的while（true），直到线程切换，很耗性能  \ntestLockThread线程：出于waitting状态，等待notify  \n\n死锁：\n```java\npackage cn.java.jvm;\n\npublic class TestDeadThread implements Runnable {\n\tint a, b;\n\n\tpublic TestDeadThread(int a, int b) {\n\t\tthis.a = a;\n\t\tthis.b = b;\n\t}\n\n\t@Override\n\tpublic void run() {\n\t\tSystem.out.println(\"createDeadThread\");\n\t\tsynchronized (Integer.valueOf(a)) {\n\t\t\tsynchronized (Integer.valueOf(b)) {\n\t\t\t\tSystem.out.println(a + b);\n\t\t\t}\n\t\t}\n\t}\n\n\tpublic static void main(String[] args) {\n\t\tfor (int i = 0; i < 100; i++) {\n\t\t\tnew Thread(new TestDeadThread(1, 2)).start();\n\t\t\tnew Thread(new TestDeadThread(2, 1)).start();\n\t\t}\n\t}\n}\n\n\n```\n点击检查死锁，会出现死锁的详情。\n\n![2017125234810](http://ovasdkxqr.bkt.clouddn.com/image/blog/2017125234810.png)\n\n![2017125234928](http://ovasdkxqr.bkt.clouddn.com/image/blog/2017125234928.png)\n\nthread-5的锁被thread-10持有，相反亦是，造成死锁。\n","slug":"大数据/大数据0406-javaJVM技术","published":1,"updated":"2017-12-05T15:50:19.436Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjcsq4ljq003ux4vf9f9cxf0t","content":"<h1 id=\"监控工具的使用\"><a href=\"#监控工具的使用\" class=\"headerlink\" title=\"监控工具的使用\"></a>监控工具的使用</h1><h2 id=\"jconsole\"><a href=\"#jconsole\" class=\"headerlink\" title=\"jconsole\"></a>jconsole</h2><p>可以分析jvm的内存使用情况和线程等信息。</p>\n<h2 id=\"启动方式\"><a href=\"#启动方式\" class=\"headerlink\" title=\"启动方式\"></a>启动方式</h2><p><code>JDK/bin</code> 目录下 <code>jconsole.exe</code>将自动搜索出本机运行的所有JVM进程，不需要用户使用jps来查询了，双击其中一个进程即可开始监控。也可以“远程连接服务器，进行远程虚拟机的监控。”</p>\n<p><img src=\"http://ovasdkxqr.bkt.clouddn.com/image/blog/2017125231152.png\" alt=\"2017125231152\"></p>\n<p><img src=\"http://ovasdkxqr.bkt.clouddn.com/image/blog/2017125231222.png\" alt=\"2017125231222\"></p>\n<h2 id=\"jvisualvm\"><a href=\"#jvisualvm\" class=\"headerlink\" title=\"jvisualvm\"></a>jvisualvm</h2><p>提供了和jconsole的功能类似，提供了一大堆的插件。<br>插件中，Visual GC（可视化GC）还是比较好用的，可视化GC可以看到内存的具体使用情况。</p>\n<h1 id=\"java内存模型\"><a href=\"#java内存模型\" class=\"headerlink\" title=\"java内存模型\"></a>java内存模型</h1><h2 id=\"内存模型图解\"><a href=\"#内存模型图解\" class=\"headerlink\" title=\"内存模型图解\"></a>内存模型图解</h2><p>Java虚拟机在执行Java程序的过程中，会把它所管理的内存划分为若干个不同的数据区。这些区域有各自的用途，以及创建和销毁的时间，有的区域随着虚拟机进程的启动而存在，有的区域则依赖用户线程的启动和结束而建立和销毁，我们可以将这些区域统称为Java运行时数据区域。<br>如下图是一个内存模型的关系图（详情见图：内存划分.png）：<br><img src=\"http://ovasdkxqr.bkt.clouddn.com/image/blog/2017125231537.png\" alt=\"2017125231537\"></p>\n<p>Java虚拟机运行时数据区域被分为五个区域：<code>堆(Heap)、栈(Stack)、本地方法栈(Native Stack)、方法区(Method Area)、程序计数器(Program Count Register)</code>。<br><img src=\"http://ovasdkxqr.bkt.clouddn.com/image/blog/2017125232329.png\" alt=\"2017125232329\"></p>\n<h2 id=\"堆（Heap）\"><a href=\"#堆（Heap）\" class=\"headerlink\" title=\"堆（Heap）\"></a>堆（Heap）</h2><p>对于大多数应用来说，<code>Java Heap</code>是Java虚拟机管理的内存的最大一块，这块区域<code>随着虚拟机的启动而创建</code>。在实际的运用中，我们创建的<code>对象</code>和<code>数组</code>就是存放在堆里面。如果你听说线程安全的问题，就会很明确的知道Java Heap是一块<code>共享的区域</code>，操作共享区域的成员就有了锁和同步。<br>与Java Heap相关的还有Java的垃圾回收机制（GC）,Java Heap是垃圾回收器管理的主要区域。程序猿所熟悉的<code>新生代</code>、<code>老生代</code>、<code>永久代</code>的概念就是在堆里面，现在大多数的GC基本都采用了<code>分代收集算法</code>。如果再细致一点，Java Heap还有<code>Eden空间</code>，<code>From Survivor空间</code>,<code>To Survivor空间</code>等。<br>Java Heap可以处于物理上不连续的内存空间中，只要逻辑上是连续的即可。<br><img src=\"http://ovasdkxqr.bkt.clouddn.com/image/blog/2017125233020.png\" alt=\"2017125233020\"></p>\n<h2 id=\"栈（Stack）\"><a href=\"#栈（Stack）\" class=\"headerlink\" title=\"栈（Stack）\"></a>栈（Stack）</h2><p>相对于Java Heap来讲，<code>Java Stack</code>是<code>线程私有</code>的，她的<code>生命周期与线程相同</code>。Java Stack描述的是Java方法执行时的内存模型，<code>每个方法执行时都会创建一个栈帧</code>（Stack Frame）用语存储局部变量表、操作数栈、动态链接、方法出口等信息。从下图从可以看到，每个线程在执行一个方法时，都意味着有一个栈帧在当前线程对应的栈帧中入栈和出栈。<br><img src=\"http://ovasdkxqr.bkt.clouddn.com/image/blog/2017125233212.png\" alt=\"2017125233212\"></p>\n<p>图中可以看到每一个栈帧中都有局部变量表。局部变量表存放了编译期间的各种基本数据类型，对象引用等信息。</p>\n<h2 id=\"本地方法栈（Native-Stack）\"><a href=\"#本地方法栈（Native-Stack）\" class=\"headerlink\" title=\"本地方法栈（Native Stack）\"></a>本地方法栈（Native Stack）</h2><p>本地方法栈（Native Stack）与Java虚拟机站（Java Stack）所发挥的作用非常相似，他们之间的区别在于虚拟机栈为虚拟机栈执行java方法（也就是字节码）服务，而本地方法栈则为使用到Native方法服务。</p>\n<h2 id=\"方法区（Method-Area）\"><a href=\"#方法区（Method-Area）\" class=\"headerlink\" title=\"方法区（Method Area）\"></a>方法区（Method Area）</h2><p>方法区（Method Area）与堆（Java Heap）一样，是<code>各个线程共享的内存区域</code>，它用于存储虚拟机加载的<code>类信息</code>，<code>常量</code>，<code>静态变量</code>，<code>即时编译器编译后的代码</code>等数据。虽然Java虚拟机规范把方法区描述为堆的一个逻辑部分，但是她却有一个别名叫做非堆（Non-Heap）。分析下Java虚拟机规范，之所以把方法区描述为堆的一个逻辑部分，应该觉得她们都是存储数据的角度出发的。一个存储对象数据（堆），一个存储静态信息(方法区)。</p>\n<h2 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h2><h3 id=\"线程私有的数据区域有：\"><a href=\"#线程私有的数据区域有：\" class=\"headerlink\" title=\"线程私有的数据区域有：\"></a>线程私有的数据区域有：</h3><p>Java虚拟机栈（Java Stack）<br>本地方法栈（Native Stack）  </p>\n<h3 id=\"线程共有的数据区域有：\"><a href=\"#线程共有的数据区域有：\" class=\"headerlink\" title=\"线程共有的数据区域有：\"></a>线程共有的数据区域有：</h3><p>堆（Java Heap）<br>方法区  </p>\n<h1 id=\"JVM参数列表\"><a href=\"#JVM参数列表\" class=\"headerlink\" title=\"JVM参数列表\"></a>JVM参数列表</h1><p>java -Xmx3550m -Xms3550m -Xmn2g -Xss128k -XX:NewRatio=4 -XX:SurvivorRatio=4 -XX:MaxPermSize=16m  -XX:MaxTenuringThreshold=0<br><code>-Xmx3550m</code>：最大堆内存为3550M。<br><code>-Xms3550m</code>：初始堆内存为3550m。<br>此值可以设置与-Xmx相同，以避免每次垃圾回收完成后JVM重新分配内存。<br><code>-Xmn2g</code>：设置年轻代大小为2G。<br>整个堆大小=年轻代大小 + 年老代大小 + 持久代大小。持久代一般固定大小为64m，所以增大年轻代后，将会减小年老代大小。此值对系统性能影响较大，Sun官方推荐配置为整个堆的3/8。<br><code>-Xss128k</code>：设置每个线程的堆栈大小。<br>JDK5.0以后每个线程堆栈大小为1M，在相同物理内存下，减小这个值能生成更多的线程。但是操作系统对一个进程内的线程数还是有限制的，不能无限生成，经验值在 3000~5000左右。<br><code>-XX:NewRatio=4</code>:设置年轻代（包括Eden和两个Survivor区）与年老代的比值（除去持久代）。设置为4，则年轻代与年老代所占比值为1：4，年轻代占整个堆栈的1/5<br><code>-XX:SurvivorRatio=4</code>：设置年轻代中Eden区与Survivor区的大小比值。<br>设置为4，则两个Survivor区与一个Eden区的比值为2:4，一个Survivor区占整个年轻代的1/6<br><code>-XX:MaxPermSize=16m</code>:设置持久代大小为16m。<br><code>-XX:MaxTenuringThreshold=0</code>：设置垃圾最大年龄。<br>如果设置为0的话，则年轻代对象不经过Survivor区，直 接进入年老代。对于年老代比较多的应用，可以提高效率。如果将此值设置为一个较大值，则年轻代对象会在Survivor区进行多次复制，这样可以增加对象 再年轻代的存活时间，增加在年轻代即被回收的概论。  </p>\n<p>收集器设置<br>-XX:+UseSerialGC:设置串行收集器<br>-XX:+UseParallelGC:设置并行收集器<br>-XX:+UseParalledlOldGC:设置并行年老代收集器<br>-XX:+UseConcMarkSweepGC:设置并发收集器<br>垃圾回收统计信息<br>-XX:+PrintGC<br>-XX:+PrintGCDetails<br>-XX:+PrintGCTimeStamps<br>-Xloggc:filename<br>并行收集器设置<br>-XX:ParallelGCThreads=n:设置并行收集器收集时使用的CPU数。并行收集线程数。<br>-XX:MaxGCPauseMillis=n:设置并行收集最大暂停时间<br>-XX:GCTimeRatio=n:设置垃圾回收时间占程序运行时间的百分比。公式为1/(1+n)<br>并发收集器设置<br>-XX:+CMSIncrementalMode:设置为增量模式。适用于单CPU情况。<br>-XX:ParallelGCThreads=n:设置并发收集器年轻代收集方式为并行收集时，使用的CPU数。并行收集线程数。  </p>\n<h1 id=\"jvm案例演示\"><a href=\"#jvm案例演示\" class=\"headerlink\" title=\"jvm案例演示\"></a>jvm案例演示</h1><h2 id=\"内存\"><a href=\"#内存\" class=\"headerlink\" title=\"内存\"></a>内存</h2><p>Jconsole的内存标签相当于可视化的jstat命令，用于监视收集器管理的虚拟机内存（java堆和永久代）的变化趋势。<br>我们通过下面的一段代码体验一下它的监视功能。运行时设置的虚拟机参数为：-Xms100m -Xmx100m -XX:+UseSerialGC，这段代码的作用是以64kb/50毫秒的速度往java堆内存中填充数据。<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">TestMemory</span> </span>&#123;</div><div class=\"line\">\t<span class=\"keyword\">static</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">OOMObject</span> </span>&#123;</div><div class=\"line\">\t\t<span class=\"keyword\">public</span> <span class=\"keyword\">byte</span>[] placeholder = <span class=\"keyword\">new</span> <span class=\"keyword\">byte</span>[<span class=\"number\">64</span> * <span class=\"number\">1024</span>];</div><div class=\"line\">\t&#125;</div><div class=\"line\"></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">fillHeap</span><span class=\"params\">(<span class=\"keyword\">int</span> num)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</div><div class=\"line\">\t\tArrayList&lt;OOMObject&gt; list = <span class=\"keyword\">new</span> ArrayList&lt;OOMObject&gt;();</div><div class=\"line\">\t\t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; num; i++) &#123;</div><div class=\"line\">\t\t\tThread.sleep(<span class=\"number\">50</span>);</div><div class=\"line\">\t\t\tlist.add(<span class=\"keyword\">new</span> OOMObject());</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t\tSystem.gc();</div><div class=\"line\">\t&#125;</div><div class=\"line\"></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</div><div class=\"line\">\t\tfillHeap(<span class=\"number\">1000</span>);</div><div class=\"line\">\t\tThread.sleep(<span class=\"number\">500000</span>);</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p><img src=\"http://ovasdkxqr.bkt.clouddn.com/image/blog/2017125234140.png\" alt=\"2017125234140\"></p>\n<p>从图中可以看出，运行轨迹成曲线增长，循环1000次后，虽然整个新生代Eden和Survivor区都基本上被清空了，但是老年代仍然保持峰值状态，这说明，填充的数据在GC后仍然存活，因为list的作用域没有结束。如果把System.gc();移到fillHeap(1000);后，就可以全部回收掉。</p>\n<h2 id=\"线程\"><a href=\"#线程\" class=\"headerlink\" title=\"线程\"></a>线程</h2><p>jconsole线程标签相当于可视化了jstack命令，遇到线程停顿时，可以使用这个也签进行监控分析。线程长时间停顿的主要原因有：等待外部资源（数据库连接等），死循环、锁等待。下面的代码将演示这几种情况：<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">package</span> cn.java.jvm;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">import</span> java.io.BufferedReader;</div><div class=\"line\"><span class=\"keyword\">import</span> java.io.IOException;</div><div class=\"line\"><span class=\"keyword\">import</span> java.io.InputStreamReader;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">TestThread</span> </span>&#123;</div><div class=\"line\">\t<span class=\"comment\">/**</span></div><div class=\"line\"><span class=\"comment\">\t * 死循环演示</span></div><div class=\"line\"><span class=\"comment\">\t * </span></div><div class=\"line\"><span class=\"comment\">\t * <span class=\"doctag\">@param</span> args</span></div><div class=\"line\"><span class=\"comment\">\t */</span></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">createBusyThread</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">\t\tThread thread = <span class=\"keyword\">new</span> Thread(<span class=\"keyword\">new</span> Runnable() &#123;</div><div class=\"line\">\t\t\t<span class=\"meta\">@Override</span></div><div class=\"line\">\t\t\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">\t\t\t\tSystem.out.println(<span class=\"string\">\"createBusyThread\"</span>);</div><div class=\"line\">\t\t\t\t<span class=\"keyword\">while</span> (<span class=\"keyword\">true</span>)</div><div class=\"line\">\t\t\t\t\t;</div><div class=\"line\">\t\t\t&#125;</div><div class=\"line\">\t\t&#125;, <span class=\"string\">\"testBusyThread\"</span>);</div><div class=\"line\">\t\tthread.start();</div><div class=\"line\">\t&#125;</div><div class=\"line\"></div><div class=\"line\">\t<span class=\"comment\">/**</span></div><div class=\"line\"><span class=\"comment\">\t * 线程锁等待</span></div><div class=\"line\"><span class=\"comment\">\t * </span></div><div class=\"line\"><span class=\"comment\">\t * <span class=\"doctag\">@param</span> args</span></div><div class=\"line\"><span class=\"comment\">\t */</span></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">createLockThread</span><span class=\"params\">(<span class=\"keyword\">final</span> Object lock)</span> </span>&#123;</div><div class=\"line\">\t\tThread thread = <span class=\"keyword\">new</span> Thread(<span class=\"keyword\">new</span> Runnable() &#123;</div><div class=\"line\">\t\t\t<span class=\"meta\">@Override</span></div><div class=\"line\">\t\t\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">\t\t\t\tSystem.out.println(<span class=\"string\">\"createLockThread\"</span>);</div><div class=\"line\">\t\t\t\t<span class=\"keyword\">synchronized</span> (lock) &#123;</div><div class=\"line\">\t\t\t\t\t<span class=\"keyword\">try</span> &#123;</div><div class=\"line\">\t\t\t\t\t\tlock.wait();</div><div class=\"line\">\t\t\t\t\t&#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</div><div class=\"line\">\t\t\t\t\t\te.printStackTrace();</div><div class=\"line\">\t\t\t\t\t&#125;</div><div class=\"line\">\t\t\t\t&#125;</div><div class=\"line\"></div><div class=\"line\">\t\t\t&#125;</div><div class=\"line\">\t\t&#125;, <span class=\"string\">\"testLockThread\"</span>);</div><div class=\"line\">\t\tthread.start();</div><div class=\"line\">\t&#125;</div><div class=\"line\"></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</div><div class=\"line\">\t\tBufferedReader br = <span class=\"keyword\">new</span> BufferedReader(<span class=\"keyword\">new</span> InputStreamReader(System.in));</div><div class=\"line\">\t\tbr.readLine();</div><div class=\"line\">\t\tcreateBusyThread();</div><div class=\"line\">\t\tbr.readLine();</div><div class=\"line\">\t\tObject object = <span class=\"keyword\">new</span> Object();</div><div class=\"line\">\t\tcreateLockThread(object);</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>main线程：追踪到需要键盘录入<br>testBusyThread线程：线程阻塞在18行的while（true），直到线程切换，很耗性能<br>testLockThread线程：出于waitting状态，等待notify  </p>\n<p>死锁：<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">package</span> cn.java.jvm;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">TestDeadThread</span> <span class=\"keyword\">implements</span> <span class=\"title\">Runnable</span> </span>&#123;</div><div class=\"line\">\t<span class=\"keyword\">int</span> a, b;</div><div class=\"line\"></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">TestDeadThread</span><span class=\"params\">(<span class=\"keyword\">int</span> a, <span class=\"keyword\">int</span> b)</span> </span>&#123;</div><div class=\"line\">\t\t<span class=\"keyword\">this</span>.a = a;</div><div class=\"line\">\t\t<span class=\"keyword\">this</span>.b = b;</div><div class=\"line\">\t&#125;</div><div class=\"line\"></div><div class=\"line\">\t<span class=\"meta\">@Override</span></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">\t\tSystem.out.println(<span class=\"string\">\"createDeadThread\"</span>);</div><div class=\"line\">\t\t<span class=\"keyword\">synchronized</span> (Integer.valueOf(a)) &#123;</div><div class=\"line\">\t\t\t<span class=\"keyword\">synchronized</span> (Integer.valueOf(b)) &#123;</div><div class=\"line\">\t\t\t\tSystem.out.println(a + b);</div><div class=\"line\">\t\t\t&#125;</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t&#125;</div><div class=\"line\"></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</div><div class=\"line\">\t\t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">100</span>; i++) &#123;</div><div class=\"line\">\t\t\t<span class=\"keyword\">new</span> Thread(<span class=\"keyword\">new</span> TestDeadThread(<span class=\"number\">1</span>, <span class=\"number\">2</span>)).start();</div><div class=\"line\">\t\t\t<span class=\"keyword\">new</span> Thread(<span class=\"keyword\">new</span> TestDeadThread(<span class=\"number\">2</span>, <span class=\"number\">1</span>)).start();</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>点击检查死锁，会出现死锁的详情。</p>\n<p><img src=\"http://ovasdkxqr.bkt.clouddn.com/image/blog/2017125234810.png\" alt=\"2017125234810\"></p>\n<p><img src=\"http://ovasdkxqr.bkt.clouddn.com/image/blog/2017125234928.png\" alt=\"2017125234928\"></p>\n<p>thread-5的锁被thread-10持有，相反亦是，造成死锁。</p>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"监控工具的使用\"><a href=\"#监控工具的使用\" class=\"headerlink\" title=\"监控工具的使用\"></a>监控工具的使用</h1><h2 id=\"jconsole\"><a href=\"#jconsole\" class=\"headerlink\" title=\"jconsole\"></a>jconsole</h2><p>可以分析jvm的内存使用情况和线程等信息。</p>\n<h2 id=\"启动方式\"><a href=\"#启动方式\" class=\"headerlink\" title=\"启动方式\"></a>启动方式</h2><p><code>JDK/bin</code> 目录下 <code>jconsole.exe</code>将自动搜索出本机运行的所有JVM进程，不需要用户使用jps来查询了，双击其中一个进程即可开始监控。也可以“远程连接服务器，进行远程虚拟机的监控。”</p>\n<p><img src=\"http://ovasdkxqr.bkt.clouddn.com/image/blog/2017125231152.png\" alt=\"2017125231152\"></p>\n<p><img src=\"http://ovasdkxqr.bkt.clouddn.com/image/blog/2017125231222.png\" alt=\"2017125231222\"></p>\n<h2 id=\"jvisualvm\"><a href=\"#jvisualvm\" class=\"headerlink\" title=\"jvisualvm\"></a>jvisualvm</h2><p>提供了和jconsole的功能类似，提供了一大堆的插件。<br>插件中，Visual GC（可视化GC）还是比较好用的，可视化GC可以看到内存的具体使用情况。</p>\n<h1 id=\"java内存模型\"><a href=\"#java内存模型\" class=\"headerlink\" title=\"java内存模型\"></a>java内存模型</h1><h2 id=\"内存模型图解\"><a href=\"#内存模型图解\" class=\"headerlink\" title=\"内存模型图解\"></a>内存模型图解</h2><p>Java虚拟机在执行Java程序的过程中，会把它所管理的内存划分为若干个不同的数据区。这些区域有各自的用途，以及创建和销毁的时间，有的区域随着虚拟机进程的启动而存在，有的区域则依赖用户线程的启动和结束而建立和销毁，我们可以将这些区域统称为Java运行时数据区域。<br>如下图是一个内存模型的关系图（详情见图：内存划分.png）：<br><img src=\"http://ovasdkxqr.bkt.clouddn.com/image/blog/2017125231537.png\" alt=\"2017125231537\"></p>\n<p>Java虚拟机运行时数据区域被分为五个区域：<code>堆(Heap)、栈(Stack)、本地方法栈(Native Stack)、方法区(Method Area)、程序计数器(Program Count Register)</code>。<br><img src=\"http://ovasdkxqr.bkt.clouddn.com/image/blog/2017125232329.png\" alt=\"2017125232329\"></p>\n<h2 id=\"堆（Heap）\"><a href=\"#堆（Heap）\" class=\"headerlink\" title=\"堆（Heap）\"></a>堆（Heap）</h2><p>对于大多数应用来说，<code>Java Heap</code>是Java虚拟机管理的内存的最大一块，这块区域<code>随着虚拟机的启动而创建</code>。在实际的运用中，我们创建的<code>对象</code>和<code>数组</code>就是存放在堆里面。如果你听说线程安全的问题，就会很明确的知道Java Heap是一块<code>共享的区域</code>，操作共享区域的成员就有了锁和同步。<br>与Java Heap相关的还有Java的垃圾回收机制（GC）,Java Heap是垃圾回收器管理的主要区域。程序猿所熟悉的<code>新生代</code>、<code>老生代</code>、<code>永久代</code>的概念就是在堆里面，现在大多数的GC基本都采用了<code>分代收集算法</code>。如果再细致一点，Java Heap还有<code>Eden空间</code>，<code>From Survivor空间</code>,<code>To Survivor空间</code>等。<br>Java Heap可以处于物理上不连续的内存空间中，只要逻辑上是连续的即可。<br><img src=\"http://ovasdkxqr.bkt.clouddn.com/image/blog/2017125233020.png\" alt=\"2017125233020\"></p>\n<h2 id=\"栈（Stack）\"><a href=\"#栈（Stack）\" class=\"headerlink\" title=\"栈（Stack）\"></a>栈（Stack）</h2><p>相对于Java Heap来讲，<code>Java Stack</code>是<code>线程私有</code>的，她的<code>生命周期与线程相同</code>。Java Stack描述的是Java方法执行时的内存模型，<code>每个方法执行时都会创建一个栈帧</code>（Stack Frame）用语存储局部变量表、操作数栈、动态链接、方法出口等信息。从下图从可以看到，每个线程在执行一个方法时，都意味着有一个栈帧在当前线程对应的栈帧中入栈和出栈。<br><img src=\"http://ovasdkxqr.bkt.clouddn.com/image/blog/2017125233212.png\" alt=\"2017125233212\"></p>\n<p>图中可以看到每一个栈帧中都有局部变量表。局部变量表存放了编译期间的各种基本数据类型，对象引用等信息。</p>\n<h2 id=\"本地方法栈（Native-Stack）\"><a href=\"#本地方法栈（Native-Stack）\" class=\"headerlink\" title=\"本地方法栈（Native Stack）\"></a>本地方法栈（Native Stack）</h2><p>本地方法栈（Native Stack）与Java虚拟机站（Java Stack）所发挥的作用非常相似，他们之间的区别在于虚拟机栈为虚拟机栈执行java方法（也就是字节码）服务，而本地方法栈则为使用到Native方法服务。</p>\n<h2 id=\"方法区（Method-Area）\"><a href=\"#方法区（Method-Area）\" class=\"headerlink\" title=\"方法区（Method Area）\"></a>方法区（Method Area）</h2><p>方法区（Method Area）与堆（Java Heap）一样，是<code>各个线程共享的内存区域</code>，它用于存储虚拟机加载的<code>类信息</code>，<code>常量</code>，<code>静态变量</code>，<code>即时编译器编译后的代码</code>等数据。虽然Java虚拟机规范把方法区描述为堆的一个逻辑部分，但是她却有一个别名叫做非堆（Non-Heap）。分析下Java虚拟机规范，之所以把方法区描述为堆的一个逻辑部分，应该觉得她们都是存储数据的角度出发的。一个存储对象数据（堆），一个存储静态信息(方法区)。</p>\n<h2 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h2><h3 id=\"线程私有的数据区域有：\"><a href=\"#线程私有的数据区域有：\" class=\"headerlink\" title=\"线程私有的数据区域有：\"></a>线程私有的数据区域有：</h3><p>Java虚拟机栈（Java Stack）<br>本地方法栈（Native Stack）  </p>\n<h3 id=\"线程共有的数据区域有：\"><a href=\"#线程共有的数据区域有：\" class=\"headerlink\" title=\"线程共有的数据区域有：\"></a>线程共有的数据区域有：</h3><p>堆（Java Heap）<br>方法区  </p>\n<h1 id=\"JVM参数列表\"><a href=\"#JVM参数列表\" class=\"headerlink\" title=\"JVM参数列表\"></a>JVM参数列表</h1><p>java -Xmx3550m -Xms3550m -Xmn2g -Xss128k -XX:NewRatio=4 -XX:SurvivorRatio=4 -XX:MaxPermSize=16m  -XX:MaxTenuringThreshold=0<br><code>-Xmx3550m</code>：最大堆内存为3550M。<br><code>-Xms3550m</code>：初始堆内存为3550m。<br>此值可以设置与-Xmx相同，以避免每次垃圾回收完成后JVM重新分配内存。<br><code>-Xmn2g</code>：设置年轻代大小为2G。<br>整个堆大小=年轻代大小 + 年老代大小 + 持久代大小。持久代一般固定大小为64m，所以增大年轻代后，将会减小年老代大小。此值对系统性能影响较大，Sun官方推荐配置为整个堆的3/8。<br><code>-Xss128k</code>：设置每个线程的堆栈大小。<br>JDK5.0以后每个线程堆栈大小为1M，在相同物理内存下，减小这个值能生成更多的线程。但是操作系统对一个进程内的线程数还是有限制的，不能无限生成，经验值在 3000~5000左右。<br><code>-XX:NewRatio=4</code>:设置年轻代（包括Eden和两个Survivor区）与年老代的比值（除去持久代）。设置为4，则年轻代与年老代所占比值为1：4，年轻代占整个堆栈的1/5<br><code>-XX:SurvivorRatio=4</code>：设置年轻代中Eden区与Survivor区的大小比值。<br>设置为4，则两个Survivor区与一个Eden区的比值为2:4，一个Survivor区占整个年轻代的1/6<br><code>-XX:MaxPermSize=16m</code>:设置持久代大小为16m。<br><code>-XX:MaxTenuringThreshold=0</code>：设置垃圾最大年龄。<br>如果设置为0的话，则年轻代对象不经过Survivor区，直 接进入年老代。对于年老代比较多的应用，可以提高效率。如果将此值设置为一个较大值，则年轻代对象会在Survivor区进行多次复制，这样可以增加对象 再年轻代的存活时间，增加在年轻代即被回收的概论。  </p>\n<p>收集器设置<br>-XX:+UseSerialGC:设置串行收集器<br>-XX:+UseParallelGC:设置并行收集器<br>-XX:+UseParalledlOldGC:设置并行年老代收集器<br>-XX:+UseConcMarkSweepGC:设置并发收集器<br>垃圾回收统计信息<br>-XX:+PrintGC<br>-XX:+PrintGCDetails<br>-XX:+PrintGCTimeStamps<br>-Xloggc:filename<br>并行收集器设置<br>-XX:ParallelGCThreads=n:设置并行收集器收集时使用的CPU数。并行收集线程数。<br>-XX:MaxGCPauseMillis=n:设置并行收集最大暂停时间<br>-XX:GCTimeRatio=n:设置垃圾回收时间占程序运行时间的百分比。公式为1/(1+n)<br>并发收集器设置<br>-XX:+CMSIncrementalMode:设置为增量模式。适用于单CPU情况。<br>-XX:ParallelGCThreads=n:设置并发收集器年轻代收集方式为并行收集时，使用的CPU数。并行收集线程数。  </p>\n<h1 id=\"jvm案例演示\"><a href=\"#jvm案例演示\" class=\"headerlink\" title=\"jvm案例演示\"></a>jvm案例演示</h1><h2 id=\"内存\"><a href=\"#内存\" class=\"headerlink\" title=\"内存\"></a>内存</h2><p>Jconsole的内存标签相当于可视化的jstat命令，用于监视收集器管理的虚拟机内存（java堆和永久代）的变化趋势。<br>我们通过下面的一段代码体验一下它的监视功能。运行时设置的虚拟机参数为：-Xms100m -Xmx100m -XX:+UseSerialGC，这段代码的作用是以64kb/50毫秒的速度往java堆内存中填充数据。<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">TestMemory</span> </span>&#123;</div><div class=\"line\">\t<span class=\"keyword\">static</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">OOMObject</span> </span>&#123;</div><div class=\"line\">\t\t<span class=\"keyword\">public</span> <span class=\"keyword\">byte</span>[] placeholder = <span class=\"keyword\">new</span> <span class=\"keyword\">byte</span>[<span class=\"number\">64</span> * <span class=\"number\">1024</span>];</div><div class=\"line\">\t&#125;</div><div class=\"line\"></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">fillHeap</span><span class=\"params\">(<span class=\"keyword\">int</span> num)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</div><div class=\"line\">\t\tArrayList&lt;OOMObject&gt; list = <span class=\"keyword\">new</span> ArrayList&lt;OOMObject&gt;();</div><div class=\"line\">\t\t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; num; i++) &#123;</div><div class=\"line\">\t\t\tThread.sleep(<span class=\"number\">50</span>);</div><div class=\"line\">\t\t\tlist.add(<span class=\"keyword\">new</span> OOMObject());</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t\tSystem.gc();</div><div class=\"line\">\t&#125;</div><div class=\"line\"></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</div><div class=\"line\">\t\tfillHeap(<span class=\"number\">1000</span>);</div><div class=\"line\">\t\tThread.sleep(<span class=\"number\">500000</span>);</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p><img src=\"http://ovasdkxqr.bkt.clouddn.com/image/blog/2017125234140.png\" alt=\"2017125234140\"></p>\n<p>从图中可以看出，运行轨迹成曲线增长，循环1000次后，虽然整个新生代Eden和Survivor区都基本上被清空了，但是老年代仍然保持峰值状态，这说明，填充的数据在GC后仍然存活，因为list的作用域没有结束。如果把System.gc();移到fillHeap(1000);后，就可以全部回收掉。</p>\n<h2 id=\"线程\"><a href=\"#线程\" class=\"headerlink\" title=\"线程\"></a>线程</h2><p>jconsole线程标签相当于可视化了jstack命令，遇到线程停顿时，可以使用这个也签进行监控分析。线程长时间停顿的主要原因有：等待外部资源（数据库连接等），死循环、锁等待。下面的代码将演示这几种情况：<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">package</span> cn.java.jvm;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">import</span> java.io.BufferedReader;</div><div class=\"line\"><span class=\"keyword\">import</span> java.io.IOException;</div><div class=\"line\"><span class=\"keyword\">import</span> java.io.InputStreamReader;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">TestThread</span> </span>&#123;</div><div class=\"line\">\t<span class=\"comment\">/**</span></div><div class=\"line\"><span class=\"comment\">\t * 死循环演示</span></div><div class=\"line\"><span class=\"comment\">\t * </span></div><div class=\"line\"><span class=\"comment\">\t * <span class=\"doctag\">@param</span> args</span></div><div class=\"line\"><span class=\"comment\">\t */</span></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">createBusyThread</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">\t\tThread thread = <span class=\"keyword\">new</span> Thread(<span class=\"keyword\">new</span> Runnable() &#123;</div><div class=\"line\">\t\t\t<span class=\"meta\">@Override</span></div><div class=\"line\">\t\t\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">\t\t\t\tSystem.out.println(<span class=\"string\">\"createBusyThread\"</span>);</div><div class=\"line\">\t\t\t\t<span class=\"keyword\">while</span> (<span class=\"keyword\">true</span>)</div><div class=\"line\">\t\t\t\t\t;</div><div class=\"line\">\t\t\t&#125;</div><div class=\"line\">\t\t&#125;, <span class=\"string\">\"testBusyThread\"</span>);</div><div class=\"line\">\t\tthread.start();</div><div class=\"line\">\t&#125;</div><div class=\"line\"></div><div class=\"line\">\t<span class=\"comment\">/**</span></div><div class=\"line\"><span class=\"comment\">\t * 线程锁等待</span></div><div class=\"line\"><span class=\"comment\">\t * </span></div><div class=\"line\"><span class=\"comment\">\t * <span class=\"doctag\">@param</span> args</span></div><div class=\"line\"><span class=\"comment\">\t */</span></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">createLockThread</span><span class=\"params\">(<span class=\"keyword\">final</span> Object lock)</span> </span>&#123;</div><div class=\"line\">\t\tThread thread = <span class=\"keyword\">new</span> Thread(<span class=\"keyword\">new</span> Runnable() &#123;</div><div class=\"line\">\t\t\t<span class=\"meta\">@Override</span></div><div class=\"line\">\t\t\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">\t\t\t\tSystem.out.println(<span class=\"string\">\"createLockThread\"</span>);</div><div class=\"line\">\t\t\t\t<span class=\"keyword\">synchronized</span> (lock) &#123;</div><div class=\"line\">\t\t\t\t\t<span class=\"keyword\">try</span> &#123;</div><div class=\"line\">\t\t\t\t\t\tlock.wait();</div><div class=\"line\">\t\t\t\t\t&#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</div><div class=\"line\">\t\t\t\t\t\te.printStackTrace();</div><div class=\"line\">\t\t\t\t\t&#125;</div><div class=\"line\">\t\t\t\t&#125;</div><div class=\"line\"></div><div class=\"line\">\t\t\t&#125;</div><div class=\"line\">\t\t&#125;, <span class=\"string\">\"testLockThread\"</span>);</div><div class=\"line\">\t\tthread.start();</div><div class=\"line\">\t&#125;</div><div class=\"line\"></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</div><div class=\"line\">\t\tBufferedReader br = <span class=\"keyword\">new</span> BufferedReader(<span class=\"keyword\">new</span> InputStreamReader(System.in));</div><div class=\"line\">\t\tbr.readLine();</div><div class=\"line\">\t\tcreateBusyThread();</div><div class=\"line\">\t\tbr.readLine();</div><div class=\"line\">\t\tObject object = <span class=\"keyword\">new</span> Object();</div><div class=\"line\">\t\tcreateLockThread(object);</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>main线程：追踪到需要键盘录入<br>testBusyThread线程：线程阻塞在18行的while（true），直到线程切换，很耗性能<br>testLockThread线程：出于waitting状态，等待notify  </p>\n<p>死锁：<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">package</span> cn.java.jvm;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">TestDeadThread</span> <span class=\"keyword\">implements</span> <span class=\"title\">Runnable</span> </span>&#123;</div><div class=\"line\">\t<span class=\"keyword\">int</span> a, b;</div><div class=\"line\"></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">TestDeadThread</span><span class=\"params\">(<span class=\"keyword\">int</span> a, <span class=\"keyword\">int</span> b)</span> </span>&#123;</div><div class=\"line\">\t\t<span class=\"keyword\">this</span>.a = a;</div><div class=\"line\">\t\t<span class=\"keyword\">this</span>.b = b;</div><div class=\"line\">\t&#125;</div><div class=\"line\"></div><div class=\"line\">\t<span class=\"meta\">@Override</span></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">\t\tSystem.out.println(<span class=\"string\">\"createDeadThread\"</span>);</div><div class=\"line\">\t\t<span class=\"keyword\">synchronized</span> (Integer.valueOf(a)) &#123;</div><div class=\"line\">\t\t\t<span class=\"keyword\">synchronized</span> (Integer.valueOf(b)) &#123;</div><div class=\"line\">\t\t\t\tSystem.out.println(a + b);</div><div class=\"line\">\t\t\t&#125;</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t&#125;</div><div class=\"line\"></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</div><div class=\"line\">\t\t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">100</span>; i++) &#123;</div><div class=\"line\">\t\t\t<span class=\"keyword\">new</span> Thread(<span class=\"keyword\">new</span> TestDeadThread(<span class=\"number\">1</span>, <span class=\"number\">2</span>)).start();</div><div class=\"line\">\t\t\t<span class=\"keyword\">new</span> Thread(<span class=\"keyword\">new</span> TestDeadThread(<span class=\"number\">2</span>, <span class=\"number\">1</span>)).start();</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>点击检查死锁，会出现死锁的详情。</p>\n<p><img src=\"http://ovasdkxqr.bkt.clouddn.com/image/blog/2017125234810.png\" alt=\"2017125234810\"></p>\n<p><img src=\"http://ovasdkxqr.bkt.clouddn.com/image/blog/2017125234928.png\" alt=\"2017125234928\"></p>\n<p>thread-5的锁被thread-10持有，相反亦是，造成死锁。</p>\n"},{"title":"微服务框架与实战-总体概览","toc":true,"date":"2018-01-21T15:49:54.000Z","scaffolds":null,"_content":"\n这本书整体的看了一遍，具体细节还没有实践。先做个骨架，用的时候再丰富下。书中按照下面的顺序进行整合。\n<!-- more -->\n\n<style>\ntable th:first-of-type {\n    width: 15px;\n}\n\ntable th:nth-of-type(2) {\n    width: 20%;\n}\n\ntable th:nth-of-type(3) {\n    width: 30%;\n}\n</style>\n\n 章 | 组件 | 功能 | 描述 | \n----------|----------|------------|-------------\n 3|spring-boot             | 基础业务开发 |\n  |spring-boot-actuator    | 提供很多监控端点 | \n 4|Eureka   | 服务的注册与发现 | 集成于spring-cloud-netflix <br/>是Netflix开源的服务发现组件<br/>基于REST的服务<br/>相似组件： Zookeeper，Consul\n 5|Ribbon   | 客户端测负载均衡 | Netflix发布的负载均衡器<br/>有助于控制HTTP和TCP客户端的行为。\n |Feign    | 实现声明式REST调用 | Netflix开发的声明式、模板化的HTTP客户端。\n |Hystrix  | 服务容错处理 |\n |Turbine  | 聚合Hystrix监控数据的工具 | 将所有相关 /hystrix.stream 端点的数据聚合到一个聚合的/turbine.stream中<br/>让集群的监控更加方便\n |RabbitMQ | 消息中间件 | 解决网络故障问题（例如微服务与Turbine网络不通）\n 8|Zuul | 构建微服务网关 | Netflix开源的微服务网关<br/>可以和Eureka、Ribbon、Hystrix等组件配合使用<br/>核心是一系列的过滤器\n  |Sidecar | 整合非JVM微服务 | \n 9|spring-cloud-Config | 统一管理微服务配置 | \n 10|spring-cloud-sleuth | 微服务跟踪 | 分布式跟踪的解决方案\n |ELK | 日志分析系统 | \n |Zipkin | Twitter开源的分布式跟踪系统 | 可与Sleuth配合使用<br/>收集系统的时序数据<br/>追踪微服务框架的系统延时等问题<br/>提供友好的界面，帮助分析追踪数据。\n 12|Docker | 开源容器引擎<br/>有助于更快地交付应用 | 可将应用程序和基础设施层隔离<br/>能将基础设置当做程序一样进行管理<br/>可更快地打包、测试以及部署应用程序<br/>缩短从编写到部署运行代码的周期\n 14|Docker Compose | 编排微服务 | 用于定义和运行多容器Docker应用程序的工具<br/>前身是Fig<br/>非常适合用在开发、测试、构建CI工作流等场景\n\n雪崩效应：\n- 我们常把 “基础服务故障” 导致 “级联故障” 的现象成为雪崩效应。\n- 描述的是提供者不可用导致消费者不可用，并将不可用逐渐放大的过程。\n\n\n\n\n\n","source":"_posts/微服务/微服务框架与实战-总体概览.md","raw":"---\ntitle: 微服务框架与实战-总体概览\ncategories: 学习\ntags:\n  - 微服务\ntoc: true\ndate: 2018-01-21 23:49:54\nscaffolds:\n---\n\n这本书整体的看了一遍，具体细节还没有实践。先做个骨架，用的时候再丰富下。书中按照下面的顺序进行整合。\n<!-- more -->\n\n<style>\ntable th:first-of-type {\n    width: 15px;\n}\n\ntable th:nth-of-type(2) {\n    width: 20%;\n}\n\ntable th:nth-of-type(3) {\n    width: 30%;\n}\n</style>\n\n 章 | 组件 | 功能 | 描述 | \n----------|----------|------------|-------------\n 3|spring-boot             | 基础业务开发 |\n  |spring-boot-actuator    | 提供很多监控端点 | \n 4|Eureka   | 服务的注册与发现 | 集成于spring-cloud-netflix <br/>是Netflix开源的服务发现组件<br/>基于REST的服务<br/>相似组件： Zookeeper，Consul\n 5|Ribbon   | 客户端测负载均衡 | Netflix发布的负载均衡器<br/>有助于控制HTTP和TCP客户端的行为。\n |Feign    | 实现声明式REST调用 | Netflix开发的声明式、模板化的HTTP客户端。\n |Hystrix  | 服务容错处理 |\n |Turbine  | 聚合Hystrix监控数据的工具 | 将所有相关 /hystrix.stream 端点的数据聚合到一个聚合的/turbine.stream中<br/>让集群的监控更加方便\n |RabbitMQ | 消息中间件 | 解决网络故障问题（例如微服务与Turbine网络不通）\n 8|Zuul | 构建微服务网关 | Netflix开源的微服务网关<br/>可以和Eureka、Ribbon、Hystrix等组件配合使用<br/>核心是一系列的过滤器\n  |Sidecar | 整合非JVM微服务 | \n 9|spring-cloud-Config | 统一管理微服务配置 | \n 10|spring-cloud-sleuth | 微服务跟踪 | 分布式跟踪的解决方案\n |ELK | 日志分析系统 | \n |Zipkin | Twitter开源的分布式跟踪系统 | 可与Sleuth配合使用<br/>收集系统的时序数据<br/>追踪微服务框架的系统延时等问题<br/>提供友好的界面，帮助分析追踪数据。\n 12|Docker | 开源容器引擎<br/>有助于更快地交付应用 | 可将应用程序和基础设施层隔离<br/>能将基础设置当做程序一样进行管理<br/>可更快地打包、测试以及部署应用程序<br/>缩短从编写到部署运行代码的周期\n 14|Docker Compose | 编排微服务 | 用于定义和运行多容器Docker应用程序的工具<br/>前身是Fig<br/>非常适合用在开发、测试、构建CI工作流等场景\n\n雪崩效应：\n- 我们常把 “基础服务故障” 导致 “级联故障” 的现象成为雪崩效应。\n- 描述的是提供者不可用导致消费者不可用，并将不可用逐渐放大的过程。\n\n\n\n\n\n","slug":"微服务/微服务框架与实战-总体概览","published":1,"updated":"2018-01-21T16:16:54.403Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjcsq4ljw003yx4vf1rxpjwvj","content":"<p>这本书整体的看了一遍，具体细节还没有实践。先做个骨架，用的时候再丰富下。书中按照下面的顺序进行整合。<br><a id=\"more\"></a></p>\n<style>\ntable th:first-of-type {\n    width: 15px;\n}\n\ntable th:nth-of-type(2) {\n    width: 20%;\n}\n\ntable th:nth-of-type(3) {\n    width: 30%;\n}\n</style>\n\n<table>\n<thead>\n<tr>\n<th>章</th>\n<th>组件</th>\n<th>功能</th>\n<th>描述</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td> 3</td>\n<td>spring-boot</td>\n<td>基础业务开发</td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td>spring-boot-actuator</td>\n<td>提供很多监控端点</td>\n<td></td>\n</tr>\n<tr>\n<td> 4</td>\n<td>Eureka</td>\n<td>服务的注册与发现</td>\n<td>集成于spring-cloud-netflix <br>是Netflix开源的服务发现组件<br>基于REST的服务<br>相似组件： Zookeeper，Consul</td>\n</tr>\n<tr>\n<td> 5</td>\n<td>Ribbon</td>\n<td>客户端测负载均衡</td>\n<td>Netflix发布的负载均衡器<br>有助于控制HTTP和TCP客户端的行为。</td>\n</tr>\n<tr>\n<td></td>\n<td>Feign</td>\n<td>实现声明式REST调用</td>\n<td>Netflix开发的声明式、模板化的HTTP客户端。</td>\n</tr>\n<tr>\n<td></td>\n<td>Hystrix</td>\n<td>服务容错处理</td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td>Turbine</td>\n<td>聚合Hystrix监控数据的工具</td>\n<td>将所有相关 /hystrix.stream 端点的数据聚合到一个聚合的/turbine.stream中<br>让集群的监控更加方便</td>\n</tr>\n<tr>\n<td></td>\n<td>RabbitMQ</td>\n<td>消息中间件</td>\n<td>解决网络故障问题（例如微服务与Turbine网络不通）</td>\n</tr>\n<tr>\n<td> 8</td>\n<td>Zuul</td>\n<td>构建微服务网关</td>\n<td>Netflix开源的微服务网关<br>可以和Eureka、Ribbon、Hystrix等组件配合使用<br>核心是一系列的过滤器</td>\n</tr>\n<tr>\n<td></td>\n<td>Sidecar</td>\n<td>整合非JVM微服务</td>\n<td></td>\n</tr>\n<tr>\n<td> 9</td>\n<td>spring-cloud-Config</td>\n<td>统一管理微服务配置</td>\n<td></td>\n</tr>\n<tr>\n<td> 10</td>\n<td>spring-cloud-sleuth</td>\n<td>微服务跟踪</td>\n<td>分布式跟踪的解决方案</td>\n</tr>\n<tr>\n<td></td>\n<td>ELK</td>\n<td>日志分析系统</td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td>Zipkin</td>\n<td>Twitter开源的分布式跟踪系统</td>\n<td>可与Sleuth配合使用<br>收集系统的时序数据<br>追踪微服务框架的系统延时等问题<br>提供友好的界面，帮助分析追踪数据。</td>\n</tr>\n<tr>\n<td> 12</td>\n<td>Docker</td>\n<td>开源容器引擎<br>有助于更快地交付应用</td>\n<td>可将应用程序和基础设施层隔离<br>能将基础设置当做程序一样进行管理<br>可更快地打包、测试以及部署应用程序<br>缩短从编写到部署运行代码的周期</td>\n</tr>\n<tr>\n<td> 14</td>\n<td>Docker Compose</td>\n<td>编排微服务</td>\n<td>用于定义和运行多容器Docker应用程序的工具<br>前身是Fig<br>非常适合用在开发、测试、构建CI工作流等场景</td>\n</tr>\n</tbody>\n</table>\n<p>雪崩效应：</p>\n<ul>\n<li>我们常把 “基础服务故障” 导致 “级联故障” 的现象成为雪崩效应。</li>\n<li>描述的是提供者不可用导致消费者不可用，并将不可用逐渐放大的过程。</li>\n</ul>\n","site":{"data":{}},"excerpt":"<p>这本书整体的看了一遍，具体细节还没有实践。先做个骨架，用的时候再丰富下。书中按照下面的顺序进行整合。<br>","more":"</p>\n<style>\ntable th:first-of-type {\n    width: 15px;\n}\n\ntable th:nth-of-type(2) {\n    width: 20%;\n}\n\ntable th:nth-of-type(3) {\n    width: 30%;\n}\n</style>\n\n<table>\n<thead>\n<tr>\n<th>章</th>\n<th>组件</th>\n<th>功能</th>\n<th>描述</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td> 3</td>\n<td>spring-boot</td>\n<td>基础业务开发</td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td>spring-boot-actuator</td>\n<td>提供很多监控端点</td>\n<td></td>\n</tr>\n<tr>\n<td> 4</td>\n<td>Eureka</td>\n<td>服务的注册与发现</td>\n<td>集成于spring-cloud-netflix <br>是Netflix开源的服务发现组件<br>基于REST的服务<br>相似组件： Zookeeper，Consul</td>\n</tr>\n<tr>\n<td> 5</td>\n<td>Ribbon</td>\n<td>客户端测负载均衡</td>\n<td>Netflix发布的负载均衡器<br>有助于控制HTTP和TCP客户端的行为。</td>\n</tr>\n<tr>\n<td></td>\n<td>Feign</td>\n<td>实现声明式REST调用</td>\n<td>Netflix开发的声明式、模板化的HTTP客户端。</td>\n</tr>\n<tr>\n<td></td>\n<td>Hystrix</td>\n<td>服务容错处理</td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td>Turbine</td>\n<td>聚合Hystrix监控数据的工具</td>\n<td>将所有相关 /hystrix.stream 端点的数据聚合到一个聚合的/turbine.stream中<br>让集群的监控更加方便</td>\n</tr>\n<tr>\n<td></td>\n<td>RabbitMQ</td>\n<td>消息中间件</td>\n<td>解决网络故障问题（例如微服务与Turbine网络不通）</td>\n</tr>\n<tr>\n<td> 8</td>\n<td>Zuul</td>\n<td>构建微服务网关</td>\n<td>Netflix开源的微服务网关<br>可以和Eureka、Ribbon、Hystrix等组件配合使用<br>核心是一系列的过滤器</td>\n</tr>\n<tr>\n<td></td>\n<td>Sidecar</td>\n<td>整合非JVM微服务</td>\n<td></td>\n</tr>\n<tr>\n<td> 9</td>\n<td>spring-cloud-Config</td>\n<td>统一管理微服务配置</td>\n<td></td>\n</tr>\n<tr>\n<td> 10</td>\n<td>spring-cloud-sleuth</td>\n<td>微服务跟踪</td>\n<td>分布式跟踪的解决方案</td>\n</tr>\n<tr>\n<td></td>\n<td>ELK</td>\n<td>日志分析系统</td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td>Zipkin</td>\n<td>Twitter开源的分布式跟踪系统</td>\n<td>可与Sleuth配合使用<br>收集系统的时序数据<br>追踪微服务框架的系统延时等问题<br>提供友好的界面，帮助分析追踪数据。</td>\n</tr>\n<tr>\n<td> 12</td>\n<td>Docker</td>\n<td>开源容器引擎<br>有助于更快地交付应用</td>\n<td>可将应用程序和基础设施层隔离<br>能将基础设置当做程序一样进行管理<br>可更快地打包、测试以及部署应用程序<br>缩短从编写到部署运行代码的周期</td>\n</tr>\n<tr>\n<td> 14</td>\n<td>Docker Compose</td>\n<td>编排微服务</td>\n<td>用于定义和运行多容器Docker应用程序的工具<br>前身是Fig<br>非常适合用在开发、测试、构建CI工作流等场景</td>\n</tr>\n</tbody>\n</table>\n<p>雪崩效应：</p>\n<ul>\n<li>我们常把 “基础服务故障” 导致 “级联故障” 的现象成为雪崩效应。</li>\n<li>描述的是提供者不可用导致消费者不可用，并将不可用逐渐放大的过程。</li>\n</ul>"},{"title":"大数据0501-轻量级RPC框架开发","toc":true,"date":"2017-12-31T18:08:22.000Z","scaffolds":null,"_content":"\n1、掌握RPC原理\n2、掌握nio操作\n3、掌握netty简单的api\n4、掌握自定义RPC框架\n<!-- more -->\n# RPC原理\n## 什么是RPC\nRPC（Remote Procedure Call Protocol）——`远程过程调用协议`，它是一种通过网络从远程计算机程序上请求服务，而不需要了解底层网络技术的协议。RPC协议假定某些传输协议的存在，如TCP或UDP，为通信程序之间携带信息数据。在OSI网络通信模型中，RPC跨越了传输层和应用层。RPC使得开发包括网络分布式多程序在内的应用程序更加容易。\nRPC采用`客户机/服务器模式`。请求程序就是一个客户机，而服务提供程序就是一个服务器。首先，客户机调用进程发送一个有进程参数的调用信息到服务进程，然后等待应答信息。在服务器端，进程保持睡眠状态直到调用信息到达为止。当一个调用信息到达，服务器获得进程参数，计算结果，发送答复信息，然后等待下一个调用信息，最后，客户端调用进程接收答复信息，获得进程结果，然后调用执行继续进行。\n\n## RPC原理\n\n![2017126231022](http://ovasdkxqr.bkt.clouddn.com/image/blog/2017126231022.png)\n\n运行时,一次客户机对服务器的RPC调用,其内部操作大致有如下十步：\n1. 调用客户端句柄；执行传送参数\n1. 调用本地系统内核发送网络消息\n1. 消息传送到远程主机\n1. 服务器句柄得到消息并取得参数\n1. 执行远程过程\n1. 执行的过程将结果返回服务器句柄\n1. 服务器句柄返回结果，调用远程系统内核\n1. 消息传回本地主机\n1. 客户句柄由内核接收消息\n1. 客户接收句柄返回的数据\n\n# NIO\nnio 是New IO 的简称，在jdk1.4 里提供的新api 。   \nSun 官方标榜的特性如下：   \n1. 为所有的原始类型提供(Buffer)缓存支持。字符集编码解码解决方案。 \n2. Channel ：一个新的原始I/O 抽象。 \n3. 支持锁和内存映射文件的文件访问接口。 \n4. 提供多路(non-bloking) 非阻塞式的高伸缩性网络I/O 。\n\n## socket nio原理\n###  传统的I/O\n使用传统的I/O程序读取文件内容, 并写入到另一个文件(或Socket), 如下程序:\n```java\nFile.read(fileDesc, buf, len);\nSocket.send(socket, buf, len);\n```\n\n会有较大的性能开销, 主要表现在一下两方面:\n1. 上下文切换(context switch), 此处有4次用户态和内核态的切换\n2. Buffer内存开销, 一个是应用程序buffer, 另一个是系统读取buffer以及socket buffer\n\n其运行示意图如下    \n![2017127225741](http://ovasdkxqr.bkt.clouddn.com/image/blog/2017127225741.png)\n\n1. 先将文件内容从磁盘中拷贝到操作系统buffer\n2. 再从操作系统buffer拷贝到程序应用buffer\n3. 从程序buffer拷贝到socket buffer\n4. 从socket buffer拷贝到协议引擎.\n\n## NIO\nNIO技术省去了将操作系统的read buffer拷贝到程序的buffer, 以及从程序buffer拷贝到socket buffer的步骤, 直接将 read buffer 拷贝到 socket buffer. java 的 FileChannel.transferTo() 方法就是这样的实现, 这个实现是依赖于操作系统底层的sendFile()实现的.  \n```\npublicvoid transferTo(long position, long count, WritableByteChannel target);\n\n```\n他的底层调用的是系统调用sendFile()方法\n```\nsendfile(int out_fd, int in_fd, off_t *offset, size_t count);\n```\n如下图  \n![201712723052](http://ovasdkxqr.bkt.clouddn.com/image/blog/201712723052.png)\n\n参考帖子：http://blog.csdn.net/dd864140130/article/details/50299687\n# 轻量级RPC开发\n## 轻量级RPC框架需求分析及原理分析\n![2017126231155](http://ovasdkxqr.bkt.clouddn.com/image/blog/2017126231155.png)\n## 大概流程\n![20181115823](http://ovasdkxqr.bkt.clouddn.com/image/blog/20181115823.png)\n\n## 工程目录\n![20181115919](http://ovasdkxqr.bkt.clouddn.com/image/blog/20181115919.png)\n- rpc-sample-server   用户服务端 业务实现类 \n- rpc-sample-common   用户公用包 包含了业务接口\n- rpc-sample-app      用户客户端 调用业务接口\n- rpc-server          框架 服务包\n- rpc-registry        框架 注册和发现 zk用的包\n- rpc-common          框架 公共包 request response 加密 解密 序列化等公用类\n- rpc-client          框架 客户包\n## 框架\nrpc-server 主要利用`反射`将接收到的request进行解析、执行、返回结果。  \nrpc-client 主要使用`动态代理`将接口的调用 封装进request进行请求，然后返回结果。\n","source":"_posts/大数据/大数据0501-轻量级RPC框架开发.md","raw":"---\ntitle: 大数据0501-轻量级RPC框架开发\ncategories: 学习\ntags:\n  - 大数据\n  - rpc\ntoc: true\ndate: 2018-01-01 02:08:22\nscaffolds:\n---\n\n1、掌握RPC原理\n2、掌握nio操作\n3、掌握netty简单的api\n4、掌握自定义RPC框架\n<!-- more -->\n# RPC原理\n## 什么是RPC\nRPC（Remote Procedure Call Protocol）——`远程过程调用协议`，它是一种通过网络从远程计算机程序上请求服务，而不需要了解底层网络技术的协议。RPC协议假定某些传输协议的存在，如TCP或UDP，为通信程序之间携带信息数据。在OSI网络通信模型中，RPC跨越了传输层和应用层。RPC使得开发包括网络分布式多程序在内的应用程序更加容易。\nRPC采用`客户机/服务器模式`。请求程序就是一个客户机，而服务提供程序就是一个服务器。首先，客户机调用进程发送一个有进程参数的调用信息到服务进程，然后等待应答信息。在服务器端，进程保持睡眠状态直到调用信息到达为止。当一个调用信息到达，服务器获得进程参数，计算结果，发送答复信息，然后等待下一个调用信息，最后，客户端调用进程接收答复信息，获得进程结果，然后调用执行继续进行。\n\n## RPC原理\n\n![2017126231022](http://ovasdkxqr.bkt.clouddn.com/image/blog/2017126231022.png)\n\n运行时,一次客户机对服务器的RPC调用,其内部操作大致有如下十步：\n1. 调用客户端句柄；执行传送参数\n1. 调用本地系统内核发送网络消息\n1. 消息传送到远程主机\n1. 服务器句柄得到消息并取得参数\n1. 执行远程过程\n1. 执行的过程将结果返回服务器句柄\n1. 服务器句柄返回结果，调用远程系统内核\n1. 消息传回本地主机\n1. 客户句柄由内核接收消息\n1. 客户接收句柄返回的数据\n\n# NIO\nnio 是New IO 的简称，在jdk1.4 里提供的新api 。   \nSun 官方标榜的特性如下：   \n1. 为所有的原始类型提供(Buffer)缓存支持。字符集编码解码解决方案。 \n2. Channel ：一个新的原始I/O 抽象。 \n3. 支持锁和内存映射文件的文件访问接口。 \n4. 提供多路(non-bloking) 非阻塞式的高伸缩性网络I/O 。\n\n## socket nio原理\n###  传统的I/O\n使用传统的I/O程序读取文件内容, 并写入到另一个文件(或Socket), 如下程序:\n```java\nFile.read(fileDesc, buf, len);\nSocket.send(socket, buf, len);\n```\n\n会有较大的性能开销, 主要表现在一下两方面:\n1. 上下文切换(context switch), 此处有4次用户态和内核态的切换\n2. Buffer内存开销, 一个是应用程序buffer, 另一个是系统读取buffer以及socket buffer\n\n其运行示意图如下    \n![2017127225741](http://ovasdkxqr.bkt.clouddn.com/image/blog/2017127225741.png)\n\n1. 先将文件内容从磁盘中拷贝到操作系统buffer\n2. 再从操作系统buffer拷贝到程序应用buffer\n3. 从程序buffer拷贝到socket buffer\n4. 从socket buffer拷贝到协议引擎.\n\n## NIO\nNIO技术省去了将操作系统的read buffer拷贝到程序的buffer, 以及从程序buffer拷贝到socket buffer的步骤, 直接将 read buffer 拷贝到 socket buffer. java 的 FileChannel.transferTo() 方法就是这样的实现, 这个实现是依赖于操作系统底层的sendFile()实现的.  \n```\npublicvoid transferTo(long position, long count, WritableByteChannel target);\n\n```\n他的底层调用的是系统调用sendFile()方法\n```\nsendfile(int out_fd, int in_fd, off_t *offset, size_t count);\n```\n如下图  \n![201712723052](http://ovasdkxqr.bkt.clouddn.com/image/blog/201712723052.png)\n\n参考帖子：http://blog.csdn.net/dd864140130/article/details/50299687\n# 轻量级RPC开发\n## 轻量级RPC框架需求分析及原理分析\n![2017126231155](http://ovasdkxqr.bkt.clouddn.com/image/blog/2017126231155.png)\n## 大概流程\n![20181115823](http://ovasdkxqr.bkt.clouddn.com/image/blog/20181115823.png)\n\n## 工程目录\n![20181115919](http://ovasdkxqr.bkt.clouddn.com/image/blog/20181115919.png)\n- rpc-sample-server   用户服务端 业务实现类 \n- rpc-sample-common   用户公用包 包含了业务接口\n- rpc-sample-app      用户客户端 调用业务接口\n- rpc-server          框架 服务包\n- rpc-registry        框架 注册和发现 zk用的包\n- rpc-common          框架 公共包 request response 加密 解密 序列化等公用类\n- rpc-client          框架 客户包\n## 框架\nrpc-server 主要利用`反射`将接收到的request进行解析、执行、返回结果。  \nrpc-client 主要使用`动态代理`将接口的调用 封装进request进行请求，然后返回结果。\n","slug":"大数据/大数据0501-轻量级RPC框架开发","published":1,"updated":"2017-12-31T18:10:29.078Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjcsq4ljy0041x4vfmuzwdrj7","content":"<p>1、掌握RPC原理<br>2、掌握nio操作<br>3、掌握netty简单的api<br>4、掌握自定义RPC框架<br><a id=\"more\"></a></p>\n<h1 id=\"RPC原理\"><a href=\"#RPC原理\" class=\"headerlink\" title=\"RPC原理\"></a>RPC原理</h1><h2 id=\"什么是RPC\"><a href=\"#什么是RPC\" class=\"headerlink\" title=\"什么是RPC\"></a>什么是RPC</h2><p>RPC（Remote Procedure Call Protocol）——<code>远程过程调用协议</code>，它是一种通过网络从远程计算机程序上请求服务，而不需要了解底层网络技术的协议。RPC协议假定某些传输协议的存在，如TCP或UDP，为通信程序之间携带信息数据。在OSI网络通信模型中，RPC跨越了传输层和应用层。RPC使得开发包括网络分布式多程序在内的应用程序更加容易。<br>RPC采用<code>客户机/服务器模式</code>。请求程序就是一个客户机，而服务提供程序就是一个服务器。首先，客户机调用进程发送一个有进程参数的调用信息到服务进程，然后等待应答信息。在服务器端，进程保持睡眠状态直到调用信息到达为止。当一个调用信息到达，服务器获得进程参数，计算结果，发送答复信息，然后等待下一个调用信息，最后，客户端调用进程接收答复信息，获得进程结果，然后调用执行继续进行。</p>\n<h2 id=\"RPC原理-1\"><a href=\"#RPC原理-1\" class=\"headerlink\" title=\"RPC原理\"></a>RPC原理</h2><p><img src=\"http://ovasdkxqr.bkt.clouddn.com/image/blog/2017126231022.png\" alt=\"2017126231022\"></p>\n<p>运行时,一次客户机对服务器的RPC调用,其内部操作大致有如下十步：</p>\n<ol>\n<li>调用客户端句柄；执行传送参数</li>\n<li>调用本地系统内核发送网络消息</li>\n<li>消息传送到远程主机</li>\n<li>服务器句柄得到消息并取得参数</li>\n<li>执行远程过程</li>\n<li>执行的过程将结果返回服务器句柄</li>\n<li>服务器句柄返回结果，调用远程系统内核</li>\n<li>消息传回本地主机</li>\n<li>客户句柄由内核接收消息</li>\n<li>客户接收句柄返回的数据</li>\n</ol>\n<h1 id=\"NIO\"><a href=\"#NIO\" class=\"headerlink\" title=\"NIO\"></a>NIO</h1><p>nio 是New IO 的简称，在jdk1.4 里提供的新api 。<br>Sun 官方标榜的特性如下：   </p>\n<ol>\n<li>为所有的原始类型提供(Buffer)缓存支持。字符集编码解码解决方案。 </li>\n<li>Channel ：一个新的原始I/O 抽象。 </li>\n<li>支持锁和内存映射文件的文件访问接口。 </li>\n<li>提供多路(non-bloking) 非阻塞式的高伸缩性网络I/O 。</li>\n</ol>\n<h2 id=\"socket-nio原理\"><a href=\"#socket-nio原理\" class=\"headerlink\" title=\"socket nio原理\"></a>socket nio原理</h2><h3 id=\"传统的I-O\"><a href=\"#传统的I-O\" class=\"headerlink\" title=\"传统的I/O\"></a>传统的I/O</h3><p>使用传统的I/O程序读取文件内容, 并写入到另一个文件(或Socket), 如下程序:<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\">File.read(fileDesc, buf, len);</div><div class=\"line\">Socket.send(socket, buf, len);</div></pre></td></tr></table></figure></p>\n<p>会有较大的性能开销, 主要表现在一下两方面:</p>\n<ol>\n<li>上下文切换(context switch), 此处有4次用户态和内核态的切换</li>\n<li>Buffer内存开销, 一个是应用程序buffer, 另一个是系统读取buffer以及socket buffer</li>\n</ol>\n<p>其运行示意图如下<br><img src=\"http://ovasdkxqr.bkt.clouddn.com/image/blog/2017127225741.png\" alt=\"2017127225741\"></p>\n<ol>\n<li>先将文件内容从磁盘中拷贝到操作系统buffer</li>\n<li>再从操作系统buffer拷贝到程序应用buffer</li>\n<li>从程序buffer拷贝到socket buffer</li>\n<li>从socket buffer拷贝到协议引擎.</li>\n</ol>\n<h2 id=\"NIO-1\"><a href=\"#NIO-1\" class=\"headerlink\" title=\"NIO\"></a>NIO</h2><p>NIO技术省去了将操作系统的read buffer拷贝到程序的buffer, 以及从程序buffer拷贝到socket buffer的步骤, 直接将 read buffer 拷贝到 socket buffer. java 的 FileChannel.transferTo() 方法就是这样的实现, 这个实现是依赖于操作系统底层的sendFile()实现的.<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">publicvoid transferTo(long position, long count, WritableByteChannel target);</div></pre></td></tr></table></figure></p>\n<p>他的底层调用的是系统调用sendFile()方法<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">sendfile(int out_fd, int in_fd, off_t *offset, size_t count);</div></pre></td></tr></table></figure></p>\n<p>如下图<br><img src=\"http://ovasdkxqr.bkt.clouddn.com/image/blog/201712723052.png\" alt=\"201712723052\"></p>\n<p>参考帖子：<a href=\"http://blog.csdn.net/dd864140130/article/details/50299687\" target=\"_blank\" rel=\"external\">http://blog.csdn.net/dd864140130/article/details/50299687</a></p>\n<h1 id=\"轻量级RPC开发\"><a href=\"#轻量级RPC开发\" class=\"headerlink\" title=\"轻量级RPC开发\"></a>轻量级RPC开发</h1><h2 id=\"轻量级RPC框架需求分析及原理分析\"><a href=\"#轻量级RPC框架需求分析及原理分析\" class=\"headerlink\" title=\"轻量级RPC框架需求分析及原理分析\"></a>轻量级RPC框架需求分析及原理分析</h2><p><img src=\"http://ovasdkxqr.bkt.clouddn.com/image/blog/2017126231155.png\" alt=\"2017126231155\"></p>\n<h2 id=\"大概流程\"><a href=\"#大概流程\" class=\"headerlink\" title=\"大概流程\"></a>大概流程</h2><p><img src=\"http://ovasdkxqr.bkt.clouddn.com/image/blog/20181115823.png\" alt=\"20181115823\"></p>\n<h2 id=\"工程目录\"><a href=\"#工程目录\" class=\"headerlink\" title=\"工程目录\"></a>工程目录</h2><p><img src=\"http://ovasdkxqr.bkt.clouddn.com/image/blog/20181115919.png\" alt=\"20181115919\"></p>\n<ul>\n<li>rpc-sample-server   用户服务端 业务实现类 </li>\n<li>rpc-sample-common   用户公用包 包含了业务接口</li>\n<li>rpc-sample-app      用户客户端 调用业务接口</li>\n<li>rpc-server          框架 服务包</li>\n<li>rpc-registry        框架 注册和发现 zk用的包</li>\n<li>rpc-common          框架 公共包 request response 加密 解密 序列化等公用类</li>\n<li>rpc-client          框架 客户包<h2 id=\"框架\"><a href=\"#框架\" class=\"headerlink\" title=\"框架\"></a>框架</h2>rpc-server 主要利用<code>反射</code>将接收到的request进行解析、执行、返回结果。<br>rpc-client 主要使用<code>动态代理</code>将接口的调用 封装进request进行请求，然后返回结果。</li>\n</ul>\n","site":{"data":{}},"excerpt":"<p>1、掌握RPC原理<br>2、掌握nio操作<br>3、掌握netty简单的api<br>4、掌握自定义RPC框架<br>","more":"</p>\n<h1 id=\"RPC原理\"><a href=\"#RPC原理\" class=\"headerlink\" title=\"RPC原理\"></a>RPC原理</h1><h2 id=\"什么是RPC\"><a href=\"#什么是RPC\" class=\"headerlink\" title=\"什么是RPC\"></a>什么是RPC</h2><p>RPC（Remote Procedure Call Protocol）——<code>远程过程调用协议</code>，它是一种通过网络从远程计算机程序上请求服务，而不需要了解底层网络技术的协议。RPC协议假定某些传输协议的存在，如TCP或UDP，为通信程序之间携带信息数据。在OSI网络通信模型中，RPC跨越了传输层和应用层。RPC使得开发包括网络分布式多程序在内的应用程序更加容易。<br>RPC采用<code>客户机/服务器模式</code>。请求程序就是一个客户机，而服务提供程序就是一个服务器。首先，客户机调用进程发送一个有进程参数的调用信息到服务进程，然后等待应答信息。在服务器端，进程保持睡眠状态直到调用信息到达为止。当一个调用信息到达，服务器获得进程参数，计算结果，发送答复信息，然后等待下一个调用信息，最后，客户端调用进程接收答复信息，获得进程结果，然后调用执行继续进行。</p>\n<h2 id=\"RPC原理-1\"><a href=\"#RPC原理-1\" class=\"headerlink\" title=\"RPC原理\"></a>RPC原理</h2><p><img src=\"http://ovasdkxqr.bkt.clouddn.com/image/blog/2017126231022.png\" alt=\"2017126231022\"></p>\n<p>运行时,一次客户机对服务器的RPC调用,其内部操作大致有如下十步：</p>\n<ol>\n<li>调用客户端句柄；执行传送参数</li>\n<li>调用本地系统内核发送网络消息</li>\n<li>消息传送到远程主机</li>\n<li>服务器句柄得到消息并取得参数</li>\n<li>执行远程过程</li>\n<li>执行的过程将结果返回服务器句柄</li>\n<li>服务器句柄返回结果，调用远程系统内核</li>\n<li>消息传回本地主机</li>\n<li>客户句柄由内核接收消息</li>\n<li>客户接收句柄返回的数据</li>\n</ol>\n<h1 id=\"NIO\"><a href=\"#NIO\" class=\"headerlink\" title=\"NIO\"></a>NIO</h1><p>nio 是New IO 的简称，在jdk1.4 里提供的新api 。<br>Sun 官方标榜的特性如下：   </p>\n<ol>\n<li>为所有的原始类型提供(Buffer)缓存支持。字符集编码解码解决方案。 </li>\n<li>Channel ：一个新的原始I/O 抽象。 </li>\n<li>支持锁和内存映射文件的文件访问接口。 </li>\n<li>提供多路(non-bloking) 非阻塞式的高伸缩性网络I/O 。</li>\n</ol>\n<h2 id=\"socket-nio原理\"><a href=\"#socket-nio原理\" class=\"headerlink\" title=\"socket nio原理\"></a>socket nio原理</h2><h3 id=\"传统的I-O\"><a href=\"#传统的I-O\" class=\"headerlink\" title=\"传统的I/O\"></a>传统的I/O</h3><p>使用传统的I/O程序读取文件内容, 并写入到另一个文件(或Socket), 如下程序:<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\">File.read(fileDesc, buf, len);</div><div class=\"line\">Socket.send(socket, buf, len);</div></pre></td></tr></table></figure></p>\n<p>会有较大的性能开销, 主要表现在一下两方面:</p>\n<ol>\n<li>上下文切换(context switch), 此处有4次用户态和内核态的切换</li>\n<li>Buffer内存开销, 一个是应用程序buffer, 另一个是系统读取buffer以及socket buffer</li>\n</ol>\n<p>其运行示意图如下<br><img src=\"http://ovasdkxqr.bkt.clouddn.com/image/blog/2017127225741.png\" alt=\"2017127225741\"></p>\n<ol>\n<li>先将文件内容从磁盘中拷贝到操作系统buffer</li>\n<li>再从操作系统buffer拷贝到程序应用buffer</li>\n<li>从程序buffer拷贝到socket buffer</li>\n<li>从socket buffer拷贝到协议引擎.</li>\n</ol>\n<h2 id=\"NIO-1\"><a href=\"#NIO-1\" class=\"headerlink\" title=\"NIO\"></a>NIO</h2><p>NIO技术省去了将操作系统的read buffer拷贝到程序的buffer, 以及从程序buffer拷贝到socket buffer的步骤, 直接将 read buffer 拷贝到 socket buffer. java 的 FileChannel.transferTo() 方法就是这样的实现, 这个实现是依赖于操作系统底层的sendFile()实现的.<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">publicvoid transferTo(long position, long count, WritableByteChannel target);</div></pre></td></tr></table></figure></p>\n<p>他的底层调用的是系统调用sendFile()方法<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">sendfile(int out_fd, int in_fd, off_t *offset, size_t count);</div></pre></td></tr></table></figure></p>\n<p>如下图<br><img src=\"http://ovasdkxqr.bkt.clouddn.com/image/blog/201712723052.png\" alt=\"201712723052\"></p>\n<p>参考帖子：<a href=\"http://blog.csdn.net/dd864140130/article/details/50299687\" target=\"_blank\" rel=\"external\">http://blog.csdn.net/dd864140130/article/details/50299687</a></p>\n<h1 id=\"轻量级RPC开发\"><a href=\"#轻量级RPC开发\" class=\"headerlink\" title=\"轻量级RPC开发\"></a>轻量级RPC开发</h1><h2 id=\"轻量级RPC框架需求分析及原理分析\"><a href=\"#轻量级RPC框架需求分析及原理分析\" class=\"headerlink\" title=\"轻量级RPC框架需求分析及原理分析\"></a>轻量级RPC框架需求分析及原理分析</h2><p><img src=\"http://ovasdkxqr.bkt.clouddn.com/image/blog/2017126231155.png\" alt=\"2017126231155\"></p>\n<h2 id=\"大概流程\"><a href=\"#大概流程\" class=\"headerlink\" title=\"大概流程\"></a>大概流程</h2><p><img src=\"http://ovasdkxqr.bkt.clouddn.com/image/blog/20181115823.png\" alt=\"20181115823\"></p>\n<h2 id=\"工程目录\"><a href=\"#工程目录\" class=\"headerlink\" title=\"工程目录\"></a>工程目录</h2><p><img src=\"http://ovasdkxqr.bkt.clouddn.com/image/blog/20181115919.png\" alt=\"20181115919\"></p>\n<ul>\n<li>rpc-sample-server   用户服务端 业务实现类 </li>\n<li>rpc-sample-common   用户公用包 包含了业务接口</li>\n<li>rpc-sample-app      用户客户端 调用业务接口</li>\n<li>rpc-server          框架 服务包</li>\n<li>rpc-registry        框架 注册和发现 zk用的包</li>\n<li>rpc-common          框架 公共包 request response 加密 解密 序列化等公用类</li>\n<li>rpc-client          框架 客户包<h2 id=\"框架\"><a href=\"#框架\" class=\"headerlink\" title=\"框架\"></a>框架</h2>rpc-server 主要利用<code>反射</code>将接收到的request进行解析、执行、返回结果。<br>rpc-client 主要使用<code>动态代理</code>将接口的调用 封装进request进行请求，然后返回结果。</li>\n</ul>"},{"title":"aws-vpn","toc":true,"date":"2018-01-02T16:20:16.000Z","scaffolds":null,"_content":"\n# aws服务器的创建及vpn的安装\nhttps://www.jianshu.com/p/b0d460efca4e\n\n# 配置 IPsec/L2TP VPN 客户端\nhttps://github.com/hwdsl2/setup-ipsec-vpn/blob/master/docs/clients-zh.md#windows\n## 注册表修改\nhttps://github.com/hwdsl2/setup-ipsec-vpn/blob/master/docs/clients-zh.md#windows-错误-809 \n\nwindows10注册表修改,然后需要重启才能连上vpn \n```\nREG ADD HKLM\\SYSTEM\\CurrentControlSet\\Services\\PolicyAgent /v AssumeUDPEncapsulationContextOnSendRule /t REG_DWORD /d 0x2 /f\n```\n","source":"_posts/杂记/aws-vpn.md","raw":"---\ntitle: aws-vpn\ncategories: 工具\ntags:\n  - vpn\n  - aws\ntoc: true\ndate: 2018-01-03 00:20:16\nscaffolds:\n---\n\n# aws服务器的创建及vpn的安装\nhttps://www.jianshu.com/p/b0d460efca4e\n\n# 配置 IPsec/L2TP VPN 客户端\nhttps://github.com/hwdsl2/setup-ipsec-vpn/blob/master/docs/clients-zh.md#windows\n## 注册表修改\nhttps://github.com/hwdsl2/setup-ipsec-vpn/blob/master/docs/clients-zh.md#windows-错误-809 \n\nwindows10注册表修改,然后需要重启才能连上vpn \n```\nREG ADD HKLM\\SYSTEM\\CurrentControlSet\\Services\\PolicyAgent /v AssumeUDPEncapsulationContextOnSendRule /t REG_DWORD /d 0x2 /f\n```\n","slug":"杂记/aws-vpn","published":1,"updated":"2018-01-06T16:23:24.547Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjcsq4lk10044x4vf9h4k571d","content":"<h1 id=\"aws服务器的创建及vpn的安装\"><a href=\"#aws服务器的创建及vpn的安装\" class=\"headerlink\" title=\"aws服务器的创建及vpn的安装\"></a>aws服务器的创建及vpn的安装</h1><p><a href=\"https://www.jianshu.com/p/b0d460efca4e\" target=\"_blank\" rel=\"external\">https://www.jianshu.com/p/b0d460efca4e</a></p>\n<h1 id=\"配置-IPsec-L2TP-VPN-客户端\"><a href=\"#配置-IPsec-L2TP-VPN-客户端\" class=\"headerlink\" title=\"配置 IPsec/L2TP VPN 客户端\"></a>配置 IPsec/L2TP VPN 客户端</h1><p><a href=\"https://github.com/hwdsl2/setup-ipsec-vpn/blob/master/docs/clients-zh.md#windows\" target=\"_blank\" rel=\"external\">https://github.com/hwdsl2/setup-ipsec-vpn/blob/master/docs/clients-zh.md#windows</a></p>\n<h2 id=\"注册表修改\"><a href=\"#注册表修改\" class=\"headerlink\" title=\"注册表修改\"></a>注册表修改</h2><p><a href=\"https://github.com/hwdsl2/setup-ipsec-vpn/blob/master/docs/clients-zh.md#windows-错误-809\" target=\"_blank\" rel=\"external\">https://github.com/hwdsl2/setup-ipsec-vpn/blob/master/docs/clients-zh.md#windows-错误-809</a> </p>\n<p>windows10注册表修改,然后需要重启才能连上vpn<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">REG ADD HKLM\\SYSTEM\\CurrentControlSet\\Services\\PolicyAgent /v AssumeUDPEncapsulationContextOnSendRule /t REG_DWORD /d 0x2 /f</div></pre></td></tr></table></figure></p>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"aws服务器的创建及vpn的安装\"><a href=\"#aws服务器的创建及vpn的安装\" class=\"headerlink\" title=\"aws服务器的创建及vpn的安装\"></a>aws服务器的创建及vpn的安装</h1><p><a href=\"https://www.jianshu.com/p/b0d460efca4e\" target=\"_blank\" rel=\"external\">https://www.jianshu.com/p/b0d460efca4e</a></p>\n<h1 id=\"配置-IPsec-L2TP-VPN-客户端\"><a href=\"#配置-IPsec-L2TP-VPN-客户端\" class=\"headerlink\" title=\"配置 IPsec/L2TP VPN 客户端\"></a>配置 IPsec/L2TP VPN 客户端</h1><p><a href=\"https://github.com/hwdsl2/setup-ipsec-vpn/blob/master/docs/clients-zh.md#windows\" target=\"_blank\" rel=\"external\">https://github.com/hwdsl2/setup-ipsec-vpn/blob/master/docs/clients-zh.md#windows</a></p>\n<h2 id=\"注册表修改\"><a href=\"#注册表修改\" class=\"headerlink\" title=\"注册表修改\"></a>注册表修改</h2><p><a href=\"https://github.com/hwdsl2/setup-ipsec-vpn/blob/master/docs/clients-zh.md#windows-错误-809\" target=\"_blank\" rel=\"external\">https://github.com/hwdsl2/setup-ipsec-vpn/blob/master/docs/clients-zh.md#windows-错误-809</a> </p>\n<p>windows10注册表修改,然后需要重启才能连上vpn<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">REG ADD HKLM\\SYSTEM\\CurrentControlSet\\Services\\PolicyAgent /v AssumeUDPEncapsulationContextOnSendRule /t REG_DWORD /d 0x2 /f</div></pre></td></tr></table></figure></p>\n"},{"title":"大数据0404-java动态代理","toc":true,"date":"2017-12-03T10:18:16.000Z","scaffolds":null,"_content":"\n#  动态代理\n在之前的代码调用阶段，我们用action调用service的方法实现业务即可。  \n由于之前在service中实现的业务可能不能够满足当先客户的要求，需要我们重新修改service中的方法，但是service的方法不只在我们这个模块使用，在其他模块也在调用，其他模块调用的时候，现有的service方法已经能够满足业务需求，所以我们不能只为了我们的业务而修改service，导致其他模块授影响。  \n那怎么办呢？  \n可以通过动态代理的方式，扩展我们的service中的方法实现，使得在原有的方法中增加更多的业务，而不是实际修改service中的方法，这种实现技术就叫做动态代理。  \n动态代理：在不修改原业务的基础上，基于原业务方法，进行重新的扩展，实现新的业务。  \n## 例如下面的例子：  \n- 旧业务  \n买家调用action，购买衣服，衣服在数据库的标价为50元，购买流程就是简单的调用。\n- 新业务  \n在原先的价格上可以使用优惠券，但是这个功能在以前没有实现过，我们通过代理类，代理了原先的接口方法，在这个方法的基础上，修改了返回值。\n\t \n代理实现流程：\n1. 书写代理类和代理方法，在代理方法中实现代理Proxy.newProxyInstance\n1. 代理中需要的参数分别为：被代理的类的类加载器soneObjectclass.getClassLoader()，被代理类的所有实现接口new Class[] { Interface.class }，句柄方法new InvocationHandler()\n1. 在句柄方法中复写invoke方法，invoke方法的输入有3个参数Object proxy（代理类对象）, Method method（被代理类的方法）,Object[] args（被代理类方法的传入参数），在这个方法中，我们可以定制化的开发新的业务。\n1. 获取代理类，强转成被代理的接口\n1. 最后，我们可以像没被代理一样，调用接口的认可方法，方法被调用后，方法名和参数列表将被传入代理类的invoke方法中，进行新业务的逻辑流程。\n\n\n```java\n原业务接口IBoss=================================\n/**\n * 这是一个业务的接口，这个接口中的业务就是返回衣服的价格\n * @author wilson\n *\n */\npublic interface IBoss {//接口\n\tint yifu(String size);\n}\n\n原业务实现类====================================\npublic class Boss implements IBoss{\n\tpublic int yifu(String size){\n\t\tSystem.err.println(\"天猫小强旗舰店，老板给客户发快递----衣服型号：\"+size);\n\t\t//这件衣服的价钱，从数据库读取\n\t\treturn 50;\n\t}\n\tpublic void kuzi(){\n\t\tSystem.err.println(\"天猫小强旗舰店，老板给客户发快递----裤子\");\n\t}\n}\n原业务调用====================================\npublic class SaleAction {\n\t\t@Test\n\tpublic void saleByBossSelf() throws Exception {\n\t\tIBoss boss = new Boss();\n\t\tSystem.out.println(\"老板自营！\");\n\t\tint money = boss.yifu(\"xxl\");\n\t\tSystem.out.println(\"衣服成交价：\" + money);\n\t}\n}\n代理类========================================\nimport java.lang.reflect.InvocationHandler;\nimport java.lang.reflect.Method;\nimport java.lang.reflect.Proxy;\npublic class ProxyBoss {\n\t/**\n\t * 对接口方法进行代理\n\t */\n\t@SuppressWarnings(\"unchecked\")\n\tpublic static <T> T getProxy(final int discountCoupon,\n\t\t\tfinal Class<?> interfaceClass, final Class<?> implementsClass)\n\t\t\tthrows Exception {\n\t\treturn (T) Proxy.newProxyInstance(interfaceClass.getClassLoader(),\n\t\t\t\tnew Class[] { interfaceClass }, new InvocationHandler() {\n\t\t\t\t\tpublic Object invoke(Object proxy, Method method,\n\t\t\t\t\t\t\tObject[] args) throws Throwable {\n\t\t\t\t\t\tInteger returnValue = (Integer) method.invoke(\n\t\t\t\t\t\t\t\timplementsClass.newInstance(), args);// 调用原始对象以后返回的值\n\t\t\t\t\t\treturn returnValue - discountCoupon;\n\t\t\t\t\t}\n\t\t\t\t});\n\t}\n}\n\n新业务调用=======================================\nimport org.junit.Test;\nimport cn.itcast_05_proxy.proxyclass.ProxyBoss;\nimport cn.itcast_05_proxy.service.IBoss;\nimport cn.itcast_05_proxy.service.impl.Boss;\n/**\n * 什么是动态代理？ 简单的写一个模板接口，剩下的个性化工作，好给动态代理来完成！\n */\npublic class ProxySaleAction {\n\t/**\n\t *使用代理，在这个代理中，只代理了Boss的yifu方法\n\t *定制化业务，可以改变原接口的参数、返回值等\n\t */\n\t@Test\n\tpublic void saleByProxy() throws Exception {\n\t\tIBoss boss = ProxyBoss.getProxy(10,IBoss.class,Boss.class);// 将代理的方法实例化成接口\n\t\t//IBoss boss = new Boss();// 将代理的方法实例化成接口\n\t\tSystem.out.println(\"代理经营！\");\n\t\tint money = boss.yifu(\"xxl\");// 调用接口的方法，实际上调用方式没有变\n\t\tSystem.out.println(\"衣服成交价：\" + money);\n\t}\n}\n\n```\n","source":"_posts/大数据/大数据0404-java动态代理.md","raw":"---\ntitle: 大数据0404-java动态代理\ncategories: 学习\ntags:\n  - 大数据\n  - java\n  - 动态代理\ntoc: true\ndate: 2017-12-03 18:18:16\nscaffolds:\n---\n\n#  动态代理\n在之前的代码调用阶段，我们用action调用service的方法实现业务即可。  \n由于之前在service中实现的业务可能不能够满足当先客户的要求，需要我们重新修改service中的方法，但是service的方法不只在我们这个模块使用，在其他模块也在调用，其他模块调用的时候，现有的service方法已经能够满足业务需求，所以我们不能只为了我们的业务而修改service，导致其他模块授影响。  \n那怎么办呢？  \n可以通过动态代理的方式，扩展我们的service中的方法实现，使得在原有的方法中增加更多的业务，而不是实际修改service中的方法，这种实现技术就叫做动态代理。  \n动态代理：在不修改原业务的基础上，基于原业务方法，进行重新的扩展，实现新的业务。  \n## 例如下面的例子：  \n- 旧业务  \n买家调用action，购买衣服，衣服在数据库的标价为50元，购买流程就是简单的调用。\n- 新业务  \n在原先的价格上可以使用优惠券，但是这个功能在以前没有实现过，我们通过代理类，代理了原先的接口方法，在这个方法的基础上，修改了返回值。\n\t \n代理实现流程：\n1. 书写代理类和代理方法，在代理方法中实现代理Proxy.newProxyInstance\n1. 代理中需要的参数分别为：被代理的类的类加载器soneObjectclass.getClassLoader()，被代理类的所有实现接口new Class[] { Interface.class }，句柄方法new InvocationHandler()\n1. 在句柄方法中复写invoke方法，invoke方法的输入有3个参数Object proxy（代理类对象）, Method method（被代理类的方法）,Object[] args（被代理类方法的传入参数），在这个方法中，我们可以定制化的开发新的业务。\n1. 获取代理类，强转成被代理的接口\n1. 最后，我们可以像没被代理一样，调用接口的认可方法，方法被调用后，方法名和参数列表将被传入代理类的invoke方法中，进行新业务的逻辑流程。\n\n\n```java\n原业务接口IBoss=================================\n/**\n * 这是一个业务的接口，这个接口中的业务就是返回衣服的价格\n * @author wilson\n *\n */\npublic interface IBoss {//接口\n\tint yifu(String size);\n}\n\n原业务实现类====================================\npublic class Boss implements IBoss{\n\tpublic int yifu(String size){\n\t\tSystem.err.println(\"天猫小强旗舰店，老板给客户发快递----衣服型号：\"+size);\n\t\t//这件衣服的价钱，从数据库读取\n\t\treturn 50;\n\t}\n\tpublic void kuzi(){\n\t\tSystem.err.println(\"天猫小强旗舰店，老板给客户发快递----裤子\");\n\t}\n}\n原业务调用====================================\npublic class SaleAction {\n\t\t@Test\n\tpublic void saleByBossSelf() throws Exception {\n\t\tIBoss boss = new Boss();\n\t\tSystem.out.println(\"老板自营！\");\n\t\tint money = boss.yifu(\"xxl\");\n\t\tSystem.out.println(\"衣服成交价：\" + money);\n\t}\n}\n代理类========================================\nimport java.lang.reflect.InvocationHandler;\nimport java.lang.reflect.Method;\nimport java.lang.reflect.Proxy;\npublic class ProxyBoss {\n\t/**\n\t * 对接口方法进行代理\n\t */\n\t@SuppressWarnings(\"unchecked\")\n\tpublic static <T> T getProxy(final int discountCoupon,\n\t\t\tfinal Class<?> interfaceClass, final Class<?> implementsClass)\n\t\t\tthrows Exception {\n\t\treturn (T) Proxy.newProxyInstance(interfaceClass.getClassLoader(),\n\t\t\t\tnew Class[] { interfaceClass }, new InvocationHandler() {\n\t\t\t\t\tpublic Object invoke(Object proxy, Method method,\n\t\t\t\t\t\t\tObject[] args) throws Throwable {\n\t\t\t\t\t\tInteger returnValue = (Integer) method.invoke(\n\t\t\t\t\t\t\t\timplementsClass.newInstance(), args);// 调用原始对象以后返回的值\n\t\t\t\t\t\treturn returnValue - discountCoupon;\n\t\t\t\t\t}\n\t\t\t\t});\n\t}\n}\n\n新业务调用=======================================\nimport org.junit.Test;\nimport cn.itcast_05_proxy.proxyclass.ProxyBoss;\nimport cn.itcast_05_proxy.service.IBoss;\nimport cn.itcast_05_proxy.service.impl.Boss;\n/**\n * 什么是动态代理？ 简单的写一个模板接口，剩下的个性化工作，好给动态代理来完成！\n */\npublic class ProxySaleAction {\n\t/**\n\t *使用代理，在这个代理中，只代理了Boss的yifu方法\n\t *定制化业务，可以改变原接口的参数、返回值等\n\t */\n\t@Test\n\tpublic void saleByProxy() throws Exception {\n\t\tIBoss boss = ProxyBoss.getProxy(10,IBoss.class,Boss.class);// 将代理的方法实例化成接口\n\t\t//IBoss boss = new Boss();// 将代理的方法实例化成接口\n\t\tSystem.out.println(\"代理经营！\");\n\t\tint money = boss.yifu(\"xxl\");// 调用接口的方法，实际上调用方式没有变\n\t\tSystem.out.println(\"衣服成交价：\" + money);\n\t}\n}\n\n```\n","slug":"大数据/大数据0404-java动态代理","published":1,"updated":"2017-12-03T10:30:22.149Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjcsq4lk30046x4vfzh3uqcg7","content":"<h1 id=\"动态代理\"><a href=\"#动态代理\" class=\"headerlink\" title=\"动态代理\"></a>动态代理</h1><p>在之前的代码调用阶段，我们用action调用service的方法实现业务即可。<br>由于之前在service中实现的业务可能不能够满足当先客户的要求，需要我们重新修改service中的方法，但是service的方法不只在我们这个模块使用，在其他模块也在调用，其他模块调用的时候，现有的service方法已经能够满足业务需求，所以我们不能只为了我们的业务而修改service，导致其他模块授影响。<br>那怎么办呢？<br>可以通过动态代理的方式，扩展我们的service中的方法实现，使得在原有的方法中增加更多的业务，而不是实际修改service中的方法，这种实现技术就叫做动态代理。<br>动态代理：在不修改原业务的基础上，基于原业务方法，进行重新的扩展，实现新的业务。  </p>\n<h2 id=\"例如下面的例子：\"><a href=\"#例如下面的例子：\" class=\"headerlink\" title=\"例如下面的例子：\"></a>例如下面的例子：</h2><ul>\n<li>旧业务<br>买家调用action，购买衣服，衣服在数据库的标价为50元，购买流程就是简单的调用。</li>\n<li>新业务<br>在原先的价格上可以使用优惠券，但是这个功能在以前没有实现过，我们通过代理类，代理了原先的接口方法，在这个方法的基础上，修改了返回值。</li>\n</ul>\n<p>代理实现流程：</p>\n<ol>\n<li>书写代理类和代理方法，在代理方法中实现代理Proxy.newProxyInstance</li>\n<li>代理中需要的参数分别为：被代理的类的类加载器soneObjectclass.getClassLoader()，被代理类的所有实现接口new Class[] { Interface.class }，句柄方法new InvocationHandler()</li>\n<li>在句柄方法中复写invoke方法，invoke方法的输入有3个参数Object proxy（代理类对象）, Method method（被代理类的方法）,Object[] args（被代理类方法的传入参数），在这个方法中，我们可以定制化的开发新的业务。</li>\n<li>获取代理类，强转成被代理的接口</li>\n<li>最后，我们可以像没被代理一样，调用接口的认可方法，方法被调用后，方法名和参数列表将被传入代理类的invoke方法中，进行新业务的逻辑流程。</li>\n</ol>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div></pre></td><td class=\"code\"><pre><div class=\"line\">原业务接口IBoss=================================</div><div class=\"line\"><span class=\"comment\">/**</span></div><div class=\"line\"><span class=\"comment\"> * 这是一个业务的接口，这个接口中的业务就是返回衣服的价格</span></div><div class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> wilson</span></div><div class=\"line\"><span class=\"comment\"> *</span></div><div class=\"line\"><span class=\"comment\"> */</span></div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">IBoss</span> </span>&#123;<span class=\"comment\">//接口</span></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">yifu</span><span class=\"params\">(String size)</span></span>;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\">原业务实现类====================================</div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Boss</span> <span class=\"keyword\">implements</span> <span class=\"title\">IBoss</span></span>&#123;</div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">int</span> <span class=\"title\">yifu</span><span class=\"params\">(String size)</span></span>&#123;</div><div class=\"line\">\t\tSystem.err.println(<span class=\"string\">\"天猫小强旗舰店，老板给客户发快递----衣服型号：\"</span>+size);</div><div class=\"line\">\t\t<span class=\"comment\">//这件衣服的价钱，从数据库读取</span></div><div class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"number\">50</span>;</div><div class=\"line\">\t&#125;</div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">kuzi</span><span class=\"params\">()</span></span>&#123;</div><div class=\"line\">\t\tSystem.err.println(<span class=\"string\">\"天猫小强旗舰店，老板给客户发快递----裤子\"</span>);</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div><div class=\"line\">原业务调用====================================</div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">SaleAction</span> </span>&#123;</div><div class=\"line\">\t\t<span class=\"meta\">@Test</span></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">saleByBossSelf</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</div><div class=\"line\">\t\tIBoss boss = <span class=\"keyword\">new</span> Boss();</div><div class=\"line\">\t\tSystem.out.println(<span class=\"string\">\"老板自营！\"</span>);</div><div class=\"line\">\t\t<span class=\"keyword\">int</span> money = boss.yifu(<span class=\"string\">\"xxl\"</span>);</div><div class=\"line\">\t\tSystem.out.println(<span class=\"string\">\"衣服成交价：\"</span> + money);</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div><div class=\"line\">代理类========================================</div><div class=\"line\"><span class=\"keyword\">import</span> java.lang.reflect.InvocationHandler;</div><div class=\"line\"><span class=\"keyword\">import</span> java.lang.reflect.Method;</div><div class=\"line\"><span class=\"keyword\">import</span> java.lang.reflect.Proxy;</div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ProxyBoss</span> </span>&#123;</div><div class=\"line\">\t<span class=\"comment\">/**</span></div><div class=\"line\"><span class=\"comment\">\t * 对接口方法进行代理</span></div><div class=\"line\"><span class=\"comment\">\t */</span></div><div class=\"line\">\t<span class=\"meta\">@SuppressWarnings</span>(<span class=\"string\">\"unchecked\"</span>)</div><div class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"keyword\">static</span> &lt;T&gt; <span class=\"function\">T <span class=\"title\">getProxy</span><span class=\"params\">(<span class=\"keyword\">final</span> <span class=\"keyword\">int</span> discountCoupon,</span></span></div><div class=\"line\"><span class=\"function\"><span class=\"params\">\t\t\t<span class=\"keyword\">final</span> Class&lt;?&gt; interfaceClass, <span class=\"keyword\">final</span> Class&lt;?&gt; implementsClass)</span></span></div><div class=\"line\"><span class=\"function\">\t\t\t<span class=\"keyword\">throws</span> Exception </span>&#123;</div><div class=\"line\">\t\t<span class=\"keyword\">return</span> (T) Proxy.newProxyInstance(interfaceClass.getClassLoader(),</div><div class=\"line\">\t\t\t\t<span class=\"keyword\">new</span> Class[] &#123; interfaceClass &#125;, <span class=\"keyword\">new</span> InvocationHandler() &#123;</div><div class=\"line\">\t\t\t\t\t<span class=\"function\"><span class=\"keyword\">public</span> Object <span class=\"title\">invoke</span><span class=\"params\">(Object proxy, Method method,</span></span></div><div class=\"line\"><span class=\"function\"><span class=\"params\">\t\t\t\t\t\t\tObject[] args)</span> <span class=\"keyword\">throws</span> Throwable </span>&#123;</div><div class=\"line\">\t\t\t\t\t\tInteger returnValue = (Integer) method.invoke(</div><div class=\"line\">\t\t\t\t\t\t\t\timplementsClass.newInstance(), args);<span class=\"comment\">// 调用原始对象以后返回的值</span></div><div class=\"line\">\t\t\t\t\t\t<span class=\"keyword\">return</span> returnValue - discountCoupon;</div><div class=\"line\">\t\t\t\t\t&#125;</div><div class=\"line\">\t\t\t\t&#125;);</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\">新业务调用=======================================</div><div class=\"line\"><span class=\"keyword\">import</span> org.junit.Test;</div><div class=\"line\"><span class=\"keyword\">import</span> cn.itcast_05_proxy.proxyclass.ProxyBoss;</div><div class=\"line\"><span class=\"keyword\">import</span> cn.itcast_05_proxy.service.IBoss;</div><div class=\"line\"><span class=\"keyword\">import</span> cn.itcast_05_proxy.service.impl.Boss;</div><div class=\"line\"><span class=\"comment\">/**</span></div><div class=\"line\"><span class=\"comment\"> * 什么是动态代理？ 简单的写一个模板接口，剩下的个性化工作，好给动态代理来完成！</span></div><div class=\"line\"><span class=\"comment\"> */</span></div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ProxySaleAction</span> </span>&#123;</div><div class=\"line\">\t<span class=\"comment\">/**</span></div><div class=\"line\"><span class=\"comment\">\t *使用代理，在这个代理中，只代理了Boss的yifu方法</span></div><div class=\"line\"><span class=\"comment\">\t *定制化业务，可以改变原接口的参数、返回值等</span></div><div class=\"line\"><span class=\"comment\">\t */</span></div><div class=\"line\">\t<span class=\"meta\">@Test</span></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">saleByProxy</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</div><div class=\"line\">\t\tIBoss boss = ProxyBoss.getProxy(<span class=\"number\">10</span>,IBoss.class,Boss.class);<span class=\"comment\">// 将代理的方法实例化成接口</span></div><div class=\"line\">\t\t<span class=\"comment\">//IBoss boss = new Boss();// 将代理的方法实例化成接口</span></div><div class=\"line\">\t\tSystem.out.println(<span class=\"string\">\"代理经营！\"</span>);</div><div class=\"line\">\t\t<span class=\"keyword\">int</span> money = boss.yifu(<span class=\"string\">\"xxl\"</span>);<span class=\"comment\">// 调用接口的方法，实际上调用方式没有变</span></div><div class=\"line\">\t\tSystem.out.println(<span class=\"string\">\"衣服成交价：\"</span> + money);</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"动态代理\"><a href=\"#动态代理\" class=\"headerlink\" title=\"动态代理\"></a>动态代理</h1><p>在之前的代码调用阶段，我们用action调用service的方法实现业务即可。<br>由于之前在service中实现的业务可能不能够满足当先客户的要求，需要我们重新修改service中的方法，但是service的方法不只在我们这个模块使用，在其他模块也在调用，其他模块调用的时候，现有的service方法已经能够满足业务需求，所以我们不能只为了我们的业务而修改service，导致其他模块授影响。<br>那怎么办呢？<br>可以通过动态代理的方式，扩展我们的service中的方法实现，使得在原有的方法中增加更多的业务，而不是实际修改service中的方法，这种实现技术就叫做动态代理。<br>动态代理：在不修改原业务的基础上，基于原业务方法，进行重新的扩展，实现新的业务。  </p>\n<h2 id=\"例如下面的例子：\"><a href=\"#例如下面的例子：\" class=\"headerlink\" title=\"例如下面的例子：\"></a>例如下面的例子：</h2><ul>\n<li>旧业务<br>买家调用action，购买衣服，衣服在数据库的标价为50元，购买流程就是简单的调用。</li>\n<li>新业务<br>在原先的价格上可以使用优惠券，但是这个功能在以前没有实现过，我们通过代理类，代理了原先的接口方法，在这个方法的基础上，修改了返回值。</li>\n</ul>\n<p>代理实现流程：</p>\n<ol>\n<li>书写代理类和代理方法，在代理方法中实现代理Proxy.newProxyInstance</li>\n<li>代理中需要的参数分别为：被代理的类的类加载器soneObjectclass.getClassLoader()，被代理类的所有实现接口new Class[] { Interface.class }，句柄方法new InvocationHandler()</li>\n<li>在句柄方法中复写invoke方法，invoke方法的输入有3个参数Object proxy（代理类对象）, Method method（被代理类的方法）,Object[] args（被代理类方法的传入参数），在这个方法中，我们可以定制化的开发新的业务。</li>\n<li>获取代理类，强转成被代理的接口</li>\n<li>最后，我们可以像没被代理一样，调用接口的认可方法，方法被调用后，方法名和参数列表将被传入代理类的invoke方法中，进行新业务的逻辑流程。</li>\n</ol>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div></pre></td><td class=\"code\"><pre><div class=\"line\">原业务接口IBoss=================================</div><div class=\"line\"><span class=\"comment\">/**</span></div><div class=\"line\"><span class=\"comment\"> * 这是一个业务的接口，这个接口中的业务就是返回衣服的价格</span></div><div class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> wilson</span></div><div class=\"line\"><span class=\"comment\"> *</span></div><div class=\"line\"><span class=\"comment\"> */</span></div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">IBoss</span> </span>&#123;<span class=\"comment\">//接口</span></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">yifu</span><span class=\"params\">(String size)</span></span>;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\">原业务实现类====================================</div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Boss</span> <span class=\"keyword\">implements</span> <span class=\"title\">IBoss</span></span>&#123;</div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">int</span> <span class=\"title\">yifu</span><span class=\"params\">(String size)</span></span>&#123;</div><div class=\"line\">\t\tSystem.err.println(<span class=\"string\">\"天猫小强旗舰店，老板给客户发快递----衣服型号：\"</span>+size);</div><div class=\"line\">\t\t<span class=\"comment\">//这件衣服的价钱，从数据库读取</span></div><div class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"number\">50</span>;</div><div class=\"line\">\t&#125;</div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">kuzi</span><span class=\"params\">()</span></span>&#123;</div><div class=\"line\">\t\tSystem.err.println(<span class=\"string\">\"天猫小强旗舰店，老板给客户发快递----裤子\"</span>);</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div><div class=\"line\">原业务调用====================================</div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">SaleAction</span> </span>&#123;</div><div class=\"line\">\t\t<span class=\"meta\">@Test</span></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">saleByBossSelf</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</div><div class=\"line\">\t\tIBoss boss = <span class=\"keyword\">new</span> Boss();</div><div class=\"line\">\t\tSystem.out.println(<span class=\"string\">\"老板自营！\"</span>);</div><div class=\"line\">\t\t<span class=\"keyword\">int</span> money = boss.yifu(<span class=\"string\">\"xxl\"</span>);</div><div class=\"line\">\t\tSystem.out.println(<span class=\"string\">\"衣服成交价：\"</span> + money);</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div><div class=\"line\">代理类========================================</div><div class=\"line\"><span class=\"keyword\">import</span> java.lang.reflect.InvocationHandler;</div><div class=\"line\"><span class=\"keyword\">import</span> java.lang.reflect.Method;</div><div class=\"line\"><span class=\"keyword\">import</span> java.lang.reflect.Proxy;</div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ProxyBoss</span> </span>&#123;</div><div class=\"line\">\t<span class=\"comment\">/**</span></div><div class=\"line\"><span class=\"comment\">\t * 对接口方法进行代理</span></div><div class=\"line\"><span class=\"comment\">\t */</span></div><div class=\"line\">\t<span class=\"meta\">@SuppressWarnings</span>(<span class=\"string\">\"unchecked\"</span>)</div><div class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"keyword\">static</span> &lt;T&gt; <span class=\"function\">T <span class=\"title\">getProxy</span><span class=\"params\">(<span class=\"keyword\">final</span> <span class=\"keyword\">int</span> discountCoupon,</span></span></div><div class=\"line\"><span class=\"function\"><span class=\"params\">\t\t\t<span class=\"keyword\">final</span> Class&lt;?&gt; interfaceClass, <span class=\"keyword\">final</span> Class&lt;?&gt; implementsClass)</span></span></div><div class=\"line\"><span class=\"function\">\t\t\t<span class=\"keyword\">throws</span> Exception </span>&#123;</div><div class=\"line\">\t\t<span class=\"keyword\">return</span> (T) Proxy.newProxyInstance(interfaceClass.getClassLoader(),</div><div class=\"line\">\t\t\t\t<span class=\"keyword\">new</span> Class[] &#123; interfaceClass &#125;, <span class=\"keyword\">new</span> InvocationHandler() &#123;</div><div class=\"line\">\t\t\t\t\t<span class=\"function\"><span class=\"keyword\">public</span> Object <span class=\"title\">invoke</span><span class=\"params\">(Object proxy, Method method,</span></span></div><div class=\"line\"><span class=\"function\"><span class=\"params\">\t\t\t\t\t\t\tObject[] args)</span> <span class=\"keyword\">throws</span> Throwable </span>&#123;</div><div class=\"line\">\t\t\t\t\t\tInteger returnValue = (Integer) method.invoke(</div><div class=\"line\">\t\t\t\t\t\t\t\timplementsClass.newInstance(), args);<span class=\"comment\">// 调用原始对象以后返回的值</span></div><div class=\"line\">\t\t\t\t\t\t<span class=\"keyword\">return</span> returnValue - discountCoupon;</div><div class=\"line\">\t\t\t\t\t&#125;</div><div class=\"line\">\t\t\t\t&#125;);</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\">新业务调用=======================================</div><div class=\"line\"><span class=\"keyword\">import</span> org.junit.Test;</div><div class=\"line\"><span class=\"keyword\">import</span> cn.itcast_05_proxy.proxyclass.ProxyBoss;</div><div class=\"line\"><span class=\"keyword\">import</span> cn.itcast_05_proxy.service.IBoss;</div><div class=\"line\"><span class=\"keyword\">import</span> cn.itcast_05_proxy.service.impl.Boss;</div><div class=\"line\"><span class=\"comment\">/**</span></div><div class=\"line\"><span class=\"comment\"> * 什么是动态代理？ 简单的写一个模板接口，剩下的个性化工作，好给动态代理来完成！</span></div><div class=\"line\"><span class=\"comment\"> */</span></div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ProxySaleAction</span> </span>&#123;</div><div class=\"line\">\t<span class=\"comment\">/**</span></div><div class=\"line\"><span class=\"comment\">\t *使用代理，在这个代理中，只代理了Boss的yifu方法</span></div><div class=\"line\"><span class=\"comment\">\t *定制化业务，可以改变原接口的参数、返回值等</span></div><div class=\"line\"><span class=\"comment\">\t */</span></div><div class=\"line\">\t<span class=\"meta\">@Test</span></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">saleByProxy</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</div><div class=\"line\">\t\tIBoss boss = ProxyBoss.getProxy(<span class=\"number\">10</span>,IBoss.class,Boss.class);<span class=\"comment\">// 将代理的方法实例化成接口</span></div><div class=\"line\">\t\t<span class=\"comment\">//IBoss boss = new Boss();// 将代理的方法实例化成接口</span></div><div class=\"line\">\t\tSystem.out.println(<span class=\"string\">\"代理经营！\"</span>);</div><div class=\"line\">\t\t<span class=\"keyword\">int</span> money = boss.yifu(<span class=\"string\">\"xxl\"</span>);<span class=\"comment\">// 调用接口的方法，实际上调用方式没有变</span></div><div class=\"line\">\t\tSystem.out.println(<span class=\"string\">\"衣服成交价：\"</span> + money);</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n"},{"title":"微服务框架与实战-笔记01-概述","toc":true,"date":"2018-01-05T14:42:27.000Z","scaffolds":null,"_content":"\n# 单体应用架构存在的问题\n1. 复杂性高  \n    - 包含模块多\n    - 模块边界模糊\n    - 依赖关系不清\n    - 代码质量残次不齐等等\n1. 技术债务\n1. 部署频率低  \n    - 功能变更或缺陷修复都要重新部署整个应用。\n    - 全量部署 耗时长。影响范围大、风险高。\n1. 可靠性差  \n    - 一个bug可能会导致整个系统的崩溃\n1. 扩展能力受限  \n    - 只能整体扩展，无法根据业务模块进行伸缩。\n1. 阻碍技术创新  \n    - 一般使用统一的技术平台或方案解决所有问题。例如一个使用struts2的100万行代码的单体应用，如果想换成springMVC，成本是非常高的。\n\n# 微服务简介\n并没有严格的定义，将一个单一应用程序开发为一组小型服务的方法。构建的是分布式系统。\n## 特性\n\n1. 每个服务运行在自己的进程中\n2. 一系列服务共同构建起整个项目\n3. 服务针对独立业务，只关注某个特定功能\n4. 服务间通信采用轻量级通信机制（如http资源api）\n5. 可以使用不同的语言，不同的存储\n6. 全自动部署机制\n\n# 有点\n1. 易于开发维护\n2. 单个服务启动快\n3. 局部修改易部署\n4. 技术栈不受限\n5. 按需伸缩\n\n# 挑战\n- 运维要求高\n    - 需要保证几十个甚至上百个服务的正常运行与写作\n- 分布式固有的复杂性\n- 接口调整成本搞\n- 重复劳动 \n    - 重复功能不足以分解为一个微服务，可以封装为公共组件，但是多语言就不一定行得通\n\n# 设计原则\n- 单一职责原则\n- 服务自治原则 \n    - 治具备独立的业务能力、依赖与运行环境。\n- 轻量级通信机制 \n    - 体量轻 \n    - 跨语言 \n    - 跨平台 \n    - 常用的有REST AMQP STOMP MQTT\n- 微服务力度\n\n`康威定律`：设计系统的组织，其产生的设计等同于组织之内、组织之间的沟通结构。看看下面的图片（来源于互联网，侵删），再想想Apple的产品、微软的产品设计，就能形象生动的理解这句话。\n\n![20181522357](http://ovasdkxqr.bkt.clouddn.com/image/blog/20181522357.png)\n\n用通俗的说法就是：`组织形式等同系统设计`。\n\n# 如何实现微服务架构\n## 技术选型\n从开发和运行平台两个维度考虑：\n- 开发框架\n    - spring cloud\n    - dubbo\n    - dropwizard \n    - armada\n- 运行平台\n    - 并不绑定运行平台\n    - PCServer\n    - 阿里云\n    - aws\n    - Docker\n# 架构图\n![201815224722](http://ovasdkxqr.bkt.clouddn.com//image/blog/201815224722.jpg)\n\n","source":"_posts/微服务/微服务框架与实战-笔记01-概述.md","raw":"---\ntitle: 微服务框架与实战-笔记01-概述\ncategories: 学习\ntags:\n  - 微服务\ntoc: true\ndate: 2018-01-05 22:42:27\nscaffolds:\n---\n\n# 单体应用架构存在的问题\n1. 复杂性高  \n    - 包含模块多\n    - 模块边界模糊\n    - 依赖关系不清\n    - 代码质量残次不齐等等\n1. 技术债务\n1. 部署频率低  \n    - 功能变更或缺陷修复都要重新部署整个应用。\n    - 全量部署 耗时长。影响范围大、风险高。\n1. 可靠性差  \n    - 一个bug可能会导致整个系统的崩溃\n1. 扩展能力受限  \n    - 只能整体扩展，无法根据业务模块进行伸缩。\n1. 阻碍技术创新  \n    - 一般使用统一的技术平台或方案解决所有问题。例如一个使用struts2的100万行代码的单体应用，如果想换成springMVC，成本是非常高的。\n\n# 微服务简介\n并没有严格的定义，将一个单一应用程序开发为一组小型服务的方法。构建的是分布式系统。\n## 特性\n\n1. 每个服务运行在自己的进程中\n2. 一系列服务共同构建起整个项目\n3. 服务针对独立业务，只关注某个特定功能\n4. 服务间通信采用轻量级通信机制（如http资源api）\n5. 可以使用不同的语言，不同的存储\n6. 全自动部署机制\n\n# 有点\n1. 易于开发维护\n2. 单个服务启动快\n3. 局部修改易部署\n4. 技术栈不受限\n5. 按需伸缩\n\n# 挑战\n- 运维要求高\n    - 需要保证几十个甚至上百个服务的正常运行与写作\n- 分布式固有的复杂性\n- 接口调整成本搞\n- 重复劳动 \n    - 重复功能不足以分解为一个微服务，可以封装为公共组件，但是多语言就不一定行得通\n\n# 设计原则\n- 单一职责原则\n- 服务自治原则 \n    - 治具备独立的业务能力、依赖与运行环境。\n- 轻量级通信机制 \n    - 体量轻 \n    - 跨语言 \n    - 跨平台 \n    - 常用的有REST AMQP STOMP MQTT\n- 微服务力度\n\n`康威定律`：设计系统的组织，其产生的设计等同于组织之内、组织之间的沟通结构。看看下面的图片（来源于互联网，侵删），再想想Apple的产品、微软的产品设计，就能形象生动的理解这句话。\n\n![20181522357](http://ovasdkxqr.bkt.clouddn.com/image/blog/20181522357.png)\n\n用通俗的说法就是：`组织形式等同系统设计`。\n\n# 如何实现微服务架构\n## 技术选型\n从开发和运行平台两个维度考虑：\n- 开发框架\n    - spring cloud\n    - dubbo\n    - dropwizard \n    - armada\n- 运行平台\n    - 并不绑定运行平台\n    - PCServer\n    - 阿里云\n    - aws\n    - Docker\n# 架构图\n![201815224722](http://ovasdkxqr.bkt.clouddn.com//image/blog/201815224722.jpg)\n\n","slug":"微服务/微服务框架与实战-笔记01-概述","published":1,"updated":"2018-01-09T15:13:10.578Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjcsq4lk5004ax4vfnsp9171v","content":"<h1 id=\"单体应用架构存在的问题\"><a href=\"#单体应用架构存在的问题\" class=\"headerlink\" title=\"单体应用架构存在的问题\"></a>单体应用架构存在的问题</h1><ol>\n<li>复杂性高  <ul>\n<li>包含模块多</li>\n<li>模块边界模糊</li>\n<li>依赖关系不清</li>\n<li>代码质量残次不齐等等</li>\n</ul>\n</li>\n<li>技术债务</li>\n<li>部署频率低  <ul>\n<li>功能变更或缺陷修复都要重新部署整个应用。</li>\n<li>全量部署 耗时长。影响范围大、风险高。</li>\n</ul>\n</li>\n<li>可靠性差  <ul>\n<li>一个bug可能会导致整个系统的崩溃</li>\n</ul>\n</li>\n<li>扩展能力受限  <ul>\n<li>只能整体扩展，无法根据业务模块进行伸缩。</li>\n</ul>\n</li>\n<li>阻碍技术创新  <ul>\n<li>一般使用统一的技术平台或方案解决所有问题。例如一个使用struts2的100万行代码的单体应用，如果想换成springMVC，成本是非常高的。</li>\n</ul>\n</li>\n</ol>\n<h1 id=\"微服务简介\"><a href=\"#微服务简介\" class=\"headerlink\" title=\"微服务简介\"></a>微服务简介</h1><p>并没有严格的定义，将一个单一应用程序开发为一组小型服务的方法。构建的是分布式系统。</p>\n<h2 id=\"特性\"><a href=\"#特性\" class=\"headerlink\" title=\"特性\"></a>特性</h2><ol>\n<li>每个服务运行在自己的进程中</li>\n<li>一系列服务共同构建起整个项目</li>\n<li>服务针对独立业务，只关注某个特定功能</li>\n<li>服务间通信采用轻量级通信机制（如http资源api）</li>\n<li>可以使用不同的语言，不同的存储</li>\n<li>全自动部署机制</li>\n</ol>\n<h1 id=\"有点\"><a href=\"#有点\" class=\"headerlink\" title=\"有点\"></a>有点</h1><ol>\n<li>易于开发维护</li>\n<li>单个服务启动快</li>\n<li>局部修改易部署</li>\n<li>技术栈不受限</li>\n<li>按需伸缩</li>\n</ol>\n<h1 id=\"挑战\"><a href=\"#挑战\" class=\"headerlink\" title=\"挑战\"></a>挑战</h1><ul>\n<li>运维要求高<ul>\n<li>需要保证几十个甚至上百个服务的正常运行与写作</li>\n</ul>\n</li>\n<li>分布式固有的复杂性</li>\n<li>接口调整成本搞</li>\n<li>重复劳动 <ul>\n<li>重复功能不足以分解为一个微服务，可以封装为公共组件，但是多语言就不一定行得通</li>\n</ul>\n</li>\n</ul>\n<h1 id=\"设计原则\"><a href=\"#设计原则\" class=\"headerlink\" title=\"设计原则\"></a>设计原则</h1><ul>\n<li>单一职责原则</li>\n<li>服务自治原则 <ul>\n<li>治具备独立的业务能力、依赖与运行环境。</li>\n</ul>\n</li>\n<li>轻量级通信机制 <ul>\n<li>体量轻 </li>\n<li>跨语言 </li>\n<li>跨平台 </li>\n<li>常用的有REST AMQP STOMP MQTT</li>\n</ul>\n</li>\n<li>微服务力度</li>\n</ul>\n<p><code>康威定律</code>：设计系统的组织，其产生的设计等同于组织之内、组织之间的沟通结构。看看下面的图片（来源于互联网，侵删），再想想Apple的产品、微软的产品设计，就能形象生动的理解这句话。</p>\n<p><img src=\"http://ovasdkxqr.bkt.clouddn.com/image/blog/20181522357.png\" alt=\"20181522357\"></p>\n<p>用通俗的说法就是：<code>组织形式等同系统设计</code>。</p>\n<h1 id=\"如何实现微服务架构\"><a href=\"#如何实现微服务架构\" class=\"headerlink\" title=\"如何实现微服务架构\"></a>如何实现微服务架构</h1><h2 id=\"技术选型\"><a href=\"#技术选型\" class=\"headerlink\" title=\"技术选型\"></a>技术选型</h2><p>从开发和运行平台两个维度考虑：</p>\n<ul>\n<li>开发框架<ul>\n<li>spring cloud</li>\n<li>dubbo</li>\n<li>dropwizard </li>\n<li>armada</li>\n</ul>\n</li>\n<li>运行平台<ul>\n<li>并不绑定运行平台</li>\n<li>PCServer</li>\n<li>阿里云</li>\n<li>aws</li>\n<li>Docker<h1 id=\"架构图\"><a href=\"#架构图\" class=\"headerlink\" title=\"架构图\"></a>架构图</h1><img src=\"http://ovasdkxqr.bkt.clouddn.com//image/blog/201815224722.jpg\" alt=\"201815224722\"></li>\n</ul>\n</li>\n</ul>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"单体应用架构存在的问题\"><a href=\"#单体应用架构存在的问题\" class=\"headerlink\" title=\"单体应用架构存在的问题\"></a>单体应用架构存在的问题</h1><ol>\n<li>复杂性高  <ul>\n<li>包含模块多</li>\n<li>模块边界模糊</li>\n<li>依赖关系不清</li>\n<li>代码质量残次不齐等等</li>\n</ul>\n</li>\n<li>技术债务</li>\n<li>部署频率低  <ul>\n<li>功能变更或缺陷修复都要重新部署整个应用。</li>\n<li>全量部署 耗时长。影响范围大、风险高。</li>\n</ul>\n</li>\n<li>可靠性差  <ul>\n<li>一个bug可能会导致整个系统的崩溃</li>\n</ul>\n</li>\n<li>扩展能力受限  <ul>\n<li>只能整体扩展，无法根据业务模块进行伸缩。</li>\n</ul>\n</li>\n<li>阻碍技术创新  <ul>\n<li>一般使用统一的技术平台或方案解决所有问题。例如一个使用struts2的100万行代码的单体应用，如果想换成springMVC，成本是非常高的。</li>\n</ul>\n</li>\n</ol>\n<h1 id=\"微服务简介\"><a href=\"#微服务简介\" class=\"headerlink\" title=\"微服务简介\"></a>微服务简介</h1><p>并没有严格的定义，将一个单一应用程序开发为一组小型服务的方法。构建的是分布式系统。</p>\n<h2 id=\"特性\"><a href=\"#特性\" class=\"headerlink\" title=\"特性\"></a>特性</h2><ol>\n<li>每个服务运行在自己的进程中</li>\n<li>一系列服务共同构建起整个项目</li>\n<li>服务针对独立业务，只关注某个特定功能</li>\n<li>服务间通信采用轻量级通信机制（如http资源api）</li>\n<li>可以使用不同的语言，不同的存储</li>\n<li>全自动部署机制</li>\n</ol>\n<h1 id=\"有点\"><a href=\"#有点\" class=\"headerlink\" title=\"有点\"></a>有点</h1><ol>\n<li>易于开发维护</li>\n<li>单个服务启动快</li>\n<li>局部修改易部署</li>\n<li>技术栈不受限</li>\n<li>按需伸缩</li>\n</ol>\n<h1 id=\"挑战\"><a href=\"#挑战\" class=\"headerlink\" title=\"挑战\"></a>挑战</h1><ul>\n<li>运维要求高<ul>\n<li>需要保证几十个甚至上百个服务的正常运行与写作</li>\n</ul>\n</li>\n<li>分布式固有的复杂性</li>\n<li>接口调整成本搞</li>\n<li>重复劳动 <ul>\n<li>重复功能不足以分解为一个微服务，可以封装为公共组件，但是多语言就不一定行得通</li>\n</ul>\n</li>\n</ul>\n<h1 id=\"设计原则\"><a href=\"#设计原则\" class=\"headerlink\" title=\"设计原则\"></a>设计原则</h1><ul>\n<li>单一职责原则</li>\n<li>服务自治原则 <ul>\n<li>治具备独立的业务能力、依赖与运行环境。</li>\n</ul>\n</li>\n<li>轻量级通信机制 <ul>\n<li>体量轻 </li>\n<li>跨语言 </li>\n<li>跨平台 </li>\n<li>常用的有REST AMQP STOMP MQTT</li>\n</ul>\n</li>\n<li>微服务力度</li>\n</ul>\n<p><code>康威定律</code>：设计系统的组织，其产生的设计等同于组织之内、组织之间的沟通结构。看看下面的图片（来源于互联网，侵删），再想想Apple的产品、微软的产品设计，就能形象生动的理解这句话。</p>\n<p><img src=\"http://ovasdkxqr.bkt.clouddn.com/image/blog/20181522357.png\" alt=\"20181522357\"></p>\n<p>用通俗的说法就是：<code>组织形式等同系统设计</code>。</p>\n<h1 id=\"如何实现微服务架构\"><a href=\"#如何实现微服务架构\" class=\"headerlink\" title=\"如何实现微服务架构\"></a>如何实现微服务架构</h1><h2 id=\"技术选型\"><a href=\"#技术选型\" class=\"headerlink\" title=\"技术选型\"></a>技术选型</h2><p>从开发和运行平台两个维度考虑：</p>\n<ul>\n<li>开发框架<ul>\n<li>spring cloud</li>\n<li>dubbo</li>\n<li>dropwizard </li>\n<li>armada</li>\n</ul>\n</li>\n<li>运行平台<ul>\n<li>并不绑定运行平台</li>\n<li>PCServer</li>\n<li>阿里云</li>\n<li>aws</li>\n<li>Docker<h1 id=\"架构图\"><a href=\"#架构图\" class=\"headerlink\" title=\"架构图\"></a>架构图</h1><img src=\"http://ovasdkxqr.bkt.clouddn.com//image/blog/201815224722.jpg\" alt=\"201815224722\"></li>\n</ul>\n</li>\n</ul>\n"},{"title":"微服务框架与实战-笔记02-微服务开发框架-SpringCloud","toc":true,"date":"2018-01-09T15:12:17.000Z","scaffolds":null,"_content":"\n# Spring Cloud 简介\n- 在SpringBoot基础上构建的，用于快速构建分布式系统的通用模式工具集。\n- 程序适合在Docker或者PaaS上部署。 所以又叫`云原生应用`（Cloud Native Application）。\n- `云原生`（CloudNative）可简单理解为面向云环境的软件架构。\n# Spring Cloud 特点\n- 约定优于配置\n- 适用于各种环境\n- 隐藏了组件的复杂性，并提供声明式、无xml的配置方式\n- 开箱即用、快速启动\n- 轻量级组件\n- 组件丰富，功能齐全。如 配置管理，服务发现，断路器，微服务网关等\n- 选型中立、丰富。例如：支持使用Eureka、Zookeeper、Consul实现服务发现。\n- 灵活。组成部分解耦，可按需挑选技术选型。\n# 版本\nSpring项目一般以下面这种方式命名，但`SpringCloud`并`没有`使用这种方式。可以略过。\n主版本号.次版本号.增量版本号.里程碑版本号  \n例如：4.3.5.RELEASE\n- 主版本号：项目重大重构\n- 次版本号：新特性的添加和变化\n- 增量版本号：一般表示BUG修复\n- 里程碑版本号：某个版本号的里程碑\n## 版本简介\n![20181923037](http://ovasdkxqr.bkt.clouddn.com/image/blog/20181923037.png)\n命名方式：英文单词SRX（x为数字）\n英文单词：release train \nSR：service release bug修复\n\nDalston SR5 表示Dalston 第5次bug修复版本\n\nhttps://github.com/spring-cloud/spring-cloud-release/releases 版本发布\n\n## 子项目一览\n\nComponent | Camden.SR7 | Dalston.SR4 | Edgware.RELEASE | Finchley.M4 | Finchley.BUILD-SNAPSHOT\n----------|------------|-------------|-----------------|-------------|------------------------\nspring-cloud-aws | 1.1.4.RELEASE | 1.2.1.RELEASE | 1.2.2.RELEASE | 2.0.0.M2 | 2.0.0.BUILD-SNAPSHOT\nspring-cloud-bus | 1.2.2.RELEASE | 1.3.1.RELEASE | 1.3.2.RELEASE | 2.0.0.M3 | 2.0.0.BUILD-SNAPSHOT\nspring-cloud-cli | 1.2.4.RELEASE | 1.3.4.RELEASE | 1.4.0.RELEASE | 2.0.0.M1 | 2.0.0.BUILD-SNAPSHOT\nspring-cloud-commons | 1.1.9.RELEASE | 1.2.4.RELEASE | 1.3.0.RELEASE | 2.0.0.M4 | 2.0.0.BUILD-SNAPSHOT\nspring-cloud-contract | 1.0.5.RELEASE | 1.1.4.RELEASE | 1.2.0.RELEASE | 2.0.0.M4 | 2.0.0.BUILD-SNAPSHOT\nspring-cloud-config | 1.2.3.RELEASE | 1.3.3.RELEASE | 1.4.0.RELEASE | 2.0.0.M4 | 2.0.0.BUILD-SNAPSHOT\nspring-cloud-netflix | 1.2.7.RELEASE | 1.3.5.RELEASE | 1.4.0.RELEASE | 2.0.0.M4 | 2.0.0.BUILD-SNAPSHOT\nspring-cloud-security | 1.1.4.RELEASE | 1.2.1.RELEASE | 1.2.1.RELEASE | 2.0.0.M1 | 2.0.0.BUILD-SNAPSHOT\nspring-cloud-cloudfoundry | 1.0.1.RELEASE | 1.1.0.RELEASE | 1.1.0.RELEASE | 2.0.0.M1 | 2.0.0.BUILD-SNAPSHOT\nspring-cloud-consul | 1.1.4.RELEASE | 1.2.1.RELEASE | 1.3.0.RELEASE | 2.0.0.M3 | 2.0.0.BUILD-SNAPSHOT\nspring-cloud-sleuth | 1.1.3.RELEASE | 1.2.5.RELEASE | 1.3.0.RELEASE | 2.0.0.M4 | 2.0.0.BUILD-SNAPSHOT\nspring-cloud-stream | Brooklyn.SR3 | Chelsea.SR2 | Ditmars.RELEASE | Elmhurst.M3 | Elmhurst.BUILD-SNAPSHOT\nspring-cloud-zookeeper | 1.0.4.RELEASE | 1.1.2.RELEASE | 1.2.0.RELEASE | 2.0.0.M3 | 2.0.0.BUILD-SNAPSHOT\nspring-boot | 1.4.5.RELEASE | 1.5.4.RELEASE | 1.5.8.RELEASE | 2.0.0.M6 | 2.0.0.BUILD-SNAPSHOT\nspring-cloud-task | 1.0.3.RELEASE | 1.1.2.RELEASE | 1.2.2.RELEASE | 2.0.0.M2 | 2.0.0.RELEASE\nspring-cloud-vault |   | 1.0.2.RELEASE | 1.1.0.RELEASE | 2.0.0.M4 | 2.0.0.BUILD-SNAPSHOT\nspring-cloud-gateway |   |   | 1.0.0.RELEASE | 2.0.0.M4 | 2.0.0.BUILD-SNAPSHOT\n\n\n## spring cloud / spring boot 版本兼容性\n\n- Finchley使用Spring Boot 2.0.x构建和运行，并且不希望与Spring Boot 1.5.x一起使用。\n- Dalston和Edgware发行版建立在Spring Boot 1.5.x之上，并且不希望与Spring Boot 2.0.x一起使用。\n- Camden发行版基于Spring Boot 1.4.x，但也使用1.5.x进行测试。\n\nhttp://projects.spring.io/spring-cloud/ 更具体的额可以看这里","source":"_posts/微服务/微服务框架与实战-笔记02-微服务开发框架-SpringCloud.md","raw":"---\ntitle: 微服务框架与实战-笔记02-微服务开发框架-SpringCloud\ncategories: 学习\ntags:\n  - 微服务\ntoc: true\ndate: 2018-01-09 23:12:17\nscaffolds:\n---\n\n# Spring Cloud 简介\n- 在SpringBoot基础上构建的，用于快速构建分布式系统的通用模式工具集。\n- 程序适合在Docker或者PaaS上部署。 所以又叫`云原生应用`（Cloud Native Application）。\n- `云原生`（CloudNative）可简单理解为面向云环境的软件架构。\n# Spring Cloud 特点\n- 约定优于配置\n- 适用于各种环境\n- 隐藏了组件的复杂性，并提供声明式、无xml的配置方式\n- 开箱即用、快速启动\n- 轻量级组件\n- 组件丰富，功能齐全。如 配置管理，服务发现，断路器，微服务网关等\n- 选型中立、丰富。例如：支持使用Eureka、Zookeeper、Consul实现服务发现。\n- 灵活。组成部分解耦，可按需挑选技术选型。\n# 版本\nSpring项目一般以下面这种方式命名，但`SpringCloud`并`没有`使用这种方式。可以略过。\n主版本号.次版本号.增量版本号.里程碑版本号  \n例如：4.3.5.RELEASE\n- 主版本号：项目重大重构\n- 次版本号：新特性的添加和变化\n- 增量版本号：一般表示BUG修复\n- 里程碑版本号：某个版本号的里程碑\n## 版本简介\n![20181923037](http://ovasdkxqr.bkt.clouddn.com/image/blog/20181923037.png)\n命名方式：英文单词SRX（x为数字）\n英文单词：release train \nSR：service release bug修复\n\nDalston SR5 表示Dalston 第5次bug修复版本\n\nhttps://github.com/spring-cloud/spring-cloud-release/releases 版本发布\n\n## 子项目一览\n\nComponent | Camden.SR7 | Dalston.SR4 | Edgware.RELEASE | Finchley.M4 | Finchley.BUILD-SNAPSHOT\n----------|------------|-------------|-----------------|-------------|------------------------\nspring-cloud-aws | 1.1.4.RELEASE | 1.2.1.RELEASE | 1.2.2.RELEASE | 2.0.0.M2 | 2.0.0.BUILD-SNAPSHOT\nspring-cloud-bus | 1.2.2.RELEASE | 1.3.1.RELEASE | 1.3.2.RELEASE | 2.0.0.M3 | 2.0.0.BUILD-SNAPSHOT\nspring-cloud-cli | 1.2.4.RELEASE | 1.3.4.RELEASE | 1.4.0.RELEASE | 2.0.0.M1 | 2.0.0.BUILD-SNAPSHOT\nspring-cloud-commons | 1.1.9.RELEASE | 1.2.4.RELEASE | 1.3.0.RELEASE | 2.0.0.M4 | 2.0.0.BUILD-SNAPSHOT\nspring-cloud-contract | 1.0.5.RELEASE | 1.1.4.RELEASE | 1.2.0.RELEASE | 2.0.0.M4 | 2.0.0.BUILD-SNAPSHOT\nspring-cloud-config | 1.2.3.RELEASE | 1.3.3.RELEASE | 1.4.0.RELEASE | 2.0.0.M4 | 2.0.0.BUILD-SNAPSHOT\nspring-cloud-netflix | 1.2.7.RELEASE | 1.3.5.RELEASE | 1.4.0.RELEASE | 2.0.0.M4 | 2.0.0.BUILD-SNAPSHOT\nspring-cloud-security | 1.1.4.RELEASE | 1.2.1.RELEASE | 1.2.1.RELEASE | 2.0.0.M1 | 2.0.0.BUILD-SNAPSHOT\nspring-cloud-cloudfoundry | 1.0.1.RELEASE | 1.1.0.RELEASE | 1.1.0.RELEASE | 2.0.0.M1 | 2.0.0.BUILD-SNAPSHOT\nspring-cloud-consul | 1.1.4.RELEASE | 1.2.1.RELEASE | 1.3.0.RELEASE | 2.0.0.M3 | 2.0.0.BUILD-SNAPSHOT\nspring-cloud-sleuth | 1.1.3.RELEASE | 1.2.5.RELEASE | 1.3.0.RELEASE | 2.0.0.M4 | 2.0.0.BUILD-SNAPSHOT\nspring-cloud-stream | Brooklyn.SR3 | Chelsea.SR2 | Ditmars.RELEASE | Elmhurst.M3 | Elmhurst.BUILD-SNAPSHOT\nspring-cloud-zookeeper | 1.0.4.RELEASE | 1.1.2.RELEASE | 1.2.0.RELEASE | 2.0.0.M3 | 2.0.0.BUILD-SNAPSHOT\nspring-boot | 1.4.5.RELEASE | 1.5.4.RELEASE | 1.5.8.RELEASE | 2.0.0.M6 | 2.0.0.BUILD-SNAPSHOT\nspring-cloud-task | 1.0.3.RELEASE | 1.1.2.RELEASE | 1.2.2.RELEASE | 2.0.0.M2 | 2.0.0.RELEASE\nspring-cloud-vault |   | 1.0.2.RELEASE | 1.1.0.RELEASE | 2.0.0.M4 | 2.0.0.BUILD-SNAPSHOT\nspring-cloud-gateway |   |   | 1.0.0.RELEASE | 2.0.0.M4 | 2.0.0.BUILD-SNAPSHOT\n\n\n## spring cloud / spring boot 版本兼容性\n\n- Finchley使用Spring Boot 2.0.x构建和运行，并且不希望与Spring Boot 1.5.x一起使用。\n- Dalston和Edgware发行版建立在Spring Boot 1.5.x之上，并且不希望与Spring Boot 2.0.x一起使用。\n- Camden发行版基于Spring Boot 1.4.x，但也使用1.5.x进行测试。\n\nhttp://projects.spring.io/spring-cloud/ 更具体的额可以看这里","slug":"微服务/微服务框架与实战-笔记02-微服务开发框架-SpringCloud","published":1,"updated":"2018-01-09T15:24:15.937Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjcsq4lk7004bx4vf7dfn5pfa","content":"<h1 id=\"Spring-Cloud-简介\"><a href=\"#Spring-Cloud-简介\" class=\"headerlink\" title=\"Spring Cloud 简介\"></a>Spring Cloud 简介</h1><ul>\n<li>在SpringBoot基础上构建的，用于快速构建分布式系统的通用模式工具集。</li>\n<li>程序适合在Docker或者PaaS上部署。 所以又叫<code>云原生应用</code>（Cloud Native Application）。</li>\n<li><code>云原生</code>（CloudNative）可简单理解为面向云环境的软件架构。<h1 id=\"Spring-Cloud-特点\"><a href=\"#Spring-Cloud-特点\" class=\"headerlink\" title=\"Spring Cloud 特点\"></a>Spring Cloud 特点</h1></li>\n<li>约定优于配置</li>\n<li>适用于各种环境</li>\n<li>隐藏了组件的复杂性，并提供声明式、无xml的配置方式</li>\n<li>开箱即用、快速启动</li>\n<li>轻量级组件</li>\n<li>组件丰富，功能齐全。如 配置管理，服务发现，断路器，微服务网关等</li>\n<li>选型中立、丰富。例如：支持使用Eureka、Zookeeper、Consul实现服务发现。</li>\n<li>灵活。组成部分解耦，可按需挑选技术选型。<h1 id=\"版本\"><a href=\"#版本\" class=\"headerlink\" title=\"版本\"></a>版本</h1>Spring项目一般以下面这种方式命名，但<code>SpringCloud</code>并<code>没有</code>使用这种方式。可以略过。<br>主版本号.次版本号.增量版本号.里程碑版本号<br>例如：4.3.5.RELEASE</li>\n<li>主版本号：项目重大重构</li>\n<li>次版本号：新特性的添加和变化</li>\n<li>增量版本号：一般表示BUG修复</li>\n<li>里程碑版本号：某个版本号的里程碑<h2 id=\"版本简介\"><a href=\"#版本简介\" class=\"headerlink\" title=\"版本简介\"></a>版本简介</h2><img src=\"http://ovasdkxqr.bkt.clouddn.com/image/blog/20181923037.png\" alt=\"20181923037\"><br>命名方式：英文单词SRX（x为数字）<br>英文单词：release train<br>SR：service release bug修复</li>\n</ul>\n<p>Dalston SR5 表示Dalston 第5次bug修复版本</p>\n<p><a href=\"https://github.com/spring-cloud/spring-cloud-release/releases\" target=\"_blank\" rel=\"external\">https://github.com/spring-cloud/spring-cloud-release/releases</a> 版本发布</p>\n<h2 id=\"子项目一览\"><a href=\"#子项目一览\" class=\"headerlink\" title=\"子项目一览\"></a>子项目一览</h2><table>\n<thead>\n<tr>\n<th>Component</th>\n<th>Camden.SR7</th>\n<th>Dalston.SR4</th>\n<th>Edgware.RELEASE</th>\n<th>Finchley.M4</th>\n<th>Finchley.BUILD-SNAPSHOT</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>spring-cloud-aws</td>\n<td>1.1.4.RELEASE</td>\n<td>1.2.1.RELEASE</td>\n<td>1.2.2.RELEASE</td>\n<td>2.0.0.M2</td>\n<td>2.0.0.BUILD-SNAPSHOT</td>\n</tr>\n<tr>\n<td>spring-cloud-bus</td>\n<td>1.2.2.RELEASE</td>\n<td>1.3.1.RELEASE</td>\n<td>1.3.2.RELEASE</td>\n<td>2.0.0.M3</td>\n<td>2.0.0.BUILD-SNAPSHOT</td>\n</tr>\n<tr>\n<td>spring-cloud-cli</td>\n<td>1.2.4.RELEASE</td>\n<td>1.3.4.RELEASE</td>\n<td>1.4.0.RELEASE</td>\n<td>2.0.0.M1</td>\n<td>2.0.0.BUILD-SNAPSHOT</td>\n</tr>\n<tr>\n<td>spring-cloud-commons</td>\n<td>1.1.9.RELEASE</td>\n<td>1.2.4.RELEASE</td>\n<td>1.3.0.RELEASE</td>\n<td>2.0.0.M4</td>\n<td>2.0.0.BUILD-SNAPSHOT</td>\n</tr>\n<tr>\n<td>spring-cloud-contract</td>\n<td>1.0.5.RELEASE</td>\n<td>1.1.4.RELEASE</td>\n<td>1.2.0.RELEASE</td>\n<td>2.0.0.M4</td>\n<td>2.0.0.BUILD-SNAPSHOT</td>\n</tr>\n<tr>\n<td>spring-cloud-config</td>\n<td>1.2.3.RELEASE</td>\n<td>1.3.3.RELEASE</td>\n<td>1.4.0.RELEASE</td>\n<td>2.0.0.M4</td>\n<td>2.0.0.BUILD-SNAPSHOT</td>\n</tr>\n<tr>\n<td>spring-cloud-netflix</td>\n<td>1.2.7.RELEASE</td>\n<td>1.3.5.RELEASE</td>\n<td>1.4.0.RELEASE</td>\n<td>2.0.0.M4</td>\n<td>2.0.0.BUILD-SNAPSHOT</td>\n</tr>\n<tr>\n<td>spring-cloud-security</td>\n<td>1.1.4.RELEASE</td>\n<td>1.2.1.RELEASE</td>\n<td>1.2.1.RELEASE</td>\n<td>2.0.0.M1</td>\n<td>2.0.0.BUILD-SNAPSHOT</td>\n</tr>\n<tr>\n<td>spring-cloud-cloudfoundry</td>\n<td>1.0.1.RELEASE</td>\n<td>1.1.0.RELEASE</td>\n<td>1.1.0.RELEASE</td>\n<td>2.0.0.M1</td>\n<td>2.0.0.BUILD-SNAPSHOT</td>\n</tr>\n<tr>\n<td>spring-cloud-consul</td>\n<td>1.1.4.RELEASE</td>\n<td>1.2.1.RELEASE</td>\n<td>1.3.0.RELEASE</td>\n<td>2.0.0.M3</td>\n<td>2.0.0.BUILD-SNAPSHOT</td>\n</tr>\n<tr>\n<td>spring-cloud-sleuth</td>\n<td>1.1.3.RELEASE</td>\n<td>1.2.5.RELEASE</td>\n<td>1.3.0.RELEASE</td>\n<td>2.0.0.M4</td>\n<td>2.0.0.BUILD-SNAPSHOT</td>\n</tr>\n<tr>\n<td>spring-cloud-stream</td>\n<td>Brooklyn.SR3</td>\n<td>Chelsea.SR2</td>\n<td>Ditmars.RELEASE</td>\n<td>Elmhurst.M3</td>\n<td>Elmhurst.BUILD-SNAPSHOT</td>\n</tr>\n<tr>\n<td>spring-cloud-zookeeper</td>\n<td>1.0.4.RELEASE</td>\n<td>1.1.2.RELEASE</td>\n<td>1.2.0.RELEASE</td>\n<td>2.0.0.M3</td>\n<td>2.0.0.BUILD-SNAPSHOT</td>\n</tr>\n<tr>\n<td>spring-boot</td>\n<td>1.4.5.RELEASE</td>\n<td>1.5.4.RELEASE</td>\n<td>1.5.8.RELEASE</td>\n<td>2.0.0.M6</td>\n<td>2.0.0.BUILD-SNAPSHOT</td>\n</tr>\n<tr>\n<td>spring-cloud-task</td>\n<td>1.0.3.RELEASE</td>\n<td>1.1.2.RELEASE</td>\n<td>1.2.2.RELEASE</td>\n<td>2.0.0.M2</td>\n<td>2.0.0.RELEASE</td>\n</tr>\n<tr>\n<td>spring-cloud-vault</td>\n<td></td>\n<td>1.0.2.RELEASE</td>\n<td>1.1.0.RELEASE</td>\n<td>2.0.0.M4</td>\n<td>2.0.0.BUILD-SNAPSHOT</td>\n</tr>\n<tr>\n<td>spring-cloud-gateway</td>\n<td></td>\n<td></td>\n<td>1.0.0.RELEASE</td>\n<td>2.0.0.M4</td>\n<td>2.0.0.BUILD-SNAPSHOT</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"spring-cloud-spring-boot-版本兼容性\"><a href=\"#spring-cloud-spring-boot-版本兼容性\" class=\"headerlink\" title=\"spring cloud / spring boot 版本兼容性\"></a>spring cloud / spring boot 版本兼容性</h2><ul>\n<li>Finchley使用Spring Boot 2.0.x构建和运行，并且不希望与Spring Boot 1.5.x一起使用。</li>\n<li>Dalston和Edgware发行版建立在Spring Boot 1.5.x之上，并且不希望与Spring Boot 2.0.x一起使用。</li>\n<li>Camden发行版基于Spring Boot 1.4.x，但也使用1.5.x进行测试。</li>\n</ul>\n<p><a href=\"http://projects.spring.io/spring-cloud/\" target=\"_blank\" rel=\"external\">http://projects.spring.io/spring-cloud/</a> 更具体的额可以看这里</p>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"Spring-Cloud-简介\"><a href=\"#Spring-Cloud-简介\" class=\"headerlink\" title=\"Spring Cloud 简介\"></a>Spring Cloud 简介</h1><ul>\n<li>在SpringBoot基础上构建的，用于快速构建分布式系统的通用模式工具集。</li>\n<li>程序适合在Docker或者PaaS上部署。 所以又叫<code>云原生应用</code>（Cloud Native Application）。</li>\n<li><code>云原生</code>（CloudNative）可简单理解为面向云环境的软件架构。<h1 id=\"Spring-Cloud-特点\"><a href=\"#Spring-Cloud-特点\" class=\"headerlink\" title=\"Spring Cloud 特点\"></a>Spring Cloud 特点</h1></li>\n<li>约定优于配置</li>\n<li>适用于各种环境</li>\n<li>隐藏了组件的复杂性，并提供声明式、无xml的配置方式</li>\n<li>开箱即用、快速启动</li>\n<li>轻量级组件</li>\n<li>组件丰富，功能齐全。如 配置管理，服务发现，断路器，微服务网关等</li>\n<li>选型中立、丰富。例如：支持使用Eureka、Zookeeper、Consul实现服务发现。</li>\n<li>灵活。组成部分解耦，可按需挑选技术选型。<h1 id=\"版本\"><a href=\"#版本\" class=\"headerlink\" title=\"版本\"></a>版本</h1>Spring项目一般以下面这种方式命名，但<code>SpringCloud</code>并<code>没有</code>使用这种方式。可以略过。<br>主版本号.次版本号.增量版本号.里程碑版本号<br>例如：4.3.5.RELEASE</li>\n<li>主版本号：项目重大重构</li>\n<li>次版本号：新特性的添加和变化</li>\n<li>增量版本号：一般表示BUG修复</li>\n<li>里程碑版本号：某个版本号的里程碑<h2 id=\"版本简介\"><a href=\"#版本简介\" class=\"headerlink\" title=\"版本简介\"></a>版本简介</h2><img src=\"http://ovasdkxqr.bkt.clouddn.com/image/blog/20181923037.png\" alt=\"20181923037\"><br>命名方式：英文单词SRX（x为数字）<br>英文单词：release train<br>SR：service release bug修复</li>\n</ul>\n<p>Dalston SR5 表示Dalston 第5次bug修复版本</p>\n<p><a href=\"https://github.com/spring-cloud/spring-cloud-release/releases\" target=\"_blank\" rel=\"external\">https://github.com/spring-cloud/spring-cloud-release/releases</a> 版本发布</p>\n<h2 id=\"子项目一览\"><a href=\"#子项目一览\" class=\"headerlink\" title=\"子项目一览\"></a>子项目一览</h2><table>\n<thead>\n<tr>\n<th>Component</th>\n<th>Camden.SR7</th>\n<th>Dalston.SR4</th>\n<th>Edgware.RELEASE</th>\n<th>Finchley.M4</th>\n<th>Finchley.BUILD-SNAPSHOT</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>spring-cloud-aws</td>\n<td>1.1.4.RELEASE</td>\n<td>1.2.1.RELEASE</td>\n<td>1.2.2.RELEASE</td>\n<td>2.0.0.M2</td>\n<td>2.0.0.BUILD-SNAPSHOT</td>\n</tr>\n<tr>\n<td>spring-cloud-bus</td>\n<td>1.2.2.RELEASE</td>\n<td>1.3.1.RELEASE</td>\n<td>1.3.2.RELEASE</td>\n<td>2.0.0.M3</td>\n<td>2.0.0.BUILD-SNAPSHOT</td>\n</tr>\n<tr>\n<td>spring-cloud-cli</td>\n<td>1.2.4.RELEASE</td>\n<td>1.3.4.RELEASE</td>\n<td>1.4.0.RELEASE</td>\n<td>2.0.0.M1</td>\n<td>2.0.0.BUILD-SNAPSHOT</td>\n</tr>\n<tr>\n<td>spring-cloud-commons</td>\n<td>1.1.9.RELEASE</td>\n<td>1.2.4.RELEASE</td>\n<td>1.3.0.RELEASE</td>\n<td>2.0.0.M4</td>\n<td>2.0.0.BUILD-SNAPSHOT</td>\n</tr>\n<tr>\n<td>spring-cloud-contract</td>\n<td>1.0.5.RELEASE</td>\n<td>1.1.4.RELEASE</td>\n<td>1.2.0.RELEASE</td>\n<td>2.0.0.M4</td>\n<td>2.0.0.BUILD-SNAPSHOT</td>\n</tr>\n<tr>\n<td>spring-cloud-config</td>\n<td>1.2.3.RELEASE</td>\n<td>1.3.3.RELEASE</td>\n<td>1.4.0.RELEASE</td>\n<td>2.0.0.M4</td>\n<td>2.0.0.BUILD-SNAPSHOT</td>\n</tr>\n<tr>\n<td>spring-cloud-netflix</td>\n<td>1.2.7.RELEASE</td>\n<td>1.3.5.RELEASE</td>\n<td>1.4.0.RELEASE</td>\n<td>2.0.0.M4</td>\n<td>2.0.0.BUILD-SNAPSHOT</td>\n</tr>\n<tr>\n<td>spring-cloud-security</td>\n<td>1.1.4.RELEASE</td>\n<td>1.2.1.RELEASE</td>\n<td>1.2.1.RELEASE</td>\n<td>2.0.0.M1</td>\n<td>2.0.0.BUILD-SNAPSHOT</td>\n</tr>\n<tr>\n<td>spring-cloud-cloudfoundry</td>\n<td>1.0.1.RELEASE</td>\n<td>1.1.0.RELEASE</td>\n<td>1.1.0.RELEASE</td>\n<td>2.0.0.M1</td>\n<td>2.0.0.BUILD-SNAPSHOT</td>\n</tr>\n<tr>\n<td>spring-cloud-consul</td>\n<td>1.1.4.RELEASE</td>\n<td>1.2.1.RELEASE</td>\n<td>1.3.0.RELEASE</td>\n<td>2.0.0.M3</td>\n<td>2.0.0.BUILD-SNAPSHOT</td>\n</tr>\n<tr>\n<td>spring-cloud-sleuth</td>\n<td>1.1.3.RELEASE</td>\n<td>1.2.5.RELEASE</td>\n<td>1.3.0.RELEASE</td>\n<td>2.0.0.M4</td>\n<td>2.0.0.BUILD-SNAPSHOT</td>\n</tr>\n<tr>\n<td>spring-cloud-stream</td>\n<td>Brooklyn.SR3</td>\n<td>Chelsea.SR2</td>\n<td>Ditmars.RELEASE</td>\n<td>Elmhurst.M3</td>\n<td>Elmhurst.BUILD-SNAPSHOT</td>\n</tr>\n<tr>\n<td>spring-cloud-zookeeper</td>\n<td>1.0.4.RELEASE</td>\n<td>1.1.2.RELEASE</td>\n<td>1.2.0.RELEASE</td>\n<td>2.0.0.M3</td>\n<td>2.0.0.BUILD-SNAPSHOT</td>\n</tr>\n<tr>\n<td>spring-boot</td>\n<td>1.4.5.RELEASE</td>\n<td>1.5.4.RELEASE</td>\n<td>1.5.8.RELEASE</td>\n<td>2.0.0.M6</td>\n<td>2.0.0.BUILD-SNAPSHOT</td>\n</tr>\n<tr>\n<td>spring-cloud-task</td>\n<td>1.0.3.RELEASE</td>\n<td>1.1.2.RELEASE</td>\n<td>1.2.2.RELEASE</td>\n<td>2.0.0.M2</td>\n<td>2.0.0.RELEASE</td>\n</tr>\n<tr>\n<td>spring-cloud-vault</td>\n<td></td>\n<td>1.0.2.RELEASE</td>\n<td>1.1.0.RELEASE</td>\n<td>2.0.0.M4</td>\n<td>2.0.0.BUILD-SNAPSHOT</td>\n</tr>\n<tr>\n<td>spring-cloud-gateway</td>\n<td></td>\n<td></td>\n<td>1.0.0.RELEASE</td>\n<td>2.0.0.M4</td>\n<td>2.0.0.BUILD-SNAPSHOT</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"spring-cloud-spring-boot-版本兼容性\"><a href=\"#spring-cloud-spring-boot-版本兼容性\" class=\"headerlink\" title=\"spring cloud / spring boot 版本兼容性\"></a>spring cloud / spring boot 版本兼容性</h2><ul>\n<li>Finchley使用Spring Boot 2.0.x构建和运行，并且不希望与Spring Boot 1.5.x一起使用。</li>\n<li>Dalston和Edgware发行版建立在Spring Boot 1.5.x之上，并且不希望与Spring Boot 2.0.x一起使用。</li>\n<li>Camden发行版基于Spring Boot 1.4.x，但也使用1.5.x进行测试。</li>\n</ul>\n<p><a href=\"http://projects.spring.io/spring-cloud/\" target=\"_blank\" rel=\"external\">http://projects.spring.io/spring-cloud/</a> 更具体的额可以看这里</p>\n"},{"title":"微服务框架与实战-笔记03-开始使用SpringCloud实战微服务","toc":true,"date":"2018-01-21T15:50:00.000Z","scaffolds":null,"_content":"\n配套代码\n- http://www.broadview.com.cn/book/4774  可以去勘误等\n- 1-11 章配套代码：\nhttps://github.com/itmuch/spring-cloud-docker-microservice-book-code\n- 12-14 章配套代码：\nhttps://github.com/itmuch/spring-cloud-docker-microservice-book-code-docker\n\n# 实战前提\n## 技术储备\n- 语言基础：java或scala、Groovy\n- spring boot ：\n- 项目管理和构建工具：maven gradle （可以相互转换）\n## 工具及软件版本\n- JKD：官方建议1.8，也可以用1.7\n- springboot： 书中使用1.4.5.RELEASE\n- springCloud：Camden SR4\n- IDE：Spring Tool suite 3.8.3 基于eclipse的IDE ，idea\n- maven：3.3.9 （3.3.x运行在JDK1.8以上）\n降低学习成本的重要方法之一:`少踩坑`\n# 服务提供者、服务消费者\n描述微服务之间的调用关系  \n服务提供者：被调用方  \n服务消费者：调用方\n# 编写服务提供者\nSpring Data JPA作为持久层框架，H2作为数据库\n## 编写项目\n自己下载代码看吧，microservice-simple-provider-user\n### pom.xml\n`spring-boot-starter-web`：springMVC支持  \n`spring-boot-starter-data-jpa`：Spring Data JPA支持\n```xml\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n  xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\n  <modelVersion>4.0.0</modelVersion>\n  <groupId>com.itmuch.cloud</groupId>\n  <artifactId>microservice-simple-provider-user</artifactId>\n  <version>0.0.1-SNAPSHOT</version>\n  <packaging>jar</packaging>\n\n  <!-- 引入spring boot的依赖 -->\n  <parent>\n    <groupId>org.springframework.boot</groupId>\n    <artifactId>spring-boot-starter-parent</artifactId>\n    <version>1.4.3.RELEASE</version>\n  </parent>\n\n  <properties>\n    <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>\n    <java.version>1.8</java.version>\n  </properties>\n\n  <dependencies>\n    <dependency>\n      <groupId>org.springframework.boot</groupId>\n      <artifactId>spring-boot-starter-web</artifactId>\n    </dependency>\n    <dependency>\n      <groupId>org.springframework.boot</groupId>\n      <artifactId>spring-boot-starter-data-jpa</artifactId>\n    </dependency>\n    <dependency>\n      <groupId>com.h2database</groupId>\n      <artifactId>h2</artifactId>\n    </dependency>\n    <dependency>\n      <groupId>org.springframework.boot</groupId>\n      <artifactId>spring-boot-starter-actuator</artifactId>\n    </dependency>\n  </dependencies>\n\n  <!-- 引入spring cloud的依赖 -->\n  <dependencyManagement>\n    <dependencies>\n      <dependency>\n        <groupId>org.springframework.cloud</groupId>\n        <artifactId>spring-cloud-dependencies</artifactId>\n        <version>Camden.SR4</version>\n        <type>pom</type>\n        <scope>import</scope>\n      </dependency>\n    </dependencies>\n  </dependencyManagement>\n\n  <!-- 添加spring-boot的maven插件 -->\n  <build>\n    <plugins>\n      <plugin>\n        <groupId>org.springframework.boot</groupId>\n        <artifactId>spring-boot-maven-plugin</artifactId>\n      </plugin>\n    </plugins>\n  </build>\n</project>\n```\n\n### classpath下schema.sql 建表语句\n```sql\ndrop table user if exists;\ncreate table user (id bigint generated by default as identity, username varchar(40), name varchar(20), age int(3), balance decimal(10,2), primary key (id));\n```\n### classpath下data.sql\n```sql\ninsert into user (id, username, name, age, balance) values (1, 'account1', '张三', 20, 100.00);\ninsert into user (id, username, name, age, balance) values (2, 'account2', '李四', 28, 180.00);\ninsert into user (id, username, name, age, balance) values (3, 'account3', '王五', 32, 280.00);\n```\n### 用户实体类\n```java\npackage com.itmuch.cloud.study.entity;\n\nimport java.math.BigDecimal;\n\nimport javax.persistence.Column;\nimport javax.persistence.Entity;\nimport javax.persistence.GeneratedValue;\nimport javax.persistence.GenerationType;\nimport javax.persistence.Id;\n\n@Entity\npublic class User {\n  @Id\n  @GeneratedValue(strategy = GenerationType.AUTO)\n  private Long id;\n  @Column\n  private String username;\n  @Column\n  private String name;\n  @Column\n  private Integer age;\n  @Column\n  private BigDecimal balance;\n\n  public Long getId() {\n    return this.id;\n  }\n\n  public void setId(Long id) {\n    this.id = id;\n  }\n\n  public String getUsername() {\n    return this.username;\n  }\n\n  public void setUsername(String username) {\n    this.username = username;\n  }\n\n  public String getName() {\n    return this.name;\n  }\n\n  public void setName(String name) {\n    this.name = name;\n  }\n\n  public Integer getAge() {\n    return this.age;\n  }\n\n  public void setAge(Integer age) {\n    this.age = age;\n  }\n\n  public BigDecimal getBalance() {\n    return this.balance;\n  }\n\n  public void setBalance(BigDecimal balance) {\n    this.balance = balance;\n  }\n\n}\n```\n## DAO\n```java\npackage com.itmuch.cloud.study.repository;\n\nimport org.springframework.data.jpa.repository.JpaRepository;\nimport org.springframework.stereotype.Repository;\n\nimport com.itmuch.cloud.study.entity.User;\n\n@Repository\npublic interface UserRepository extends JpaRepository<User, Long> {\n}\n\n```\n## controller\n`@GetMapping` Spring4.3新注解。组合注解，等价 @RequestMapping(method=RequestMethod.GET)  \n还有`@PostMapping`、`@PutMapping`、`@DeleteMapping`、`@PatchMapping`\n```java\npackage com.itmuch.cloud.study.controller;\n\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.web.bind.annotation.GetMapping;\nimport org.springframework.web.bind.annotation.PathVariable;\nimport org.springframework.web.bind.annotation.RestController;\n\nimport com.itmuch.cloud.study.entity.User;\nimport com.itmuch.cloud.study.repository.UserRepository;\n\n@RestController\npublic class UserController {\n  @Autowired\n  private UserRepository userRepository;\n\n  @GetMapping(\"/{id}\")\n  public User findById(@PathVariable Long id) {\n    User findOne = this.userRepository.findOne(id);\n    return findOne;\n  }\n}\n```\n## 启动类\n`@SpringBootApplication` \n- 声明是一个Spring boot项目\n- 组合注解，整合了@Configuration、@EnableAutoConfiguration、@ComponentScan\n- 并开启了SpringBoot组件扫描和自动配置功能\n```java\npackage com.itmuch.cloud.study;\n\nimport org.springframework.boot.SpringApplication;\nimport org.springframework.boot.autoconfigure.SpringBootApplication;\n\n@SpringBootApplication\npublic class ProviderUserApplication {\n  public static void main(String[] args) {\n    SpringApplication.run(ProviderUserApplication.class, args);\n  }\n}\n```\n## 配置文件 application.yml\n\nSpringCloud、SpringBoot支持`properties`或者`yml格式`文件作为`配置文件`    \n`yml文件格式`：YAML（Yet Another Markup Language）编写的文件格式。  \nYAML和properties格式文件可以互相转换。  \nyml文件有`严格的缩进`  \n```yml\nserver:\n  port: 8000\nspring:\n  jpa:\n    generate-ddl: false\n    show-sql: true\n    hibernate:\n      ddl-auto: none\n  datasource:                           # 指定数据源\n    platform: h2                        # 指定数据源类型\n    schema: classpath:schema.sql        # 指定h2数据库的建表脚本\n    data: classpath:data.sql            # 指定h2数据库的数据脚本\nlogging:                                # 配置日志级别，让hibernate打印出执行的SQL\n  level:\n    root: INFO\n    org.hibernate: INFO\n    org.hibernate.type.descriptor.sql.BasicBinder: TRACE\n    org.hibernate.type.descriptor.sql.BasicExtractor: TRACE\n    \n## INFO\ninfo: \n  app: \n    name: @project.artifactId@\n    encoding: @project.build.sourceEncoding@\n    java:\n      source: @java.version@\n      target: @java.version@\n\n```\n测试：http://localhost:8000/1","source":"_posts/微服务/微服务框架与实战-笔记03-开始使用SpringCloud实战微服务.md","raw":"---\ntitle: 微服务框架与实战-笔记03-开始使用SpringCloud实战微服务\ncategories: 学习\ntags:\n  - 微服务\ntoc: true\ndate: 2018-01-21 23:50:00\nscaffolds:\n---\n\n配套代码\n- http://www.broadview.com.cn/book/4774  可以去勘误等\n- 1-11 章配套代码：\nhttps://github.com/itmuch/spring-cloud-docker-microservice-book-code\n- 12-14 章配套代码：\nhttps://github.com/itmuch/spring-cloud-docker-microservice-book-code-docker\n\n# 实战前提\n## 技术储备\n- 语言基础：java或scala、Groovy\n- spring boot ：\n- 项目管理和构建工具：maven gradle （可以相互转换）\n## 工具及软件版本\n- JKD：官方建议1.8，也可以用1.7\n- springboot： 书中使用1.4.5.RELEASE\n- springCloud：Camden SR4\n- IDE：Spring Tool suite 3.8.3 基于eclipse的IDE ，idea\n- maven：3.3.9 （3.3.x运行在JDK1.8以上）\n降低学习成本的重要方法之一:`少踩坑`\n# 服务提供者、服务消费者\n描述微服务之间的调用关系  \n服务提供者：被调用方  \n服务消费者：调用方\n# 编写服务提供者\nSpring Data JPA作为持久层框架，H2作为数据库\n## 编写项目\n自己下载代码看吧，microservice-simple-provider-user\n### pom.xml\n`spring-boot-starter-web`：springMVC支持  \n`spring-boot-starter-data-jpa`：Spring Data JPA支持\n```xml\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n  xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\n  <modelVersion>4.0.0</modelVersion>\n  <groupId>com.itmuch.cloud</groupId>\n  <artifactId>microservice-simple-provider-user</artifactId>\n  <version>0.0.1-SNAPSHOT</version>\n  <packaging>jar</packaging>\n\n  <!-- 引入spring boot的依赖 -->\n  <parent>\n    <groupId>org.springframework.boot</groupId>\n    <artifactId>spring-boot-starter-parent</artifactId>\n    <version>1.4.3.RELEASE</version>\n  </parent>\n\n  <properties>\n    <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>\n    <java.version>1.8</java.version>\n  </properties>\n\n  <dependencies>\n    <dependency>\n      <groupId>org.springframework.boot</groupId>\n      <artifactId>spring-boot-starter-web</artifactId>\n    </dependency>\n    <dependency>\n      <groupId>org.springframework.boot</groupId>\n      <artifactId>spring-boot-starter-data-jpa</artifactId>\n    </dependency>\n    <dependency>\n      <groupId>com.h2database</groupId>\n      <artifactId>h2</artifactId>\n    </dependency>\n    <dependency>\n      <groupId>org.springframework.boot</groupId>\n      <artifactId>spring-boot-starter-actuator</artifactId>\n    </dependency>\n  </dependencies>\n\n  <!-- 引入spring cloud的依赖 -->\n  <dependencyManagement>\n    <dependencies>\n      <dependency>\n        <groupId>org.springframework.cloud</groupId>\n        <artifactId>spring-cloud-dependencies</artifactId>\n        <version>Camden.SR4</version>\n        <type>pom</type>\n        <scope>import</scope>\n      </dependency>\n    </dependencies>\n  </dependencyManagement>\n\n  <!-- 添加spring-boot的maven插件 -->\n  <build>\n    <plugins>\n      <plugin>\n        <groupId>org.springframework.boot</groupId>\n        <artifactId>spring-boot-maven-plugin</artifactId>\n      </plugin>\n    </plugins>\n  </build>\n</project>\n```\n\n### classpath下schema.sql 建表语句\n```sql\ndrop table user if exists;\ncreate table user (id bigint generated by default as identity, username varchar(40), name varchar(20), age int(3), balance decimal(10,2), primary key (id));\n```\n### classpath下data.sql\n```sql\ninsert into user (id, username, name, age, balance) values (1, 'account1', '张三', 20, 100.00);\ninsert into user (id, username, name, age, balance) values (2, 'account2', '李四', 28, 180.00);\ninsert into user (id, username, name, age, balance) values (3, 'account3', '王五', 32, 280.00);\n```\n### 用户实体类\n```java\npackage com.itmuch.cloud.study.entity;\n\nimport java.math.BigDecimal;\n\nimport javax.persistence.Column;\nimport javax.persistence.Entity;\nimport javax.persistence.GeneratedValue;\nimport javax.persistence.GenerationType;\nimport javax.persistence.Id;\n\n@Entity\npublic class User {\n  @Id\n  @GeneratedValue(strategy = GenerationType.AUTO)\n  private Long id;\n  @Column\n  private String username;\n  @Column\n  private String name;\n  @Column\n  private Integer age;\n  @Column\n  private BigDecimal balance;\n\n  public Long getId() {\n    return this.id;\n  }\n\n  public void setId(Long id) {\n    this.id = id;\n  }\n\n  public String getUsername() {\n    return this.username;\n  }\n\n  public void setUsername(String username) {\n    this.username = username;\n  }\n\n  public String getName() {\n    return this.name;\n  }\n\n  public void setName(String name) {\n    this.name = name;\n  }\n\n  public Integer getAge() {\n    return this.age;\n  }\n\n  public void setAge(Integer age) {\n    this.age = age;\n  }\n\n  public BigDecimal getBalance() {\n    return this.balance;\n  }\n\n  public void setBalance(BigDecimal balance) {\n    this.balance = balance;\n  }\n\n}\n```\n## DAO\n```java\npackage com.itmuch.cloud.study.repository;\n\nimport org.springframework.data.jpa.repository.JpaRepository;\nimport org.springframework.stereotype.Repository;\n\nimport com.itmuch.cloud.study.entity.User;\n\n@Repository\npublic interface UserRepository extends JpaRepository<User, Long> {\n}\n\n```\n## controller\n`@GetMapping` Spring4.3新注解。组合注解，等价 @RequestMapping(method=RequestMethod.GET)  \n还有`@PostMapping`、`@PutMapping`、`@DeleteMapping`、`@PatchMapping`\n```java\npackage com.itmuch.cloud.study.controller;\n\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.web.bind.annotation.GetMapping;\nimport org.springframework.web.bind.annotation.PathVariable;\nimport org.springframework.web.bind.annotation.RestController;\n\nimport com.itmuch.cloud.study.entity.User;\nimport com.itmuch.cloud.study.repository.UserRepository;\n\n@RestController\npublic class UserController {\n  @Autowired\n  private UserRepository userRepository;\n\n  @GetMapping(\"/{id}\")\n  public User findById(@PathVariable Long id) {\n    User findOne = this.userRepository.findOne(id);\n    return findOne;\n  }\n}\n```\n## 启动类\n`@SpringBootApplication` \n- 声明是一个Spring boot项目\n- 组合注解，整合了@Configuration、@EnableAutoConfiguration、@ComponentScan\n- 并开启了SpringBoot组件扫描和自动配置功能\n```java\npackage com.itmuch.cloud.study;\n\nimport org.springframework.boot.SpringApplication;\nimport org.springframework.boot.autoconfigure.SpringBootApplication;\n\n@SpringBootApplication\npublic class ProviderUserApplication {\n  public static void main(String[] args) {\n    SpringApplication.run(ProviderUserApplication.class, args);\n  }\n}\n```\n## 配置文件 application.yml\n\nSpringCloud、SpringBoot支持`properties`或者`yml格式`文件作为`配置文件`    \n`yml文件格式`：YAML（Yet Another Markup Language）编写的文件格式。  \nYAML和properties格式文件可以互相转换。  \nyml文件有`严格的缩进`  \n```yml\nserver:\n  port: 8000\nspring:\n  jpa:\n    generate-ddl: false\n    show-sql: true\n    hibernate:\n      ddl-auto: none\n  datasource:                           # 指定数据源\n    platform: h2                        # 指定数据源类型\n    schema: classpath:schema.sql        # 指定h2数据库的建表脚本\n    data: classpath:data.sql            # 指定h2数据库的数据脚本\nlogging:                                # 配置日志级别，让hibernate打印出执行的SQL\n  level:\n    root: INFO\n    org.hibernate: INFO\n    org.hibernate.type.descriptor.sql.BasicBinder: TRACE\n    org.hibernate.type.descriptor.sql.BasicExtractor: TRACE\n    \n## INFO\ninfo: \n  app: \n    name: @project.artifactId@\n    encoding: @project.build.sourceEncoding@\n    java:\n      source: @java.version@\n      target: @java.version@\n\n```\n测试：http://localhost:8000/1","slug":"微服务/微服务框架与实战-笔记03-开始使用SpringCloud实战微服务","published":1,"updated":"2018-01-21T16:17:09.085Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjcsq4lka004ex4vf7ms1p148","content":"<p>配套代码</p>\n<ul>\n<li><a href=\"http://www.broadview.com.cn/book/4774\" target=\"_blank\" rel=\"external\">http://www.broadview.com.cn/book/4774</a>  可以去勘误等</li>\n<li>1-11 章配套代码：<br><a href=\"https://github.com/itmuch/spring-cloud-docker-microservice-book-code\" target=\"_blank\" rel=\"external\">https://github.com/itmuch/spring-cloud-docker-microservice-book-code</a></li>\n<li>12-14 章配套代码：<br><a href=\"https://github.com/itmuch/spring-cloud-docker-microservice-book-code-docker\" target=\"_blank\" rel=\"external\">https://github.com/itmuch/spring-cloud-docker-microservice-book-code-docker</a></li>\n</ul>\n<h1 id=\"实战前提\"><a href=\"#实战前提\" class=\"headerlink\" title=\"实战前提\"></a>实战前提</h1><h2 id=\"技术储备\"><a href=\"#技术储备\" class=\"headerlink\" title=\"技术储备\"></a>技术储备</h2><ul>\n<li>语言基础：java或scala、Groovy</li>\n<li>spring boot ：</li>\n<li>项目管理和构建工具：maven gradle （可以相互转换）<h2 id=\"工具及软件版本\"><a href=\"#工具及软件版本\" class=\"headerlink\" title=\"工具及软件版本\"></a>工具及软件版本</h2></li>\n<li>JKD：官方建议1.8，也可以用1.7</li>\n<li>springboot： 书中使用1.4.5.RELEASE</li>\n<li>springCloud：Camden SR4</li>\n<li>IDE：Spring Tool suite 3.8.3 基于eclipse的IDE ，idea</li>\n<li>maven：3.3.9 （3.3.x运行在JDK1.8以上）<br>降低学习成本的重要方法之一:<code>少踩坑</code><h1 id=\"服务提供者、服务消费者\"><a href=\"#服务提供者、服务消费者\" class=\"headerlink\" title=\"服务提供者、服务消费者\"></a>服务提供者、服务消费者</h1>描述微服务之间的调用关系<br>服务提供者：被调用方<br>服务消费者：调用方<h1 id=\"编写服务提供者\"><a href=\"#编写服务提供者\" class=\"headerlink\" title=\"编写服务提供者\"></a>编写服务提供者</h1>Spring Data JPA作为持久层框架，H2作为数据库<h2 id=\"编写项目\"><a href=\"#编写项目\" class=\"headerlink\" title=\"编写项目\"></a>编写项目</h2>自己下载代码看吧，microservice-simple-provider-user<h3 id=\"pom-xml\"><a href=\"#pom-xml\" class=\"headerlink\" title=\"pom.xml\"></a>pom.xml</h3><code>spring-boot-starter-web</code>：springMVC支持<br><code>spring-boot-starter-data-jpa</code>：Spring Data JPA支持<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div></pre></td><td class=\"code\"><pre><div class=\"line\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;</div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">project</span> <span class=\"attr\">xmlns</span>=<span class=\"string\">\"http://maven.apache.org/POM/4.0.0\"</span> <span class=\"attr\">xmlns:xsi</span>=<span class=\"string\">\"http://www.w3.org/2001/XMLSchema-instance\"</span></span></div><div class=\"line\"><span class=\"tag\">  <span class=\"attr\">xsi:schemaLocation</span>=<span class=\"string\">\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\"</span>&gt;</span></div><div class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">modelVersion</span>&gt;</span>4.0.0<span class=\"tag\">&lt;/<span class=\"name\">modelVersion</span>&gt;</span></div><div class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.itmuch.cloud<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>microservice-simple-provider-user<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>0.0.1-SNAPSHOT<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">packaging</span>&gt;</span>jar<span class=\"tag\">&lt;/<span class=\"name\">packaging</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\">  <span class=\"comment\">&lt;!-- 引入spring boot的依赖 --&gt;</span></div><div class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">parent</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-parent<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.4.3.RELEASE<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">parent</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">properties</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class=\"tag\">&lt;/<span class=\"name\">project.build.sourceEncoding</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">java.version</span>&gt;</span>1.8<span class=\"tag\">&lt;/<span class=\"name\">java.version</span>&gt;</span></div><div class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">properties</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">dependencies</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-web<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-data-jpa<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.h2database<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>h2<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">dependencies</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\">  <span class=\"comment\">&lt;!-- 引入spring cloud的依赖 --&gt;</span></div><div class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">dependencyManagement</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">dependencies</span>&gt;</span></div><div class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.cloud<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-cloud-dependencies<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>Camden.SR4<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">type</span>&gt;</span>pom<span class=\"tag\">&lt;/<span class=\"name\">type</span>&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>import<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></div><div class=\"line\">      <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">dependencies</span>&gt;</span></div><div class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">dependencyManagement</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\">  <span class=\"comment\">&lt;!-- 添加spring-boot的maven插件 --&gt;</span></div><div class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">build</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">plugins</span>&gt;</span></div><div class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">plugin</span>&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">      <span class=\"tag\">&lt;/<span class=\"name\">plugin</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">plugins</span>&gt;</span></div><div class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">build</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">project</span>&gt;</span></div></pre></td></tr></table></figure>\n</li>\n</ul>\n<h3 id=\"classpath下schema-sql-建表语句\"><a href=\"#classpath下schema-sql-建表语句\" class=\"headerlink\" title=\"classpath下schema.sql 建表语句\"></a>classpath下schema.sql 建表语句</h3><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">drop</span> <span class=\"keyword\">table</span> <span class=\"keyword\">user</span> <span class=\"keyword\">if</span> <span class=\"keyword\">exists</span>;</div><div class=\"line\"><span class=\"keyword\">create</span> <span class=\"keyword\">table</span> <span class=\"keyword\">user</span> (<span class=\"keyword\">id</span> <span class=\"built_in\">bigint</span> <span class=\"keyword\">generated</span> <span class=\"keyword\">by</span> <span class=\"keyword\">default</span> <span class=\"keyword\">as</span> <span class=\"keyword\">identity</span>, username <span class=\"built_in\">varchar</span>(<span class=\"number\">40</span>), <span class=\"keyword\">name</span> <span class=\"built_in\">varchar</span>(<span class=\"number\">20</span>), age <span class=\"built_in\">int</span>(<span class=\"number\">3</span>), balance <span class=\"built_in\">decimal</span>(<span class=\"number\">10</span>,<span class=\"number\">2</span>), primary <span class=\"keyword\">key</span> (<span class=\"keyword\">id</span>));</div></pre></td></tr></table></figure>\n<h3 id=\"classpath下data-sql\"><a href=\"#classpath下data-sql\" class=\"headerlink\" title=\"classpath下data.sql\"></a>classpath下data.sql</h3><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">insert</span> <span class=\"keyword\">into</span> <span class=\"keyword\">user</span> (<span class=\"keyword\">id</span>, username, <span class=\"keyword\">name</span>, age, balance) <span class=\"keyword\">values</span> (<span class=\"number\">1</span>, <span class=\"string\">'account1'</span>, <span class=\"string\">'张三'</span>, <span class=\"number\">20</span>, <span class=\"number\">100.00</span>);</div><div class=\"line\"><span class=\"keyword\">insert</span> <span class=\"keyword\">into</span> <span class=\"keyword\">user</span> (<span class=\"keyword\">id</span>, username, <span class=\"keyword\">name</span>, age, balance) <span class=\"keyword\">values</span> (<span class=\"number\">2</span>, <span class=\"string\">'account2'</span>, <span class=\"string\">'李四'</span>, <span class=\"number\">28</span>, <span class=\"number\">180.00</span>);</div><div class=\"line\"><span class=\"keyword\">insert</span> <span class=\"keyword\">into</span> <span class=\"keyword\">user</span> (<span class=\"keyword\">id</span>, username, <span class=\"keyword\">name</span>, age, balance) <span class=\"keyword\">values</span> (<span class=\"number\">3</span>, <span class=\"string\">'account3'</span>, <span class=\"string\">'王五'</span>, <span class=\"number\">32</span>, <span class=\"number\">280.00</span>);</div></pre></td></tr></table></figure>\n<h3 id=\"用户实体类\"><a href=\"#用户实体类\" class=\"headerlink\" title=\"用户实体类\"></a>用户实体类</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">package</span> com.itmuch.cloud.study.entity;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">import</span> java.math.BigDecimal;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">import</span> javax.persistence.Column;</div><div class=\"line\"><span class=\"keyword\">import</span> javax.persistence.Entity;</div><div class=\"line\"><span class=\"keyword\">import</span> javax.persistence.GeneratedValue;</div><div class=\"line\"><span class=\"keyword\">import</span> javax.persistence.GenerationType;</div><div class=\"line\"><span class=\"keyword\">import</span> javax.persistence.Id;</div><div class=\"line\"></div><div class=\"line\"><span class=\"meta\">@Entity</span></div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">User</span> </span>&#123;</div><div class=\"line\">  <span class=\"meta\">@Id</span></div><div class=\"line\">  <span class=\"meta\">@GeneratedValue</span>(strategy = GenerationType.AUTO)</div><div class=\"line\">  <span class=\"keyword\">private</span> Long id;</div><div class=\"line\">  <span class=\"meta\">@Column</span></div><div class=\"line\">  <span class=\"keyword\">private</span> String username;</div><div class=\"line\">  <span class=\"meta\">@Column</span></div><div class=\"line\">  <span class=\"keyword\">private</span> String name;</div><div class=\"line\">  <span class=\"meta\">@Column</span></div><div class=\"line\">  <span class=\"keyword\">private</span> Integer age;</div><div class=\"line\">  <span class=\"meta\">@Column</span></div><div class=\"line\">  <span class=\"keyword\">private</span> BigDecimal balance;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> Long <span class=\"title\">getId</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.id;</div><div class=\"line\">  &#125;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setId</span><span class=\"params\">(Long id)</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">this</span>.id = id;</div><div class=\"line\">  &#125;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">getUsername</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.username;</div><div class=\"line\">  &#125;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setUsername</span><span class=\"params\">(String username)</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">this</span>.username = username;</div><div class=\"line\">  &#125;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">getName</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.name;</div><div class=\"line\">  &#125;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setName</span><span class=\"params\">(String name)</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">this</span>.name = name;</div><div class=\"line\">  &#125;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> Integer <span class=\"title\">getAge</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.age;</div><div class=\"line\">  &#125;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setAge</span><span class=\"params\">(Integer age)</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">this</span>.age = age;</div><div class=\"line\">  &#125;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> BigDecimal <span class=\"title\">getBalance</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.balance;</div><div class=\"line\">  &#125;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setBalance</span><span class=\"params\">(BigDecimal balance)</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">this</span>.balance = balance;</div><div class=\"line\">  &#125;</div><div class=\"line\"></div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h2 id=\"DAO\"><a href=\"#DAO\" class=\"headerlink\" title=\"DAO\"></a>DAO</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">package</span> com.itmuch.cloud.study.repository;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.jpa.repository.JpaRepository;</div><div class=\"line\"><span class=\"keyword\">import</span> org.springframework.stereotype.Repository;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">import</span> com.itmuch.cloud.study.entity.User;</div><div class=\"line\"></div><div class=\"line\"><span class=\"meta\">@Repository</span></div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">UserRepository</span> <span class=\"keyword\">extends</span> <span class=\"title\">JpaRepository</span>&lt;<span class=\"title\">User</span>, <span class=\"title\">Long</span>&gt; </span>&#123;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h2 id=\"controller\"><a href=\"#controller\" class=\"headerlink\" title=\"controller\"></a>controller</h2><p><code>@GetMapping</code> Spring4.3新注解。组合注解，等价 @RequestMapping(method=RequestMethod.GET)<br>还有<code>@PostMapping</code>、<code>@PutMapping</code>、<code>@DeleteMapping</code>、<code>@PatchMapping</code><br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">package</span> com.itmuch.cloud.study.controller;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">import</span> org.springframework.beans.factory.annotation.Autowired;</div><div class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.GetMapping;</div><div class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.PathVariable;</div><div class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.RestController;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">import</span> com.itmuch.cloud.study.entity.User;</div><div class=\"line\"><span class=\"keyword\">import</span> com.itmuch.cloud.study.repository.UserRepository;</div><div class=\"line\"></div><div class=\"line\"><span class=\"meta\">@RestController</span></div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">UserController</span> </span>&#123;</div><div class=\"line\">  <span class=\"meta\">@Autowired</span></div><div class=\"line\">  <span class=\"keyword\">private</span> UserRepository userRepository;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"meta\">@GetMapping</span>(<span class=\"string\">\"/&#123;id&#125;\"</span>)</div><div class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> User <span class=\"title\">findById</span><span class=\"params\">(@PathVariable Long id)</span> </span>&#123;</div><div class=\"line\">    User findOne = <span class=\"keyword\">this</span>.userRepository.findOne(id);</div><div class=\"line\">    <span class=\"keyword\">return</span> findOne;</div><div class=\"line\">  &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<h2 id=\"启动类\"><a href=\"#启动类\" class=\"headerlink\" title=\"启动类\"></a>启动类</h2><p><code>@SpringBootApplication</code> </p>\n<ul>\n<li>声明是一个Spring boot项目</li>\n<li>组合注解，整合了@Configuration、@EnableAutoConfiguration、@ComponentScan</li>\n<li>并开启了SpringBoot组件扫描和自动配置功能<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">package</span> com.itmuch.cloud.study;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">import</span> org.springframework.boot.SpringApplication;</div><div class=\"line\"><span class=\"keyword\">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</div><div class=\"line\"></div><div class=\"line\"><span class=\"meta\">@SpringBootApplication</span></div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ProviderUserApplication</span> </span>&#123;</div><div class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</div><div class=\"line\">    SpringApplication.run(ProviderUserApplication.class, args);</div><div class=\"line\">  &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n</li>\n</ul>\n<h2 id=\"配置文件-application-yml\"><a href=\"#配置文件-application-yml\" class=\"headerlink\" title=\"配置文件 application.yml\"></a>配置文件 application.yml</h2><p>SpringCloud、SpringBoot支持<code>properties</code>或者<code>yml格式</code>文件作为<code>配置文件</code><br><code>yml文件格式</code>：YAML（Yet Another Markup Language）编写的文件格式。<br>YAML和properties格式文件可以互相转换。<br>yml文件有<code>严格的缩进</code><br><figure class=\"highlight yml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"attr\">server:</span></div><div class=\"line\"><span class=\"attr\">  port:</span> <span class=\"number\">8000</span></div><div class=\"line\"><span class=\"attr\">spring:</span></div><div class=\"line\"><span class=\"attr\">  jpa:</span></div><div class=\"line\"><span class=\"attr\">    generate-ddl:</span> <span class=\"literal\">false</span></div><div class=\"line\"><span class=\"attr\">    show-sql:</span> <span class=\"literal\">true</span></div><div class=\"line\"><span class=\"attr\">    hibernate:</span></div><div class=\"line\"><span class=\"attr\">      ddl-auto:</span> <span class=\"string\">none</span></div><div class=\"line\"><span class=\"attr\">  datasource:</span>                           <span class=\"comment\"># 指定数据源</span></div><div class=\"line\"><span class=\"attr\">    platform:</span> <span class=\"string\">h2</span>                        <span class=\"comment\"># 指定数据源类型</span></div><div class=\"line\"><span class=\"attr\">    schema:</span> <span class=\"attr\">classpath:schema.sql</span>        <span class=\"comment\"># 指定h2数据库的建表脚本</span></div><div class=\"line\"><span class=\"attr\">    data:</span> <span class=\"attr\">classpath:data.sql</span>            <span class=\"comment\"># 指定h2数据库的数据脚本</span></div><div class=\"line\"><span class=\"attr\">logging:</span>                                <span class=\"comment\"># 配置日志级别，让hibernate打印出执行的SQL</span></div><div class=\"line\"><span class=\"attr\">  level:</span></div><div class=\"line\"><span class=\"attr\">    root:</span> <span class=\"string\">INFO</span></div><div class=\"line\">    <span class=\"string\">org.hibernate:</span> <span class=\"string\">INFO</span></div><div class=\"line\">    <span class=\"string\">org.hibernate.type.descriptor.sql.BasicBinder:</span> <span class=\"string\">TRACE</span></div><div class=\"line\">    <span class=\"string\">org.hibernate.type.descriptor.sql.BasicExtractor:</span> <span class=\"string\">TRACE</span></div><div class=\"line\">    </div><div class=\"line\"><span class=\"comment\">## INFO</span></div><div class=\"line\"><span class=\"attr\">info:</span> </div><div class=\"line\"><span class=\"attr\">  app:</span> </div><div class=\"line\"><span class=\"attr\">    name:</span> <span class=\"string\">@project.artifactId@</span></div><div class=\"line\"><span class=\"attr\">    encoding:</span> <span class=\"string\">@project.build.sourceEncoding@</span></div><div class=\"line\"><span class=\"attr\">    java:</span></div><div class=\"line\"><span class=\"attr\">      source:</span> <span class=\"string\">@java.version@</span></div><div class=\"line\"><span class=\"attr\">      target:</span> <span class=\"string\">@java.version@</span></div></pre></td></tr></table></figure></p>\n<p>测试：<a href=\"http://localhost:8000/1\" target=\"_blank\" rel=\"external\">http://localhost:8000/1</a></p>\n","site":{"data":{}},"excerpt":"","more":"<p>配套代码</p>\n<ul>\n<li><a href=\"http://www.broadview.com.cn/book/4774\" target=\"_blank\" rel=\"external\">http://www.broadview.com.cn/book/4774</a>  可以去勘误等</li>\n<li>1-11 章配套代码：<br><a href=\"https://github.com/itmuch/spring-cloud-docker-microservice-book-code\" target=\"_blank\" rel=\"external\">https://github.com/itmuch/spring-cloud-docker-microservice-book-code</a></li>\n<li>12-14 章配套代码：<br><a href=\"https://github.com/itmuch/spring-cloud-docker-microservice-book-code-docker\" target=\"_blank\" rel=\"external\">https://github.com/itmuch/spring-cloud-docker-microservice-book-code-docker</a></li>\n</ul>\n<h1 id=\"实战前提\"><a href=\"#实战前提\" class=\"headerlink\" title=\"实战前提\"></a>实战前提</h1><h2 id=\"技术储备\"><a href=\"#技术储备\" class=\"headerlink\" title=\"技术储备\"></a>技术储备</h2><ul>\n<li>语言基础：java或scala、Groovy</li>\n<li>spring boot ：</li>\n<li>项目管理和构建工具：maven gradle （可以相互转换）<h2 id=\"工具及软件版本\"><a href=\"#工具及软件版本\" class=\"headerlink\" title=\"工具及软件版本\"></a>工具及软件版本</h2></li>\n<li>JKD：官方建议1.8，也可以用1.7</li>\n<li>springboot： 书中使用1.4.5.RELEASE</li>\n<li>springCloud：Camden SR4</li>\n<li>IDE：Spring Tool suite 3.8.3 基于eclipse的IDE ，idea</li>\n<li>maven：3.3.9 （3.3.x运行在JDK1.8以上）<br>降低学习成本的重要方法之一:<code>少踩坑</code><h1 id=\"服务提供者、服务消费者\"><a href=\"#服务提供者、服务消费者\" class=\"headerlink\" title=\"服务提供者、服务消费者\"></a>服务提供者、服务消费者</h1>描述微服务之间的调用关系<br>服务提供者：被调用方<br>服务消费者：调用方<h1 id=\"编写服务提供者\"><a href=\"#编写服务提供者\" class=\"headerlink\" title=\"编写服务提供者\"></a>编写服务提供者</h1>Spring Data JPA作为持久层框架，H2作为数据库<h2 id=\"编写项目\"><a href=\"#编写项目\" class=\"headerlink\" title=\"编写项目\"></a>编写项目</h2>自己下载代码看吧，microservice-simple-provider-user<h3 id=\"pom-xml\"><a href=\"#pom-xml\" class=\"headerlink\" title=\"pom.xml\"></a>pom.xml</h3><code>spring-boot-starter-web</code>：springMVC支持<br><code>spring-boot-starter-data-jpa</code>：Spring Data JPA支持<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div></pre></td><td class=\"code\"><pre><div class=\"line\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;</div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">project</span> <span class=\"attr\">xmlns</span>=<span class=\"string\">\"http://maven.apache.org/POM/4.0.0\"</span> <span class=\"attr\">xmlns:xsi</span>=<span class=\"string\">\"http://www.w3.org/2001/XMLSchema-instance\"</span></span></div><div class=\"line\"><span class=\"tag\">  <span class=\"attr\">xsi:schemaLocation</span>=<span class=\"string\">\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\"</span>&gt;</span></div><div class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">modelVersion</span>&gt;</span>4.0.0<span class=\"tag\">&lt;/<span class=\"name\">modelVersion</span>&gt;</span></div><div class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.itmuch.cloud<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>microservice-simple-provider-user<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>0.0.1-SNAPSHOT<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">packaging</span>&gt;</span>jar<span class=\"tag\">&lt;/<span class=\"name\">packaging</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\">  <span class=\"comment\">&lt;!-- 引入spring boot的依赖 --&gt;</span></div><div class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">parent</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-parent<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.4.3.RELEASE<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">parent</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">properties</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class=\"tag\">&lt;/<span class=\"name\">project.build.sourceEncoding</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">java.version</span>&gt;</span>1.8<span class=\"tag\">&lt;/<span class=\"name\">java.version</span>&gt;</span></div><div class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">properties</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">dependencies</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-web<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-data-jpa<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.h2database<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>h2<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">dependencies</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\">  <span class=\"comment\">&lt;!-- 引入spring cloud的依赖 --&gt;</span></div><div class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">dependencyManagement</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">dependencies</span>&gt;</span></div><div class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.cloud<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-cloud-dependencies<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>Camden.SR4<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">type</span>&gt;</span>pom<span class=\"tag\">&lt;/<span class=\"name\">type</span>&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>import<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></div><div class=\"line\">      <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">dependencies</span>&gt;</span></div><div class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">dependencyManagement</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\">  <span class=\"comment\">&lt;!-- 添加spring-boot的maven插件 --&gt;</span></div><div class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">build</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">plugins</span>&gt;</span></div><div class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">plugin</span>&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">      <span class=\"tag\">&lt;/<span class=\"name\">plugin</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">plugins</span>&gt;</span></div><div class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">build</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">project</span>&gt;</span></div></pre></td></tr></table></figure>\n</li>\n</ul>\n<h3 id=\"classpath下schema-sql-建表语句\"><a href=\"#classpath下schema-sql-建表语句\" class=\"headerlink\" title=\"classpath下schema.sql 建表语句\"></a>classpath下schema.sql 建表语句</h3><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">drop</span> <span class=\"keyword\">table</span> <span class=\"keyword\">user</span> <span class=\"keyword\">if</span> <span class=\"keyword\">exists</span>;</div><div class=\"line\"><span class=\"keyword\">create</span> <span class=\"keyword\">table</span> <span class=\"keyword\">user</span> (<span class=\"keyword\">id</span> <span class=\"built_in\">bigint</span> <span class=\"keyword\">generated</span> <span class=\"keyword\">by</span> <span class=\"keyword\">default</span> <span class=\"keyword\">as</span> <span class=\"keyword\">identity</span>, username <span class=\"built_in\">varchar</span>(<span class=\"number\">40</span>), <span class=\"keyword\">name</span> <span class=\"built_in\">varchar</span>(<span class=\"number\">20</span>), age <span class=\"built_in\">int</span>(<span class=\"number\">3</span>), balance <span class=\"built_in\">decimal</span>(<span class=\"number\">10</span>,<span class=\"number\">2</span>), primary <span class=\"keyword\">key</span> (<span class=\"keyword\">id</span>));</div></pre></td></tr></table></figure>\n<h3 id=\"classpath下data-sql\"><a href=\"#classpath下data-sql\" class=\"headerlink\" title=\"classpath下data.sql\"></a>classpath下data.sql</h3><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">insert</span> <span class=\"keyword\">into</span> <span class=\"keyword\">user</span> (<span class=\"keyword\">id</span>, username, <span class=\"keyword\">name</span>, age, balance) <span class=\"keyword\">values</span> (<span class=\"number\">1</span>, <span class=\"string\">'account1'</span>, <span class=\"string\">'张三'</span>, <span class=\"number\">20</span>, <span class=\"number\">100.00</span>);</div><div class=\"line\"><span class=\"keyword\">insert</span> <span class=\"keyword\">into</span> <span class=\"keyword\">user</span> (<span class=\"keyword\">id</span>, username, <span class=\"keyword\">name</span>, age, balance) <span class=\"keyword\">values</span> (<span class=\"number\">2</span>, <span class=\"string\">'account2'</span>, <span class=\"string\">'李四'</span>, <span class=\"number\">28</span>, <span class=\"number\">180.00</span>);</div><div class=\"line\"><span class=\"keyword\">insert</span> <span class=\"keyword\">into</span> <span class=\"keyword\">user</span> (<span class=\"keyword\">id</span>, username, <span class=\"keyword\">name</span>, age, balance) <span class=\"keyword\">values</span> (<span class=\"number\">3</span>, <span class=\"string\">'account3'</span>, <span class=\"string\">'王五'</span>, <span class=\"number\">32</span>, <span class=\"number\">280.00</span>);</div></pre></td></tr></table></figure>\n<h3 id=\"用户实体类\"><a href=\"#用户实体类\" class=\"headerlink\" title=\"用户实体类\"></a>用户实体类</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">package</span> com.itmuch.cloud.study.entity;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">import</span> java.math.BigDecimal;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">import</span> javax.persistence.Column;</div><div class=\"line\"><span class=\"keyword\">import</span> javax.persistence.Entity;</div><div class=\"line\"><span class=\"keyword\">import</span> javax.persistence.GeneratedValue;</div><div class=\"line\"><span class=\"keyword\">import</span> javax.persistence.GenerationType;</div><div class=\"line\"><span class=\"keyword\">import</span> javax.persistence.Id;</div><div class=\"line\"></div><div class=\"line\"><span class=\"meta\">@Entity</span></div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">User</span> </span>&#123;</div><div class=\"line\">  <span class=\"meta\">@Id</span></div><div class=\"line\">  <span class=\"meta\">@GeneratedValue</span>(strategy = GenerationType.AUTO)</div><div class=\"line\">  <span class=\"keyword\">private</span> Long id;</div><div class=\"line\">  <span class=\"meta\">@Column</span></div><div class=\"line\">  <span class=\"keyword\">private</span> String username;</div><div class=\"line\">  <span class=\"meta\">@Column</span></div><div class=\"line\">  <span class=\"keyword\">private</span> String name;</div><div class=\"line\">  <span class=\"meta\">@Column</span></div><div class=\"line\">  <span class=\"keyword\">private</span> Integer age;</div><div class=\"line\">  <span class=\"meta\">@Column</span></div><div class=\"line\">  <span class=\"keyword\">private</span> BigDecimal balance;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> Long <span class=\"title\">getId</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.id;</div><div class=\"line\">  &#125;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setId</span><span class=\"params\">(Long id)</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">this</span>.id = id;</div><div class=\"line\">  &#125;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">getUsername</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.username;</div><div class=\"line\">  &#125;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setUsername</span><span class=\"params\">(String username)</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">this</span>.username = username;</div><div class=\"line\">  &#125;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">getName</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.name;</div><div class=\"line\">  &#125;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setName</span><span class=\"params\">(String name)</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">this</span>.name = name;</div><div class=\"line\">  &#125;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> Integer <span class=\"title\">getAge</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.age;</div><div class=\"line\">  &#125;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setAge</span><span class=\"params\">(Integer age)</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">this</span>.age = age;</div><div class=\"line\">  &#125;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> BigDecimal <span class=\"title\">getBalance</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.balance;</div><div class=\"line\">  &#125;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setBalance</span><span class=\"params\">(BigDecimal balance)</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">this</span>.balance = balance;</div><div class=\"line\">  &#125;</div><div class=\"line\"></div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h2 id=\"DAO\"><a href=\"#DAO\" class=\"headerlink\" title=\"DAO\"></a>DAO</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">package</span> com.itmuch.cloud.study.repository;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.jpa.repository.JpaRepository;</div><div class=\"line\"><span class=\"keyword\">import</span> org.springframework.stereotype.Repository;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">import</span> com.itmuch.cloud.study.entity.User;</div><div class=\"line\"></div><div class=\"line\"><span class=\"meta\">@Repository</span></div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">UserRepository</span> <span class=\"keyword\">extends</span> <span class=\"title\">JpaRepository</span>&lt;<span class=\"title\">User</span>, <span class=\"title\">Long</span>&gt; </span>&#123;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h2 id=\"controller\"><a href=\"#controller\" class=\"headerlink\" title=\"controller\"></a>controller</h2><p><code>@GetMapping</code> Spring4.3新注解。组合注解，等价 @RequestMapping(method=RequestMethod.GET)<br>还有<code>@PostMapping</code>、<code>@PutMapping</code>、<code>@DeleteMapping</code>、<code>@PatchMapping</code><br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">package</span> com.itmuch.cloud.study.controller;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">import</span> org.springframework.beans.factory.annotation.Autowired;</div><div class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.GetMapping;</div><div class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.PathVariable;</div><div class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.RestController;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">import</span> com.itmuch.cloud.study.entity.User;</div><div class=\"line\"><span class=\"keyword\">import</span> com.itmuch.cloud.study.repository.UserRepository;</div><div class=\"line\"></div><div class=\"line\"><span class=\"meta\">@RestController</span></div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">UserController</span> </span>&#123;</div><div class=\"line\">  <span class=\"meta\">@Autowired</span></div><div class=\"line\">  <span class=\"keyword\">private</span> UserRepository userRepository;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"meta\">@GetMapping</span>(<span class=\"string\">\"/&#123;id&#125;\"</span>)</div><div class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> User <span class=\"title\">findById</span><span class=\"params\">(@PathVariable Long id)</span> </span>&#123;</div><div class=\"line\">    User findOne = <span class=\"keyword\">this</span>.userRepository.findOne(id);</div><div class=\"line\">    <span class=\"keyword\">return</span> findOne;</div><div class=\"line\">  &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<h2 id=\"启动类\"><a href=\"#启动类\" class=\"headerlink\" title=\"启动类\"></a>启动类</h2><p><code>@SpringBootApplication</code> </p>\n<ul>\n<li>声明是一个Spring boot项目</li>\n<li>组合注解，整合了@Configuration、@EnableAutoConfiguration、@ComponentScan</li>\n<li>并开启了SpringBoot组件扫描和自动配置功能<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">package</span> com.itmuch.cloud.study;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">import</span> org.springframework.boot.SpringApplication;</div><div class=\"line\"><span class=\"keyword\">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</div><div class=\"line\"></div><div class=\"line\"><span class=\"meta\">@SpringBootApplication</span></div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ProviderUserApplication</span> </span>&#123;</div><div class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</div><div class=\"line\">    SpringApplication.run(ProviderUserApplication.class, args);</div><div class=\"line\">  &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n</li>\n</ul>\n<h2 id=\"配置文件-application-yml\"><a href=\"#配置文件-application-yml\" class=\"headerlink\" title=\"配置文件 application.yml\"></a>配置文件 application.yml</h2><p>SpringCloud、SpringBoot支持<code>properties</code>或者<code>yml格式</code>文件作为<code>配置文件</code><br><code>yml文件格式</code>：YAML（Yet Another Markup Language）编写的文件格式。<br>YAML和properties格式文件可以互相转换。<br>yml文件有<code>严格的缩进</code><br><figure class=\"highlight yml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"attr\">server:</span></div><div class=\"line\"><span class=\"attr\">  port:</span> <span class=\"number\">8000</span></div><div class=\"line\"><span class=\"attr\">spring:</span></div><div class=\"line\"><span class=\"attr\">  jpa:</span></div><div class=\"line\"><span class=\"attr\">    generate-ddl:</span> <span class=\"literal\">false</span></div><div class=\"line\"><span class=\"attr\">    show-sql:</span> <span class=\"literal\">true</span></div><div class=\"line\"><span class=\"attr\">    hibernate:</span></div><div class=\"line\"><span class=\"attr\">      ddl-auto:</span> <span class=\"string\">none</span></div><div class=\"line\"><span class=\"attr\">  datasource:</span>                           <span class=\"comment\"># 指定数据源</span></div><div class=\"line\"><span class=\"attr\">    platform:</span> <span class=\"string\">h2</span>                        <span class=\"comment\"># 指定数据源类型</span></div><div class=\"line\"><span class=\"attr\">    schema:</span> <span class=\"attr\">classpath:schema.sql</span>        <span class=\"comment\"># 指定h2数据库的建表脚本</span></div><div class=\"line\"><span class=\"attr\">    data:</span> <span class=\"attr\">classpath:data.sql</span>            <span class=\"comment\"># 指定h2数据库的数据脚本</span></div><div class=\"line\"><span class=\"attr\">logging:</span>                                <span class=\"comment\"># 配置日志级别，让hibernate打印出执行的SQL</span></div><div class=\"line\"><span class=\"attr\">  level:</span></div><div class=\"line\"><span class=\"attr\">    root:</span> <span class=\"string\">INFO</span></div><div class=\"line\">    <span class=\"string\">org.hibernate:</span> <span class=\"string\">INFO</span></div><div class=\"line\">    <span class=\"string\">org.hibernate.type.descriptor.sql.BasicBinder:</span> <span class=\"string\">TRACE</span></div><div class=\"line\">    <span class=\"string\">org.hibernate.type.descriptor.sql.BasicExtractor:</span> <span class=\"string\">TRACE</span></div><div class=\"line\">    </div><div class=\"line\"><span class=\"comment\">## INFO</span></div><div class=\"line\"><span class=\"attr\">info:</span> </div><div class=\"line\"><span class=\"attr\">  app:</span> </div><div class=\"line\"><span class=\"attr\">    name:</span> <span class=\"string\">@project.artifactId@</span></div><div class=\"line\"><span class=\"attr\">    encoding:</span> <span class=\"string\">@project.build.sourceEncoding@</span></div><div class=\"line\"><span class=\"attr\">    java:</span></div><div class=\"line\"><span class=\"attr\">      source:</span> <span class=\"string\">@java.version@</span></div><div class=\"line\"><span class=\"attr\">      target:</span> <span class=\"string\">@java.version@</span></div></pre></td></tr></table></figure></p>\n<p>测试：<a href=\"http://localhost:8000/1\" target=\"_blank\" rel=\"external\">http://localhost:8000/1</a></p>\n"},{"title":"centos7 安装mysql-转","toc":true,"date":"2017-11-04T14:30:14.000Z","scaffolds":null,"_content":"[linux下安装Mysql](http://www.cnblogs.com/xxoome/p/5864912.html)\n\n\n# 其他\n## 错误\n### 本地登陆不进去\n```\n#mysql -u root -p \n提示”Access denied for user ‘root’@’localhost’ (using password: YES)”\n```\n我的mysql版本 \n> mysql  Ver 14.14 Distrib 5.6.38\n\n先修改一下mysql安装目录下面my.cnf,最后一行添加 `skip-grant-tables`\n然后登陆 进去修改\n> update mysql.user set password=password(‘mypassword’) where user=’root’; \n\n退出,修改文件删除刚加的属性,重启mysql服务\n\n### 远程连接 ip无权限\n> update mysql.user set host='%' where user=’root’;","source":"_posts/杂记/centos7-安装mysql-转.md","raw":"---\ntitle: centos7 安装mysql-转\ncategories: 学习\ntags:\n  - 大数据\n  - linux\n  - mysql\ntoc: true\ndate: 2017-11-04 22:30:14\nscaffolds:\n---\n[linux下安装Mysql](http://www.cnblogs.com/xxoome/p/5864912.html)\n\n\n# 其他\n## 错误\n### 本地登陆不进去\n```\n#mysql -u root -p \n提示”Access denied for user ‘root’@’localhost’ (using password: YES)”\n```\n我的mysql版本 \n> mysql  Ver 14.14 Distrib 5.6.38\n\n先修改一下mysql安装目录下面my.cnf,最后一行添加 `skip-grant-tables`\n然后登陆 进去修改\n> update mysql.user set password=password(‘mypassword’) where user=’root’; \n\n退出,修改文件删除刚加的属性,重启mysql服务\n\n### 远程连接 ip无权限\n> update mysql.user set host='%' where user=’root’;","slug":"杂记/centos7-安装mysql-转","published":1,"updated":"2017-11-04T15:15:04.097Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjcsq4lkd004hx4vf2gfvyyui","content":"<p><a href=\"http://www.cnblogs.com/xxoome/p/5864912.html\" target=\"_blank\" rel=\"external\">linux下安装Mysql</a></p>\n<h1 id=\"其他\"><a href=\"#其他\" class=\"headerlink\" title=\"其他\"></a>其他</h1><h2 id=\"错误\"><a href=\"#错误\" class=\"headerlink\" title=\"错误\"></a>错误</h2><h3 id=\"本地登陆不进去\"><a href=\"#本地登陆不进去\" class=\"headerlink\" title=\"本地登陆不进去\"></a>本地登陆不进去</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\">#mysql -u root -p </div><div class=\"line\">提示”Access denied for user ‘root’@’localhost’ (using password: YES)”</div></pre></td></tr></table></figure>\n<p>我的mysql版本 </p>\n<blockquote>\n<p>mysql  Ver 14.14 Distrib 5.6.38</p>\n</blockquote>\n<p>先修改一下mysql安装目录下面my.cnf,最后一行添加 <code>skip-grant-tables</code><br>然后登陆 进去修改</p>\n<blockquote>\n<p>update mysql.user set password=password(‘mypassword’) where user=’root’; </p>\n</blockquote>\n<p>退出,修改文件删除刚加的属性,重启mysql服务</p>\n<h3 id=\"远程连接-ip无权限\"><a href=\"#远程连接-ip无权限\" class=\"headerlink\" title=\"远程连接 ip无权限\"></a>远程连接 ip无权限</h3><blockquote>\n<p>update mysql.user set host=’%’ where user=’root’;</p>\n</blockquote>\n","site":{"data":{}},"excerpt":"","more":"<p><a href=\"http://www.cnblogs.com/xxoome/p/5864912.html\" target=\"_blank\" rel=\"external\">linux下安装Mysql</a></p>\n<h1 id=\"其他\"><a href=\"#其他\" class=\"headerlink\" title=\"其他\"></a>其他</h1><h2 id=\"错误\"><a href=\"#错误\" class=\"headerlink\" title=\"错误\"></a>错误</h2><h3 id=\"本地登陆不进去\"><a href=\"#本地登陆不进去\" class=\"headerlink\" title=\"本地登陆不进去\"></a>本地登陆不进去</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\">#mysql -u root -p </div><div class=\"line\">提示”Access denied for user ‘root’@’localhost’ (using password: YES)”</div></pre></td></tr></table></figure>\n<p>我的mysql版本 </p>\n<blockquote>\n<p>mysql  Ver 14.14 Distrib 5.6.38</p>\n</blockquote>\n<p>先修改一下mysql安装目录下面my.cnf,最后一行添加 <code>skip-grant-tables</code><br>然后登陆 进去修改</p>\n<blockquote>\n<p>update mysql.user set password=password(‘mypassword’) where user=’root’; </p>\n</blockquote>\n<p>退出,修改文件删除刚加的属性,重启mysql服务</p>\n<h3 id=\"远程连接-ip无权限\"><a href=\"#远程连接-ip无权限\" class=\"headerlink\" title=\"远程连接 ip无权限\"></a>远程连接 ip无权限</h3><blockquote>\n<p>update mysql.user set host=’%’ where user=’root’;</p>\n</blockquote>\n"},{"title":"centos7 开放端口","toc":true,"date":"2017-11-04T14:15:10.000Z","scaffolds":null,"_content":"CentOS升级到7之后，发现无法使用iptables控制Linuxs的端口，google之后发现Centos 7使用firewalld代替了原来的iptables。下面记录如何使用firewalld开放Linux端口：\n\n开启端口\n\n```\nfirewall-cmd --zone=public --add-port=80/tcp --permanent\n\n```\n命令含义：\n\n```\n--zone #作用域\n\n--add-port=80/tcp  #添加端口，格式为：端口/通讯协议\n\n--permanent  #永久生效，没有此参数重启后失效\n\n```\n重启防火墙\n\n```\nfirewall-cmd --reload\n```\n\n查看开启了那些端口\n> /sbin/iptables -L -n","source":"_posts/杂记/centos7-开放端口.md","raw":"---\ntitle: centos7 开放端口\ncategories: 学习\ntags: [大数据,linux,centos7]\ntoc: true\ndate: 2017-11-04 22:15:10\nscaffolds:\n---\nCentOS升级到7之后，发现无法使用iptables控制Linuxs的端口，google之后发现Centos 7使用firewalld代替了原来的iptables。下面记录如何使用firewalld开放Linux端口：\n\n开启端口\n\n```\nfirewall-cmd --zone=public --add-port=80/tcp --permanent\n\n```\n命令含义：\n\n```\n--zone #作用域\n\n--add-port=80/tcp  #添加端口，格式为：端口/通讯协议\n\n--permanent  #永久生效，没有此参数重启后失效\n\n```\n重启防火墙\n\n```\nfirewall-cmd --reload\n```\n\n查看开启了那些端口\n> /sbin/iptables -L -n","slug":"杂记/centos7-开放端口","published":1,"updated":"2017-11-05T10:15:25.250Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjcsq4lkf004lx4vf5ylaqhuh","content":"<p>CentOS升级到7之后，发现无法使用iptables控制Linuxs的端口，google之后发现Centos 7使用firewalld代替了原来的iptables。下面记录如何使用firewalld开放Linux端口：</p>\n<p>开启端口</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">firewall-cmd --zone=public --add-port=80/tcp --permanent</div></pre></td></tr></table></figure>\n<p>命令含义：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\">--zone #作用域</div><div class=\"line\"></div><div class=\"line\">--add-port=80/tcp  #添加端口，格式为：端口/通讯协议</div><div class=\"line\"></div><div class=\"line\">--permanent  #永久生效，没有此参数重启后失效</div></pre></td></tr></table></figure>\n<p>重启防火墙</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">firewall-cmd --reload</div></pre></td></tr></table></figure>\n<p>查看开启了那些端口</p>\n<blockquote>\n<p>/sbin/iptables -L -n</p>\n</blockquote>\n","site":{"data":{}},"excerpt":"","more":"<p>CentOS升级到7之后，发现无法使用iptables控制Linuxs的端口，google之后发现Centos 7使用firewalld代替了原来的iptables。下面记录如何使用firewalld开放Linux端口：</p>\n<p>开启端口</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">firewall-cmd --zone=public --add-port=80/tcp --permanent</div></pre></td></tr></table></figure>\n<p>命令含义：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\">--zone #作用域</div><div class=\"line\"></div><div class=\"line\">--add-port=80/tcp  #添加端口，格式为：端口/通讯协议</div><div class=\"line\"></div><div class=\"line\">--permanent  #永久生效，没有此参数重启后失效</div></pre></td></tr></table></figure>\n<p>重启防火墙</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">firewall-cmd --reload</div></pre></td></tr></table></figure>\n<p>查看开启了那些端口</p>\n<blockquote>\n<p>/sbin/iptables -L -n</p>\n</blockquote>\n"},{"title":"hexo next 搜索 algolia","toc":true,"date":"2017-10-30T14:48:47.000Z","scaffolds":null,"_content":"# 目的:添加搜索功能\nalgolia似乎是试用一段时间就不能用了,建议使用本地搜索  \n[hexo-next 本地搜索](/2017/11/14/hexo-next-%E6%9C%AC%E5%9C%B0%E6%90%9C%E7%B4%A2/#more)  \n\n#next版本\n我的版本号是\n```java\n    # Theme version\n    version: 5.1.2\n```\nnext5.0+版本集成了algolia 这样使配置algolia更简单\n\n# algolia账号申请\n[Algolia官网](https://www.algolia.com/)\n<!-- more -->\n* 直接用github账号注册就好啦\n* 创建index空间 输入一个名称,填写你自己站点的网址\n\n![1](http://ovasdkxqr.bkt.clouddn.com/hexo/QQ%E6%88%AA%E5%9B%BE20171030220402.jpg)\n* 创建两个key   \n    1. 空间创建好后默认会有一个只有搜索权限的key  \n    2. 需要另建一个有修改记录等权限的key(这个供我们提交索引到空间使用)  \n    3. 创建key的时候要选择授权的空间\n\n![3](http://ovasdkxqr.bkt.clouddn.com/hexo/QQ%E6%88%AA%E5%9B%BE20171030220635.jpg)\n![2](http://ovasdkxqr.bkt.clouddn.com/hexo/QQ%E6%88%AA%E5%9B%BE20171030220735.jpg)\n![4](http://ovasdkxqr.bkt.clouddn.com/hexo/QQ%E6%88%AA%E5%9B%BE20171030220846.jpg)\n![5](http://ovasdkxqr.bkt.clouddn.com/hexo/QQ%E6%88%AA%E5%9B%BE20171030220920.jpg)\n* 记录  \n    1. Application ID  \n    2. 两个key建\n\n# 安装hexo-algolia\n\n用git-bash在hexo工程根目录下执行\n\n    npm install hexo-algolia --save\n# 配置algolia\n- 在Hexo工程根目录的_config.yml中加入如下配置，注意改成前面API Keys页面相应配置\n\n```java\n    algolia:\n        applicationID: '你的Application ID'\n        apiKey: '只有搜索权限的key'\n        adminApiKey: ''\n        indexName: '你的index空间名称'\n        chunkSize: 5000\n```\n\n- 修改themes>next>_config.yml \n\n    搜索 algolia_search 修改enable 为true  \n    其他字体提示可以自己随意修改\n![2](http://ovasdkxqr.bkt.clouddn.com/hexo/QQ%E6%88%AA%E5%9B%BE20171030223530.jpg)\n# 添加环境变量\n我的电脑>右键属性>高级设置>环境变量>新建>填写变量名称和变量值\n\n    变量名称 : HEXO_ALGOLIA_INDEXING_KEY\n    变量值: 在algolia新建的有修改权限的key\n![1](http://ovasdkxqr.bkt.clouddn.com/hexo/QQ%E6%88%AA%E5%9B%BE20171030222934.jpg)\n![2](http://ovasdkxqr.bkt.clouddn.com/hexo/QQ%E6%88%AA%E5%9B%BE20171030222951.jpg)\n# 生成index上传到algolia\n在hexo根目录执行,**注意确保命令行面板已经重新载入新加的环境变量**\n```java\n    hexo algolia\n```\n\n不报错就可以啦\n\n# 参考\n[NexT主题集成Algolia搜索插件](http://blog.csdn.net/luzheqi/article/details/52798557)  \n[Hexo集成Algolia搜索插件](https://jobbym.github.io/2017/01/16/Hexo%E9%9B%86%E6%88%90Algolia%E6%90%9C%E7%B4%A2%E6%8F%92%E4%BB%B6/)\n","source":"_posts/杂记/hexo-next-搜索-algolia.md","raw":"---\ntitle: hexo next 搜索 algolia\ncategories: 工具\ntags: [hexo]\ntoc: true\ndate: 2017-10-30 22:48:47\nscaffolds:\n---\n# 目的:添加搜索功能\nalgolia似乎是试用一段时间就不能用了,建议使用本地搜索  \n[hexo-next 本地搜索](/2017/11/14/hexo-next-%E6%9C%AC%E5%9C%B0%E6%90%9C%E7%B4%A2/#more)  \n\n#next版本\n我的版本号是\n```java\n    # Theme version\n    version: 5.1.2\n```\nnext5.0+版本集成了algolia 这样使配置algolia更简单\n\n# algolia账号申请\n[Algolia官网](https://www.algolia.com/)\n<!-- more -->\n* 直接用github账号注册就好啦\n* 创建index空间 输入一个名称,填写你自己站点的网址\n\n![1](http://ovasdkxqr.bkt.clouddn.com/hexo/QQ%E6%88%AA%E5%9B%BE20171030220402.jpg)\n* 创建两个key   \n    1. 空间创建好后默认会有一个只有搜索权限的key  \n    2. 需要另建一个有修改记录等权限的key(这个供我们提交索引到空间使用)  \n    3. 创建key的时候要选择授权的空间\n\n![3](http://ovasdkxqr.bkt.clouddn.com/hexo/QQ%E6%88%AA%E5%9B%BE20171030220635.jpg)\n![2](http://ovasdkxqr.bkt.clouddn.com/hexo/QQ%E6%88%AA%E5%9B%BE20171030220735.jpg)\n![4](http://ovasdkxqr.bkt.clouddn.com/hexo/QQ%E6%88%AA%E5%9B%BE20171030220846.jpg)\n![5](http://ovasdkxqr.bkt.clouddn.com/hexo/QQ%E6%88%AA%E5%9B%BE20171030220920.jpg)\n* 记录  \n    1. Application ID  \n    2. 两个key建\n\n# 安装hexo-algolia\n\n用git-bash在hexo工程根目录下执行\n\n    npm install hexo-algolia --save\n# 配置algolia\n- 在Hexo工程根目录的_config.yml中加入如下配置，注意改成前面API Keys页面相应配置\n\n```java\n    algolia:\n        applicationID: '你的Application ID'\n        apiKey: '只有搜索权限的key'\n        adminApiKey: ''\n        indexName: '你的index空间名称'\n        chunkSize: 5000\n```\n\n- 修改themes>next>_config.yml \n\n    搜索 algolia_search 修改enable 为true  \n    其他字体提示可以自己随意修改\n![2](http://ovasdkxqr.bkt.clouddn.com/hexo/QQ%E6%88%AA%E5%9B%BE20171030223530.jpg)\n# 添加环境变量\n我的电脑>右键属性>高级设置>环境变量>新建>填写变量名称和变量值\n\n    变量名称 : HEXO_ALGOLIA_INDEXING_KEY\n    变量值: 在algolia新建的有修改权限的key\n![1](http://ovasdkxqr.bkt.clouddn.com/hexo/QQ%E6%88%AA%E5%9B%BE20171030222934.jpg)\n![2](http://ovasdkxqr.bkt.clouddn.com/hexo/QQ%E6%88%AA%E5%9B%BE20171030222951.jpg)\n# 生成index上传到algolia\n在hexo根目录执行,**注意确保命令行面板已经重新载入新加的环境变量**\n```java\n    hexo algolia\n```\n\n不报错就可以啦\n\n# 参考\n[NexT主题集成Algolia搜索插件](http://blog.csdn.net/luzheqi/article/details/52798557)  \n[Hexo集成Algolia搜索插件](https://jobbym.github.io/2017/01/16/Hexo%E9%9B%86%E6%88%90Algolia%E6%90%9C%E7%B4%A2%E6%8F%92%E4%BB%B6/)\n","slug":"杂记/hexo-next-搜索-algolia","published":1,"updated":"2017-11-14T16:18:06.015Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjcsq4lkh004ox4vf2jwr6fpr","content":"<h1 id=\"目的-添加搜索功能\"><a href=\"#目的-添加搜索功能\" class=\"headerlink\" title=\"目的:添加搜索功能\"></a>目的:添加搜索功能</h1><p>algolia似乎是试用一段时间就不能用了,建议使用本地搜索<br><a href=\"/2017/11/14/hexo-next-%E6%9C%AC%E5%9C%B0%E6%90%9C%E7%B4%A2/#more\">hexo-next 本地搜索</a>  </p>\n<p>#next版本<br>我的版本号是<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\"># Theme version</div><div class=\"line\">version: <span class=\"number\">5.1</span>.2</div></pre></td></tr></table></figure></p>\n<p>next5.0+版本集成了algolia 这样使配置algolia更简单</p>\n<h1 id=\"algolia账号申请\"><a href=\"#algolia账号申请\" class=\"headerlink\" title=\"algolia账号申请\"></a>algolia账号申请</h1><p><a href=\"https://www.algolia.com/\" target=\"_blank\" rel=\"external\">Algolia官网</a><br><a id=\"more\"></a></p>\n<ul>\n<li>直接用github账号注册就好啦</li>\n<li>创建index空间 输入一个名称,填写你自己站点的网址</li>\n</ul>\n<p><img src=\"http://ovasdkxqr.bkt.clouddn.com/hexo/QQ%E6%88%AA%E5%9B%BE20171030220402.jpg\" alt=\"1\"></p>\n<ul>\n<li>创建两个key   <ol>\n<li>空间创建好后默认会有一个只有搜索权限的key  </li>\n<li>需要另建一个有修改记录等权限的key(这个供我们提交索引到空间使用)  </li>\n<li>创建key的时候要选择授权的空间</li>\n</ol>\n</li>\n</ul>\n<p><img src=\"http://ovasdkxqr.bkt.clouddn.com/hexo/QQ%E6%88%AA%E5%9B%BE20171030220635.jpg\" alt=\"3\"><br><img src=\"http://ovasdkxqr.bkt.clouddn.com/hexo/QQ%E6%88%AA%E5%9B%BE20171030220735.jpg\" alt=\"2\"><br><img src=\"http://ovasdkxqr.bkt.clouddn.com/hexo/QQ%E6%88%AA%E5%9B%BE20171030220846.jpg\" alt=\"4\"><br><img src=\"http://ovasdkxqr.bkt.clouddn.com/hexo/QQ%E6%88%AA%E5%9B%BE20171030220920.jpg\" alt=\"5\"></p>\n<ul>\n<li>记录  <ol>\n<li>Application ID  </li>\n<li>两个key建</li>\n</ol>\n</li>\n</ul>\n<h1 id=\"安装hexo-algolia\"><a href=\"#安装hexo-algolia\" class=\"headerlink\" title=\"安装hexo-algolia\"></a>安装hexo-algolia</h1><p>用git-bash在hexo工程根目录下执行</p>\n<pre><code>npm install hexo-algolia --save\n</code></pre><h1 id=\"配置algolia\"><a href=\"#配置algolia\" class=\"headerlink\" title=\"配置algolia\"></a>配置algolia</h1><ul>\n<li>在Hexo工程根目录的_config.yml中加入如下配置，注意改成前面API Keys页面相应配置</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\">algolia:</div><div class=\"line\">    applicationID: <span class=\"string\">'你的Application ID'</span></div><div class=\"line\">    apiKey: <span class=\"string\">'只有搜索权限的key'</span></div><div class=\"line\">    adminApiKey: <span class=\"string\">''</span></div><div class=\"line\">    indexName: <span class=\"string\">'你的index空间名称'</span></div><div class=\"line\">    chunkSize: <span class=\"number\">5000</span></div></pre></td></tr></table></figure>\n<ul>\n<li><p>修改themes&gt;next&gt;_config.yml </p>\n<p>  搜索 algolia_search 修改enable 为true<br>  其他字体提示可以自己随意修改<br><img src=\"http://ovasdkxqr.bkt.clouddn.com/hexo/QQ%E6%88%AA%E5%9B%BE20171030223530.jpg\" alt=\"2\"></p>\n<h1 id=\"添加环境变量\"><a href=\"#添加环境变量\" class=\"headerlink\" title=\"添加环境变量\"></a>添加环境变量</h1><p>我的电脑&gt;右键属性&gt;高级设置&gt;环境变量&gt;新建&gt;填写变量名称和变量值</p>\n<p>  变量名称 : HEXO_ALGOLIA_INDEXING_KEY<br>  变量值: 在algolia新建的有修改权限的key<br><img src=\"http://ovasdkxqr.bkt.clouddn.com/hexo/QQ%E6%88%AA%E5%9B%BE20171030222934.jpg\" alt=\"1\"><br><img src=\"http://ovasdkxqr.bkt.clouddn.com/hexo/QQ%E6%88%AA%E5%9B%BE20171030222951.jpg\" alt=\"2\"></p>\n<h1 id=\"生成index上传到algolia\"><a href=\"#生成index上传到algolia\" class=\"headerlink\" title=\"生成index上传到algolia\"></a>生成index上传到algolia</h1><p>在hexo根目录执行,<strong>注意确保命令行面板已经重新载入新加的环境变量</strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">hexo algolia</div></pre></td></tr></table></figure>\n</li>\n</ul>\n<p>不报错就可以啦</p>\n<h1 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h1><p><a href=\"http://blog.csdn.net/luzheqi/article/details/52798557\" target=\"_blank\" rel=\"external\">NexT主题集成Algolia搜索插件</a><br><a href=\"https://jobbym.github.io/2017/01/16/Hexo%E9%9B%86%E6%88%90Algolia%E6%90%9C%E7%B4%A2%E6%8F%92%E4%BB%B6/\" target=\"_blank\" rel=\"external\">Hexo集成Algolia搜索插件</a></p>\n","site":{"data":{}},"excerpt":"<h1 id=\"目的-添加搜索功能\"><a href=\"#目的-添加搜索功能\" class=\"headerlink\" title=\"目的:添加搜索功能\"></a>目的:添加搜索功能</h1><p>algolia似乎是试用一段时间就不能用了,建议使用本地搜索<br><a href=\"/2017/11/14/hexo-next-%E6%9C%AC%E5%9C%B0%E6%90%9C%E7%B4%A2/#more\">hexo-next 本地搜索</a>  </p>\n<p>#next版本<br>我的版本号是<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\"># Theme version</div><div class=\"line\">version: <span class=\"number\">5.1</span>.2</div></pre></td></tr></table></figure></p>\n<p>next5.0+版本集成了algolia 这样使配置algolia更简单</p>\n<h1 id=\"algolia账号申请\"><a href=\"#algolia账号申请\" class=\"headerlink\" title=\"algolia账号申请\"></a>algolia账号申请</h1><p><a href=\"https://www.algolia.com/\" target=\"_blank\" rel=\"external\">Algolia官网</a><br>","more":"</p>\n<ul>\n<li>直接用github账号注册就好啦</li>\n<li>创建index空间 输入一个名称,填写你自己站点的网址</li>\n</ul>\n<p><img src=\"http://ovasdkxqr.bkt.clouddn.com/hexo/QQ%E6%88%AA%E5%9B%BE20171030220402.jpg\" alt=\"1\"></p>\n<ul>\n<li>创建两个key   <ol>\n<li>空间创建好后默认会有一个只有搜索权限的key  </li>\n<li>需要另建一个有修改记录等权限的key(这个供我们提交索引到空间使用)  </li>\n<li>创建key的时候要选择授权的空间</li>\n</ol>\n</li>\n</ul>\n<p><img src=\"http://ovasdkxqr.bkt.clouddn.com/hexo/QQ%E6%88%AA%E5%9B%BE20171030220635.jpg\" alt=\"3\"><br><img src=\"http://ovasdkxqr.bkt.clouddn.com/hexo/QQ%E6%88%AA%E5%9B%BE20171030220735.jpg\" alt=\"2\"><br><img src=\"http://ovasdkxqr.bkt.clouddn.com/hexo/QQ%E6%88%AA%E5%9B%BE20171030220846.jpg\" alt=\"4\"><br><img src=\"http://ovasdkxqr.bkt.clouddn.com/hexo/QQ%E6%88%AA%E5%9B%BE20171030220920.jpg\" alt=\"5\"></p>\n<ul>\n<li>记录  <ol>\n<li>Application ID  </li>\n<li>两个key建</li>\n</ol>\n</li>\n</ul>\n<h1 id=\"安装hexo-algolia\"><a href=\"#安装hexo-algolia\" class=\"headerlink\" title=\"安装hexo-algolia\"></a>安装hexo-algolia</h1><p>用git-bash在hexo工程根目录下执行</p>\n<pre><code>npm install hexo-algolia --save\n</code></pre><h1 id=\"配置algolia\"><a href=\"#配置algolia\" class=\"headerlink\" title=\"配置algolia\"></a>配置algolia</h1><ul>\n<li>在Hexo工程根目录的_config.yml中加入如下配置，注意改成前面API Keys页面相应配置</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\">algolia:</div><div class=\"line\">    applicationID: <span class=\"string\">'你的Application ID'</span></div><div class=\"line\">    apiKey: <span class=\"string\">'只有搜索权限的key'</span></div><div class=\"line\">    adminApiKey: <span class=\"string\">''</span></div><div class=\"line\">    indexName: <span class=\"string\">'你的index空间名称'</span></div><div class=\"line\">    chunkSize: <span class=\"number\">5000</span></div></pre></td></tr></table></figure>\n<ul>\n<li><p>修改themes&gt;next&gt;_config.yml </p>\n<p>  搜索 algolia_search 修改enable 为true<br>  其他字体提示可以自己随意修改<br><img src=\"http://ovasdkxqr.bkt.clouddn.com/hexo/QQ%E6%88%AA%E5%9B%BE20171030223530.jpg\" alt=\"2\"></p>\n<h1 id=\"添加环境变量\"><a href=\"#添加环境变量\" class=\"headerlink\" title=\"添加环境变量\"></a>添加环境变量</h1><p>我的电脑&gt;右键属性&gt;高级设置&gt;环境变量&gt;新建&gt;填写变量名称和变量值</p>\n<p>  变量名称 : HEXO_ALGOLIA_INDEXING_KEY<br>  变量值: 在algolia新建的有修改权限的key<br><img src=\"http://ovasdkxqr.bkt.clouddn.com/hexo/QQ%E6%88%AA%E5%9B%BE20171030222934.jpg\" alt=\"1\"><br><img src=\"http://ovasdkxqr.bkt.clouddn.com/hexo/QQ%E6%88%AA%E5%9B%BE20171030222951.jpg\" alt=\"2\"></p>\n<h1 id=\"生成index上传到algolia\"><a href=\"#生成index上传到algolia\" class=\"headerlink\" title=\"生成index上传到algolia\"></a>生成index上传到algolia</h1><p>在hexo根目录执行,<strong>注意确保命令行面板已经重新载入新加的环境变量</strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">hexo algolia</div></pre></td></tr></table></figure>\n</li>\n</ul>\n<p>不报错就可以啦</p>\n<h1 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h1><p><a href=\"http://blog.csdn.net/luzheqi/article/details/52798557\" target=\"_blank\" rel=\"external\">NexT主题集成Algolia搜索插件</a><br><a href=\"https://jobbym.github.io/2017/01/16/Hexo%E9%9B%86%E6%88%90Algolia%E6%90%9C%E7%B4%A2%E6%8F%92%E4%BB%B6/\" target=\"_blank\" rel=\"external\">Hexo集成Algolia搜索插件</a></p>"},{"title":"hexo-next 本地搜索","toc":true,"date":"2017-11-14T15:46:14.000Z","scaffolds":null,"_content":"之前用的algolia用不了了，应该是收费。查找了帖子做了本地搜索，感觉也很不错，主要是不用担心不好使了。\n# local search\n## 安装hexo-generator-searchdb\n在站点根目录通过gitbash安装\n```\nnpm install hexo-generator-searchdb --save\n```\n<!--more-->\n## 添加search字段\n在站点下_config.yml中添加search字段\n```\nsearch:\n  path: search.xml\n  field: post\n  format: html\n  limit: 10000\n```\n## 在themes\\next\\_config.yml主题配置中找到\n```\nlocal_search:\n  enable: true\n```\n将enable的值改成true\n\n# 参考链接\n[Hexo的Next主题配置](https://www.cnblogs.com/syd192/p/6074323.html)","source":"_posts/杂记/hexo-next-本地搜索.md","raw":"---\ntitle: hexo-next 本地搜索\ncategories: 学习\ntags:\n  - hexo\ntoc: true\ndate: 2017-11-14 23:46:14\nscaffolds:\n---\n之前用的algolia用不了了，应该是收费。查找了帖子做了本地搜索，感觉也很不错，主要是不用担心不好使了。\n# local search\n## 安装hexo-generator-searchdb\n在站点根目录通过gitbash安装\n```\nnpm install hexo-generator-searchdb --save\n```\n<!--more-->\n## 添加search字段\n在站点下_config.yml中添加search字段\n```\nsearch:\n  path: search.xml\n  field: post\n  format: html\n  limit: 10000\n```\n## 在themes\\next\\_config.yml主题配置中找到\n```\nlocal_search:\n  enable: true\n```\n将enable的值改成true\n\n# 参考链接\n[Hexo的Next主题配置](https://www.cnblogs.com/syd192/p/6074323.html)","slug":"杂记/hexo-next-本地搜索","published":1,"updated":"2017-11-19T11:37:54.840Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjcsq4lkk004sx4vfnmls9r0b","content":"<p>之前用的algolia用不了了，应该是收费。查找了帖子做了本地搜索，感觉也很不错，主要是不用担心不好使了。</p>\n<h1 id=\"local-search\"><a href=\"#local-search\" class=\"headerlink\" title=\"local search\"></a>local search</h1><h2 id=\"安装hexo-generator-searchdb\"><a href=\"#安装hexo-generator-searchdb\" class=\"headerlink\" title=\"安装hexo-generator-searchdb\"></a>安装hexo-generator-searchdb</h2><p>在站点根目录通过gitbash安装<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">npm install hexo-generator-searchdb --save</div></pre></td></tr></table></figure></p>\n<a id=\"more\"></a>\n<h2 id=\"添加search字段\"><a href=\"#添加search字段\" class=\"headerlink\" title=\"添加search字段\"></a>添加search字段</h2><p>在站点下_config.yml中添加search字段<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\">search:</div><div class=\"line\">  path: search.xml</div><div class=\"line\">  field: post</div><div class=\"line\">  format: html</div><div class=\"line\">  limit: 10000</div></pre></td></tr></table></figure></p>\n<h2 id=\"在themes-next-config-yml主题配置中找到\"><a href=\"#在themes-next-config-yml主题配置中找到\" class=\"headerlink\" title=\"在themes\\next_config.yml主题配置中找到\"></a>在themes\\next_config.yml主题配置中找到</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\">local_search:</div><div class=\"line\">  enable: true</div></pre></td></tr></table></figure>\n<p>将enable的值改成true</p>\n<h1 id=\"参考链接\"><a href=\"#参考链接\" class=\"headerlink\" title=\"参考链接\"></a>参考链接</h1><p><a href=\"https://www.cnblogs.com/syd192/p/6074323.html\" target=\"_blank\" rel=\"external\">Hexo的Next主题配置</a></p>\n","site":{"data":{}},"excerpt":"<p>之前用的algolia用不了了，应该是收费。查找了帖子做了本地搜索，感觉也很不错，主要是不用担心不好使了。</p>\n<h1 id=\"local-search\"><a href=\"#local-search\" class=\"headerlink\" title=\"local search\"></a>local search</h1><h2 id=\"安装hexo-generator-searchdb\"><a href=\"#安装hexo-generator-searchdb\" class=\"headerlink\" title=\"安装hexo-generator-searchdb\"></a>安装hexo-generator-searchdb</h2><p>在站点根目录通过gitbash安装<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">npm install hexo-generator-searchdb --save</div></pre></td></tr></table></figure></p>","more":"<h2 id=\"添加search字段\"><a href=\"#添加search字段\" class=\"headerlink\" title=\"添加search字段\"></a>添加search字段</h2><p>在站点下_config.yml中添加search字段<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\">search:</div><div class=\"line\">  path: search.xml</div><div class=\"line\">  field: post</div><div class=\"line\">  format: html</div><div class=\"line\">  limit: 10000</div></pre></td></tr></table></figure></p>\n<h2 id=\"在themes-next-config-yml主题配置中找到\"><a href=\"#在themes-next-config-yml主题配置中找到\" class=\"headerlink\" title=\"在themes\\next_config.yml主题配置中找到\"></a>在themes\\next_config.yml主题配置中找到</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\">local_search:</div><div class=\"line\">  enable: true</div></pre></td></tr></table></figure>\n<p>将enable的值改成true</p>\n<h1 id=\"参考链接\"><a href=\"#参考链接\" class=\"headerlink\" title=\"参考链接\"></a>参考链接</h1><p><a href=\"https://www.cnblogs.com/syd192/p/6074323.html\" target=\"_blank\" rel=\"external\">Hexo的Next主题配置</a></p>"},{"title":"idea快捷键记录","toc":true,"date":"2017-09-03T15:37:13.000Z","scaffolds":null,"_content":"查找方法,这个用于看源码的时候感觉很好用记录一下\n> ctrl+shift+alt+n\n\n//-----------------------------------\n\nNavigate | Call Hierarchy命令查看一个Java方法调用树（caller和callee两个方向）\n> ctrl+alt+H\n\nAnalyze | Dataflow from/to Here两个命令查看表达式、变量和方法参数的传递关系树。\n>Analyze | Data Flow  to Here  \n>Analyze | Data Flow  from Here\n\n<!-- more -->\n\n\"Find Usage\"可以查看一个Java类、方法或变量的直接使用情况。 \n>alt+F7\n\nNavigate | File Structure 查看文件的结构\n> ctrl+F12\n\nhttp://www.cnblogs.com/huaxingtianxia/p/5728847.html\n\n//-----------------------------------\n","source":"_posts/杂记/idea快捷键记录.md","raw":"---\ntitle: idea快捷键记录\ncategories: 工具\ntoc: true\ndate: 2017-09-03 23:37:13\nscaffolds:\ntags: [idea,快捷键]\n---\n查找方法,这个用于看源码的时候感觉很好用记录一下\n> ctrl+shift+alt+n\n\n//-----------------------------------\n\nNavigate | Call Hierarchy命令查看一个Java方法调用树（caller和callee两个方向）\n> ctrl+alt+H\n\nAnalyze | Dataflow from/to Here两个命令查看表达式、变量和方法参数的传递关系树。\n>Analyze | Data Flow  to Here  \n>Analyze | Data Flow  from Here\n\n<!-- more -->\n\n\"Find Usage\"可以查看一个Java类、方法或变量的直接使用情况。 \n>alt+F7\n\nNavigate | File Structure 查看文件的结构\n> ctrl+F12\n\nhttp://www.cnblogs.com/huaxingtianxia/p/5728847.html\n\n//-----------------------------------\n","slug":"杂记/idea快捷键记录","published":1,"updated":"2017-09-10T16:23:29.507Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjcsq4lkm004vx4vfdez4yo36","content":"<p>查找方法,这个用于看源码的时候感觉很好用记录一下</p>\n<blockquote>\n<p>ctrl+shift+alt+n</p>\n</blockquote>\n<p>//———————————–</p>\n<p>Navigate | Call Hierarchy命令查看一个Java方法调用树（caller和callee两个方向）</p>\n<blockquote>\n<p>ctrl+alt+H</p>\n</blockquote>\n<p>Analyze | Dataflow from/to Here两个命令查看表达式、变量和方法参数的传递关系树。</p>\n<blockquote>\n<p>Analyze | Data Flow  to Here<br>Analyze | Data Flow  from Here</p>\n</blockquote>\n<a id=\"more\"></a>\n<p>“Find Usage”可以查看一个Java类、方法或变量的直接使用情况。 </p>\n<blockquote>\n<p>alt+F7</p>\n</blockquote>\n<p>Navigate | File Structure 查看文件的结构</p>\n<blockquote>\n<p>ctrl+F12</p>\n</blockquote>\n<p><a href=\"http://www.cnblogs.com/huaxingtianxia/p/5728847.html\" target=\"_blank\" rel=\"external\">http://www.cnblogs.com/huaxingtianxia/p/5728847.html</a></p>\n<p>//———————————–</p>\n","site":{"data":{}},"excerpt":"<p>查找方法,这个用于看源码的时候感觉很好用记录一下</p>\n<blockquote>\n<p>ctrl+shift+alt+n</p>\n</blockquote>\n<p>//———————————–</p>\n<p>Navigate | Call Hierarchy命令查看一个Java方法调用树（caller和callee两个方向）</p>\n<blockquote>\n<p>ctrl+alt+H</p>\n</blockquote>\n<p>Analyze | Dataflow from/to Here两个命令查看表达式、变量和方法参数的传递关系树。</p>\n<blockquote>\n<p>Analyze | Data Flow  to Here<br>Analyze | Data Flow  from Here</p>\n</blockquote>","more":"<p>“Find Usage”可以查看一个Java类、方法或变量的直接使用情况。 </p>\n<blockquote>\n<p>alt+F7</p>\n</blockquote>\n<p>Navigate | File Structure 查看文件的结构</p>\n<blockquote>\n<p>ctrl+F12</p>\n</blockquote>\n<p><a href=\"http://www.cnblogs.com/huaxingtianxia/p/5728847.html\" target=\"_blank\" rel=\"external\">http://www.cnblogs.com/huaxingtianxia/p/5728847.html</a></p>\n<p>//———————————–</p>"},{"title":"linux笔记-修改语言","toc":true,"date":"2017-11-05T15:39:47.000Z","scaffolds":null,"_content":"# 版本\ncentos7\n# 查看系统是否有安装中文语言包 （列出所有可用的公共语言环境的名称，包含有zh_CN）\n```\n[vagrant@mysql1 ~]$ locale -a |grep \"zh_CN\"\nzh_CN\nzh_CN.gb18030\nzh_CN.gb2312\nzh_CN.gbk\nzh_CN.utf8\n```\n若发现以上几项，说明系统已安装中文语言包，无需再安装\n<!-- more -->\n# 安装中文包\n```\nroot@iZj6cbstl2n6r280a27eppZ tmp]# yum groupinstall \"fonts\"\n```\n# 修改i18n国际化和locale.conf本土化配置文件\n## 先查看系统语言环境\n```\n[vagrant@mysql1 ~]$ locale\nLANG=en_US.UTF-8\nLC_CTYPE=\"en_US.UTF-8\"\nLC_NUMERIC=\"en_US.UTF-8\"\nLC_TIME=\"en_US.UTF-8\"\nLC_COLLATE=\"en_US.UTF-8\"\nLC_MONETARY=\"en_US.UTF-8\"\nLC_MESSAGES=\"en_US.UTF-8\"\nLC_PAPER=\"en_US.UTF-8\"\nLC_NAME=\"en_US.UTF-8\"\nLC_ADDRESS=\"en_US.UTF-8\"\nLC_TELEPHONE=\"en_US.UTF-8\"\nLC_MEASUREMENT=\"en_US.UTF-8\"\nLC_IDENTIFICATION=\"en_US.UTF-8\"\nLC_ALL=\n```\n## 修改配置文件\n```\n vi /etc/locale.conf \n 或\n vi /etc/sysconfig/i18n (有些帖子上说修改这个,但是我的linux没有这个文件)\n```\n\n虽然安装了中文语言包但本机的语言环境并不是中文，先修改i18n配置文件\n\n```\n[root@iZj6cbstl2n6r280a27eppZ sysconfig]# vim /etc/sysconfig/i18n\n\nLANG=\"zh_CN.UTF-8\"\nLC_ALL=\"zh_CN.UTF-8\"\n\n[root@iZj6cbstl2n6r280a27eppZ sysconfig]# source /etc/sysconfig/i18n\n\n[root@iZj6cbstl2n6r280a27eppZ sysconfig]# vim /etc/locale.conf\n\nLANG=\"zh_CN.UTF-8\"\n\n [root@iZj6cbstl2n6r280a27eppZ sysconfig]# source   /etc/locale.conf\n```","source":"_posts/杂记/linux笔记-修改语言.md","raw":"---\ntitle: linux笔记-修改语言\ncategories: 学习\ntags:\n  - linux\n  - centos7\ntoc: true\ndate: 2017-11-05 23:39:47\nscaffolds:\n---\n# 版本\ncentos7\n# 查看系统是否有安装中文语言包 （列出所有可用的公共语言环境的名称，包含有zh_CN）\n```\n[vagrant@mysql1 ~]$ locale -a |grep \"zh_CN\"\nzh_CN\nzh_CN.gb18030\nzh_CN.gb2312\nzh_CN.gbk\nzh_CN.utf8\n```\n若发现以上几项，说明系统已安装中文语言包，无需再安装\n<!-- more -->\n# 安装中文包\n```\nroot@iZj6cbstl2n6r280a27eppZ tmp]# yum groupinstall \"fonts\"\n```\n# 修改i18n国际化和locale.conf本土化配置文件\n## 先查看系统语言环境\n```\n[vagrant@mysql1 ~]$ locale\nLANG=en_US.UTF-8\nLC_CTYPE=\"en_US.UTF-8\"\nLC_NUMERIC=\"en_US.UTF-8\"\nLC_TIME=\"en_US.UTF-8\"\nLC_COLLATE=\"en_US.UTF-8\"\nLC_MONETARY=\"en_US.UTF-8\"\nLC_MESSAGES=\"en_US.UTF-8\"\nLC_PAPER=\"en_US.UTF-8\"\nLC_NAME=\"en_US.UTF-8\"\nLC_ADDRESS=\"en_US.UTF-8\"\nLC_TELEPHONE=\"en_US.UTF-8\"\nLC_MEASUREMENT=\"en_US.UTF-8\"\nLC_IDENTIFICATION=\"en_US.UTF-8\"\nLC_ALL=\n```\n## 修改配置文件\n```\n vi /etc/locale.conf \n 或\n vi /etc/sysconfig/i18n (有些帖子上说修改这个,但是我的linux没有这个文件)\n```\n\n虽然安装了中文语言包但本机的语言环境并不是中文，先修改i18n配置文件\n\n```\n[root@iZj6cbstl2n6r280a27eppZ sysconfig]# vim /etc/sysconfig/i18n\n\nLANG=\"zh_CN.UTF-8\"\nLC_ALL=\"zh_CN.UTF-8\"\n\n[root@iZj6cbstl2n6r280a27eppZ sysconfig]# source /etc/sysconfig/i18n\n\n[root@iZj6cbstl2n6r280a27eppZ sysconfig]# vim /etc/locale.conf\n\nLANG=\"zh_CN.UTF-8\"\n\n [root@iZj6cbstl2n6r280a27eppZ sysconfig]# source   /etc/locale.conf\n```","slug":"杂记/linux笔记-修改语言","published":1,"updated":"2017-11-14T15:11:26.099Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjcsq4lkq004yx4vfo8g3u2br","content":"<h1 id=\"版本\"><a href=\"#版本\" class=\"headerlink\" title=\"版本\"></a>版本</h1><p>centos7</p>\n<h1 id=\"查看系统是否有安装中文语言包-（列出所有可用的公共语言环境的名称，包含有zh-CN）\"><a href=\"#查看系统是否有安装中文语言包-（列出所有可用的公共语言环境的名称，包含有zh-CN）\" class=\"headerlink\" title=\"查看系统是否有安装中文语言包 （列出所有可用的公共语言环境的名称，包含有zh_CN）\"></a>查看系统是否有安装中文语言包 （列出所有可用的公共语言环境的名称，包含有zh_CN）</h1><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\">[vagrant@mysql1 ~]$ locale -a |grep &quot;zh_CN&quot;</div><div class=\"line\">zh_CN</div><div class=\"line\">zh_CN.gb18030</div><div class=\"line\">zh_CN.gb2312</div><div class=\"line\">zh_CN.gbk</div><div class=\"line\">zh_CN.utf8</div></pre></td></tr></table></figure>\n<p>若发现以上几项，说明系统已安装中文语言包，无需再安装<br><a id=\"more\"></a></p>\n<h1 id=\"安装中文包\"><a href=\"#安装中文包\" class=\"headerlink\" title=\"安装中文包\"></a>安装中文包</h1><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">root@iZj6cbstl2n6r280a27eppZ tmp]# yum groupinstall &quot;fonts&quot;</div></pre></td></tr></table></figure>\n<h1 id=\"修改i18n国际化和locale-conf本土化配置文件\"><a href=\"#修改i18n国际化和locale-conf本土化配置文件\" class=\"headerlink\" title=\"修改i18n国际化和locale.conf本土化配置文件\"></a>修改i18n国际化和locale.conf本土化配置文件</h1><h2 id=\"先查看系统语言环境\"><a href=\"#先查看系统语言环境\" class=\"headerlink\" title=\"先查看系统语言环境\"></a>先查看系统语言环境</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div></pre></td><td class=\"code\"><pre><div class=\"line\">[vagrant@mysql1 ~]$ locale</div><div class=\"line\">LANG=en_US.UTF-8</div><div class=\"line\">LC_CTYPE=&quot;en_US.UTF-8&quot;</div><div class=\"line\">LC_NUMERIC=&quot;en_US.UTF-8&quot;</div><div class=\"line\">LC_TIME=&quot;en_US.UTF-8&quot;</div><div class=\"line\">LC_COLLATE=&quot;en_US.UTF-8&quot;</div><div class=\"line\">LC_MONETARY=&quot;en_US.UTF-8&quot;</div><div class=\"line\">LC_MESSAGES=&quot;en_US.UTF-8&quot;</div><div class=\"line\">LC_PAPER=&quot;en_US.UTF-8&quot;</div><div class=\"line\">LC_NAME=&quot;en_US.UTF-8&quot;</div><div class=\"line\">LC_ADDRESS=&quot;en_US.UTF-8&quot;</div><div class=\"line\">LC_TELEPHONE=&quot;en_US.UTF-8&quot;</div><div class=\"line\">LC_MEASUREMENT=&quot;en_US.UTF-8&quot;</div><div class=\"line\">LC_IDENTIFICATION=&quot;en_US.UTF-8&quot;</div><div class=\"line\">LC_ALL=</div></pre></td></tr></table></figure>\n<h2 id=\"修改配置文件\"><a href=\"#修改配置文件\" class=\"headerlink\" title=\"修改配置文件\"></a>修改配置文件</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\">vi /etc/locale.conf </div><div class=\"line\">或</div><div class=\"line\">vi /etc/sysconfig/i18n (有些帖子上说修改这个,但是我的linux没有这个文件)</div></pre></td></tr></table></figure>\n<p>虽然安装了中文语言包但本机的语言环境并不是中文，先修改i18n配置文件</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div></pre></td><td class=\"code\"><pre><div class=\"line\">[root@iZj6cbstl2n6r280a27eppZ sysconfig]# vim /etc/sysconfig/i18n</div><div class=\"line\"></div><div class=\"line\">LANG=&quot;zh_CN.UTF-8&quot;</div><div class=\"line\">LC_ALL=&quot;zh_CN.UTF-8&quot;</div><div class=\"line\"></div><div class=\"line\">[root@iZj6cbstl2n6r280a27eppZ sysconfig]# source /etc/sysconfig/i18n</div><div class=\"line\"></div><div class=\"line\">[root@iZj6cbstl2n6r280a27eppZ sysconfig]# vim /etc/locale.conf</div><div class=\"line\"></div><div class=\"line\">LANG=&quot;zh_CN.UTF-8&quot;</div><div class=\"line\"></div><div class=\"line\"> [root@iZj6cbstl2n6r280a27eppZ sysconfig]# source   /etc/locale.conf</div></pre></td></tr></table></figure>","site":{"data":{}},"excerpt":"<h1 id=\"版本\"><a href=\"#版本\" class=\"headerlink\" title=\"版本\"></a>版本</h1><p>centos7</p>\n<h1 id=\"查看系统是否有安装中文语言包-（列出所有可用的公共语言环境的名称，包含有zh-CN）\"><a href=\"#查看系统是否有安装中文语言包-（列出所有可用的公共语言环境的名称，包含有zh-CN）\" class=\"headerlink\" title=\"查看系统是否有安装中文语言包 （列出所有可用的公共语言环境的名称，包含有zh_CN）\"></a>查看系统是否有安装中文语言包 （列出所有可用的公共语言环境的名称，包含有zh_CN）</h1><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\">[vagrant@mysql1 ~]$ locale -a |grep &quot;zh_CN&quot;</div><div class=\"line\">zh_CN</div><div class=\"line\">zh_CN.gb18030</div><div class=\"line\">zh_CN.gb2312</div><div class=\"line\">zh_CN.gbk</div><div class=\"line\">zh_CN.utf8</div></pre></td></tr></table></figure>\n<p>若发现以上几项，说明系统已安装中文语言包，无需再安装<br>","more":"</p>\n<h1 id=\"安装中文包\"><a href=\"#安装中文包\" class=\"headerlink\" title=\"安装中文包\"></a>安装中文包</h1><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">root@iZj6cbstl2n6r280a27eppZ tmp]# yum groupinstall &quot;fonts&quot;</div></pre></td></tr></table></figure>\n<h1 id=\"修改i18n国际化和locale-conf本土化配置文件\"><a href=\"#修改i18n国际化和locale-conf本土化配置文件\" class=\"headerlink\" title=\"修改i18n国际化和locale.conf本土化配置文件\"></a>修改i18n国际化和locale.conf本土化配置文件</h1><h2 id=\"先查看系统语言环境\"><a href=\"#先查看系统语言环境\" class=\"headerlink\" title=\"先查看系统语言环境\"></a>先查看系统语言环境</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div></pre></td><td class=\"code\"><pre><div class=\"line\">[vagrant@mysql1 ~]$ locale</div><div class=\"line\">LANG=en_US.UTF-8</div><div class=\"line\">LC_CTYPE=&quot;en_US.UTF-8&quot;</div><div class=\"line\">LC_NUMERIC=&quot;en_US.UTF-8&quot;</div><div class=\"line\">LC_TIME=&quot;en_US.UTF-8&quot;</div><div class=\"line\">LC_COLLATE=&quot;en_US.UTF-8&quot;</div><div class=\"line\">LC_MONETARY=&quot;en_US.UTF-8&quot;</div><div class=\"line\">LC_MESSAGES=&quot;en_US.UTF-8&quot;</div><div class=\"line\">LC_PAPER=&quot;en_US.UTF-8&quot;</div><div class=\"line\">LC_NAME=&quot;en_US.UTF-8&quot;</div><div class=\"line\">LC_ADDRESS=&quot;en_US.UTF-8&quot;</div><div class=\"line\">LC_TELEPHONE=&quot;en_US.UTF-8&quot;</div><div class=\"line\">LC_MEASUREMENT=&quot;en_US.UTF-8&quot;</div><div class=\"line\">LC_IDENTIFICATION=&quot;en_US.UTF-8&quot;</div><div class=\"line\">LC_ALL=</div></pre></td></tr></table></figure>\n<h2 id=\"修改配置文件\"><a href=\"#修改配置文件\" class=\"headerlink\" title=\"修改配置文件\"></a>修改配置文件</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\">vi /etc/locale.conf </div><div class=\"line\">或</div><div class=\"line\">vi /etc/sysconfig/i18n (有些帖子上说修改这个,但是我的linux没有这个文件)</div></pre></td></tr></table></figure>\n<p>虽然安装了中文语言包但本机的语言环境并不是中文，先修改i18n配置文件</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div></pre></td><td class=\"code\"><pre><div class=\"line\">[root@iZj6cbstl2n6r280a27eppZ sysconfig]# vim /etc/sysconfig/i18n</div><div class=\"line\"></div><div class=\"line\">LANG=&quot;zh_CN.UTF-8&quot;</div><div class=\"line\">LC_ALL=&quot;zh_CN.UTF-8&quot;</div><div class=\"line\"></div><div class=\"line\">[root@iZj6cbstl2n6r280a27eppZ sysconfig]# source /etc/sysconfig/i18n</div><div class=\"line\"></div><div class=\"line\">[root@iZj6cbstl2n6r280a27eppZ sysconfig]# vim /etc/locale.conf</div><div class=\"line\"></div><div class=\"line\">LANG=&quot;zh_CN.UTF-8&quot;</div><div class=\"line\"></div><div class=\"line\"> [root@iZj6cbstl2n6r280a27eppZ sysconfig]# source   /etc/locale.conf</div></pre></td></tr></table></figure>"},{"title":"vagrant 创建virtualBox虚拟机","toc":true,"date":"2017-11-04T15:37:13.000Z","scaffolds":null,"_content":"# 安装vagrant\n## 本机环境\n\n系统环境 ： win10 64 系统\n\n## 软件及镜像\n\n\nvagrant 官网 https://www.vagrantup.com/  \nvagrant 需要依赖虚拟机 我用的 virtualBox  \nvirtualBox 官网 https://www.virtualbox.org/   \nvirtualBox 镜像 在vagrant官网中可以下载  \n镜像下载 http://www.vagrantbox.es/\n\n由于国内下载比较慢，已分享到百度云\n<!-- more -->\n\n|名称|类型| 分享链接|\n|:----|:----:|:---------:|\n|vagrant_1.9.5.msi | 软件 | http://pan.baidu.com/s/1kVzFP1H|\n|VirtualBox-5.1.22-115126-Win.exe | 软件 | http://pan.baidu.com/s/1jIQgl6m|\n|centos-7.0-x86_64.box | 镜像文件 | http://pan.baidu.com/s/1o7Zlspk|\n|gparted-live-0.28.1-1-i686.iso | 32位分区live-cd | http://pan.baidu.com/s/1jISiee6|\n|gparted-live-0.28.1-1-amd64.iso | 64位分区live-cd | http://pan.baidu.com/s/1dFenvvb|\n\n上面的gparted iso 文件是分区用的不过没有用到，下载不容易就一块传上来了。\n\n## 更改vagrant 存放box的位置\n默认vagrant 添加的box 默认存放位置为\n> C:\\Users\\当前用户名\\ .vagrant.d\\boxes\\ \n\n可以通过添加环境变量 VAGRANT_HOME 修改存放位置\n\n例如：VAGRANT_HOME = D:\\Program Files\\VagrantHome\n\n## 更改virtualBox 存放镜像目录\n默认目录 \n\n> C:\\Users\\当前用户名\\VirtualBox VMs\n  \n可以在virtualBox 软件 > 管理 > 全局设置 > 常规 > 默认虚拟电脑位置进行修改\n\n我修改为\n> D:\\VirtualBoxVMs\n# 启动vagrant\n## 添加box\n> vagrant box add centos7 E:\\软件安装包\\centos-7.0-x86_64.box\n\n查看已添加的box\n\n> vagrant box list\n\n    D:\\vagrantSpace>vagrant box list\n    centos7 (virtualbox, 0)\n\n## 初始化\n\n在准备存放vagrant配置文件的文件夹中执行\n\n> vagrant init \n\n会生成 Vagrantfile 文件  \n文件中包含vagrant 配置信息  \n其中有一些配置项的说明  \n\n    config.vm.box = \"base\" 修改base 为centos7 即 boxlist 中的名字  \n    config.vm.synced_folder \"E:\\\", \"/vagrant_data\" 共享文件夹\n    \n其他配置请自行百度\n\n### vagrant 配置文件\n\n下面的是我的配置\n\n    # -*- mode: ruby -*-\n    # vi: set ft=ruby :\n    Vagrant.configure(\"2\") do |config|\n      config.vm.box = \"centos7\"\n      config.vm.define :java do |java|\n        java.vm.provider \"virtualbox\" do |v|\n            v.customize [\"modifyvm\", :id, \"--name\", \"java\", \"--memory\", \"512\"]\n        end\n        java.vm.box = \"centos7\"\n        java.vm.hostname = \"java\"\n        java.vm.network :private_network, ip: \"192.168.33.10\"\n      end\n      config.vm.define :linux do |linux|\n        linux.vm.provider \"virtualbox\" do |v|\n            v.customize [\"modifyvm\", :id, \"--name\", \"linux\", \"--memory\", \"512\"]\n        end\n        linux.vm.box = \"centos7\"\n        linux.vm.hostname = \"linux\"\n        linux.vm.network :private_network, ip: \"192.168.33.11\"\n      end\n    end\n\n## 启动虚拟机\n\n> vagrant up linux \n\n第一次会初始化虚拟机,并启动,成功后查看虚拟机运行状态\n\n> vagrant global-status\n\n    D:\\vagrantSpace>vagrant global-status\n    id       name   provider   state   directory\n    -----------------------------------------------------------------------\n    1d24610  linux  virtualbox running D:/vagrantSpace\n\n这个时候就可以通过ssh登录虚拟机了。默认用户和密码都是 vagrant\n\n------------------------------------\n下面是修改磁盘大小,如果觉得没有必要,可以不修改,直接玩就可以啦\n\n# 修改虚拟机磁盘大小\n\nvagrant 默认创建的磁盘 根目录下只有10G.觉得太小,修改为1T.\n\n- 关闭 linux\n\n> vagrant halt linux\n\n- 进入到 D:\\VirtualBoxVMs文件夹下 即 之前设置的virtualBox的路径,里面会有个刚才创建的linux系统的文件夹 D:\\VirtualBoxVMs\\linux\n- 加入virtualBox 安装目录加入环境变量path\n\n    安装virtualBox后会自动加入 VBOX_MSI_INSTALL_PATH 环境变量,直接把这个路径加到path后面即可. \n    \n> %VBOX_MSI_INSTALL_PATH%\n    \n- 通过下面命令 复制一份磁盘文件, .vmdk 文件直接修改大小会报错\n\n\n> vboxmanage clonehd box-disk1.vmdk box.vdi --format vdi\n\n    D:\\VirtualBoxVMs\\linux>vboxmanage clonehd box-disk1.vmdk box.vdi --format vdi\n    0%...10%...20%...30%...40%...50%...60%...70%...80%...90%...100%\n    Clone medium created in format 'vdi'. UUID: 1431c156-a3b1-4374-b196-36450edecd9e\n\n- 修改vdi 文件大小,命令如下\n\n> vboxmanage modifyhd box.vdi --resize 1048576\n\n    D:\\VirtualBoxVMs\\linux>vboxmanage modifyhd box.vdi --resize 1048576\n    0%...10%...20%...30%...40%...50%...60%...70%...80%...90%...100%\n\n- 打开虚拟机,修改 linux 磁盘文件为 box.vdi\n\n![](https://static.oschina.net/uploads/img/201707/02192036_F9Jv.jpg)\n\n修改后\n\n![](https://static.oschina.net/uploads/img/201707/02192410_T07t.jpg)\n\n- 查看D:\\VirtualBoxVMs\\linux 文件夹下linux.vbox 文件 \n删除 原来的harddisk \n```\n     <HardDisk uuid=\"{3417d3e1-fcfd-410c-8df6-adba5f8b01bb}\" location=\"box-disk1.vmdk\" format=\"VMDK\" type=\"Normal\"/>\n```\n\n保留新的harddisk\n```\n    <HardDisk uuid=\"{417759f6-4e5d-4a45-9ce1-1351b15c5a7d}\" location=\"box-linux.vdi\" format=\"VDI\" type=\"Normal\"/>\n```\n\n\n- 删除原来的磁盘文件, box-disk1.vmdk。这个可以以后再删除也可以，防止操作中出现什么错误。\n- 启动虚拟机\n> vagrant up linux\n\n切换到root，密码为vagrant\n\n> su\n\n查看磁盘\n\n> fdisk -l\n\n    Gerät  boot.     Anfang        Ende     Blöcke   Id  System\n    /dev/sda1   *        2048     1026047      512000   83  Linux\n    /dev/sda2         1026048    20766719     9870336   8e  Linux LVM\n\n可以看到一共还是10G,并不是1T,我们需要加一个磁盘sda3\n\n    fdisk /dev/sda\n    n\n    p\n    3\n    回车\n    回车\n更改磁盘类型为 lvm\n\n    t\n    3\n    8e\n\n\n查看磁盘\n\n    p\n全部操作如下\n    \n    Befehl (m für Hilfe): n\n    Partition type:\n       p   primary (2 primary, 0 extended, 2 free)\n       e   Erweiterte\n    Select (default p): p\n    Partitionsnummer (3,4, default 3): 3\n    Erster Sektor (20766720-2147483647, Vorgabe: 20766720): \n    Benutze den Standardwert 20766720\n    Last Sektor, +Sektoren or +size{K,M,G} (20766720-2147483647, Vorgabe: 2147483647): \n    Benutze den Standardwert 2147483647\n    Partition 3 of type Linux and of size 1014,1 GiB is set\n    \n    Befehl (m für Hilfe): t\n    Partitionsnummer (1-3, default 3): 3\n    Hex code (type L to list all codes): 8e\n    Changed type of partition 'Linux' to 'Linux LVM'\n    \n    Befehl (m für Hilfe): p\n    \n    Disk /dev/sda: 1099.5 GB, 1099511627776 bytes, 2147483648 sectors\n    Units = Sektoren of 1 * 512 = 512 bytes\n    Sector size (logical/physical): 512 bytes / 512 bytes\n    I/O size (minimum/optimal): 512 bytes / 512 bytes\n    Disk label type: dos\n    Disk identifier: 0x00095a8e\n    \n       Gerät  boot.     Anfang        Ende     Blöcke   Id  System\n    /dev/sda1   *        2048     1026047      512000   83  Linux\n    /dev/sda2         1026048    20766719     9870336   8e  Linux LVM\n    /dev/sda3        20766720  2147483647  1063358464   8e  Linux LVM\n\n保存退出\n\n    w\n重启虚拟机\n    \n    reboot\n查看当前 Volume Group\n\n    vgdisplay\n信息如下\n\n    [root@linux vagrant]# vgdisplay\n      --- Volume group ---\n      VG Name               centos\n      System ID             \n      Format                lvm2\n      Metadata Areas        1\n      Metadata Sequence No  3\n      VG Access             read/write\n      VG Status             resizable\n      MAX LV                0\n      Cur LV                2\n      Open LV               2\n      Max PV                0\n      Cur PV                1\n      Act PV                1\n      VG Size               9,41 GiB\n      PE Size               4,00 MiB\n      Total PE              2409\n      Alloc PE / Size       2399 / 9,37 GiB\n      Free  PE / Size       10 / 40,00 MiB\n      VG UUID               NJWfOH-An0K-Hm9Q-8Tjs-yq2x-ZWXi-L2vP7i\n      \n名称为 centos，可调整大小（resizable），当前大小为 9,41GB。活动的 LVM 卷有\n\n    lvscan\n    \n    [root@linux vagrant]# lvscan\n    ACTIVE            '/dev/centos/swap' [1016,00 MiB] inherit\n    ACTIVE            '/dev/centos/root' [8,38 GiB] inherit\n    \n先将分配过来的新磁盘空间创建为一个新的物理卷\n\n    pvcreate /dev/sda3\n    \n    [root@linux vagrant]# pvcreate /dev/sda3\n    Physical volume \"/dev/sda3\" successfully created\n    \n然后使用新的物理卷来扩展 LVM 的 centos\n\n    vgextend centos /dev/sda3\n    \n    [root@linux vagrant]# vgextend centos /dev/sda3\n    Volume group \"centos\" successfully extended\n\n然后扩展 LVM 的逻辑卷 centos-lv_root\n\n    lvextend /dev/centos/root /dev/sda3\n    \n    [root@linux vagrant]# lvextend /dev/centos/root /dev/sda3\n    Size of logical volume centos/root changed from 8,38 GiB (2145 extents) to 1022,47 GiB (261753 extents).\n    Logical volume root successfully resized\n    \n最后，调整逻辑卷文件系统的大小\n\n    vagrant]# resize2fs /dev/centos/root\n    \n    [root@linux vagrant]# resize2fs /dev/centos/root\n    resize2fs 1.42.9 (28-Dec-2013)\n    resize2fs: Ungültige magische Zahl im Superblock beim Versuch, /dev/centos/root zu öffnen\n    Kann keinen gültigen Dateisystem-Superblock finden.\n    \n完成。看看效果,可以看到root下变成了1T\n\n    lvscan\n    \n    [root@linux vagrant]# lvscan\n      ACTIVE            '/dev/centos/swap' [1016,00 MiB] inherit\n      ACTIVE            '/dev/centos/root' [1022,47 GiB] inherit\n      \n但是,查看根目录下面分配大小, 跟目录还是为8.4G\n\n    [root@linux vagrant]# df -h\n    Dateisystem             Größe Benutzt Verf. Verw% Eingehängt auf\n    /dev/mapper/centos-root  8,4G    1,1G  7,4G   13% /\n    devtmpfs                 236M       0  236M    0% /dev\n    tmpfs                    245M       0  245M    0% /dev/shm\n    tmpfs                    245M    4,3M  241M    2% /run\n    tmpfs                    245M       0  245M    0% /sys/fs/cgroup\n    /dev/sda1                497M    118M  379M   24% /boot  \n \n用 xfs_growfs 对扩容后的 LV 进行 xfs 格式大小调整\n\n    xfs_growfs /dev/centos/root\n    \n    [root@linux vagrant]# xfs_growfs /dev/centos/root\n    meta-data=/dev/mapper/centos-root isize=256    agcount=4, agsize=549120 blks\n             =                       sectsz=512   attr=2, projid32bit=1\n             =                       crc=0        finobt=0\n    data     =                       bsize=4096   blocks=2196480, imaxpct=25\n             =                       sunit=0      swidth=0 blks\n    naming   =version 2              bsize=4096   ascii-ci=0 ftype=0\n    log      =Intern                 bsize=4096   blocks=2560, version=2\n             =                       sectsz=512   sunit=0 blks, lazy-count=1\n    realtime =keine                  extsz=4096   blocks=0, rtextents=0\n    Datenblöcke von 2196480 auf 268035072 geändert.\n\n再查看\n\n    [root@linux vagrant]# df -h\n    Dateisystem             Größe Benutzt Verf. Verw% Eingehängt auf\n    /dev/mapper/centos-root 1023G    1,1G 1022G    1% /\n    devtmpfs                 236M       0  236M    0% /dev\n    tmpfs                    245M       0  245M    0% /dev/shm\n    tmpfs                    245M    4,3M  241M    2% /run\n    tmpfs                    245M       0  245M    0% /sys/fs/cgroup\n    /dev/sda1                497M    118M  379M   24% /boot\n    \n可以看到根目录大小已经变成1T了\n\nhttp://pan.baidu.com/s/1dEC3ePr\n\n由于不了解linux,修改磁盘大小费了很多事.完成后打了包,做成了新的box，方便以后直接使用。\n\n# 其他\n## 修改linux 语言\n> /etc/locale.conf\n```\nLANG='en_US.UTF-8'\n```\n\n\n# 参考博客:  \n\n## 调整 VirtualBox 虚拟机的磁盘大小  \nhttps://cnzhx.net/blog/resizing-lvm-centos-virtualbox-guest/  \n\n## 手把手教你给 CentOS 7 添加硬盘及扩容(LVM)  \nhttps://aurthurxlc.github.io/Aurthur-2017/Centos-7-extend-lvm-volume.html\n","source":"_posts/杂记/vagrant 创建virtualBox虚拟机.md","raw":"---\ntitle: vagrant 创建virtualBox虚拟机\ncategories: 工具\ntoc: true\ndate: 2017-11-04 23:37:13\nscaffolds:\ntags: [vagrant]\n---\n# 安装vagrant\n## 本机环境\n\n系统环境 ： win10 64 系统\n\n## 软件及镜像\n\n\nvagrant 官网 https://www.vagrantup.com/  \nvagrant 需要依赖虚拟机 我用的 virtualBox  \nvirtualBox 官网 https://www.virtualbox.org/   \nvirtualBox 镜像 在vagrant官网中可以下载  \n镜像下载 http://www.vagrantbox.es/\n\n由于国内下载比较慢，已分享到百度云\n<!-- more -->\n\n|名称|类型| 分享链接|\n|:----|:----:|:---------:|\n|vagrant_1.9.5.msi | 软件 | http://pan.baidu.com/s/1kVzFP1H|\n|VirtualBox-5.1.22-115126-Win.exe | 软件 | http://pan.baidu.com/s/1jIQgl6m|\n|centos-7.0-x86_64.box | 镜像文件 | http://pan.baidu.com/s/1o7Zlspk|\n|gparted-live-0.28.1-1-i686.iso | 32位分区live-cd | http://pan.baidu.com/s/1jISiee6|\n|gparted-live-0.28.1-1-amd64.iso | 64位分区live-cd | http://pan.baidu.com/s/1dFenvvb|\n\n上面的gparted iso 文件是分区用的不过没有用到，下载不容易就一块传上来了。\n\n## 更改vagrant 存放box的位置\n默认vagrant 添加的box 默认存放位置为\n> C:\\Users\\当前用户名\\ .vagrant.d\\boxes\\ \n\n可以通过添加环境变量 VAGRANT_HOME 修改存放位置\n\n例如：VAGRANT_HOME = D:\\Program Files\\VagrantHome\n\n## 更改virtualBox 存放镜像目录\n默认目录 \n\n> C:\\Users\\当前用户名\\VirtualBox VMs\n  \n可以在virtualBox 软件 > 管理 > 全局设置 > 常规 > 默认虚拟电脑位置进行修改\n\n我修改为\n> D:\\VirtualBoxVMs\n# 启动vagrant\n## 添加box\n> vagrant box add centos7 E:\\软件安装包\\centos-7.0-x86_64.box\n\n查看已添加的box\n\n> vagrant box list\n\n    D:\\vagrantSpace>vagrant box list\n    centos7 (virtualbox, 0)\n\n## 初始化\n\n在准备存放vagrant配置文件的文件夹中执行\n\n> vagrant init \n\n会生成 Vagrantfile 文件  \n文件中包含vagrant 配置信息  \n其中有一些配置项的说明  \n\n    config.vm.box = \"base\" 修改base 为centos7 即 boxlist 中的名字  \n    config.vm.synced_folder \"E:\\\", \"/vagrant_data\" 共享文件夹\n    \n其他配置请自行百度\n\n### vagrant 配置文件\n\n下面的是我的配置\n\n    # -*- mode: ruby -*-\n    # vi: set ft=ruby :\n    Vagrant.configure(\"2\") do |config|\n      config.vm.box = \"centos7\"\n      config.vm.define :java do |java|\n        java.vm.provider \"virtualbox\" do |v|\n            v.customize [\"modifyvm\", :id, \"--name\", \"java\", \"--memory\", \"512\"]\n        end\n        java.vm.box = \"centos7\"\n        java.vm.hostname = \"java\"\n        java.vm.network :private_network, ip: \"192.168.33.10\"\n      end\n      config.vm.define :linux do |linux|\n        linux.vm.provider \"virtualbox\" do |v|\n            v.customize [\"modifyvm\", :id, \"--name\", \"linux\", \"--memory\", \"512\"]\n        end\n        linux.vm.box = \"centos7\"\n        linux.vm.hostname = \"linux\"\n        linux.vm.network :private_network, ip: \"192.168.33.11\"\n      end\n    end\n\n## 启动虚拟机\n\n> vagrant up linux \n\n第一次会初始化虚拟机,并启动,成功后查看虚拟机运行状态\n\n> vagrant global-status\n\n    D:\\vagrantSpace>vagrant global-status\n    id       name   provider   state   directory\n    -----------------------------------------------------------------------\n    1d24610  linux  virtualbox running D:/vagrantSpace\n\n这个时候就可以通过ssh登录虚拟机了。默认用户和密码都是 vagrant\n\n------------------------------------\n下面是修改磁盘大小,如果觉得没有必要,可以不修改,直接玩就可以啦\n\n# 修改虚拟机磁盘大小\n\nvagrant 默认创建的磁盘 根目录下只有10G.觉得太小,修改为1T.\n\n- 关闭 linux\n\n> vagrant halt linux\n\n- 进入到 D:\\VirtualBoxVMs文件夹下 即 之前设置的virtualBox的路径,里面会有个刚才创建的linux系统的文件夹 D:\\VirtualBoxVMs\\linux\n- 加入virtualBox 安装目录加入环境变量path\n\n    安装virtualBox后会自动加入 VBOX_MSI_INSTALL_PATH 环境变量,直接把这个路径加到path后面即可. \n    \n> %VBOX_MSI_INSTALL_PATH%\n    \n- 通过下面命令 复制一份磁盘文件, .vmdk 文件直接修改大小会报错\n\n\n> vboxmanage clonehd box-disk1.vmdk box.vdi --format vdi\n\n    D:\\VirtualBoxVMs\\linux>vboxmanage clonehd box-disk1.vmdk box.vdi --format vdi\n    0%...10%...20%...30%...40%...50%...60%...70%...80%...90%...100%\n    Clone medium created in format 'vdi'. UUID: 1431c156-a3b1-4374-b196-36450edecd9e\n\n- 修改vdi 文件大小,命令如下\n\n> vboxmanage modifyhd box.vdi --resize 1048576\n\n    D:\\VirtualBoxVMs\\linux>vboxmanage modifyhd box.vdi --resize 1048576\n    0%...10%...20%...30%...40%...50%...60%...70%...80%...90%...100%\n\n- 打开虚拟机,修改 linux 磁盘文件为 box.vdi\n\n![](https://static.oschina.net/uploads/img/201707/02192036_F9Jv.jpg)\n\n修改后\n\n![](https://static.oschina.net/uploads/img/201707/02192410_T07t.jpg)\n\n- 查看D:\\VirtualBoxVMs\\linux 文件夹下linux.vbox 文件 \n删除 原来的harddisk \n```\n     <HardDisk uuid=\"{3417d3e1-fcfd-410c-8df6-adba5f8b01bb}\" location=\"box-disk1.vmdk\" format=\"VMDK\" type=\"Normal\"/>\n```\n\n保留新的harddisk\n```\n    <HardDisk uuid=\"{417759f6-4e5d-4a45-9ce1-1351b15c5a7d}\" location=\"box-linux.vdi\" format=\"VDI\" type=\"Normal\"/>\n```\n\n\n- 删除原来的磁盘文件, box-disk1.vmdk。这个可以以后再删除也可以，防止操作中出现什么错误。\n- 启动虚拟机\n> vagrant up linux\n\n切换到root，密码为vagrant\n\n> su\n\n查看磁盘\n\n> fdisk -l\n\n    Gerät  boot.     Anfang        Ende     Blöcke   Id  System\n    /dev/sda1   *        2048     1026047      512000   83  Linux\n    /dev/sda2         1026048    20766719     9870336   8e  Linux LVM\n\n可以看到一共还是10G,并不是1T,我们需要加一个磁盘sda3\n\n    fdisk /dev/sda\n    n\n    p\n    3\n    回车\n    回车\n更改磁盘类型为 lvm\n\n    t\n    3\n    8e\n\n\n查看磁盘\n\n    p\n全部操作如下\n    \n    Befehl (m für Hilfe): n\n    Partition type:\n       p   primary (2 primary, 0 extended, 2 free)\n       e   Erweiterte\n    Select (default p): p\n    Partitionsnummer (3,4, default 3): 3\n    Erster Sektor (20766720-2147483647, Vorgabe: 20766720): \n    Benutze den Standardwert 20766720\n    Last Sektor, +Sektoren or +size{K,M,G} (20766720-2147483647, Vorgabe: 2147483647): \n    Benutze den Standardwert 2147483647\n    Partition 3 of type Linux and of size 1014,1 GiB is set\n    \n    Befehl (m für Hilfe): t\n    Partitionsnummer (1-3, default 3): 3\n    Hex code (type L to list all codes): 8e\n    Changed type of partition 'Linux' to 'Linux LVM'\n    \n    Befehl (m für Hilfe): p\n    \n    Disk /dev/sda: 1099.5 GB, 1099511627776 bytes, 2147483648 sectors\n    Units = Sektoren of 1 * 512 = 512 bytes\n    Sector size (logical/physical): 512 bytes / 512 bytes\n    I/O size (minimum/optimal): 512 bytes / 512 bytes\n    Disk label type: dos\n    Disk identifier: 0x00095a8e\n    \n       Gerät  boot.     Anfang        Ende     Blöcke   Id  System\n    /dev/sda1   *        2048     1026047      512000   83  Linux\n    /dev/sda2         1026048    20766719     9870336   8e  Linux LVM\n    /dev/sda3        20766720  2147483647  1063358464   8e  Linux LVM\n\n保存退出\n\n    w\n重启虚拟机\n    \n    reboot\n查看当前 Volume Group\n\n    vgdisplay\n信息如下\n\n    [root@linux vagrant]# vgdisplay\n      --- Volume group ---\n      VG Name               centos\n      System ID             \n      Format                lvm2\n      Metadata Areas        1\n      Metadata Sequence No  3\n      VG Access             read/write\n      VG Status             resizable\n      MAX LV                0\n      Cur LV                2\n      Open LV               2\n      Max PV                0\n      Cur PV                1\n      Act PV                1\n      VG Size               9,41 GiB\n      PE Size               4,00 MiB\n      Total PE              2409\n      Alloc PE / Size       2399 / 9,37 GiB\n      Free  PE / Size       10 / 40,00 MiB\n      VG UUID               NJWfOH-An0K-Hm9Q-8Tjs-yq2x-ZWXi-L2vP7i\n      \n名称为 centos，可调整大小（resizable），当前大小为 9,41GB。活动的 LVM 卷有\n\n    lvscan\n    \n    [root@linux vagrant]# lvscan\n    ACTIVE            '/dev/centos/swap' [1016,00 MiB] inherit\n    ACTIVE            '/dev/centos/root' [8,38 GiB] inherit\n    \n先将分配过来的新磁盘空间创建为一个新的物理卷\n\n    pvcreate /dev/sda3\n    \n    [root@linux vagrant]# pvcreate /dev/sda3\n    Physical volume \"/dev/sda3\" successfully created\n    \n然后使用新的物理卷来扩展 LVM 的 centos\n\n    vgextend centos /dev/sda3\n    \n    [root@linux vagrant]# vgextend centos /dev/sda3\n    Volume group \"centos\" successfully extended\n\n然后扩展 LVM 的逻辑卷 centos-lv_root\n\n    lvextend /dev/centos/root /dev/sda3\n    \n    [root@linux vagrant]# lvextend /dev/centos/root /dev/sda3\n    Size of logical volume centos/root changed from 8,38 GiB (2145 extents) to 1022,47 GiB (261753 extents).\n    Logical volume root successfully resized\n    \n最后，调整逻辑卷文件系统的大小\n\n    vagrant]# resize2fs /dev/centos/root\n    \n    [root@linux vagrant]# resize2fs /dev/centos/root\n    resize2fs 1.42.9 (28-Dec-2013)\n    resize2fs: Ungültige magische Zahl im Superblock beim Versuch, /dev/centos/root zu öffnen\n    Kann keinen gültigen Dateisystem-Superblock finden.\n    \n完成。看看效果,可以看到root下变成了1T\n\n    lvscan\n    \n    [root@linux vagrant]# lvscan\n      ACTIVE            '/dev/centos/swap' [1016,00 MiB] inherit\n      ACTIVE            '/dev/centos/root' [1022,47 GiB] inherit\n      \n但是,查看根目录下面分配大小, 跟目录还是为8.4G\n\n    [root@linux vagrant]# df -h\n    Dateisystem             Größe Benutzt Verf. Verw% Eingehängt auf\n    /dev/mapper/centos-root  8,4G    1,1G  7,4G   13% /\n    devtmpfs                 236M       0  236M    0% /dev\n    tmpfs                    245M       0  245M    0% /dev/shm\n    tmpfs                    245M    4,3M  241M    2% /run\n    tmpfs                    245M       0  245M    0% /sys/fs/cgroup\n    /dev/sda1                497M    118M  379M   24% /boot  \n \n用 xfs_growfs 对扩容后的 LV 进行 xfs 格式大小调整\n\n    xfs_growfs /dev/centos/root\n    \n    [root@linux vagrant]# xfs_growfs /dev/centos/root\n    meta-data=/dev/mapper/centos-root isize=256    agcount=4, agsize=549120 blks\n             =                       sectsz=512   attr=2, projid32bit=1\n             =                       crc=0        finobt=0\n    data     =                       bsize=4096   blocks=2196480, imaxpct=25\n             =                       sunit=0      swidth=0 blks\n    naming   =version 2              bsize=4096   ascii-ci=0 ftype=0\n    log      =Intern                 bsize=4096   blocks=2560, version=2\n             =                       sectsz=512   sunit=0 blks, lazy-count=1\n    realtime =keine                  extsz=4096   blocks=0, rtextents=0\n    Datenblöcke von 2196480 auf 268035072 geändert.\n\n再查看\n\n    [root@linux vagrant]# df -h\n    Dateisystem             Größe Benutzt Verf. Verw% Eingehängt auf\n    /dev/mapper/centos-root 1023G    1,1G 1022G    1% /\n    devtmpfs                 236M       0  236M    0% /dev\n    tmpfs                    245M       0  245M    0% /dev/shm\n    tmpfs                    245M    4,3M  241M    2% /run\n    tmpfs                    245M       0  245M    0% /sys/fs/cgroup\n    /dev/sda1                497M    118M  379M   24% /boot\n    \n可以看到根目录大小已经变成1T了\n\nhttp://pan.baidu.com/s/1dEC3ePr\n\n由于不了解linux,修改磁盘大小费了很多事.完成后打了包,做成了新的box，方便以后直接使用。\n\n# 其他\n## 修改linux 语言\n> /etc/locale.conf\n```\nLANG='en_US.UTF-8'\n```\n\n\n# 参考博客:  \n\n## 调整 VirtualBox 虚拟机的磁盘大小  \nhttps://cnzhx.net/blog/resizing-lvm-centos-virtualbox-guest/  \n\n## 手把手教你给 CentOS 7 添加硬盘及扩容(LVM)  \nhttps://aurthurxlc.github.io/Aurthur-2017/Centos-7-extend-lvm-volume.html\n","slug":"杂记/vagrant 创建virtualBox虚拟机","published":1,"updated":"2017-11-19T04:44:57.681Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjcsq4lkt0052x4vff56ta5rp","content":"<h1 id=\"安装vagrant\"><a href=\"#安装vagrant\" class=\"headerlink\" title=\"安装vagrant\"></a>安装vagrant</h1><h2 id=\"本机环境\"><a href=\"#本机环境\" class=\"headerlink\" title=\"本机环境\"></a>本机环境</h2><p>系统环境 ： win10 64 系统</p>\n<h2 id=\"软件及镜像\"><a href=\"#软件及镜像\" class=\"headerlink\" title=\"软件及镜像\"></a>软件及镜像</h2><p>vagrant 官网 <a href=\"https://www.vagrantup.com/\" target=\"_blank\" rel=\"external\">https://www.vagrantup.com/</a><br>vagrant 需要依赖虚拟机 我用的 virtualBox<br>virtualBox 官网 <a href=\"https://www.virtualbox.org/\" target=\"_blank\" rel=\"external\">https://www.virtualbox.org/</a><br>virtualBox 镜像 在vagrant官网中可以下载<br>镜像下载 <a href=\"http://www.vagrantbox.es/\" target=\"_blank\" rel=\"external\">http://www.vagrantbox.es/</a></p>\n<p>由于国内下载比较慢，已分享到百度云<br><a id=\"more\"></a></p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">名称</th>\n<th style=\"text-align:center\">类型</th>\n<th style=\"text-align:center\">分享链接</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\">vagrant_1.9.5.msi</td>\n<td style=\"text-align:center\">软件</td>\n<td style=\"text-align:center\"><a href=\"http://pan.baidu.com/s/1kVzFP1H\" target=\"_blank\" rel=\"external\">http://pan.baidu.com/s/1kVzFP1H</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">VirtualBox-5.1.22-115126-Win.exe</td>\n<td style=\"text-align:center\">软件</td>\n<td style=\"text-align:center\"><a href=\"http://pan.baidu.com/s/1jIQgl6m\" target=\"_blank\" rel=\"external\">http://pan.baidu.com/s/1jIQgl6m</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">centos-7.0-x86_64.box</td>\n<td style=\"text-align:center\">镜像文件</td>\n<td style=\"text-align:center\"><a href=\"http://pan.baidu.com/s/1o7Zlspk\" target=\"_blank\" rel=\"external\">http://pan.baidu.com/s/1o7Zlspk</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">gparted-live-0.28.1-1-i686.iso</td>\n<td style=\"text-align:center\">32位分区live-cd</td>\n<td style=\"text-align:center\"><a href=\"http://pan.baidu.com/s/1jISiee6\" target=\"_blank\" rel=\"external\">http://pan.baidu.com/s/1jISiee6</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">gparted-live-0.28.1-1-amd64.iso</td>\n<td style=\"text-align:center\">64位分区live-cd</td>\n<td style=\"text-align:center\"><a href=\"http://pan.baidu.com/s/1dFenvvb\" target=\"_blank\" rel=\"external\">http://pan.baidu.com/s/1dFenvvb</a></td>\n</tr>\n</tbody>\n</table>\n<p>上面的gparted iso 文件是分区用的不过没有用到，下载不容易就一块传上来了。</p>\n<h2 id=\"更改vagrant-存放box的位置\"><a href=\"#更改vagrant-存放box的位置\" class=\"headerlink\" title=\"更改vagrant 存放box的位置\"></a>更改vagrant 存放box的位置</h2><p>默认vagrant 添加的box 默认存放位置为</p>\n<blockquote>\n<p>C:\\Users\\当前用户名\\ .vagrant.d\\boxes\\ </p>\n</blockquote>\n<p>可以通过添加环境变量 VAGRANT_HOME 修改存放位置</p>\n<p>例如：VAGRANT_HOME = D:\\Program Files\\VagrantHome</p>\n<h2 id=\"更改virtualBox-存放镜像目录\"><a href=\"#更改virtualBox-存放镜像目录\" class=\"headerlink\" title=\"更改virtualBox 存放镜像目录\"></a>更改virtualBox 存放镜像目录</h2><p>默认目录 </p>\n<blockquote>\n<p>C:\\Users\\当前用户名\\VirtualBox VMs</p>\n</blockquote>\n<p>可以在virtualBox 软件 &gt; 管理 &gt; 全局设置 &gt; 常规 &gt; 默认虚拟电脑位置进行修改</p>\n<p>我修改为</p>\n<blockquote>\n<p>D:\\VirtualBoxVMs</p>\n<h1 id=\"启动vagrant\"><a href=\"#启动vagrant\" class=\"headerlink\" title=\"启动vagrant\"></a>启动vagrant</h1><h2 id=\"添加box\"><a href=\"#添加box\" class=\"headerlink\" title=\"添加box\"></a>添加box</h2><p>vagrant box add centos7 E:\\软件安装包\\centos-7.0-x86_64.box</p>\n</blockquote>\n<p>查看已添加的box</p>\n<blockquote>\n<p>vagrant box list</p>\n</blockquote>\n<pre><code>D:\\vagrantSpace&gt;vagrant box list\ncentos7 (virtualbox, 0)\n</code></pre><h2 id=\"初始化\"><a href=\"#初始化\" class=\"headerlink\" title=\"初始化\"></a>初始化</h2><p>在准备存放vagrant配置文件的文件夹中执行</p>\n<blockquote>\n<p>vagrant init </p>\n</blockquote>\n<p>会生成 Vagrantfile 文件<br>文件中包含vagrant 配置信息<br>其中有一些配置项的说明  </p>\n<pre><code>config.vm.box = &quot;base&quot; 修改base 为centos7 即 boxlist 中的名字  \nconfig.vm.synced_folder &quot;E:\\&quot;, &quot;/vagrant_data&quot; 共享文件夹\n</code></pre><p>其他配置请自行百度</p>\n<h3 id=\"vagrant-配置文件\"><a href=\"#vagrant-配置文件\" class=\"headerlink\" title=\"vagrant 配置文件\"></a>vagrant 配置文件</h3><p>下面的是我的配置</p>\n<pre><code># -*- mode: ruby -*-\n# vi: set ft=ruby :\nVagrant.configure(&quot;2&quot;) do |config|\n  config.vm.box = &quot;centos7&quot;\n  config.vm.define :java do |java|\n    java.vm.provider &quot;virtualbox&quot; do |v|\n        v.customize [&quot;modifyvm&quot;, :id, &quot;--name&quot;, &quot;java&quot;, &quot;--memory&quot;, &quot;512&quot;]\n    end\n    java.vm.box = &quot;centos7&quot;\n    java.vm.hostname = &quot;java&quot;\n    java.vm.network :private_network, ip: &quot;192.168.33.10&quot;\n  end\n  config.vm.define :linux do |linux|\n    linux.vm.provider &quot;virtualbox&quot; do |v|\n        v.customize [&quot;modifyvm&quot;, :id, &quot;--name&quot;, &quot;linux&quot;, &quot;--memory&quot;, &quot;512&quot;]\n    end\n    linux.vm.box = &quot;centos7&quot;\n    linux.vm.hostname = &quot;linux&quot;\n    linux.vm.network :private_network, ip: &quot;192.168.33.11&quot;\n  end\nend\n</code></pre><h2 id=\"启动虚拟机\"><a href=\"#启动虚拟机\" class=\"headerlink\" title=\"启动虚拟机\"></a>启动虚拟机</h2><blockquote>\n<p>vagrant up linux </p>\n</blockquote>\n<p>第一次会初始化虚拟机,并启动,成功后查看虚拟机运行状态</p>\n<blockquote>\n<p>vagrant global-status</p>\n</blockquote>\n<pre><code>D:\\vagrantSpace&gt;vagrant global-status\nid       name   provider   state   directory\n-----------------------------------------------------------------------\n1d24610  linux  virtualbox running D:/vagrantSpace\n</code></pre><p>这个时候就可以通过ssh登录虚拟机了。默认用户和密码都是 vagrant</p>\n<hr>\n<p>下面是修改磁盘大小,如果觉得没有必要,可以不修改,直接玩就可以啦</p>\n<h1 id=\"修改虚拟机磁盘大小\"><a href=\"#修改虚拟机磁盘大小\" class=\"headerlink\" title=\"修改虚拟机磁盘大小\"></a>修改虚拟机磁盘大小</h1><p>vagrant 默认创建的磁盘 根目录下只有10G.觉得太小,修改为1T.</p>\n<ul>\n<li>关闭 linux</li>\n</ul>\n<blockquote>\n<p>vagrant halt linux</p>\n</blockquote>\n<ul>\n<li>进入到 D:\\VirtualBoxVMs文件夹下 即 之前设置的virtualBox的路径,里面会有个刚才创建的linux系统的文件夹 D:\\VirtualBoxVMs\\linux</li>\n<li><p>加入virtualBox 安装目录加入环境变量path</p>\n<p>  安装virtualBox后会自动加入 VBOX_MSI_INSTALL_PATH 环境变量,直接把这个路径加到path后面即可. </p>\n</li>\n</ul>\n<blockquote>\n<p>%VBOX_MSI_INSTALL_PATH%</p>\n</blockquote>\n<ul>\n<li>通过下面命令 复制一份磁盘文件, .vmdk 文件直接修改大小会报错</li>\n</ul>\n<blockquote>\n<p>vboxmanage clonehd box-disk1.vmdk box.vdi –format vdi</p>\n</blockquote>\n<pre><code>D:\\VirtualBoxVMs\\linux&gt;vboxmanage clonehd box-disk1.vmdk box.vdi --format vdi\n0%...10%...20%...30%...40%...50%...60%...70%...80%...90%...100%\nClone medium created in format &apos;vdi&apos;. UUID: 1431c156-a3b1-4374-b196-36450edecd9e\n</code></pre><ul>\n<li>修改vdi 文件大小,命令如下</li>\n</ul>\n<blockquote>\n<p>vboxmanage modifyhd box.vdi –resize 1048576</p>\n</blockquote>\n<pre><code>D:\\VirtualBoxVMs\\linux&gt;vboxmanage modifyhd box.vdi --resize 1048576\n0%...10%...20%...30%...40%...50%...60%...70%...80%...90%...100%\n</code></pre><ul>\n<li>打开虚拟机,修改 linux 磁盘文件为 box.vdi</li>\n</ul>\n<p><img src=\"https://static.oschina.net/uploads/img/201707/02192036_F9Jv.jpg\" alt=\"\"></p>\n<p>修改后</p>\n<p><img src=\"https://static.oschina.net/uploads/img/201707/02192410_T07t.jpg\" alt=\"\"></p>\n<ul>\n<li>查看D:\\VirtualBoxVMs\\linux 文件夹下linux.vbox 文件<br>删除 原来的harddisk <figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">&lt;HardDisk uuid=&quot;&#123;3417d3e1-fcfd-410c-8df6-adba5f8b01bb&#125;&quot; location=&quot;box-disk1.vmdk&quot; format=&quot;VMDK&quot; type=&quot;Normal&quot;/&gt;</div></pre></td></tr></table></figure>\n</li>\n</ul>\n<p>保留新的harddisk<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">&lt;HardDisk uuid=&quot;&#123;417759f6-4e5d-4a45-9ce1-1351b15c5a7d&#125;&quot; location=&quot;box-linux.vdi&quot; format=&quot;VDI&quot; type=&quot;Normal&quot;/&gt;</div></pre></td></tr></table></figure></p>\n<ul>\n<li>删除原来的磁盘文件, box-disk1.vmdk。这个可以以后再删除也可以，防止操作中出现什么错误。</li>\n<li>启动虚拟机<blockquote>\n<p>vagrant up linux</p>\n</blockquote>\n</li>\n</ul>\n<p>切换到root，密码为vagrant</p>\n<blockquote>\n<p>su</p>\n</blockquote>\n<p>查看磁盘</p>\n<blockquote>\n<p>fdisk -l</p>\n</blockquote>\n<pre><code>Gerät  boot.     Anfang        Ende     Blöcke   Id  System\n/dev/sda1   *        2048     1026047      512000   83  Linux\n/dev/sda2         1026048    20766719     9870336   8e  Linux LVM\n</code></pre><p>可以看到一共还是10G,并不是1T,我们需要加一个磁盘sda3</p>\n<pre><code>fdisk /dev/sda\nn\np\n3\n回车\n回车\n</code></pre><p>更改磁盘类型为 lvm</p>\n<pre><code>t\n3\n8e\n</code></pre><p>查看磁盘</p>\n<pre><code>p\n</code></pre><p>全部操作如下</p>\n<pre><code>Befehl (m für Hilfe): n\nPartition type:\n   p   primary (2 primary, 0 extended, 2 free)\n   e   Erweiterte\nSelect (default p): p\nPartitionsnummer (3,4, default 3): 3\nErster Sektor (20766720-2147483647, Vorgabe: 20766720): \nBenutze den Standardwert 20766720\nLast Sektor, +Sektoren or +size{K,M,G} (20766720-2147483647, Vorgabe: 2147483647): \nBenutze den Standardwert 2147483647\nPartition 3 of type Linux and of size 1014,1 GiB is set\n\nBefehl (m für Hilfe): t\nPartitionsnummer (1-3, default 3): 3\nHex code (type L to list all codes): 8e\nChanged type of partition &apos;Linux&apos; to &apos;Linux LVM&apos;\n\nBefehl (m für Hilfe): p\n\nDisk /dev/sda: 1099.5 GB, 1099511627776 bytes, 2147483648 sectors\nUnits = Sektoren of 1 * 512 = 512 bytes\nSector size (logical/physical): 512 bytes / 512 bytes\nI/O size (minimum/optimal): 512 bytes / 512 bytes\nDisk label type: dos\nDisk identifier: 0x00095a8e\n\n   Gerät  boot.     Anfang        Ende     Blöcke   Id  System\n/dev/sda1   *        2048     1026047      512000   83  Linux\n/dev/sda2         1026048    20766719     9870336   8e  Linux LVM\n/dev/sda3        20766720  2147483647  1063358464   8e  Linux LVM\n</code></pre><p>保存退出</p>\n<pre><code>w\n</code></pre><p>重启虚拟机</p>\n<pre><code>reboot\n</code></pre><p>查看当前 Volume Group</p>\n<pre><code>vgdisplay\n</code></pre><p>信息如下</p>\n<pre><code>[root@linux vagrant]# vgdisplay\n  --- Volume group ---\n  VG Name               centos\n  System ID             \n  Format                lvm2\n  Metadata Areas        1\n  Metadata Sequence No  3\n  VG Access             read/write\n  VG Status             resizable\n  MAX LV                0\n  Cur LV                2\n  Open LV               2\n  Max PV                0\n  Cur PV                1\n  Act PV                1\n  VG Size               9,41 GiB\n  PE Size               4,00 MiB\n  Total PE              2409\n  Alloc PE / Size       2399 / 9,37 GiB\n  Free  PE / Size       10 / 40,00 MiB\n  VG UUID               NJWfOH-An0K-Hm9Q-8Tjs-yq2x-ZWXi-L2vP7i\n</code></pre><p>名称为 centos，可调整大小（resizable），当前大小为 9,41GB。活动的 LVM 卷有</p>\n<pre><code>lvscan\n\n[root@linux vagrant]# lvscan\nACTIVE            &apos;/dev/centos/swap&apos; [1016,00 MiB] inherit\nACTIVE            &apos;/dev/centos/root&apos; [8,38 GiB] inherit\n</code></pre><p>先将分配过来的新磁盘空间创建为一个新的物理卷</p>\n<pre><code>pvcreate /dev/sda3\n\n[root@linux vagrant]# pvcreate /dev/sda3\nPhysical volume &quot;/dev/sda3&quot; successfully created\n</code></pre><p>然后使用新的物理卷来扩展 LVM 的 centos</p>\n<pre><code>vgextend centos /dev/sda3\n\n[root@linux vagrant]# vgextend centos /dev/sda3\nVolume group &quot;centos&quot; successfully extended\n</code></pre><p>然后扩展 LVM 的逻辑卷 centos-lv_root</p>\n<pre><code>lvextend /dev/centos/root /dev/sda3\n\n[root@linux vagrant]# lvextend /dev/centos/root /dev/sda3\nSize of logical volume centos/root changed from 8,38 GiB (2145 extents) to 1022,47 GiB (261753 extents).\nLogical volume root successfully resized\n</code></pre><p>最后，调整逻辑卷文件系统的大小</p>\n<pre><code>vagrant]# resize2fs /dev/centos/root\n\n[root@linux vagrant]# resize2fs /dev/centos/root\nresize2fs 1.42.9 (28-Dec-2013)\nresize2fs: Ungültige magische Zahl im Superblock beim Versuch, /dev/centos/root zu öffnen\nKann keinen gültigen Dateisystem-Superblock finden.\n</code></pre><p>完成。看看效果,可以看到root下变成了1T</p>\n<pre><code>lvscan\n\n[root@linux vagrant]# lvscan\n  ACTIVE            &apos;/dev/centos/swap&apos; [1016,00 MiB] inherit\n  ACTIVE            &apos;/dev/centos/root&apos; [1022,47 GiB] inherit\n</code></pre><p>但是,查看根目录下面分配大小, 跟目录还是为8.4G</p>\n<pre><code>[root@linux vagrant]# df -h\nDateisystem             Größe Benutzt Verf. Verw% Eingehängt auf\n/dev/mapper/centos-root  8,4G    1,1G  7,4G   13% /\ndevtmpfs                 236M       0  236M    0% /dev\ntmpfs                    245M       0  245M    0% /dev/shm\ntmpfs                    245M    4,3M  241M    2% /run\ntmpfs                    245M       0  245M    0% /sys/fs/cgroup\n/dev/sda1                497M    118M  379M   24% /boot  \n</code></pre><p>用 xfs_growfs 对扩容后的 LV 进行 xfs 格式大小调整</p>\n<pre><code>xfs_growfs /dev/centos/root\n\n[root@linux vagrant]# xfs_growfs /dev/centos/root\nmeta-data=/dev/mapper/centos-root isize=256    agcount=4, agsize=549120 blks\n         =                       sectsz=512   attr=2, projid32bit=1\n         =                       crc=0        finobt=0\ndata     =                       bsize=4096   blocks=2196480, imaxpct=25\n         =                       sunit=0      swidth=0 blks\nnaming   =version 2              bsize=4096   ascii-ci=0 ftype=0\nlog      =Intern                 bsize=4096   blocks=2560, version=2\n         =                       sectsz=512   sunit=0 blks, lazy-count=1\nrealtime =keine                  extsz=4096   blocks=0, rtextents=0\nDatenblöcke von 2196480 auf 268035072 geändert.\n</code></pre><p>再查看</p>\n<pre><code>[root@linux vagrant]# df -h\nDateisystem             Größe Benutzt Verf. Verw% Eingehängt auf\n/dev/mapper/centos-root 1023G    1,1G 1022G    1% /\ndevtmpfs                 236M       0  236M    0% /dev\ntmpfs                    245M       0  245M    0% /dev/shm\ntmpfs                    245M    4,3M  241M    2% /run\ntmpfs                    245M       0  245M    0% /sys/fs/cgroup\n/dev/sda1                497M    118M  379M   24% /boot\n</code></pre><p>可以看到根目录大小已经变成1T了</p>\n<p><a href=\"http://pan.baidu.com/s/1dEC3ePr\" target=\"_blank\" rel=\"external\">http://pan.baidu.com/s/1dEC3ePr</a></p>\n<p>由于不了解linux,修改磁盘大小费了很多事.完成后打了包,做成了新的box，方便以后直接使用。</p>\n<h1 id=\"其他\"><a href=\"#其他\" class=\"headerlink\" title=\"其他\"></a>其他</h1><h2 id=\"修改linux-语言\"><a href=\"#修改linux-语言\" class=\"headerlink\" title=\"修改linux 语言\"></a>修改linux 语言</h2><blockquote>\n<p>/etc/locale.conf<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">LANG=&apos;en_US.UTF-8&apos;</div></pre></td></tr></table></figure></p>\n</blockquote>\n<h1 id=\"参考博客\"><a href=\"#参考博客\" class=\"headerlink\" title=\"参考博客:\"></a>参考博客:</h1><h2 id=\"调整-VirtualBox-虚拟机的磁盘大小\"><a href=\"#调整-VirtualBox-虚拟机的磁盘大小\" class=\"headerlink\" title=\"调整 VirtualBox 虚拟机的磁盘大小\"></a>调整 VirtualBox 虚拟机的磁盘大小</h2><p><a href=\"https://cnzhx.net/blog/resizing-lvm-centos-virtualbox-guest/\" target=\"_blank\" rel=\"external\">https://cnzhx.net/blog/resizing-lvm-centos-virtualbox-guest/</a>  </p>\n<h2 id=\"手把手教你给-CentOS-7-添加硬盘及扩容-LVM\"><a href=\"#手把手教你给-CentOS-7-添加硬盘及扩容-LVM\" class=\"headerlink\" title=\"手把手教你给 CentOS 7 添加硬盘及扩容(LVM)\"></a>手把手教你给 CentOS 7 添加硬盘及扩容(LVM)</h2><p><a href=\"https://aurthurxlc.github.io/Aurthur-2017/Centos-7-extend-lvm-volume.html\" target=\"_blank\" rel=\"external\">https://aurthurxlc.github.io/Aurthur-2017/Centos-7-extend-lvm-volume.html</a></p>\n","site":{"data":{}},"excerpt":"<h1 id=\"安装vagrant\"><a href=\"#安装vagrant\" class=\"headerlink\" title=\"安装vagrant\"></a>安装vagrant</h1><h2 id=\"本机环境\"><a href=\"#本机环境\" class=\"headerlink\" title=\"本机环境\"></a>本机环境</h2><p>系统环境 ： win10 64 系统</p>\n<h2 id=\"软件及镜像\"><a href=\"#软件及镜像\" class=\"headerlink\" title=\"软件及镜像\"></a>软件及镜像</h2><p>vagrant 官网 <a href=\"https://www.vagrantup.com/\" target=\"_blank\" rel=\"external\">https://www.vagrantup.com/</a><br>vagrant 需要依赖虚拟机 我用的 virtualBox<br>virtualBox 官网 <a href=\"https://www.virtualbox.org/\" target=\"_blank\" rel=\"external\">https://www.virtualbox.org/</a><br>virtualBox 镜像 在vagrant官网中可以下载<br>镜像下载 <a href=\"http://www.vagrantbox.es/\" target=\"_blank\" rel=\"external\">http://www.vagrantbox.es/</a></p>\n<p>由于国内下载比较慢，已分享到百度云<br>","more":"</p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">名称</th>\n<th style=\"text-align:center\">类型</th>\n<th style=\"text-align:center\">分享链接</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\">vagrant_1.9.5.msi</td>\n<td style=\"text-align:center\">软件</td>\n<td style=\"text-align:center\"><a href=\"http://pan.baidu.com/s/1kVzFP1H\" target=\"_blank\" rel=\"external\">http://pan.baidu.com/s/1kVzFP1H</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">VirtualBox-5.1.22-115126-Win.exe</td>\n<td style=\"text-align:center\">软件</td>\n<td style=\"text-align:center\"><a href=\"http://pan.baidu.com/s/1jIQgl6m\" target=\"_blank\" rel=\"external\">http://pan.baidu.com/s/1jIQgl6m</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">centos-7.0-x86_64.box</td>\n<td style=\"text-align:center\">镜像文件</td>\n<td style=\"text-align:center\"><a href=\"http://pan.baidu.com/s/1o7Zlspk\" target=\"_blank\" rel=\"external\">http://pan.baidu.com/s/1o7Zlspk</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">gparted-live-0.28.1-1-i686.iso</td>\n<td style=\"text-align:center\">32位分区live-cd</td>\n<td style=\"text-align:center\"><a href=\"http://pan.baidu.com/s/1jISiee6\" target=\"_blank\" rel=\"external\">http://pan.baidu.com/s/1jISiee6</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">gparted-live-0.28.1-1-amd64.iso</td>\n<td style=\"text-align:center\">64位分区live-cd</td>\n<td style=\"text-align:center\"><a href=\"http://pan.baidu.com/s/1dFenvvb\" target=\"_blank\" rel=\"external\">http://pan.baidu.com/s/1dFenvvb</a></td>\n</tr>\n</tbody>\n</table>\n<p>上面的gparted iso 文件是分区用的不过没有用到，下载不容易就一块传上来了。</p>\n<h2 id=\"更改vagrant-存放box的位置\"><a href=\"#更改vagrant-存放box的位置\" class=\"headerlink\" title=\"更改vagrant 存放box的位置\"></a>更改vagrant 存放box的位置</h2><p>默认vagrant 添加的box 默认存放位置为</p>\n<blockquote>\n<p>C:\\Users\\当前用户名\\ .vagrant.d\\boxes\\ </p>\n</blockquote>\n<p>可以通过添加环境变量 VAGRANT_HOME 修改存放位置</p>\n<p>例如：VAGRANT_HOME = D:\\Program Files\\VagrantHome</p>\n<h2 id=\"更改virtualBox-存放镜像目录\"><a href=\"#更改virtualBox-存放镜像目录\" class=\"headerlink\" title=\"更改virtualBox 存放镜像目录\"></a>更改virtualBox 存放镜像目录</h2><p>默认目录 </p>\n<blockquote>\n<p>C:\\Users\\当前用户名\\VirtualBox VMs</p>\n</blockquote>\n<p>可以在virtualBox 软件 &gt; 管理 &gt; 全局设置 &gt; 常规 &gt; 默认虚拟电脑位置进行修改</p>\n<p>我修改为</p>\n<blockquote>\n<p>D:\\VirtualBoxVMs</p>\n<h1 id=\"启动vagrant\"><a href=\"#启动vagrant\" class=\"headerlink\" title=\"启动vagrant\"></a>启动vagrant</h1><h2 id=\"添加box\"><a href=\"#添加box\" class=\"headerlink\" title=\"添加box\"></a>添加box</h2><p>vagrant box add centos7 E:\\软件安装包\\centos-7.0-x86_64.box</p>\n</blockquote>\n<p>查看已添加的box</p>\n<blockquote>\n<p>vagrant box list</p>\n</blockquote>\n<pre><code>D:\\vagrantSpace&gt;vagrant box list\ncentos7 (virtualbox, 0)\n</code></pre><h2 id=\"初始化\"><a href=\"#初始化\" class=\"headerlink\" title=\"初始化\"></a>初始化</h2><p>在准备存放vagrant配置文件的文件夹中执行</p>\n<blockquote>\n<p>vagrant init </p>\n</blockquote>\n<p>会生成 Vagrantfile 文件<br>文件中包含vagrant 配置信息<br>其中有一些配置项的说明  </p>\n<pre><code>config.vm.box = &quot;base&quot; 修改base 为centos7 即 boxlist 中的名字  \nconfig.vm.synced_folder &quot;E:\\&quot;, &quot;/vagrant_data&quot; 共享文件夹\n</code></pre><p>其他配置请自行百度</p>\n<h3 id=\"vagrant-配置文件\"><a href=\"#vagrant-配置文件\" class=\"headerlink\" title=\"vagrant 配置文件\"></a>vagrant 配置文件</h3><p>下面的是我的配置</p>\n<pre><code># -*- mode: ruby -*-\n# vi: set ft=ruby :\nVagrant.configure(&quot;2&quot;) do |config|\n  config.vm.box = &quot;centos7&quot;\n  config.vm.define :java do |java|\n    java.vm.provider &quot;virtualbox&quot; do |v|\n        v.customize [&quot;modifyvm&quot;, :id, &quot;--name&quot;, &quot;java&quot;, &quot;--memory&quot;, &quot;512&quot;]\n    end\n    java.vm.box = &quot;centos7&quot;\n    java.vm.hostname = &quot;java&quot;\n    java.vm.network :private_network, ip: &quot;192.168.33.10&quot;\n  end\n  config.vm.define :linux do |linux|\n    linux.vm.provider &quot;virtualbox&quot; do |v|\n        v.customize [&quot;modifyvm&quot;, :id, &quot;--name&quot;, &quot;linux&quot;, &quot;--memory&quot;, &quot;512&quot;]\n    end\n    linux.vm.box = &quot;centos7&quot;\n    linux.vm.hostname = &quot;linux&quot;\n    linux.vm.network :private_network, ip: &quot;192.168.33.11&quot;\n  end\nend\n</code></pre><h2 id=\"启动虚拟机\"><a href=\"#启动虚拟机\" class=\"headerlink\" title=\"启动虚拟机\"></a>启动虚拟机</h2><blockquote>\n<p>vagrant up linux </p>\n</blockquote>\n<p>第一次会初始化虚拟机,并启动,成功后查看虚拟机运行状态</p>\n<blockquote>\n<p>vagrant global-status</p>\n</blockquote>\n<pre><code>D:\\vagrantSpace&gt;vagrant global-status\nid       name   provider   state   directory\n-----------------------------------------------------------------------\n1d24610  linux  virtualbox running D:/vagrantSpace\n</code></pre><p>这个时候就可以通过ssh登录虚拟机了。默认用户和密码都是 vagrant</p>\n<hr>\n<p>下面是修改磁盘大小,如果觉得没有必要,可以不修改,直接玩就可以啦</p>\n<h1 id=\"修改虚拟机磁盘大小\"><a href=\"#修改虚拟机磁盘大小\" class=\"headerlink\" title=\"修改虚拟机磁盘大小\"></a>修改虚拟机磁盘大小</h1><p>vagrant 默认创建的磁盘 根目录下只有10G.觉得太小,修改为1T.</p>\n<ul>\n<li>关闭 linux</li>\n</ul>\n<blockquote>\n<p>vagrant halt linux</p>\n</blockquote>\n<ul>\n<li>进入到 D:\\VirtualBoxVMs文件夹下 即 之前设置的virtualBox的路径,里面会有个刚才创建的linux系统的文件夹 D:\\VirtualBoxVMs\\linux</li>\n<li><p>加入virtualBox 安装目录加入环境变量path</p>\n<p>  安装virtualBox后会自动加入 VBOX_MSI_INSTALL_PATH 环境变量,直接把这个路径加到path后面即可. </p>\n</li>\n</ul>\n<blockquote>\n<p>%VBOX_MSI_INSTALL_PATH%</p>\n</blockquote>\n<ul>\n<li>通过下面命令 复制一份磁盘文件, .vmdk 文件直接修改大小会报错</li>\n</ul>\n<blockquote>\n<p>vboxmanage clonehd box-disk1.vmdk box.vdi –format vdi</p>\n</blockquote>\n<pre><code>D:\\VirtualBoxVMs\\linux&gt;vboxmanage clonehd box-disk1.vmdk box.vdi --format vdi\n0%...10%...20%...30%...40%...50%...60%...70%...80%...90%...100%\nClone medium created in format &apos;vdi&apos;. UUID: 1431c156-a3b1-4374-b196-36450edecd9e\n</code></pre><ul>\n<li>修改vdi 文件大小,命令如下</li>\n</ul>\n<blockquote>\n<p>vboxmanage modifyhd box.vdi –resize 1048576</p>\n</blockquote>\n<pre><code>D:\\VirtualBoxVMs\\linux&gt;vboxmanage modifyhd box.vdi --resize 1048576\n0%...10%...20%...30%...40%...50%...60%...70%...80%...90%...100%\n</code></pre><ul>\n<li>打开虚拟机,修改 linux 磁盘文件为 box.vdi</li>\n</ul>\n<p><img src=\"https://static.oschina.net/uploads/img/201707/02192036_F9Jv.jpg\" alt=\"\"></p>\n<p>修改后</p>\n<p><img src=\"https://static.oschina.net/uploads/img/201707/02192410_T07t.jpg\" alt=\"\"></p>\n<ul>\n<li>查看D:\\VirtualBoxVMs\\linux 文件夹下linux.vbox 文件<br>删除 原来的harddisk <figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">&lt;HardDisk uuid=&quot;&#123;3417d3e1-fcfd-410c-8df6-adba5f8b01bb&#125;&quot; location=&quot;box-disk1.vmdk&quot; format=&quot;VMDK&quot; type=&quot;Normal&quot;/&gt;</div></pre></td></tr></table></figure>\n</li>\n</ul>\n<p>保留新的harddisk<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">&lt;HardDisk uuid=&quot;&#123;417759f6-4e5d-4a45-9ce1-1351b15c5a7d&#125;&quot; location=&quot;box-linux.vdi&quot; format=&quot;VDI&quot; type=&quot;Normal&quot;/&gt;</div></pre></td></tr></table></figure></p>\n<ul>\n<li>删除原来的磁盘文件, box-disk1.vmdk。这个可以以后再删除也可以，防止操作中出现什么错误。</li>\n<li>启动虚拟机<blockquote>\n<p>vagrant up linux</p>\n</blockquote>\n</li>\n</ul>\n<p>切换到root，密码为vagrant</p>\n<blockquote>\n<p>su</p>\n</blockquote>\n<p>查看磁盘</p>\n<blockquote>\n<p>fdisk -l</p>\n</blockquote>\n<pre><code>Gerät  boot.     Anfang        Ende     Blöcke   Id  System\n/dev/sda1   *        2048     1026047      512000   83  Linux\n/dev/sda2         1026048    20766719     9870336   8e  Linux LVM\n</code></pre><p>可以看到一共还是10G,并不是1T,我们需要加一个磁盘sda3</p>\n<pre><code>fdisk /dev/sda\nn\np\n3\n回车\n回车\n</code></pre><p>更改磁盘类型为 lvm</p>\n<pre><code>t\n3\n8e\n</code></pre><p>查看磁盘</p>\n<pre><code>p\n</code></pre><p>全部操作如下</p>\n<pre><code>Befehl (m für Hilfe): n\nPartition type:\n   p   primary (2 primary, 0 extended, 2 free)\n   e   Erweiterte\nSelect (default p): p\nPartitionsnummer (3,4, default 3): 3\nErster Sektor (20766720-2147483647, Vorgabe: 20766720): \nBenutze den Standardwert 20766720\nLast Sektor, +Sektoren or +size{K,M,G} (20766720-2147483647, Vorgabe: 2147483647): \nBenutze den Standardwert 2147483647\nPartition 3 of type Linux and of size 1014,1 GiB is set\n\nBefehl (m für Hilfe): t\nPartitionsnummer (1-3, default 3): 3\nHex code (type L to list all codes): 8e\nChanged type of partition &apos;Linux&apos; to &apos;Linux LVM&apos;\n\nBefehl (m für Hilfe): p\n\nDisk /dev/sda: 1099.5 GB, 1099511627776 bytes, 2147483648 sectors\nUnits = Sektoren of 1 * 512 = 512 bytes\nSector size (logical/physical): 512 bytes / 512 bytes\nI/O size (minimum/optimal): 512 bytes / 512 bytes\nDisk label type: dos\nDisk identifier: 0x00095a8e\n\n   Gerät  boot.     Anfang        Ende     Blöcke   Id  System\n/dev/sda1   *        2048     1026047      512000   83  Linux\n/dev/sda2         1026048    20766719     9870336   8e  Linux LVM\n/dev/sda3        20766720  2147483647  1063358464   8e  Linux LVM\n</code></pre><p>保存退出</p>\n<pre><code>w\n</code></pre><p>重启虚拟机</p>\n<pre><code>reboot\n</code></pre><p>查看当前 Volume Group</p>\n<pre><code>vgdisplay\n</code></pre><p>信息如下</p>\n<pre><code>[root@linux vagrant]# vgdisplay\n  --- Volume group ---\n  VG Name               centos\n  System ID             \n  Format                lvm2\n  Metadata Areas        1\n  Metadata Sequence No  3\n  VG Access             read/write\n  VG Status             resizable\n  MAX LV                0\n  Cur LV                2\n  Open LV               2\n  Max PV                0\n  Cur PV                1\n  Act PV                1\n  VG Size               9,41 GiB\n  PE Size               4,00 MiB\n  Total PE              2409\n  Alloc PE / Size       2399 / 9,37 GiB\n  Free  PE / Size       10 / 40,00 MiB\n  VG UUID               NJWfOH-An0K-Hm9Q-8Tjs-yq2x-ZWXi-L2vP7i\n</code></pre><p>名称为 centos，可调整大小（resizable），当前大小为 9,41GB。活动的 LVM 卷有</p>\n<pre><code>lvscan\n\n[root@linux vagrant]# lvscan\nACTIVE            &apos;/dev/centos/swap&apos; [1016,00 MiB] inherit\nACTIVE            &apos;/dev/centos/root&apos; [8,38 GiB] inherit\n</code></pre><p>先将分配过来的新磁盘空间创建为一个新的物理卷</p>\n<pre><code>pvcreate /dev/sda3\n\n[root@linux vagrant]# pvcreate /dev/sda3\nPhysical volume &quot;/dev/sda3&quot; successfully created\n</code></pre><p>然后使用新的物理卷来扩展 LVM 的 centos</p>\n<pre><code>vgextend centos /dev/sda3\n\n[root@linux vagrant]# vgextend centos /dev/sda3\nVolume group &quot;centos&quot; successfully extended\n</code></pre><p>然后扩展 LVM 的逻辑卷 centos-lv_root</p>\n<pre><code>lvextend /dev/centos/root /dev/sda3\n\n[root@linux vagrant]# lvextend /dev/centos/root /dev/sda3\nSize of logical volume centos/root changed from 8,38 GiB (2145 extents) to 1022,47 GiB (261753 extents).\nLogical volume root successfully resized\n</code></pre><p>最后，调整逻辑卷文件系统的大小</p>\n<pre><code>vagrant]# resize2fs /dev/centos/root\n\n[root@linux vagrant]# resize2fs /dev/centos/root\nresize2fs 1.42.9 (28-Dec-2013)\nresize2fs: Ungültige magische Zahl im Superblock beim Versuch, /dev/centos/root zu öffnen\nKann keinen gültigen Dateisystem-Superblock finden.\n</code></pre><p>完成。看看效果,可以看到root下变成了1T</p>\n<pre><code>lvscan\n\n[root@linux vagrant]# lvscan\n  ACTIVE            &apos;/dev/centos/swap&apos; [1016,00 MiB] inherit\n  ACTIVE            &apos;/dev/centos/root&apos; [1022,47 GiB] inherit\n</code></pre><p>但是,查看根目录下面分配大小, 跟目录还是为8.4G</p>\n<pre><code>[root@linux vagrant]# df -h\nDateisystem             Größe Benutzt Verf. Verw% Eingehängt auf\n/dev/mapper/centos-root  8,4G    1,1G  7,4G   13% /\ndevtmpfs                 236M       0  236M    0% /dev\ntmpfs                    245M       0  245M    0% /dev/shm\ntmpfs                    245M    4,3M  241M    2% /run\ntmpfs                    245M       0  245M    0% /sys/fs/cgroup\n/dev/sda1                497M    118M  379M   24% /boot  \n</code></pre><p>用 xfs_growfs 对扩容后的 LV 进行 xfs 格式大小调整</p>\n<pre><code>xfs_growfs /dev/centos/root\n\n[root@linux vagrant]# xfs_growfs /dev/centos/root\nmeta-data=/dev/mapper/centos-root isize=256    agcount=4, agsize=549120 blks\n         =                       sectsz=512   attr=2, projid32bit=1\n         =                       crc=0        finobt=0\ndata     =                       bsize=4096   blocks=2196480, imaxpct=25\n         =                       sunit=0      swidth=0 blks\nnaming   =version 2              bsize=4096   ascii-ci=0 ftype=0\nlog      =Intern                 bsize=4096   blocks=2560, version=2\n         =                       sectsz=512   sunit=0 blks, lazy-count=1\nrealtime =keine                  extsz=4096   blocks=0, rtextents=0\nDatenblöcke von 2196480 auf 268035072 geändert.\n</code></pre><p>再查看</p>\n<pre><code>[root@linux vagrant]# df -h\nDateisystem             Größe Benutzt Verf. Verw% Eingehängt auf\n/dev/mapper/centos-root 1023G    1,1G 1022G    1% /\ndevtmpfs                 236M       0  236M    0% /dev\ntmpfs                    245M       0  245M    0% /dev/shm\ntmpfs                    245M    4,3M  241M    2% /run\ntmpfs                    245M       0  245M    0% /sys/fs/cgroup\n/dev/sda1                497M    118M  379M   24% /boot\n</code></pre><p>可以看到根目录大小已经变成1T了</p>\n<p><a href=\"http://pan.baidu.com/s/1dEC3ePr\" target=\"_blank\" rel=\"external\">http://pan.baidu.com/s/1dEC3ePr</a></p>\n<p>由于不了解linux,修改磁盘大小费了很多事.完成后打了包,做成了新的box，方便以后直接使用。</p>\n<h1 id=\"其他\"><a href=\"#其他\" class=\"headerlink\" title=\"其他\"></a>其他</h1><h2 id=\"修改linux-语言\"><a href=\"#修改linux-语言\" class=\"headerlink\" title=\"修改linux 语言\"></a>修改linux 语言</h2><blockquote>\n<p>/etc/locale.conf<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">LANG=&apos;en_US.UTF-8&apos;</div></pre></td></tr></table></figure></p>\n</blockquote>\n<h1 id=\"参考博客\"><a href=\"#参考博客\" class=\"headerlink\" title=\"参考博客:\"></a>参考博客:</h1><h2 id=\"调整-VirtualBox-虚拟机的磁盘大小\"><a href=\"#调整-VirtualBox-虚拟机的磁盘大小\" class=\"headerlink\" title=\"调整 VirtualBox 虚拟机的磁盘大小\"></a>调整 VirtualBox 虚拟机的磁盘大小</h2><p><a href=\"https://cnzhx.net/blog/resizing-lvm-centos-virtualbox-guest/\" target=\"_blank\" rel=\"external\">https://cnzhx.net/blog/resizing-lvm-centos-virtualbox-guest/</a>  </p>\n<h2 id=\"手把手教你给-CentOS-7-添加硬盘及扩容-LVM\"><a href=\"#手把手教你给-CentOS-7-添加硬盘及扩容-LVM\" class=\"headerlink\" title=\"手把手教你给 CentOS 7 添加硬盘及扩容(LVM)\"></a>手把手教你给 CentOS 7 添加硬盘及扩容(LVM)</h2><p><a href=\"https://aurthurxlc.github.io/Aurthur-2017/Centos-7-extend-lvm-volume.html\" target=\"_blank\" rel=\"external\">https://aurthurxlc.github.io/Aurthur-2017/Centos-7-extend-lvm-volume.html</a></p>"},{"title":"vscode快捷键记录","toc":true,"date":"2017-09-10T16:07:26.000Z","scaffolds":null,"_content":"\n分屏预览  \nctrl+k v  \nctrl+B 唤出侧边栏   \n\n切换分屏  \nctrl+1     \nctrl+2   \nctrl+3  \n\n<!-- more -->\n\nalt+z  开启/取消自动换行  \nctrl+` 打开/关闭控制台\n\n文本编辑  \nalt+↑/↓ 挪动行  \nalt+shift+↑/↓ 向上/下复制行  \nctrl+enter 下方新建行  \nctrl+shift+enter 上方新建行  \nctrl+shift+k 删除当前行  \n\nctrl+x 剪切行(光标没选中的时候)  \nctrl+k z 编辑区域最大化  \n\n切换窗口  \nctrl+e 最近打开的文件  \nctrl+r 打开的工作空间  ","source":"_posts/杂记/vscode快捷键记录.md","raw":"---\ntitle: vscode快捷键记录\ncategories: 工具\ntags: [vscode,快捷键]\ntoc: true\ndate: 2017-09-11 00:07:26\nscaffolds:\n---\n\n分屏预览  \nctrl+k v  \nctrl+B 唤出侧边栏   \n\n切换分屏  \nctrl+1     \nctrl+2   \nctrl+3  \n\n<!-- more -->\n\nalt+z  开启/取消自动换行  \nctrl+` 打开/关闭控制台\n\n文本编辑  \nalt+↑/↓ 挪动行  \nalt+shift+↑/↓ 向上/下复制行  \nctrl+enter 下方新建行  \nctrl+shift+enter 上方新建行  \nctrl+shift+k 删除当前行  \n\nctrl+x 剪切行(光标没选中的时候)  \nctrl+k z 编辑区域最大化  \n\n切换窗口  \nctrl+e 最近打开的文件  \nctrl+r 打开的工作空间  ","slug":"杂记/vscode快捷键记录","published":1,"updated":"2017-09-10T16:28:16.129Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjcsq4lkx0055x4vf8rtbeajy","content":"<p>分屏预览<br>ctrl+k v<br>ctrl+B 唤出侧边栏   </p>\n<p>切换分屏<br>ctrl+1<br>ctrl+2<br>ctrl+3  </p>\n<a id=\"more\"></a>\n<p>alt+z  开启/取消自动换行<br>ctrl+` 打开/关闭控制台</p>\n<p>文本编辑<br>alt+↑/↓ 挪动行<br>alt+shift+↑/↓ 向上/下复制行<br>ctrl+enter 下方新建行<br>ctrl+shift+enter 上方新建行<br>ctrl+shift+k 删除当前行  </p>\n<p>ctrl+x 剪切行(光标没选中的时候)<br>ctrl+k z 编辑区域最大化  </p>\n<p>切换窗口<br>ctrl+e 最近打开的文件<br>ctrl+r 打开的工作空间  </p>\n","site":{"data":{}},"excerpt":"<p>分屏预览<br>ctrl+k v<br>ctrl+B 唤出侧边栏   </p>\n<p>切换分屏<br>ctrl+1<br>ctrl+2<br>ctrl+3  </p>","more":"<p>alt+z  开启/取消自动换行<br>ctrl+` 打开/关闭控制台</p>\n<p>文本编辑<br>alt+↑/↓ 挪动行<br>alt+shift+↑/↓ 向上/下复制行<br>ctrl+enter 下方新建行<br>ctrl+shift+enter 上方新建行<br>ctrl+shift+k 删除当前行  </p>\n<p>ctrl+x 剪切行(光标没选中的时候)<br>ctrl+k z 编辑区域最大化  </p>\n<p>切换窗口<br>ctrl+e 最近打开的文件<br>ctrl+r 打开的工作空间  </p>"},{"title":"使用多个git账户","toc":true,"date":"2018-01-07T09:36:01.000Z","scaffolds":null,"_content":"\n# 生成两个SSH key\n为了举例方便，这里使用“one”和“two”两个账户。下同。\n```\n$ ssh-keygen -t rsa -C \"one@gmail.com\"\n\n$ ssh-keygen -t rsa -C \"two@gmail.com\"\n```\n不要一路回车，分别在第一个对话的时候输入重命名（id_rsa_one和id_rsa_two），这样会生成两份，包含私钥和公钥的4个文件。\n```\nid_rsa_one\nid_rsa_one.pub\nid_rsa_two\nid_rsa_two.pub\n```\n# 添加私钥\n\n1. 打开ssh-agent\n\n    - 如果你是github官方的bash：\n    ```\n    $ ssh-agent -s\n    ```\n    - 如果你是其它，比如msysgit：\n    ```\n    $ eval $(ssh-agent -s)\n    ```\n\n2. 添加私钥\n\n    ```\n    ssh-agent bash  //不执行这个会报没有权限\n    $ ssh-add ~/.ssh/id_rsa_one\n    $ ssh-add ~/.ssh/id_rsa_two\n    ```\n# 创建config文件\n在.ssh下创建config\n\n```\n    # one(one@gmail.com) \n    Host one.github.com //自定义的映射\n    HostName github.com //git仓库对应的地址\n    PreferredAuthentications publickey\n    IdentityFile ~/.ssh/id_rsa_one //对应为文件\n    User one   //对应的用户名\n    # two(two@ gmail.com)\n    Host two.github.com\n    HostName github.com   \n    PreferredAuthentications publickey\n    IdentityFile ~/.ssh/id_rsa_two\n    User two\n```\n# 部署SSH key\n在github上添加对应的ssh key\n# clone项目方法\n> $ git clone git@`one.github.com`: `one的用户名`/learngit.git  注意是自定义的域名 和用户名（git的用户名）  \n> $ git clone git@`two.github.com`: `two的用户名`/learngit.git \n\n# 其他（与上面没有关联）\n##  git的三种环境变量\n1. 系统变量。\n    - 存放在git的安装目录下：%Git%\\etc\\gitconfig。\n    - 若使用 git config 时用 --system 选项，读写的就是这个文件：\n    - $ git config --system core.symlinks\n    - 系统变量对所有用户都适用。\n2. 用户变量。\n    - 存放在用户目录下。例如windows xp存放在：C:\\Documents and Settings\\$USER\\.gitconfig。\n    - 若使用 git config 时用 --global 选项，读写的就是这个文件：\n    - $ git config --global user.name\n    - 用户变量只适用于该用户\n3. 本地项目变量\n    - 当前项目的 git 目录中的配置文件（也就是工作目录中的 .git/config 文件）。\n    - 若使用git config 时用 --local 选项，读写的就是这个文件：\n    - $ git config --local remote.origin.url\n    - 本地变量只对当前项目有效。\n\n## 查找顺序\n本地 》 用户 》系统\n## 其他config命令\n```\n$ git config --list 查看所有环境变量\n$ git config --system --list 查看系统环境变量\n$ git config --global --list 查看用户环境变量\n$ git config --local --list 查看本地环境变量\n$ git config --[system/global/local] [varname] [yourname] 编辑环境变量\n```","source":"_posts/杂记/使用多个git账户.md","raw":"---\ntitle: 使用多个git账户\ncategories: 学习\ntags:\n  - git\ntoc: true\ndate: 2018-01-07 17:36:01\nscaffolds:\n---\n\n# 生成两个SSH key\n为了举例方便，这里使用“one”和“two”两个账户。下同。\n```\n$ ssh-keygen -t rsa -C \"one@gmail.com\"\n\n$ ssh-keygen -t rsa -C \"two@gmail.com\"\n```\n不要一路回车，分别在第一个对话的时候输入重命名（id_rsa_one和id_rsa_two），这样会生成两份，包含私钥和公钥的4个文件。\n```\nid_rsa_one\nid_rsa_one.pub\nid_rsa_two\nid_rsa_two.pub\n```\n# 添加私钥\n\n1. 打开ssh-agent\n\n    - 如果你是github官方的bash：\n    ```\n    $ ssh-agent -s\n    ```\n    - 如果你是其它，比如msysgit：\n    ```\n    $ eval $(ssh-agent -s)\n    ```\n\n2. 添加私钥\n\n    ```\n    ssh-agent bash  //不执行这个会报没有权限\n    $ ssh-add ~/.ssh/id_rsa_one\n    $ ssh-add ~/.ssh/id_rsa_two\n    ```\n# 创建config文件\n在.ssh下创建config\n\n```\n    # one(one@gmail.com) \n    Host one.github.com //自定义的映射\n    HostName github.com //git仓库对应的地址\n    PreferredAuthentications publickey\n    IdentityFile ~/.ssh/id_rsa_one //对应为文件\n    User one   //对应的用户名\n    # two(two@ gmail.com)\n    Host two.github.com\n    HostName github.com   \n    PreferredAuthentications publickey\n    IdentityFile ~/.ssh/id_rsa_two\n    User two\n```\n# 部署SSH key\n在github上添加对应的ssh key\n# clone项目方法\n> $ git clone git@`one.github.com`: `one的用户名`/learngit.git  注意是自定义的域名 和用户名（git的用户名）  \n> $ git clone git@`two.github.com`: `two的用户名`/learngit.git \n\n# 其他（与上面没有关联）\n##  git的三种环境变量\n1. 系统变量。\n    - 存放在git的安装目录下：%Git%\\etc\\gitconfig。\n    - 若使用 git config 时用 --system 选项，读写的就是这个文件：\n    - $ git config --system core.symlinks\n    - 系统变量对所有用户都适用。\n2. 用户变量。\n    - 存放在用户目录下。例如windows xp存放在：C:\\Documents and Settings\\$USER\\.gitconfig。\n    - 若使用 git config 时用 --global 选项，读写的就是这个文件：\n    - $ git config --global user.name\n    - 用户变量只适用于该用户\n3. 本地项目变量\n    - 当前项目的 git 目录中的配置文件（也就是工作目录中的 .git/config 文件）。\n    - 若使用git config 时用 --local 选项，读写的就是这个文件：\n    - $ git config --local remote.origin.url\n    - 本地变量只对当前项目有效。\n\n## 查找顺序\n本地 》 用户 》系统\n## 其他config命令\n```\n$ git config --list 查看所有环境变量\n$ git config --system --list 查看系统环境变量\n$ git config --global --list 查看用户环境变量\n$ git config --local --list 查看本地环境变量\n$ git config --[system/global/local] [varname] [yourname] 编辑环境变量\n```","slug":"杂记/使用多个git账户","published":1,"updated":"2018-01-07T09:40:55.039Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjcsq4ll00059x4vfmz89jfsu","content":"<h1 id=\"生成两个SSH-key\"><a href=\"#生成两个SSH-key\" class=\"headerlink\" title=\"生成两个SSH key\"></a>生成两个SSH key</h1><p>为了举例方便，这里使用“one”和“two”两个账户。下同。<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\">$ ssh-keygen -t rsa -C &quot;one@gmail.com&quot;</div><div class=\"line\"></div><div class=\"line\">$ ssh-keygen -t rsa -C &quot;two@gmail.com&quot;</div></pre></td></tr></table></figure></p>\n<p>不要一路回车，分别在第一个对话的时候输入重命名（id_rsa_one和id_rsa_two），这样会生成两份，包含私钥和公钥的4个文件。<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\">id_rsa_one</div><div class=\"line\">id_rsa_one.pub</div><div class=\"line\">id_rsa_two</div><div class=\"line\">id_rsa_two.pub</div></pre></td></tr></table></figure></p>\n<h1 id=\"添加私钥\"><a href=\"#添加私钥\" class=\"headerlink\" title=\"添加私钥\"></a>添加私钥</h1><ol>\n<li><p>打开ssh-agent</p>\n<ul>\n<li><p>如果你是github官方的bash：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">$ ssh-agent -s</div></pre></td></tr></table></figure>\n</li>\n<li><p>如果你是其它，比如msysgit：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">$ eval $(ssh-agent -s)</div></pre></td></tr></table></figure>\n</li>\n</ul>\n</li>\n<li><p>添加私钥</p>\n <figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\">ssh-agent bash  //不执行这个会报没有权限</div><div class=\"line\">$ ssh-add ~/.ssh/id_rsa_one</div><div class=\"line\">$ ssh-add ~/.ssh/id_rsa_two</div></pre></td></tr></table></figure>\n</li>\n</ol>\n<h1 id=\"创建config文件\"><a href=\"#创建config文件\" class=\"headerlink\" title=\"创建config文件\"></a>创建config文件</h1><p>在.ssh下创建config</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div></pre></td><td class=\"code\"><pre><div class=\"line\"># one(one@gmail.com) </div><div class=\"line\">Host one.github.com //自定义的映射</div><div class=\"line\">HostName github.com //git仓库对应的地址</div><div class=\"line\">PreferredAuthentications publickey</div><div class=\"line\">IdentityFile ~/.ssh/id_rsa_one //对应为文件</div><div class=\"line\">User one   //对应的用户名</div><div class=\"line\"># two(two@ gmail.com)</div><div class=\"line\">Host two.github.com</div><div class=\"line\">HostName github.com   </div><div class=\"line\">PreferredAuthentications publickey</div><div class=\"line\">IdentityFile ~/.ssh/id_rsa_two</div><div class=\"line\">User two</div></pre></td></tr></table></figure>\n<h1 id=\"部署SSH-key\"><a href=\"#部署SSH-key\" class=\"headerlink\" title=\"部署SSH key\"></a>部署SSH key</h1><p>在github上添加对应的ssh key</p>\n<h1 id=\"clone项目方法\"><a href=\"#clone项目方法\" class=\"headerlink\" title=\"clone项目方法\"></a>clone项目方法</h1><blockquote>\n<p>$ git clone git@<code>one.github.com</code>: <code>one的用户名</code>/learngit.git  注意是自定义的域名 和用户名（git的用户名）<br>$ git clone git@<code>two.github.com</code>: <code>two的用户名</code>/learngit.git </p>\n</blockquote>\n<h1 id=\"其他（与上面没有关联）\"><a href=\"#其他（与上面没有关联）\" class=\"headerlink\" title=\"其他（与上面没有关联）\"></a>其他（与上面没有关联）</h1><h2 id=\"git的三种环境变量\"><a href=\"#git的三种环境变量\" class=\"headerlink\" title=\"git的三种环境变量\"></a>git的三种环境变量</h2><ol>\n<li>系统变量。<ul>\n<li>存放在git的安装目录下：%Git%\\etc\\gitconfig。</li>\n<li>若使用 git config 时用 –system 选项，读写的就是这个文件：</li>\n<li>$ git config –system core.symlinks</li>\n<li>系统变量对所有用户都适用。</li>\n</ul>\n</li>\n<li>用户变量。<ul>\n<li>存放在用户目录下。例如windows xp存放在：C:\\Documents and Settings\\$USER.gitconfig。</li>\n<li>若使用 git config 时用 –global 选项，读写的就是这个文件：</li>\n<li>$ git config –global user.name</li>\n<li>用户变量只适用于该用户</li>\n</ul>\n</li>\n<li>本地项目变量<ul>\n<li>当前项目的 git 目录中的配置文件（也就是工作目录中的 .git/config 文件）。</li>\n<li>若使用git config 时用 –local 选项，读写的就是这个文件：</li>\n<li>$ git config –local remote.origin.url</li>\n<li>本地变量只对当前项目有效。</li>\n</ul>\n</li>\n</ol>\n<h2 id=\"查找顺序\"><a href=\"#查找顺序\" class=\"headerlink\" title=\"查找顺序\"></a>查找顺序</h2><p>本地 》 用户 》系统</p>\n<h2 id=\"其他config命令\"><a href=\"#其他config命令\" class=\"headerlink\" title=\"其他config命令\"></a>其他config命令</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\">$ git config --list 查看所有环境变量</div><div class=\"line\">$ git config --system --list 查看系统环境变量</div><div class=\"line\">$ git config --global --list 查看用户环境变量</div><div class=\"line\">$ git config --local --list 查看本地环境变量</div><div class=\"line\">$ git config --[system/global/local] [varname] [yourname] 编辑环境变量</div></pre></td></tr></table></figure>","site":{"data":{}},"excerpt":"","more":"<h1 id=\"生成两个SSH-key\"><a href=\"#生成两个SSH-key\" class=\"headerlink\" title=\"生成两个SSH key\"></a>生成两个SSH key</h1><p>为了举例方便，这里使用“one”和“two”两个账户。下同。<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\">$ ssh-keygen -t rsa -C &quot;one@gmail.com&quot;</div><div class=\"line\"></div><div class=\"line\">$ ssh-keygen -t rsa -C &quot;two@gmail.com&quot;</div></pre></td></tr></table></figure></p>\n<p>不要一路回车，分别在第一个对话的时候输入重命名（id_rsa_one和id_rsa_two），这样会生成两份，包含私钥和公钥的4个文件。<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\">id_rsa_one</div><div class=\"line\">id_rsa_one.pub</div><div class=\"line\">id_rsa_two</div><div class=\"line\">id_rsa_two.pub</div></pre></td></tr></table></figure></p>\n<h1 id=\"添加私钥\"><a href=\"#添加私钥\" class=\"headerlink\" title=\"添加私钥\"></a>添加私钥</h1><ol>\n<li><p>打开ssh-agent</p>\n<ul>\n<li><p>如果你是github官方的bash：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">$ ssh-agent -s</div></pre></td></tr></table></figure>\n</li>\n<li><p>如果你是其它，比如msysgit：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">$ eval $(ssh-agent -s)</div></pre></td></tr></table></figure>\n</li>\n</ul>\n</li>\n<li><p>添加私钥</p>\n <figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\">ssh-agent bash  //不执行这个会报没有权限</div><div class=\"line\">$ ssh-add ~/.ssh/id_rsa_one</div><div class=\"line\">$ ssh-add ~/.ssh/id_rsa_two</div></pre></td></tr></table></figure>\n</li>\n</ol>\n<h1 id=\"创建config文件\"><a href=\"#创建config文件\" class=\"headerlink\" title=\"创建config文件\"></a>创建config文件</h1><p>在.ssh下创建config</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div></pre></td><td class=\"code\"><pre><div class=\"line\"># one(one@gmail.com) </div><div class=\"line\">Host one.github.com //自定义的映射</div><div class=\"line\">HostName github.com //git仓库对应的地址</div><div class=\"line\">PreferredAuthentications publickey</div><div class=\"line\">IdentityFile ~/.ssh/id_rsa_one //对应为文件</div><div class=\"line\">User one   //对应的用户名</div><div class=\"line\"># two(two@ gmail.com)</div><div class=\"line\">Host two.github.com</div><div class=\"line\">HostName github.com   </div><div class=\"line\">PreferredAuthentications publickey</div><div class=\"line\">IdentityFile ~/.ssh/id_rsa_two</div><div class=\"line\">User two</div></pre></td></tr></table></figure>\n<h1 id=\"部署SSH-key\"><a href=\"#部署SSH-key\" class=\"headerlink\" title=\"部署SSH key\"></a>部署SSH key</h1><p>在github上添加对应的ssh key</p>\n<h1 id=\"clone项目方法\"><a href=\"#clone项目方法\" class=\"headerlink\" title=\"clone项目方法\"></a>clone项目方法</h1><blockquote>\n<p>$ git clone git@<code>one.github.com</code>: <code>one的用户名</code>/learngit.git  注意是自定义的域名 和用户名（git的用户名）<br>$ git clone git@<code>two.github.com</code>: <code>two的用户名</code>/learngit.git </p>\n</blockquote>\n<h1 id=\"其他（与上面没有关联）\"><a href=\"#其他（与上面没有关联）\" class=\"headerlink\" title=\"其他（与上面没有关联）\"></a>其他（与上面没有关联）</h1><h2 id=\"git的三种环境变量\"><a href=\"#git的三种环境变量\" class=\"headerlink\" title=\"git的三种环境变量\"></a>git的三种环境变量</h2><ol>\n<li>系统变量。<ul>\n<li>存放在git的安装目录下：%Git%\\etc\\gitconfig。</li>\n<li>若使用 git config 时用 –system 选项，读写的就是这个文件：</li>\n<li>$ git config –system core.symlinks</li>\n<li>系统变量对所有用户都适用。</li>\n</ul>\n</li>\n<li>用户变量。<ul>\n<li>存放在用户目录下。例如windows xp存放在：C:\\Documents and Settings\\$USER.gitconfig。</li>\n<li>若使用 git config 时用 –global 选项，读写的就是这个文件：</li>\n<li>$ git config –global user.name</li>\n<li>用户变量只适用于该用户</li>\n</ul>\n</li>\n<li>本地项目变量<ul>\n<li>当前项目的 git 目录中的配置文件（也就是工作目录中的 .git/config 文件）。</li>\n<li>若使用git config 时用 –local 选项，读写的就是这个文件：</li>\n<li>$ git config –local remote.origin.url</li>\n<li>本地变量只对当前项目有效。</li>\n</ul>\n</li>\n</ol>\n<h2 id=\"查找顺序\"><a href=\"#查找顺序\" class=\"headerlink\" title=\"查找顺序\"></a>查找顺序</h2><p>本地 》 用户 》系统</p>\n<h2 id=\"其他config命令\"><a href=\"#其他config命令\" class=\"headerlink\" title=\"其他config命令\"></a>其他config命令</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\">$ git config --list 查看所有环境变量</div><div class=\"line\">$ git config --system --list 查看系统环境变量</div><div class=\"line\">$ git config --global --list 查看用户环境变量</div><div class=\"line\">$ git config --local --list 查看本地环境变量</div><div class=\"line\">$ git config --[system/global/local] [varname] [yourname] 编辑环境变量</div></pre></td></tr></table></figure>"},{"title":"记录下hexo常用命令自己方便看","toc":true,"date":"2017-09-03T14:02:00.000Z","scaffolds":null,"_content":"\n```\n    Hexo常用命令：\n\n        hexo new \"postName\"       #新建文章\n        hexo new page \"pageName\"  #新建页面\n        hexo generate             #生成静态页面至public目录\n        hexo server               #开启预览访问端口（默认端口4000，'ctrl + c'关闭server）\n        hexo deploy               #将.deploy目录部署到GitHub\n```\n<!-- more -->\n简写\n    \n```\nhexo n == hexo new\nhexo g == hexo generate\nhexo s == hexo server\nhexo d == hexo deploy\n```\n\n复合命令\n\n```\n    hexo deploy -g\n    hexo server -g\n```    \n有时候生成的网页出错了，而生成的rss其实没有清除，那么用下面的命令，在重新生成吧\n    \n    hexo clean","source":"_posts/杂记/记录下hexo常用命令自己方便看.md","raw":"---\ntitle: 记录下hexo常用命令自己方便看\ntoc: true\ndate: 2017-09-03 22:02:00\ncategories: 工具\nscaffolds:\ntags: hexo\n---\n\n```\n    Hexo常用命令：\n\n        hexo new \"postName\"       #新建文章\n        hexo new page \"pageName\"  #新建页面\n        hexo generate             #生成静态页面至public目录\n        hexo server               #开启预览访问端口（默认端口4000，'ctrl + c'关闭server）\n        hexo deploy               #将.deploy目录部署到GitHub\n```\n<!-- more -->\n简写\n    \n```\nhexo n == hexo new\nhexo g == hexo generate\nhexo s == hexo server\nhexo d == hexo deploy\n```\n\n复合命令\n\n```\n    hexo deploy -g\n    hexo server -g\n```    \n有时候生成的网页出错了，而生成的rss其实没有清除，那么用下面的命令，在重新生成吧\n    \n    hexo clean","slug":"杂记/记录下hexo常用命令自己方便看","published":1,"updated":"2017-09-03T15:30:32.771Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjcsq4ll5005cx4vfjcwk626t","content":"<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div></pre></td><td class=\"code\"><pre><div class=\"line\">Hexo常用命令：</div><div class=\"line\"></div><div class=\"line\">    hexo new &quot;postName&quot;       #新建文章</div><div class=\"line\">    hexo new page &quot;pageName&quot;  #新建页面</div><div class=\"line\">    hexo generate             #生成静态页面至public目录</div><div class=\"line\">    hexo server               #开启预览访问端口（默认端口4000，&apos;ctrl + c&apos;关闭server）</div><div class=\"line\">    hexo deploy               #将.deploy目录部署到GitHub</div></pre></td></tr></table></figure>\n<a id=\"more\"></a>\n<p>简写</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\">hexo n == hexo new</div><div class=\"line\">hexo g == hexo generate</div><div class=\"line\">hexo s == hexo server</div><div class=\"line\">hexo d == hexo deploy</div></pre></td></tr></table></figure>\n<p>复合命令</p>\n<pre><code>hexo deploy -g\nhexo server -g\n</code></pre><p>有时候生成的网页出错了，而生成的rss其实没有清除，那么用下面的命令，在重新生成吧</p>\n<pre><code>hexo clean\n</code></pre>","site":{"data":{}},"excerpt":"<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div></pre></td><td class=\"code\"><pre><div class=\"line\">Hexo常用命令：</div><div class=\"line\"></div><div class=\"line\">    hexo new &quot;postName&quot;       #新建文章</div><div class=\"line\">    hexo new page &quot;pageName&quot;  #新建页面</div><div class=\"line\">    hexo generate             #生成静态页面至public目录</div><div class=\"line\">    hexo server               #开启预览访问端口（默认端口4000，&apos;ctrl + c&apos;关闭server）</div><div class=\"line\">    hexo deploy               #将.deploy目录部署到GitHub</div></pre></td></tr></table></figure>","more":"<p>简写</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\">hexo n == hexo new</div><div class=\"line\">hexo g == hexo generate</div><div class=\"line\">hexo s == hexo server</div><div class=\"line\">hexo d == hexo deploy</div></pre></td></tr></table></figure>\n<p>复合命令</p>\n<pre><code>hexo deploy -g\nhexo server -g\n</code></pre><p>有时候生成的网页出错了，而生成的rss其实没有清除，那么用下面的命令，在重新生成吧</p>\n<pre><code>hexo clean\n</code></pre>"},{"title":"js心跳请求","toc":true,"date":"2018-01-24T07:03:02.000Z","scaffolds":null,"_content":"\n示例代码,mark一下  \nvar timer = setInterval (function(){},time)  \nclearInterval(timer)  \n<!-- more -->\n\n```javascript\nvar timer;\ntimer = setInterval(function(){\n    Common.ajax.execute({\n        'url': Common.url.getBaseURL() + '/flow/get-trusteeship.do',\n        'data': {\n            \"programId\": $(\"#programId\").val(),\n        },\n        'success': function (data) {\n            if (data.result == 'success' && data.trusteeship) {\n                if(data.trusteeship.status == 3){\n                    clearInterval(timer);\n                    EmayPagination.action.skipToCurrentPage($('#trusteeshipListQueryPaginationContainer'),\n                        $('#trusteeshipListQueryPaginationContainer .pagination-node.active').attr('data-current-page-number'));\n                    Trusteeship.dom.setStep(3);\n                }\n            }\n        },\n        'error': function () {\n            Messager.action.error('操作异常。');\n        }\n    });\n\n},5000);\n```","source":"_posts/杂记/js心跳请求.md","raw":"---\ntitle: js心跳请求\ncategories: 学习\ntags:\n  - javascript\ntoc: true\ndate: 2018-01-24 15:03:02\nscaffolds:\n---\n\n示例代码,mark一下  \nvar timer = setInterval (function(){},time)  \nclearInterval(timer)  \n<!-- more -->\n\n```javascript\nvar timer;\ntimer = setInterval(function(){\n    Common.ajax.execute({\n        'url': Common.url.getBaseURL() + '/flow/get-trusteeship.do',\n        'data': {\n            \"programId\": $(\"#programId\").val(),\n        },\n        'success': function (data) {\n            if (data.result == 'success' && data.trusteeship) {\n                if(data.trusteeship.status == 3){\n                    clearInterval(timer);\n                    EmayPagination.action.skipToCurrentPage($('#trusteeshipListQueryPaginationContainer'),\n                        $('#trusteeshipListQueryPaginationContainer .pagination-node.active').attr('data-current-page-number'));\n                    Trusteeship.dom.setStep(3);\n                }\n            }\n        },\n        'error': function () {\n            Messager.action.error('操作异常。');\n        }\n    });\n\n},5000);\n```","slug":"杂记/js心跳请求","published":1,"updated":"2018-01-24T07:16:40.764Z","_id":"cjcsqintm00000gvflddykbio","comments":1,"layout":"post","photos":[],"link":"","content":"<p>示例代码,mark一下<br>var timer = setInterval (function(){},time)<br>clearInterval(timer)<br><a id=\"more\"></a></p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">var</span> timer;</div><div class=\"line\">timer = setInterval(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</div><div class=\"line\">    Common.ajax.execute(&#123;</div><div class=\"line\">        <span class=\"string\">'url'</span>: Common.url.getBaseURL() + <span class=\"string\">'/flow/get-trusteeship.do'</span>,</div><div class=\"line\">        <span class=\"string\">'data'</span>: &#123;</div><div class=\"line\">            <span class=\"string\">\"programId\"</span>: $(<span class=\"string\">\"#programId\"</span>).val(),</div><div class=\"line\">        &#125;,</div><div class=\"line\">        <span class=\"string\">'success'</span>: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">data</span>) </span>&#123;</div><div class=\"line\">            <span class=\"keyword\">if</span> (data.result == <span class=\"string\">'success'</span> &amp;&amp; data.trusteeship) &#123;</div><div class=\"line\">                <span class=\"keyword\">if</span>(data.trusteeship.status == <span class=\"number\">3</span>)&#123;</div><div class=\"line\">                    clearInterval(timer);</div><div class=\"line\">                    EmayPagination.action.skipToCurrentPage($(<span class=\"string\">'#trusteeshipListQueryPaginationContainer'</span>),</div><div class=\"line\">                        $(<span class=\"string\">'#trusteeshipListQueryPaginationContainer .pagination-node.active'</span>).attr(<span class=\"string\">'data-current-page-number'</span>));</div><div class=\"line\">                    Trusteeship.dom.setStep(<span class=\"number\">3</span>);</div><div class=\"line\">                &#125;</div><div class=\"line\">            &#125;</div><div class=\"line\">        &#125;,</div><div class=\"line\">        <span class=\"string\">'error'</span>: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</div><div class=\"line\">            Messager.action.error(<span class=\"string\">'操作异常。'</span>);</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;);</div><div class=\"line\"></div><div class=\"line\">&#125;,<span class=\"number\">5000</span>);</div></pre></td></tr></table></figure>","site":{"data":{}},"excerpt":"<p>示例代码,mark一下<br>var timer = setInterval (function(){},time)<br>clearInterval(timer)<br>","more":"</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">var</span> timer;</div><div class=\"line\">timer = setInterval(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</div><div class=\"line\">    Common.ajax.execute(&#123;</div><div class=\"line\">        <span class=\"string\">'url'</span>: Common.url.getBaseURL() + <span class=\"string\">'/flow/get-trusteeship.do'</span>,</div><div class=\"line\">        <span class=\"string\">'data'</span>: &#123;</div><div class=\"line\">            <span class=\"string\">\"programId\"</span>: $(<span class=\"string\">\"#programId\"</span>).val(),</div><div class=\"line\">        &#125;,</div><div class=\"line\">        <span class=\"string\">'success'</span>: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">data</span>) </span>&#123;</div><div class=\"line\">            <span class=\"keyword\">if</span> (data.result == <span class=\"string\">'success'</span> &amp;&amp; data.trusteeship) &#123;</div><div class=\"line\">                <span class=\"keyword\">if</span>(data.trusteeship.status == <span class=\"number\">3</span>)&#123;</div><div class=\"line\">                    clearInterval(timer);</div><div class=\"line\">                    EmayPagination.action.skipToCurrentPage($(<span class=\"string\">'#trusteeshipListQueryPaginationContainer'</span>),</div><div class=\"line\">                        $(<span class=\"string\">'#trusteeshipListQueryPaginationContainer .pagination-node.active'</span>).attr(<span class=\"string\">'data-current-page-number'</span>));</div><div class=\"line\">                    Trusteeship.dom.setStep(<span class=\"number\">3</span>);</div><div class=\"line\">                &#125;</div><div class=\"line\">            &#125;</div><div class=\"line\">        &#125;,</div><div class=\"line\">        <span class=\"string\">'error'</span>: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</div><div class=\"line\">            Messager.action.error(<span class=\"string\">'操作异常。'</span>);</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;);</div><div class=\"line\"></div><div class=\"line\">&#125;,<span class=\"number\">5000</span>);</div></pre></td></tr></table></figure>"},{"title":"linux下安装opencv-java","toc":true,"date":"2018-01-24T07:03:02.000Z","scaffolds":null,"_content":"linux下安装opencv java \n\n# 说明\n在正式环境安装的时候安装opencv时候一直编译失败，缺少文件，后来下载了310版本的opencv，可以用了  \n线上环境linux centos6.5\n\n# linux版本\ncentos7\n\n# 安装jdk\n# 安装ant\n## 下载\n[ant官网下载](http://ant.apache.org/bindownload.cgi)http://ant.apache.org/bindownload.cgi\n```\napache-ant-1.9.9-bin.tar.gz\n```\n## 解压 重命名\n```\nunzip apache-ant-1.9.9-bin.tar.gz\nmv apache-ant-1.9.9 ant\n```\n\n## 配置环境变量\n```\nvim /etc/profile \n在文件后加入 \nexport ANT_HOME=/usr/local/ant \nexport PATH=$ANT_HOME/bin:$PATH\n```\n## 刷新环境变量\n```\nsource /etc/profile\n```\n\n# 安装OpenCV\n## 安装OpenCV依赖库\n```\nyum install -y build-essential gcc gcc-c++ cmake git pkgconfig gtk+-devel gtk2-devel python python-pip python-devel\n```\n## 下载\n可以到[官网](https://opencv.org/releases.html)下载 选择对应版本，我这里是3.3.1\nhttps://opencv.org/releases.html\n## 解压\n先解压,解压后进入目录,创建build目录,进入build目录,准备预编译\n```\nunzip opencv-3.3.1.zip\ncd opencv-3.3.1 \nmkdir build && cd build/\n```\n## 预编译\n通过cmake命令预先编译一次,编译完成后查看输出结果, 在```To be built```里包含java这一项就表示预编译成功\n```\ncmake -DCMAKE_BUILD_TYPE=Release -DBUILD_SHARED_LIBS=OFF -DBUILD_EXAMPLES=OFF -DBUILD_TESTS=OFF -DBUILD_PERF_TESTS=OFF -DCMAKE_INSTALL_PREFIX=/usr/local ..\n```\n可能会卡在\n```\n-- IPPICV: Download: ippicv_2017u3_lnx_intel64_general_20170822.tgz\n```\n这个文件比较大,下载时间长一点,不要着急\n## 编译\ncmake完成后，在build目录直接输入make进行编译，如果服务器CPU核数比较多，可以在make后加入-j8 使用8个线程同时进行编译，加快编译速度。\n```\nmake -j2\n```\n关于下面这个异常，我编译的时候并没有出现，记录一下，备用。\n\n编译过程可能出现异常，提示：\n\n/usr/include/jasper/jas_math.h:117:22: error: ‘SIZE_MAX’ was not declared in this scope\n\n出现这个异常，不要慌，可以通过修改/usr/include/jasper/jas_math.h 文件源码解决。 \n在/usr/include/jasper/jas_math.h 的头部#include 的下面添加:\n```\n#if ! defined SIZE_MAX \n#define SIZE_MAX (4294967295U) \n#endif\n```\n然后重新编译就可以了。如果不行，请删除build目录下的内容，重新预编译、编译就应该没问题了\n## 安装\n编译完成，就可以进行安装，安装过程是生成opencv对应的库文件，我这里是java项目需要用到，所以也会顺便生成java相关的库文件\n```\nmake install\n```\n命令执行完成，会在结果中看到/usr/local/share/OpenCV/java/目录生成了两个java相关的依赖库文件 opencv-331.jar 和 libopencv_java331.so ， 当然，每个人的环境不同，可能目录也不同，具体看日志输出就行了。\n```\n[root@opencv java]# ll /usr/local/share/OpenCV/java\n总用量 72012\n-rwxr-xr-x 1 root root 73320721 11月  8 14:05 libopencv_java331.so\n-rw-r--r-- 1 root root   414381 11月  8 10:03 opencv-331.jar\n```\n# 参考链接\n*  [opencv官方文档 Installation in Linux](https://docs.opencv.org/master/d7/d9f/tutorial_linux_install.html)\n*  [CentOS6 - Linux下安装OpenCV](http://blog.csdn.net/chwshuang/article/details/78208273?locationNum=9&fps=1)\n\n","source":"_posts/杂记/linux下安装opencv-java.md","raw":"---\ntitle: linux下安装opencv-java \ncategories: 学习\ntags:\n  - opencv\ntoc: true\ndate: 2018-01-24 15:03:02\nscaffolds:\n---\nlinux下安装opencv java \n\n# 说明\n在正式环境安装的时候安装opencv时候一直编译失败，缺少文件，后来下载了310版本的opencv，可以用了  \n线上环境linux centos6.5\n\n# linux版本\ncentos7\n\n# 安装jdk\n# 安装ant\n## 下载\n[ant官网下载](http://ant.apache.org/bindownload.cgi)http://ant.apache.org/bindownload.cgi\n```\napache-ant-1.9.9-bin.tar.gz\n```\n## 解压 重命名\n```\nunzip apache-ant-1.9.9-bin.tar.gz\nmv apache-ant-1.9.9 ant\n```\n\n## 配置环境变量\n```\nvim /etc/profile \n在文件后加入 \nexport ANT_HOME=/usr/local/ant \nexport PATH=$ANT_HOME/bin:$PATH\n```\n## 刷新环境变量\n```\nsource /etc/profile\n```\n\n# 安装OpenCV\n## 安装OpenCV依赖库\n```\nyum install -y build-essential gcc gcc-c++ cmake git pkgconfig gtk+-devel gtk2-devel python python-pip python-devel\n```\n## 下载\n可以到[官网](https://opencv.org/releases.html)下载 选择对应版本，我这里是3.3.1\nhttps://opencv.org/releases.html\n## 解压\n先解压,解压后进入目录,创建build目录,进入build目录,准备预编译\n```\nunzip opencv-3.3.1.zip\ncd opencv-3.3.1 \nmkdir build && cd build/\n```\n## 预编译\n通过cmake命令预先编译一次,编译完成后查看输出结果, 在```To be built```里包含java这一项就表示预编译成功\n```\ncmake -DCMAKE_BUILD_TYPE=Release -DBUILD_SHARED_LIBS=OFF -DBUILD_EXAMPLES=OFF -DBUILD_TESTS=OFF -DBUILD_PERF_TESTS=OFF -DCMAKE_INSTALL_PREFIX=/usr/local ..\n```\n可能会卡在\n```\n-- IPPICV: Download: ippicv_2017u3_lnx_intel64_general_20170822.tgz\n```\n这个文件比较大,下载时间长一点,不要着急\n## 编译\ncmake完成后，在build目录直接输入make进行编译，如果服务器CPU核数比较多，可以在make后加入-j8 使用8个线程同时进行编译，加快编译速度。\n```\nmake -j2\n```\n关于下面这个异常，我编译的时候并没有出现，记录一下，备用。\n\n编译过程可能出现异常，提示：\n\n/usr/include/jasper/jas_math.h:117:22: error: ‘SIZE_MAX’ was not declared in this scope\n\n出现这个异常，不要慌，可以通过修改/usr/include/jasper/jas_math.h 文件源码解决。 \n在/usr/include/jasper/jas_math.h 的头部#include 的下面添加:\n```\n#if ! defined SIZE_MAX \n#define SIZE_MAX (4294967295U) \n#endif\n```\n然后重新编译就可以了。如果不行，请删除build目录下的内容，重新预编译、编译就应该没问题了\n## 安装\n编译完成，就可以进行安装，安装过程是生成opencv对应的库文件，我这里是java项目需要用到，所以也会顺便生成java相关的库文件\n```\nmake install\n```\n命令执行完成，会在结果中看到/usr/local/share/OpenCV/java/目录生成了两个java相关的依赖库文件 opencv-331.jar 和 libopencv_java331.so ， 当然，每个人的环境不同，可能目录也不同，具体看日志输出就行了。\n```\n[root@opencv java]# ll /usr/local/share/OpenCV/java\n总用量 72012\n-rwxr-xr-x 1 root root 73320721 11月  8 14:05 libopencv_java331.so\n-rw-r--r-- 1 root root   414381 11月  8 10:03 opencv-331.jar\n```\n# 参考链接\n*  [opencv官方文档 Installation in Linux](https://docs.opencv.org/master/d7/d9f/tutorial_linux_install.html)\n*  [CentOS6 - Linux下安装OpenCV](http://blog.csdn.net/chwshuang/article/details/78208273?locationNum=9&fps=1)\n\n","slug":"杂记/linux下安装opencv-java","published":1,"updated":"2018-01-24T07:16:39.236Z","_id":"cjcsqintz00010gvflqn2794j","comments":1,"layout":"post","photos":[],"link":"","content":"<p>linux下安装opencv java </p>\n<h1 id=\"说明\"><a href=\"#说明\" class=\"headerlink\" title=\"说明\"></a>说明</h1><p>在正式环境安装的时候安装opencv时候一直编译失败，缺少文件，后来下载了310版本的opencv，可以用了<br>线上环境linux centos6.5</p>\n<h1 id=\"linux版本\"><a href=\"#linux版本\" class=\"headerlink\" title=\"linux版本\"></a>linux版本</h1><p>centos7</p>\n<h1 id=\"安装jdk\"><a href=\"#安装jdk\" class=\"headerlink\" title=\"安装jdk\"></a>安装jdk</h1><h1 id=\"安装ant\"><a href=\"#安装ant\" class=\"headerlink\" title=\"安装ant\"></a>安装ant</h1><h2 id=\"下载\"><a href=\"#下载\" class=\"headerlink\" title=\"下载\"></a>下载</h2><p><a href=\"http://ant.apache.org/bindownload.cgi\" target=\"_blank\" rel=\"external\">ant官网下载</a><a href=\"http://ant.apache.org/bindownload.cgi\" target=\"_blank\" rel=\"external\">http://ant.apache.org/bindownload.cgi</a><br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">apache-ant-1.9.9-bin.tar.gz</div></pre></td></tr></table></figure></p>\n<h2 id=\"解压-重命名\"><a href=\"#解压-重命名\" class=\"headerlink\" title=\"解压 重命名\"></a>解压 重命名</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\">unzip apache-ant-1.9.9-bin.tar.gz</div><div class=\"line\">mv apache-ant-1.9.9 ant</div></pre></td></tr></table></figure>\n<h2 id=\"配置环境变量\"><a href=\"#配置环境变量\" class=\"headerlink\" title=\"配置环境变量\"></a>配置环境变量</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\">vim /etc/profile </div><div class=\"line\">在文件后加入 </div><div class=\"line\">export ANT_HOME=/usr/local/ant </div><div class=\"line\">export PATH=$ANT_HOME/bin:$PATH</div></pre></td></tr></table></figure>\n<h2 id=\"刷新环境变量\"><a href=\"#刷新环境变量\" class=\"headerlink\" title=\"刷新环境变量\"></a>刷新环境变量</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">source /etc/profile</div></pre></td></tr></table></figure>\n<h1 id=\"安装OpenCV\"><a href=\"#安装OpenCV\" class=\"headerlink\" title=\"安装OpenCV\"></a>安装OpenCV</h1><h2 id=\"安装OpenCV依赖库\"><a href=\"#安装OpenCV依赖库\" class=\"headerlink\" title=\"安装OpenCV依赖库\"></a>安装OpenCV依赖库</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">yum install -y build-essential gcc gcc-c++ cmake git pkgconfig gtk+-devel gtk2-devel python python-pip python-devel</div></pre></td></tr></table></figure>\n<h2 id=\"下载-1\"><a href=\"#下载-1\" class=\"headerlink\" title=\"下载\"></a>下载</h2><p>可以到<a href=\"https://opencv.org/releases.html\" target=\"_blank\" rel=\"external\">官网</a>下载 选择对应版本，我这里是3.3.1<br><a href=\"https://opencv.org/releases.html\" target=\"_blank\" rel=\"external\">https://opencv.org/releases.html</a></p>\n<h2 id=\"解压\"><a href=\"#解压\" class=\"headerlink\" title=\"解压\"></a>解压</h2><p>先解压,解压后进入目录,创建build目录,进入build目录,准备预编译<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\">unzip opencv-3.3.1.zip</div><div class=\"line\">cd opencv-3.3.1 </div><div class=\"line\">mkdir build &amp;&amp; cd build/</div></pre></td></tr></table></figure></p>\n<h2 id=\"预编译\"><a href=\"#预编译\" class=\"headerlink\" title=\"预编译\"></a>预编译</h2><p>通过cmake命令预先编译一次,编译完成后查看输出结果, 在<figure class=\"highlight plain\"><figcaption><span>be built```里包含java这一项就表示预编译成功</span></figcaption><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\">```</div><div class=\"line\">cmake -DCMAKE_BUILD_TYPE=Release -DBUILD_SHARED_LIBS=OFF -DBUILD_EXAMPLES=OFF -DBUILD_TESTS=OFF -DBUILD_PERF_TESTS=OFF -DCMAKE_INSTALL_PREFIX=/usr/local ..</div></pre></td></tr></table></figure></p>\n<p>可能会卡在<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">-- IPPICV: Download: ippicv_2017u3_lnx_intel64_general_20170822.tgz</div></pre></td></tr></table></figure></p>\n<p>这个文件比较大,下载时间长一点,不要着急</p>\n<h2 id=\"编译\"><a href=\"#编译\" class=\"headerlink\" title=\"编译\"></a>编译</h2><p>cmake完成后，在build目录直接输入make进行编译，如果服务器CPU核数比较多，可以在make后加入-j8 使用8个线程同时进行编译，加快编译速度。<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">make -j2</div></pre></td></tr></table></figure></p>\n<p>关于下面这个异常，我编译的时候并没有出现，记录一下，备用。</p>\n<p>编译过程可能出现异常，提示：</p>\n<p>/usr/include/jasper/jas_math.h:117:22: error: ‘SIZE_MAX’ was not declared in this scope</p>\n<p>出现这个异常，不要慌，可以通过修改/usr/include/jasper/jas_math.h 文件源码解决。<br>在/usr/include/jasper/jas_math.h 的头部#include 的下面添加:<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\">#if ! defined SIZE_MAX </div><div class=\"line\">#define SIZE_MAX (4294967295U) </div><div class=\"line\">#endif</div></pre></td></tr></table></figure></p>\n<p>然后重新编译就可以了。如果不行，请删除build目录下的内容，重新预编译、编译就应该没问题了</p>\n<h2 id=\"安装\"><a href=\"#安装\" class=\"headerlink\" title=\"安装\"></a>安装</h2><p>编译完成，就可以进行安装，安装过程是生成opencv对应的库文件，我这里是java项目需要用到，所以也会顺便生成java相关的库文件<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">make install</div></pre></td></tr></table></figure></p>\n<p>命令执行完成，会在结果中看到/usr/local/share/OpenCV/java/目录生成了两个java相关的依赖库文件 opencv-331.jar 和 libopencv_java331.so ， 当然，每个人的环境不同，可能目录也不同，具体看日志输出就行了。<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\">[root@opencv java]# ll /usr/local/share/OpenCV/java</div><div class=\"line\">总用量 72012</div><div class=\"line\">-rwxr-xr-x 1 root root 73320721 11月  8 14:05 libopencv_java331.so</div><div class=\"line\">-rw-r--r-- 1 root root   414381 11月  8 10:03 opencv-331.jar</div></pre></td></tr></table></figure></p>\n<h1 id=\"参考链接\"><a href=\"#参考链接\" class=\"headerlink\" title=\"参考链接\"></a>参考链接</h1><ul>\n<li><a href=\"https://docs.opencv.org/master/d7/d9f/tutorial_linux_install.html\" target=\"_blank\" rel=\"external\">opencv官方文档 Installation in Linux</a></li>\n<li><a href=\"http://blog.csdn.net/chwshuang/article/details/78208273?locationNum=9&amp;fps=1\" target=\"_blank\" rel=\"external\">CentOS6 - Linux下安装OpenCV</a></li>\n</ul>\n","site":{"data":{}},"excerpt":"","more":"<p>linux下安装opencv java </p>\n<h1 id=\"说明\"><a href=\"#说明\" class=\"headerlink\" title=\"说明\"></a>说明</h1><p>在正式环境安装的时候安装opencv时候一直编译失败，缺少文件，后来下载了310版本的opencv，可以用了<br>线上环境linux centos6.5</p>\n<h1 id=\"linux版本\"><a href=\"#linux版本\" class=\"headerlink\" title=\"linux版本\"></a>linux版本</h1><p>centos7</p>\n<h1 id=\"安装jdk\"><a href=\"#安装jdk\" class=\"headerlink\" title=\"安装jdk\"></a>安装jdk</h1><h1 id=\"安装ant\"><a href=\"#安装ant\" class=\"headerlink\" title=\"安装ant\"></a>安装ant</h1><h2 id=\"下载\"><a href=\"#下载\" class=\"headerlink\" title=\"下载\"></a>下载</h2><p><a href=\"http://ant.apache.org/bindownload.cgi\" target=\"_blank\" rel=\"external\">ant官网下载</a><a href=\"http://ant.apache.org/bindownload.cgi\" target=\"_blank\" rel=\"external\">http://ant.apache.org/bindownload.cgi</a><br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">apache-ant-1.9.9-bin.tar.gz</div></pre></td></tr></table></figure></p>\n<h2 id=\"解压-重命名\"><a href=\"#解压-重命名\" class=\"headerlink\" title=\"解压 重命名\"></a>解压 重命名</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\">unzip apache-ant-1.9.9-bin.tar.gz</div><div class=\"line\">mv apache-ant-1.9.9 ant</div></pre></td></tr></table></figure>\n<h2 id=\"配置环境变量\"><a href=\"#配置环境变量\" class=\"headerlink\" title=\"配置环境变量\"></a>配置环境变量</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\">vim /etc/profile </div><div class=\"line\">在文件后加入 </div><div class=\"line\">export ANT_HOME=/usr/local/ant </div><div class=\"line\">export PATH=$ANT_HOME/bin:$PATH</div></pre></td></tr></table></figure>\n<h2 id=\"刷新环境变量\"><a href=\"#刷新环境变量\" class=\"headerlink\" title=\"刷新环境变量\"></a>刷新环境变量</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">source /etc/profile</div></pre></td></tr></table></figure>\n<h1 id=\"安装OpenCV\"><a href=\"#安装OpenCV\" class=\"headerlink\" title=\"安装OpenCV\"></a>安装OpenCV</h1><h2 id=\"安装OpenCV依赖库\"><a href=\"#安装OpenCV依赖库\" class=\"headerlink\" title=\"安装OpenCV依赖库\"></a>安装OpenCV依赖库</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">yum install -y build-essential gcc gcc-c++ cmake git pkgconfig gtk+-devel gtk2-devel python python-pip python-devel</div></pre></td></tr></table></figure>\n<h2 id=\"下载-1\"><a href=\"#下载-1\" class=\"headerlink\" title=\"下载\"></a>下载</h2><p>可以到<a href=\"https://opencv.org/releases.html\" target=\"_blank\" rel=\"external\">官网</a>下载 选择对应版本，我这里是3.3.1<br><a href=\"https://opencv.org/releases.html\" target=\"_blank\" rel=\"external\">https://opencv.org/releases.html</a></p>\n<h2 id=\"解压\"><a href=\"#解压\" class=\"headerlink\" title=\"解压\"></a>解压</h2><p>先解压,解压后进入目录,创建build目录,进入build目录,准备预编译<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\">unzip opencv-3.3.1.zip</div><div class=\"line\">cd opencv-3.3.1 </div><div class=\"line\">mkdir build &amp;&amp; cd build/</div></pre></td></tr></table></figure></p>\n<h2 id=\"预编译\"><a href=\"#预编译\" class=\"headerlink\" title=\"预编译\"></a>预编译</h2><p>通过cmake命令预先编译一次,编译完成后查看输出结果, 在<figure class=\"highlight plain\"><figcaption><span>be built```里包含java这一项就表示预编译成功</span></figcaption><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\">```</div><div class=\"line\">cmake -DCMAKE_BUILD_TYPE=Release -DBUILD_SHARED_LIBS=OFF -DBUILD_EXAMPLES=OFF -DBUILD_TESTS=OFF -DBUILD_PERF_TESTS=OFF -DCMAKE_INSTALL_PREFIX=/usr/local ..</div></pre></td></tr></table></figure></p>\n<p>可能会卡在<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">-- IPPICV: Download: ippicv_2017u3_lnx_intel64_general_20170822.tgz</div></pre></td></tr></table></figure></p>\n<p>这个文件比较大,下载时间长一点,不要着急</p>\n<h2 id=\"编译\"><a href=\"#编译\" class=\"headerlink\" title=\"编译\"></a>编译</h2><p>cmake完成后，在build目录直接输入make进行编译，如果服务器CPU核数比较多，可以在make后加入-j8 使用8个线程同时进行编译，加快编译速度。<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">make -j2</div></pre></td></tr></table></figure></p>\n<p>关于下面这个异常，我编译的时候并没有出现，记录一下，备用。</p>\n<p>编译过程可能出现异常，提示：</p>\n<p>/usr/include/jasper/jas_math.h:117:22: error: ‘SIZE_MAX’ was not declared in this scope</p>\n<p>出现这个异常，不要慌，可以通过修改/usr/include/jasper/jas_math.h 文件源码解决。<br>在/usr/include/jasper/jas_math.h 的头部#include 的下面添加:<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\">#if ! defined SIZE_MAX </div><div class=\"line\">#define SIZE_MAX (4294967295U) </div><div class=\"line\">#endif</div></pre></td></tr></table></figure></p>\n<p>然后重新编译就可以了。如果不行，请删除build目录下的内容，重新预编译、编译就应该没问题了</p>\n<h2 id=\"安装\"><a href=\"#安装\" class=\"headerlink\" title=\"安装\"></a>安装</h2><p>编译完成，就可以进行安装，安装过程是生成opencv对应的库文件，我这里是java项目需要用到，所以也会顺便生成java相关的库文件<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">make install</div></pre></td></tr></table></figure></p>\n<p>命令执行完成，会在结果中看到/usr/local/share/OpenCV/java/目录生成了两个java相关的依赖库文件 opencv-331.jar 和 libopencv_java331.so ， 当然，每个人的环境不同，可能目录也不同，具体看日志输出就行了。<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\">[root@opencv java]# ll /usr/local/share/OpenCV/java</div><div class=\"line\">总用量 72012</div><div class=\"line\">-rwxr-xr-x 1 root root 73320721 11月  8 14:05 libopencv_java331.so</div><div class=\"line\">-rw-r--r-- 1 root root   414381 11月  8 10:03 opencv-331.jar</div></pre></td></tr></table></figure></p>\n<h1 id=\"参考链接\"><a href=\"#参考链接\" class=\"headerlink\" title=\"参考链接\"></a>参考链接</h1><ul>\n<li><a href=\"https://docs.opencv.org/master/d7/d9f/tutorial_linux_install.html\" target=\"_blank\" rel=\"external\">opencv官方文档 Installation in Linux</a></li>\n<li><a href=\"http://blog.csdn.net/chwshuang/article/details/78208273?locationNum=9&amp;fps=1\" target=\"_blank\" rel=\"external\">CentOS6 - Linux下安装OpenCV</a></li>\n</ul>\n"},{"title":"tomcat+idea远程调试","toc":true,"date":"2018-01-24T07:03:02.000Z","scaffolds":null,"_content":"# 测试的web项目\n```java\npackage com.signalfire.servlet;\nimport javax.servlet.ServletException;\nimport javax.servlet.ServletRequest;\nimport javax.servlet.ServletResponse;\nimport javax.servlet.http.HttpServlet;\nimport javax.servlet.http.HttpServletRequest;\nimport javax.servlet.http.HttpServletResponse;\nimport java.io.IOException;\n/**\n * Created by jk on 2017/12/12.\n */\npublic class HelloServlet extends HttpServlet {\n    @Override\n    protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {\n        System.out.println(\"111111111111111111\");\n        resp.getWriter().write(\"hello baby\");\n        resp.getWriter().flush();\n    }\n}\n```\n\n```xml\n<!DOCTYPE web-app PUBLIC\n \"-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN\"\n \"http://java.sun.com/dtd/web-app_2_3.dtd\" >\n<web-app>\n  <display-name>Archetype Created Web Application</display-name>\n  <servlet>\n    <servlet-name>my</servlet-name>\n    <servlet-class>com.signalfire.servlet.HelloServlet</servlet-class>\n  </servlet>\n  <servlet-mapping>\n    <servlet-name>my</servlet-name>\n    <url-pattern>/*</url-pattern>\n  </servlet-mapping>\n</web-app>\n```\n# tomcat\n- 打war包部署到tomcat中\n- 使用默认配置启动tomcat调试\n```\n[root@mytest bin]# ./catalina.sh jpda start\n```\n默认情况下，远程调试的默认端口为8000，可以通过JPDA_ADDRESS进行配置，指定自定义的端口，另外，还有两个可以配置的参数\n* JPDA_TRANSPORT：即调试器和虚拟机之间数据的传输方式，默认值是dt_socket\n* JPDA_SUSPEND：即JVM启动后是否立即挂起，默认是n\n可以在catalina.sh中进行配置：\n```bash\nJPDA_TRANSPORT=dt_socket  \nJPDA_ADDRESS=5005  \nJPAD_SUSPEND=n  \n```\n\n# idea配置远程调试\n\n## 配置  \n![tomcat+idea远程调试-20171213104020](http://ovasdkxqr.bkt.clouddn.com/image/work/tomcat+idea远程调试-20171213104020.png)  \n![tomcat+idea远程调试-2017121310403](http://ovasdkxqr.bkt.clouddn.com/image/work/tomcat+idea远程调试-2017121310403.png)  \n## debug启动  \n![tomcat+idea远程调试-20171213104146](http://ovasdkxqr.bkt.clouddn.com/image/work/tomcat+idea远程调试-20171213104146.png)\n\n## 结果\n![tomcat+idea远程调试-20171213104437](http://ovasdkxqr.bkt.clouddn.com/image/work/tomcat+idea远程调试-20171213104437.png)\n\n![tomcat+idea远程调试-20171213104256](http://ovasdkxqr.bkt.clouddn.com/image/work/tomcat+idea远程调试-20171213104256.png)\n\n# 调试java程序\n在远程服务器上java启动参赛要加上调试的参数：  \n\"-Xdebug -Xrunjdwp:transport=dt_socket,address=2345,server=y,suspend=n\"","source":"_posts/杂记/tomcat+idea远程调试.md","raw":"---\ntitle: tomcat+idea远程调试\ncategories: 学习\ntags:\n  - idea\ntoc: true\ndate: 2018-01-24 15:03:02\nscaffolds:\n---\n# 测试的web项目\n```java\npackage com.signalfire.servlet;\nimport javax.servlet.ServletException;\nimport javax.servlet.ServletRequest;\nimport javax.servlet.ServletResponse;\nimport javax.servlet.http.HttpServlet;\nimport javax.servlet.http.HttpServletRequest;\nimport javax.servlet.http.HttpServletResponse;\nimport java.io.IOException;\n/**\n * Created by jk on 2017/12/12.\n */\npublic class HelloServlet extends HttpServlet {\n    @Override\n    protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {\n        System.out.println(\"111111111111111111\");\n        resp.getWriter().write(\"hello baby\");\n        resp.getWriter().flush();\n    }\n}\n```\n\n```xml\n<!DOCTYPE web-app PUBLIC\n \"-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN\"\n \"http://java.sun.com/dtd/web-app_2_3.dtd\" >\n<web-app>\n  <display-name>Archetype Created Web Application</display-name>\n  <servlet>\n    <servlet-name>my</servlet-name>\n    <servlet-class>com.signalfire.servlet.HelloServlet</servlet-class>\n  </servlet>\n  <servlet-mapping>\n    <servlet-name>my</servlet-name>\n    <url-pattern>/*</url-pattern>\n  </servlet-mapping>\n</web-app>\n```\n# tomcat\n- 打war包部署到tomcat中\n- 使用默认配置启动tomcat调试\n```\n[root@mytest bin]# ./catalina.sh jpda start\n```\n默认情况下，远程调试的默认端口为8000，可以通过JPDA_ADDRESS进行配置，指定自定义的端口，另外，还有两个可以配置的参数\n* JPDA_TRANSPORT：即调试器和虚拟机之间数据的传输方式，默认值是dt_socket\n* JPDA_SUSPEND：即JVM启动后是否立即挂起，默认是n\n可以在catalina.sh中进行配置：\n```bash\nJPDA_TRANSPORT=dt_socket  \nJPDA_ADDRESS=5005  \nJPAD_SUSPEND=n  \n```\n\n# idea配置远程调试\n\n## 配置  \n![tomcat+idea远程调试-20171213104020](http://ovasdkxqr.bkt.clouddn.com/image/work/tomcat+idea远程调试-20171213104020.png)  \n![tomcat+idea远程调试-2017121310403](http://ovasdkxqr.bkt.clouddn.com/image/work/tomcat+idea远程调试-2017121310403.png)  \n## debug启动  \n![tomcat+idea远程调试-20171213104146](http://ovasdkxqr.bkt.clouddn.com/image/work/tomcat+idea远程调试-20171213104146.png)\n\n## 结果\n![tomcat+idea远程调试-20171213104437](http://ovasdkxqr.bkt.clouddn.com/image/work/tomcat+idea远程调试-20171213104437.png)\n\n![tomcat+idea远程调试-20171213104256](http://ovasdkxqr.bkt.clouddn.com/image/work/tomcat+idea远程调试-20171213104256.png)\n\n# 调试java程序\n在远程服务器上java启动参赛要加上调试的参数：  \n\"-Xdebug -Xrunjdwp:transport=dt_socket,address=2345,server=y,suspend=n\"","slug":"杂记/tomcat+idea远程调试","published":1,"updated":"2018-01-24T07:16:48.889Z","_id":"cjcsqinu500030gvf07r92jzj","comments":1,"layout":"post","photos":[],"link":"","content":"<h1 id=\"测试的web项目\"><a href=\"#测试的web项目\" class=\"headerlink\" title=\"测试的web项目\"></a>测试的web项目</h1><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">package</span> com.signalfire.servlet;</div><div class=\"line\"><span class=\"keyword\">import</span> javax.servlet.ServletException;</div><div class=\"line\"><span class=\"keyword\">import</span> javax.servlet.ServletRequest;</div><div class=\"line\"><span class=\"keyword\">import</span> javax.servlet.ServletResponse;</div><div class=\"line\"><span class=\"keyword\">import</span> javax.servlet.http.HttpServlet;</div><div class=\"line\"><span class=\"keyword\">import</span> javax.servlet.http.HttpServletRequest;</div><div class=\"line\"><span class=\"keyword\">import</span> javax.servlet.http.HttpServletResponse;</div><div class=\"line\"><span class=\"keyword\">import</span> java.io.IOException;</div><div class=\"line\"><span class=\"comment\">/**</span></div><div class=\"line\"><span class=\"comment\"> * Created by jk on 2017/12/12.</span></div><div class=\"line\"><span class=\"comment\"> */</span></div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">HelloServlet</span> <span class=\"keyword\">extends</span> <span class=\"title\">HttpServlet</span> </span>&#123;</div><div class=\"line\">    <span class=\"meta\">@Override</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title\">doGet</span><span class=\"params\">(HttpServletRequest req, HttpServletResponse resp)</span> <span class=\"keyword\">throws</span> ServletException, IOException </span>&#123;</div><div class=\"line\">        System.out.println(<span class=\"string\">\"111111111111111111\"</span>);</div><div class=\"line\">        resp.getWriter().write(<span class=\"string\">\"hello baby\"</span>);</div><div class=\"line\">        resp.getWriter().flush();</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">&lt;!DOCTYPE web-app PUBLIC</span></div><div class=\"line\"><span class=\"meta\"> \"-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN\"</span></div><div class=\"line\"><span class=\"meta\"> \"http://java.sun.com/dtd/web-app_2_3.dtd\" &gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">web-app</span>&gt;</span></div><div class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">display-name</span>&gt;</span>Archetype Created Web Application<span class=\"tag\">&lt;/<span class=\"name\">display-name</span>&gt;</span></div><div class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">servlet</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">servlet-name</span>&gt;</span>my<span class=\"tag\">&lt;/<span class=\"name\">servlet-name</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">servlet-class</span>&gt;</span>com.signalfire.servlet.HelloServlet<span class=\"tag\">&lt;/<span class=\"name\">servlet-class</span>&gt;</span></div><div class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">servlet</span>&gt;</span></div><div class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">servlet-mapping</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">servlet-name</span>&gt;</span>my<span class=\"tag\">&lt;/<span class=\"name\">servlet-name</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">url-pattern</span>&gt;</span>/*<span class=\"tag\">&lt;/<span class=\"name\">url-pattern</span>&gt;</span></div><div class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">servlet-mapping</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">web-app</span>&gt;</span></div></pre></td></tr></table></figure>\n<h1 id=\"tomcat\"><a href=\"#tomcat\" class=\"headerlink\" title=\"tomcat\"></a>tomcat</h1><ul>\n<li>打war包部署到tomcat中</li>\n<li>使用默认配置启动tomcat调试<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">[root@mytest bin]# ./catalina.sh jpda start</div></pre></td></tr></table></figure>\n</li>\n</ul>\n<p>默认情况下，远程调试的默认端口为8000，可以通过JPDA_ADDRESS进行配置，指定自定义的端口，另外，还有两个可以配置的参数</p>\n<ul>\n<li>JPDA_TRANSPORT：即调试器和虚拟机之间数据的传输方式，默认值是dt_socket</li>\n<li>JPDA_SUSPEND：即JVM启动后是否立即挂起，默认是n<br>可以在catalina.sh中进行配置：<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\">JPDA_TRANSPORT=dt_socket  </div><div class=\"line\">JPDA_ADDRESS=5005  </div><div class=\"line\">JPAD_SUSPEND=n</div></pre></td></tr></table></figure>\n</li>\n</ul>\n<h1 id=\"idea配置远程调试\"><a href=\"#idea配置远程调试\" class=\"headerlink\" title=\"idea配置远程调试\"></a>idea配置远程调试</h1><h2 id=\"配置\"><a href=\"#配置\" class=\"headerlink\" title=\"配置\"></a>配置</h2><p><img src=\"http://ovasdkxqr.bkt.clouddn.com/image/work/tomcat+idea远程调试-20171213104020.png\" alt=\"tomcat+idea远程调试-20171213104020\"><br><img src=\"http://ovasdkxqr.bkt.clouddn.com/image/work/tomcat+idea远程调试-2017121310403.png\" alt=\"tomcat+idea远程调试-2017121310403\">  </p>\n<h2 id=\"debug启动\"><a href=\"#debug启动\" class=\"headerlink\" title=\"debug启动\"></a>debug启动</h2><p><img src=\"http://ovasdkxqr.bkt.clouddn.com/image/work/tomcat+idea远程调试-20171213104146.png\" alt=\"tomcat+idea远程调试-20171213104146\"></p>\n<h2 id=\"结果\"><a href=\"#结果\" class=\"headerlink\" title=\"结果\"></a>结果</h2><p><img src=\"http://ovasdkxqr.bkt.clouddn.com/image/work/tomcat+idea远程调试-20171213104437.png\" alt=\"tomcat+idea远程调试-20171213104437\"></p>\n<p><img src=\"http://ovasdkxqr.bkt.clouddn.com/image/work/tomcat+idea远程调试-20171213104256.png\" alt=\"tomcat+idea远程调试-20171213104256\"></p>\n<h1 id=\"调试java程序\"><a href=\"#调试java程序\" class=\"headerlink\" title=\"调试java程序\"></a>调试java程序</h1><p>在远程服务器上java启动参赛要加上调试的参数：<br>“-Xdebug -Xrunjdwp:transport=dt_socket,address=2345,server=y,suspend=n”</p>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"测试的web项目\"><a href=\"#测试的web项目\" class=\"headerlink\" title=\"测试的web项目\"></a>测试的web项目</h1><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">package</span> com.signalfire.servlet;</div><div class=\"line\"><span class=\"keyword\">import</span> javax.servlet.ServletException;</div><div class=\"line\"><span class=\"keyword\">import</span> javax.servlet.ServletRequest;</div><div class=\"line\"><span class=\"keyword\">import</span> javax.servlet.ServletResponse;</div><div class=\"line\"><span class=\"keyword\">import</span> javax.servlet.http.HttpServlet;</div><div class=\"line\"><span class=\"keyword\">import</span> javax.servlet.http.HttpServletRequest;</div><div class=\"line\"><span class=\"keyword\">import</span> javax.servlet.http.HttpServletResponse;</div><div class=\"line\"><span class=\"keyword\">import</span> java.io.IOException;</div><div class=\"line\"><span class=\"comment\">/**</span></div><div class=\"line\"><span class=\"comment\"> * Created by jk on 2017/12/12.</span></div><div class=\"line\"><span class=\"comment\"> */</span></div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">HelloServlet</span> <span class=\"keyword\">extends</span> <span class=\"title\">HttpServlet</span> </span>&#123;</div><div class=\"line\">    <span class=\"meta\">@Override</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title\">doGet</span><span class=\"params\">(HttpServletRequest req, HttpServletResponse resp)</span> <span class=\"keyword\">throws</span> ServletException, IOException </span>&#123;</div><div class=\"line\">        System.out.println(<span class=\"string\">\"111111111111111111\"</span>);</div><div class=\"line\">        resp.getWriter().write(<span class=\"string\">\"hello baby\"</span>);</div><div class=\"line\">        resp.getWriter().flush();</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">&lt;!DOCTYPE web-app PUBLIC</span></div><div class=\"line\"><span class=\"meta\"> \"-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN\"</span></div><div class=\"line\"><span class=\"meta\"> \"http://java.sun.com/dtd/web-app_2_3.dtd\" &gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">web-app</span>&gt;</span></div><div class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">display-name</span>&gt;</span>Archetype Created Web Application<span class=\"tag\">&lt;/<span class=\"name\">display-name</span>&gt;</span></div><div class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">servlet</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">servlet-name</span>&gt;</span>my<span class=\"tag\">&lt;/<span class=\"name\">servlet-name</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">servlet-class</span>&gt;</span>com.signalfire.servlet.HelloServlet<span class=\"tag\">&lt;/<span class=\"name\">servlet-class</span>&gt;</span></div><div class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">servlet</span>&gt;</span></div><div class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">servlet-mapping</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">servlet-name</span>&gt;</span>my<span class=\"tag\">&lt;/<span class=\"name\">servlet-name</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">url-pattern</span>&gt;</span>/*<span class=\"tag\">&lt;/<span class=\"name\">url-pattern</span>&gt;</span></div><div class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">servlet-mapping</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">web-app</span>&gt;</span></div></pre></td></tr></table></figure>\n<h1 id=\"tomcat\"><a href=\"#tomcat\" class=\"headerlink\" title=\"tomcat\"></a>tomcat</h1><ul>\n<li>打war包部署到tomcat中</li>\n<li>使用默认配置启动tomcat调试<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">[root@mytest bin]# ./catalina.sh jpda start</div></pre></td></tr></table></figure>\n</li>\n</ul>\n<p>默认情况下，远程调试的默认端口为8000，可以通过JPDA_ADDRESS进行配置，指定自定义的端口，另外，还有两个可以配置的参数</p>\n<ul>\n<li>JPDA_TRANSPORT：即调试器和虚拟机之间数据的传输方式，默认值是dt_socket</li>\n<li>JPDA_SUSPEND：即JVM启动后是否立即挂起，默认是n<br>可以在catalina.sh中进行配置：<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\">JPDA_TRANSPORT=dt_socket  </div><div class=\"line\">JPDA_ADDRESS=5005  </div><div class=\"line\">JPAD_SUSPEND=n</div></pre></td></tr></table></figure>\n</li>\n</ul>\n<h1 id=\"idea配置远程调试\"><a href=\"#idea配置远程调试\" class=\"headerlink\" title=\"idea配置远程调试\"></a>idea配置远程调试</h1><h2 id=\"配置\"><a href=\"#配置\" class=\"headerlink\" title=\"配置\"></a>配置</h2><p><img src=\"http://ovasdkxqr.bkt.clouddn.com/image/work/tomcat+idea远程调试-20171213104020.png\" alt=\"tomcat+idea远程调试-20171213104020\"><br><img src=\"http://ovasdkxqr.bkt.clouddn.com/image/work/tomcat+idea远程调试-2017121310403.png\" alt=\"tomcat+idea远程调试-2017121310403\">  </p>\n<h2 id=\"debug启动\"><a href=\"#debug启动\" class=\"headerlink\" title=\"debug启动\"></a>debug启动</h2><p><img src=\"http://ovasdkxqr.bkt.clouddn.com/image/work/tomcat+idea远程调试-20171213104146.png\" alt=\"tomcat+idea远程调试-20171213104146\"></p>\n<h2 id=\"结果\"><a href=\"#结果\" class=\"headerlink\" title=\"结果\"></a>结果</h2><p><img src=\"http://ovasdkxqr.bkt.clouddn.com/image/work/tomcat+idea远程调试-20171213104437.png\" alt=\"tomcat+idea远程调试-20171213104437\"></p>\n<p><img src=\"http://ovasdkxqr.bkt.clouddn.com/image/work/tomcat+idea远程调试-20171213104256.png\" alt=\"tomcat+idea远程调试-20171213104256\"></p>\n<h1 id=\"调试java程序\"><a href=\"#调试java程序\" class=\"headerlink\" title=\"调试java程序\"></a>调试java程序</h1><p>在远程服务器上java启动参赛要加上调试的参数：<br>“-Xdebug -Xrunjdwp:transport=dt_socket,address=2345,server=y,suspend=n”</p>\n"},{"title":"linux修改时间","toc":true,"date":"2018-01-24T07:03:02.000Z","scaffolds":null,"_content":"linux修改时间\n- 修改时区\n> cp /usr/share/zoneinfo/UTC /etc/localtime \n```\n[root@localhost ~]# cp /usr/share/zoneinfo/UTC /etc/localtime \ncp：是否覆盖“/etc/localtime”? y \n[root@localhost ~]# date \n2012年 11月 02日 星期五 00:07:30 UTC\n修改为中国的东八区\n```\n\n- 配置新的时间\n```\n# vi /etc/sysconfig/clock\nZONE=\"Asia/Shanghai\"\nUTC=false\nARC=false\n```\n* 安装ntp\n```\nyum install -y ntp\n```\n* 设置时间同步\n```\nntpdate 210.72.145.44\n```\n\n\n\n参考链接 [Linux服务器同步网络时间](http://www.linuxidc.com/Linux/2017-03/141745.htm)","source":"_posts/杂记/linux修改时间.md","raw":"---\ntitle: linux修改时间 \ncategories: 学习\ntags:\n  - linux\ntoc: true\ndate: 2018-01-24 15:03:02\nscaffolds:\n---\nlinux修改时间\n- 修改时区\n> cp /usr/share/zoneinfo/UTC /etc/localtime \n```\n[root@localhost ~]# cp /usr/share/zoneinfo/UTC /etc/localtime \ncp：是否覆盖“/etc/localtime”? y \n[root@localhost ~]# date \n2012年 11月 02日 星期五 00:07:30 UTC\n修改为中国的东八区\n```\n\n- 配置新的时间\n```\n# vi /etc/sysconfig/clock\nZONE=\"Asia/Shanghai\"\nUTC=false\nARC=false\n```\n* 安装ntp\n```\nyum install -y ntp\n```\n* 设置时间同步\n```\nntpdate 210.72.145.44\n```\n\n\n\n参考链接 [Linux服务器同步网络时间](http://www.linuxidc.com/Linux/2017-03/141745.htm)","slug":"杂记/linux修改时间","published":1,"updated":"2018-01-24T07:16:43.499Z","_id":"cjcsqinui00060gvf8mg3ds2b","comments":1,"layout":"post","photos":[],"link":"","content":"<p>linux修改时间</p>\n<ul>\n<li><p>修改时区</p>\n<blockquote>\n<p>cp /usr/share/zoneinfo/UTC /etc/localtime </p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\">[root@localhost ~]# cp /usr/share/zoneinfo/UTC /etc/localtime </div><div class=\"line\">cp：是否覆盖“/etc/localtime”? y </div><div class=\"line\">[root@localhost ~]# date </div><div class=\"line\">2012年 11月 02日 星期五 00:07:30 UTC</div><div class=\"line\">修改为中国的东八区</div></pre></td></tr></table></figure>\n</blockquote>\n</li>\n<li><p>配置新的时间</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\"># vi /etc/sysconfig/clock</div><div class=\"line\">ZONE=&quot;Asia/Shanghai&quot;</div><div class=\"line\">UTC=false</div><div class=\"line\">ARC=false</div></pre></td></tr></table></figure>\n</li>\n</ul>\n<ul>\n<li><p>安装ntp</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">yum install -y ntp</div></pre></td></tr></table></figure>\n</li>\n<li><p>设置时间同步</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">ntpdate 210.72.145.44</div></pre></td></tr></table></figure>\n</li>\n</ul>\n<p>参考链接 <a href=\"http://www.linuxidc.com/Linux/2017-03/141745.htm\" target=\"_blank\" rel=\"external\">Linux服务器同步网络时间</a></p>\n","site":{"data":{}},"excerpt":"","more":"<p>linux修改时间</p>\n<ul>\n<li><p>修改时区</p>\n<blockquote>\n<p>cp /usr/share/zoneinfo/UTC /etc/localtime </p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\">[root@localhost ~]# cp /usr/share/zoneinfo/UTC /etc/localtime </div><div class=\"line\">cp：是否覆盖“/etc/localtime”? y </div><div class=\"line\">[root@localhost ~]# date </div><div class=\"line\">2012年 11月 02日 星期五 00:07:30 UTC</div><div class=\"line\">修改为中国的东八区</div></pre></td></tr></table></figure>\n</blockquote>\n</li>\n<li><p>配置新的时间</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\"># vi /etc/sysconfig/clock</div><div class=\"line\">ZONE=&quot;Asia/Shanghai&quot;</div><div class=\"line\">UTC=false</div><div class=\"line\">ARC=false</div></pre></td></tr></table></figure>\n</li>\n</ul>\n<ul>\n<li><p>安装ntp</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">yum install -y ntp</div></pre></td></tr></table></figure>\n</li>\n<li><p>设置时间同步</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">ntpdate 210.72.145.44</div></pre></td></tr></table></figure>\n</li>\n</ul>\n<p>参考链接 <a href=\"http://www.linuxidc.com/Linux/2017-03/141745.htm\" target=\"_blank\" rel=\"external\">Linux服务器同步网络时间</a></p>\n"}],"PostAsset":[],"PostCategory":[{"post_id":"cjcsq4ldd0002x4vfhhquq8c9","category_id":"cjcsq4ldr0007x4vf0fba9buv","_id":"cjcsq4ldw000ax4vfkeun5s5o"},{"post_id":"cjcsq4lf4000bx4vfa2f09a5z","category_id":"cjcsq4lf6000dx4vfmt2amd67","_id":"cjcsq4lfh000lx4vf2pwrffzo"},{"post_id":"cjcsq4lf5000cx4vfxtu7ar9z","category_id":"cjcsq4lf6000dx4vfmt2amd67","_id":"cjcsq4lfn000qx4vfklajv50n"},{"post_id":"cjcsq4lfl000px4vf9wxzb5r7","category_id":"cjcsq4lfk000nx4vfe13bru1i","_id":"cjcsq4lfs000wx4vf740m1fl4"},{"post_id":"cjcsq4lf7000fx4vfjicqj8rg","category_id":"cjcsq4lfk000nx4vfe13bru1i","_id":"cjcsq4lfw0011x4vflmq0ax5w"},{"post_id":"cjcsq4lfn000rx4vf8xga9jf2","category_id":"cjcsq4lfk000nx4vfe13bru1i","_id":"cjcsq4lfy0014x4vfa8nu6lbl"},{"post_id":"cjcsq4lfq000ux4vf2zw7rg4w","category_id":"cjcsq4lfk000nx4vfe13bru1i","_id":"cjcsq4lg10018x4vfiot1kxm5"},{"post_id":"cjcsq4lfa000gx4vf78qf7b1g","category_id":"cjcsq4lfo000sx4vf2wvb8zzs","_id":"cjcsq4lg3001bx4vf4jadxb6t"},{"post_id":"cjcsq4lfs000xx4vfhnwoguhd","category_id":"cjcsq4lfk000nx4vfe13bru1i","_id":"cjcsq4lg4001ex4vfugb3ke3g"},{"post_id":"cjcsq4lfx0012x4vfzhrnaylm","category_id":"cjcsq4lfk000nx4vfe13bru1i","_id":"cjcsq4lg6001gx4vfqbzs5lyp"},{"post_id":"cjcsq4lfc000hx4vfqexklzlg","category_id":"cjcsq4lfo000sx4vf2wvb8zzs","_id":"cjcsq4lg6001hx4vf7g6iysjh"},{"post_id":"cjcsq4lfy0015x4vfhu375ie8","category_id":"cjcsq4lfk000nx4vfe13bru1i","_id":"cjcsq4lg7001jx4vflzgjne4s"},{"post_id":"cjcsq4lg20019x4vfgnsrj7ob","category_id":"cjcsq4lfk000nx4vfe13bru1i","_id":"cjcsq4lg8001kx4vf23cwdz3z"},{"post_id":"cjcsq4lfg000kx4vftxgikp0y","category_id":"cjcsq4lfk000nx4vfe13bru1i","_id":"cjcsq4lga001mx4vfmi386t8u"},{"post_id":"cjcsq4lfj000mx4vfjss7lpgd","category_id":"cjcsq4lfk000nx4vfe13bru1i","_id":"cjcsq4lgb001ox4vfhxrza71j"},{"post_id":"cjcsq4lja003jx4vftqubkpwb","category_id":"cjcsq4lfk000nx4vfe13bru1i","_id":"cjcsq4lji003ox4vfx2dyl95n"},{"post_id":"cjcsq4ljb003kx4vfwmk7czz2","category_id":"cjcsq4lfk000nx4vfe13bru1i","_id":"cjcsq4ljm003rx4vfs1k4jckz"},{"post_id":"cjcsq4ljg003mx4vfjkm7pejj","category_id":"cjcsq4lfk000nx4vfe13bru1i","_id":"cjcsq4ljp003tx4vfalv3z6jx"},{"post_id":"cjcsq4ljj003qx4vfq0rzn1tw","category_id":"cjcsq4lfk000nx4vfe13bru1i","_id":"cjcsq4ljv003xx4vf1fxapblt"},{"post_id":"cjcsq4ljn003sx4vf8kd16nn5","category_id":"cjcsq4lfk000nx4vfe13bru1i","_id":"cjcsq4ljy0040x4vfzlo495f5"},{"post_id":"cjcsq4ljq003ux4vf9f9cxf0t","category_id":"cjcsq4lfk000nx4vfe13bru1i","_id":"cjcsq4lk00043x4vfyplw2jpz"},{"post_id":"cjcsq4ljw003yx4vf1rxpjwvj","category_id":"cjcsq4lfk000nx4vfe13bru1i","_id":"cjcsq4lk20045x4vflmj582cz"},{"post_id":"cjcsq4ljy0041x4vfmuzwdrj7","category_id":"cjcsq4lfk000nx4vfe13bru1i","_id":"cjcsq4lk50049x4vf4192n69k"},{"post_id":"cjcsq4lk30046x4vfzh3uqcg7","category_id":"cjcsq4lfk000nx4vfe13bru1i","_id":"cjcsq4lk8004dx4vf6h72ed0e"},{"post_id":"cjcsq4lk5004ax4vfnsp9171v","category_id":"cjcsq4lfk000nx4vfe13bru1i","_id":"cjcsq4lkc004gx4vfcafkyzjc"},{"post_id":"cjcsq4lk7004bx4vf7dfn5pfa","category_id":"cjcsq4lfk000nx4vfe13bru1i","_id":"cjcsq4lkf004kx4vfrtj8blci"},{"post_id":"cjcsq4lk10044x4vf9h4k571d","category_id":"cjcsq4lk40048x4vfkdrueb5z","_id":"cjcsq4lkh004nx4vfyzd2vqlz"},{"post_id":"cjcsq4lka004ex4vf7ms1p148","category_id":"cjcsq4lfk000nx4vfe13bru1i","_id":"cjcsq4lkj004qx4vfm0abg1iy"},{"post_id":"cjcsq4lkd004hx4vf2gfvyyui","category_id":"cjcsq4lfk000nx4vfe13bru1i","_id":"cjcsq4lkm004ux4vfyae5tb6m"},{"post_id":"cjcsq4lkf004lx4vf5ylaqhuh","category_id":"cjcsq4lfk000nx4vfe13bru1i","_id":"cjcsq4lkq004xx4vfvohfm7zf"},{"post_id":"cjcsq4lkh004ox4vf2jwr6fpr","category_id":"cjcsq4lk40048x4vfkdrueb5z","_id":"cjcsq4lkt0051x4vfx06dtsiv"},{"post_id":"cjcsq4lkk004sx4vfnmls9r0b","category_id":"cjcsq4lfk000nx4vfe13bru1i","_id":"cjcsq4lkx0054x4vfpy1wmqyp"},{"post_id":"cjcsq4lkm004vx4vfdez4yo36","category_id":"cjcsq4lk40048x4vfkdrueb5z","_id":"cjcsq4ll00058x4vfcwl822bp"},{"post_id":"cjcsq4lkq004yx4vfo8g3u2br","category_id":"cjcsq4lfk000nx4vfe13bru1i","_id":"cjcsq4ll4005bx4vf3q6anne1"},{"post_id":"cjcsq4lkt0052x4vff56ta5rp","category_id":"cjcsq4lk40048x4vfkdrueb5z","_id":"cjcsq4ll9005fx4vf5j3dt6ai"},{"post_id":"cjcsq4lkx0055x4vf8rtbeajy","category_id":"cjcsq4lk40048x4vfkdrueb5z","_id":"cjcsq4lla005hx4vf2a00kxac"},{"post_id":"cjcsq4ll00059x4vfmz89jfsu","category_id":"cjcsq4lfk000nx4vfe13bru1i","_id":"cjcsq4llb005jx4vffyx3prg0"},{"post_id":"cjcsq4ll5005cx4vfjcwk626t","category_id":"cjcsq4lk40048x4vfkdrueb5z","_id":"cjcsq4llc005mx4vfu7pgzrog"},{"post_id":"cjcsqintm00000gvflddykbio","category_id":"cjcsq4lfk000nx4vfe13bru1i","_id":"cjcsqlft30000w0vf49dprf7n"},{"post_id":"cjcsqintz00010gvflqn2794j","category_id":"cjcsq4lfk000nx4vfe13bru1i","_id":"cjcsqlft50001w0vfds6o9jzc"},{"post_id":"cjcsqinui00060gvf8mg3ds2b","category_id":"cjcsq4lfk000nx4vfe13bru1i","_id":"cjcsqlft70002w0vfdfvckg94"},{"post_id":"cjcsqinu500030gvf07r92jzj","category_id":"cjcsq4lfk000nx4vfe13bru1i","_id":"cjcsqlft70003w0vffd218tno"}],"PostTag":[{"post_id":"cjcsq4lf4000bx4vfa2f09a5z","tag_id":"cjcsq4lf7000ex4vfkztn2n9e","_id":"cjcsq4lfr000vx4vfleut04eo"},{"post_id":"cjcsq4lf4000bx4vfa2f09a5z","tag_id":"cjcsq4lfd000jx4vfxp3xwpxc","_id":"cjcsq4lft000yx4vflkj120lo"},{"post_id":"cjcsq4lf4000bx4vfa2f09a5z","tag_id":"cjcsq4lfl000ox4vfmewpdq6q","_id":"cjcsq4lfy0013x4vfildibniv"},{"post_id":"cjcsq4lf5000cx4vfxtu7ar9z","tag_id":"cjcsq4lfd000jx4vfxp3xwpxc","_id":"cjcsq4lg3001ax4vf4ig3fjcs"},{"post_id":"cjcsq4lf5000cx4vfxtu7ar9z","tag_id":"cjcsq4lfl000ox4vfmewpdq6q","_id":"cjcsq4lg4001cx4vfh05z13lv"},{"post_id":"cjcsq4lf7000fx4vfjicqj8rg","tag_id":"cjcsq4lg00017x4vfcs5errjf","_id":"cjcsq4lga001nx4vf75j572da"},{"post_id":"cjcsq4lf7000fx4vfjicqj8rg","tag_id":"cjcsq4lg5001fx4vfqgu0k74h","_id":"cjcsq4lgb001px4vfai2gs97o"},{"post_id":"cjcsq4lf7000fx4vfjicqj8rg","tag_id":"cjcsq4lg7001ix4vfbqk2ryom","_id":"cjcsq4lgc001rx4vfvahcqhkk"},{"post_id":"cjcsq4lfa000gx4vf78qf7b1g","tag_id":"cjcsq4lg5001fx4vfqgu0k74h","_id":"cjcsq4lge001ux4vf2558mlkf"},{"post_id":"cjcsq4lfa000gx4vf78qf7b1g","tag_id":"cjcsq4lg00017x4vfcs5errjf","_id":"cjcsq4lge001vx4vfdoqwmiu9"},{"post_id":"cjcsq4lfa000gx4vf78qf7b1g","tag_id":"cjcsq4lgd001sx4vfxhe0tzqp","_id":"cjcsq4lgf001xx4vfwsr7c1c6"},{"post_id":"cjcsq4lfc000hx4vfqexklzlg","tag_id":"cjcsq4lg00017x4vfcs5errjf","_id":"cjcsq4lgh0020x4vf0jn531c6"},{"post_id":"cjcsq4lfc000hx4vfqexklzlg","tag_id":"cjcsq4lg5001fx4vfqgu0k74h","_id":"cjcsq4lgh0021x4vf9h3ckaa1"},{"post_id":"cjcsq4lfc000hx4vfqexklzlg","tag_id":"cjcsq4lgd001sx4vfxhe0tzqp","_id":"cjcsq4lgi0023x4vfsohz2w4r"},{"post_id":"cjcsq4lfg000kx4vftxgikp0y","tag_id":"cjcsq4lg00017x4vfcs5errjf","_id":"cjcsq4lgs0027x4vfggy3xvno"},{"post_id":"cjcsq4lfg000kx4vftxgikp0y","tag_id":"cjcsq4lg5001fx4vfqgu0k74h","_id":"cjcsq4lgt0028x4vf5jbny31y"},{"post_id":"cjcsq4lfg000kx4vftxgikp0y","tag_id":"cjcsq4lg7001ix4vfbqk2ryom","_id":"cjcsq4lgu002ax4vfjjbf0qg1"},{"post_id":"cjcsq4lfg000kx4vftxgikp0y","tag_id":"cjcsq4lgd001sx4vfxhe0tzqp","_id":"cjcsq4lgu002bx4vfesl04jnd"},{"post_id":"cjcsq4lfj000mx4vfjss7lpgd","tag_id":"cjcsq4lg00017x4vfcs5errjf","_id":"cjcsq4lgx002fx4vfxlrcikjz"},{"post_id":"cjcsq4lfj000mx4vfjss7lpgd","tag_id":"cjcsq4lg5001fx4vfqgu0k74h","_id":"cjcsq4lgx002gx4vfs9ulh1x1"},{"post_id":"cjcsq4lfj000mx4vfjss7lpgd","tag_id":"cjcsq4lg7001ix4vfbqk2ryom","_id":"cjcsq4lgy002ix4vfkhb0b8p8"},{"post_id":"cjcsq4lfj000mx4vfjss7lpgd","tag_id":"cjcsq4lgd001sx4vfxhe0tzqp","_id":"cjcsq4lgy002jx4vf2cviinq4"},{"post_id":"cjcsq4lfl000px4vf9wxzb5r7","tag_id":"cjcsq4lg00017x4vfcs5errjf","_id":"cjcsq4lh1002nx4vfjx67o27c"},{"post_id":"cjcsq4lfl000px4vf9wxzb5r7","tag_id":"cjcsq4lg5001fx4vfqgu0k74h","_id":"cjcsq4lh1002ox4vfty345rh5"},{"post_id":"cjcsq4lfl000px4vf9wxzb5r7","tag_id":"cjcsq4lg7001ix4vfbqk2ryom","_id":"cjcsq4lh3002qx4vf9k43kmac"},{"post_id":"cjcsq4lfl000px4vf9wxzb5r7","tag_id":"cjcsq4lgd001sx4vfxhe0tzqp","_id":"cjcsq4lh3002rx4vfap2d9jwf"},{"post_id":"cjcsq4lfn000rx4vf8xga9jf2","tag_id":"cjcsq4lg00017x4vfcs5errjf","_id":"cjcsq4lh5002ux4vfreizx33m"},{"post_id":"cjcsq4lfn000rx4vf8xga9jf2","tag_id":"cjcsq4lg5001fx4vfqgu0k74h","_id":"cjcsq4lh5002vx4vfxhpce0k0"},{"post_id":"cjcsq4lfn000rx4vf8xga9jf2","tag_id":"cjcsq4lg7001ix4vfbqk2ryom","_id":"cjcsq4lh6002xx4vf2gk8fioh"},{"post_id":"cjcsq4lfq000ux4vf2zw7rg4w","tag_id":"cjcsq4lg00017x4vfcs5errjf","_id":"cjcsq4lh90031x4vf5iztvxuq"},{"post_id":"cjcsq4lfq000ux4vf2zw7rg4w","tag_id":"cjcsq4lg5001fx4vfqgu0k74h","_id":"cjcsq4lh90032x4vf9aij5vl4"},{"post_id":"cjcsq4lfq000ux4vf2zw7rg4w","tag_id":"cjcsq4lg7001ix4vfbqk2ryom","_id":"cjcsq4lha0034x4vfococa9wj"},{"post_id":"cjcsq4lfq000ux4vf2zw7rg4w","tag_id":"cjcsq4lgd001sx4vfxhe0tzqp","_id":"cjcsq4lha0035x4vfb31hg38b"},{"post_id":"cjcsq4lfs000xx4vfhnwoguhd","tag_id":"cjcsq4lg00017x4vfcs5errjf","_id":"cjcsq4lhc0037x4vfhejmoz6r"},{"post_id":"cjcsq4lfs000xx4vfhnwoguhd","tag_id":"cjcsq4lh90033x4vfo6qg90ez","_id":"cjcsq4lhd0038x4vfzjla7lre"},{"post_id":"cjcsq4lfx0012x4vfzhrnaylm","tag_id":"cjcsq4lg00017x4vfcs5errjf","_id":"cjcsq4lhe003bx4vf7p30ox5h"},{"post_id":"cjcsq4lfx0012x4vfzhrnaylm","tag_id":"cjcsq4lh90033x4vfo6qg90ez","_id":"cjcsq4lhf003cx4vfbmfdlgiz"},{"post_id":"cjcsq4lfy0015x4vfhu375ie8","tag_id":"cjcsq4lg00017x4vfcs5errjf","_id":"cjcsq4lhh003fx4vfwx4ooq2y"},{"post_id":"cjcsq4lfy0015x4vfhu375ie8","tag_id":"cjcsq4lh90033x4vfo6qg90ez","_id":"cjcsq4lhh003gx4vfrvqkcc97"},{"post_id":"cjcsq4lg20019x4vfgnsrj7ob","tag_id":"cjcsq4lg00017x4vfcs5errjf","_id":"cjcsq4lhh003hx4vfpec77uth"},{"post_id":"cjcsq4lg20019x4vfgnsrj7ob","tag_id":"cjcsq4lh90033x4vfo6qg90ez","_id":"cjcsq4lhi003ix4vfm5rmxekt"},{"post_id":"cjcsq4lja003jx4vftqubkpwb","tag_id":"cjcsq4lg00017x4vfcs5errjf","_id":"cjcsq4ljf003lx4vfv48rybsy"},{"post_id":"cjcsq4lja003jx4vftqubkpwb","tag_id":"cjcsq4lh90033x4vfo6qg90ez","_id":"cjcsq4ljj003px4vfqhm3jxg4"},{"post_id":"cjcsq4ljb003kx4vfwmk7czz2","tag_id":"cjcsq4lg00017x4vfcs5errjf","_id":"cjcsq4ljv003wx4vfje2w843d"},{"post_id":"cjcsq4ljb003kx4vfwmk7czz2","tag_id":"cjcsq4lji003nx4vfaqmeaior","_id":"cjcsq4ljx003zx4vft6hu09vp"},{"post_id":"cjcsq4ljg003mx4vfjkm7pejj","tag_id":"cjcsq4lg00017x4vfcs5errjf","_id":"cjcsq4lkc004fx4vfw3caohzo"},{"post_id":"cjcsq4ljg003mx4vfjkm7pejj","tag_id":"cjcsq4ljt003vx4vfj2dqzvpt","_id":"cjcsq4lke004ix4vf6q4cleti"},{"post_id":"cjcsq4ljg003mx4vfjkm7pejj","tag_id":"cjcsq4lk00042x4vfmhh3eume","_id":"cjcsq4lkg004mx4vfpppbxxj8"},{"post_id":"cjcsq4ljg003mx4vfjkm7pejj","tag_id":"cjcsq4lji003nx4vfaqmeaior","_id":"cjcsq4lki004px4vfis0lsdnp"},{"post_id":"cjcsq4lkf004lx4vf5ylaqhuh","tag_id":"cjcsq4lg00017x4vfcs5errjf","_id":"cjcsq4lkl004tx4vf3g3ky2rl"},{"post_id":"cjcsq4lkf004lx4vf5ylaqhuh","tag_id":"cjcsq4lg5001fx4vfqgu0k74h","_id":"cjcsq4lkp004wx4vfr9jni126"},{"post_id":"cjcsq4lkf004lx4vf5ylaqhuh","tag_id":"cjcsq4lg7001ix4vfbqk2ryom","_id":"cjcsq4lks0050x4vfiqfkxuoy"},{"post_id":"cjcsq4ljj003qx4vfq0rzn1tw","tag_id":"cjcsq4lg00017x4vfcs5errjf","_id":"cjcsq4lkw0053x4vflz2wjz8p"},{"post_id":"cjcsq4ljj003qx4vfq0rzn1tw","tag_id":"cjcsq4lji003nx4vfaqmeaior","_id":"cjcsq4lkz0057x4vfr19gx77d"},{"post_id":"cjcsq4ljj003qx4vfq0rzn1tw","tag_id":"cjcsq4lke004jx4vf2qyymlqd","_id":"cjcsq4ll4005ax4vfaeszbcby"},{"post_id":"cjcsq4ljn003sx4vf8kd16nn5","tag_id":"cjcsq4lg00017x4vfcs5errjf","_id":"cjcsq4ll8005dx4vf0awxezxv"},{"post_id":"cjcsq4ljn003sx4vf8kd16nn5","tag_id":"cjcsq4lji003nx4vfaqmeaior","_id":"cjcsq4lla005gx4vfpi1hzfx3"},{"post_id":"cjcsq4ljn003sx4vf8kd16nn5","tag_id":"cjcsq4lkj004rx4vfytmnray9","_id":"cjcsq4llb005ix4vfbxb4fwu3"},{"post_id":"cjcsq4lkq004yx4vfo8g3u2br","tag_id":"cjcsq4lg5001fx4vfqgu0k74h","_id":"cjcsq4llc005lx4vfokeg3o6o"},{"post_id":"cjcsq4lkq004yx4vfo8g3u2br","tag_id":"cjcsq4lg7001ix4vfbqk2ryom","_id":"cjcsq4lld005nx4vf2hk0kc0a"},{"post_id":"cjcsq4ljq003ux4vf9f9cxf0t","tag_id":"cjcsq4lg00017x4vfcs5errjf","_id":"cjcsq4lld005px4vfapny3prh"},{"post_id":"cjcsq4ljq003ux4vf9f9cxf0t","tag_id":"cjcsq4lji003nx4vfaqmeaior","_id":"cjcsq4lle005qx4vf2o81yptj"},{"post_id":"cjcsq4ljq003ux4vf9f9cxf0t","tag_id":"cjcsq4lkr004zx4vf8pzwekxd","_id":"cjcsq4llf005sx4vfti9g3xuj"},{"post_id":"cjcsq4ljw003yx4vf1rxpjwvj","tag_id":"cjcsq4lkz0056x4vf4j0kltlg","_id":"cjcsq4llf005tx4vf7w8dbbjk"},{"post_id":"cjcsq4ljy0041x4vfmuzwdrj7","tag_id":"cjcsq4lg00017x4vfcs5errjf","_id":"cjcsq4llg005ux4vfa95zskb4"},{"post_id":"cjcsq4ljy0041x4vfmuzwdrj7","tag_id":"cjcsq4ll8005ex4vfw6pylkvd","_id":"cjcsq4llh005wx4vf77014fev"},{"post_id":"cjcsq4lk10044x4vf9h4k571d","tag_id":"cjcsq4llb005kx4vff8xcicg3","_id":"cjcsq4llh005xx4vfmqp6oanw"},{"post_id":"cjcsq4lk10044x4vf9h4k571d","tag_id":"cjcsq4lld005ox4vfvdcwsqfv","_id":"cjcsq4lli005zx4vfekzmj5hp"},{"post_id":"cjcsq4lk30046x4vfzh3uqcg7","tag_id":"cjcsq4lg00017x4vfcs5errjf","_id":"cjcsq4llj0060x4vf645n8khj"},{"post_id":"cjcsq4lk30046x4vfzh3uqcg7","tag_id":"cjcsq4lji003nx4vfaqmeaior","_id":"cjcsq4llk0062x4vf75lglvxt"},{"post_id":"cjcsq4lk30046x4vfzh3uqcg7","tag_id":"cjcsq4lle005rx4vfvp7ul15x","_id":"cjcsq4llk0063x4vfo4xh8kxj"},{"post_id":"cjcsq4lk5004ax4vfnsp9171v","tag_id":"cjcsq4lkz0056x4vf4j0kltlg","_id":"cjcsq4llm0065x4vfjdtf9zuo"},{"post_id":"cjcsq4lk7004bx4vf7dfn5pfa","tag_id":"cjcsq4lkz0056x4vf4j0kltlg","_id":"cjcsq4llo0066x4vfykmcuiib"},{"post_id":"cjcsq4lka004ex4vf7ms1p148","tag_id":"cjcsq4lkz0056x4vf4j0kltlg","_id":"cjcsq4llq0068x4vfiy1re535"},{"post_id":"cjcsq4lkd004hx4vf2gfvyyui","tag_id":"cjcsq4lg00017x4vfcs5errjf","_id":"cjcsq4llq0069x4vf9nmb83da"},{"post_id":"cjcsq4lkd004hx4vf2gfvyyui","tag_id":"cjcsq4lg5001fx4vfqgu0k74h","_id":"cjcsq4lls006bx4vf2f8zvsyc"},{"post_id":"cjcsq4lkd004hx4vf2gfvyyui","tag_id":"cjcsq4llm0064x4vfi5mxe8x6","_id":"cjcsq4lls006cx4vfrr15wv48"},{"post_id":"cjcsq4lkh004ox4vf2jwr6fpr","tag_id":"cjcsq4llp0067x4vfatjjj3a9","_id":"cjcsq4llu006ex4vfnbyyfihj"},{"post_id":"cjcsq4lkk004sx4vfnmls9r0b","tag_id":"cjcsq4llp0067x4vfatjjj3a9","_id":"cjcsq4llu006fx4vfs0ysaeq1"},{"post_id":"cjcsq4lkm004vx4vfdez4yo36","tag_id":"cjcsq4llt006dx4vf6o39fitv","_id":"cjcsq4lly006ix4vf92ucx8fe"},{"post_id":"cjcsq4lkm004vx4vfdez4yo36","tag_id":"cjcsq4llv006gx4vf8hxdbuaq","_id":"cjcsq4llz006jx4vfub3jhddt"},{"post_id":"cjcsq4lkt0052x4vff56ta5rp","tag_id":"cjcsq4llx006hx4vffz3axsyn","_id":"cjcsq4lm1006lx4vf8bbhkq5x"},{"post_id":"cjcsq4lkx0055x4vf8rtbeajy","tag_id":"cjcsq4lm0006kx4vfscbyo97w","_id":"cjcsq4lm7006ox4vfi71oqjru"},{"post_id":"cjcsq4lkx0055x4vf8rtbeajy","tag_id":"cjcsq4llv006gx4vf8hxdbuaq","_id":"cjcsq4lm8006px4vfcf3uvg3l"},{"post_id":"cjcsq4ll00059x4vfmz89jfsu","tag_id":"cjcsq4lm6006nx4vfrbu0af7l","_id":"cjcsq4lmc006rx4vfiwe5kuwz"},{"post_id":"cjcsq4ll5005cx4vfjcwk626t","tag_id":"cjcsq4llp0067x4vfatjjj3a9","_id":"cjcsq4lmd006sx4vfskdtkpca"},{"post_id":"cjcsqintm00000gvflddykbio","tag_id":"cjcsq4ldm0005x4vfd7gc48aw","_id":"cjcsqinu500020gvfa2zmbwk5"},{"post_id":"cjcsqinu500030gvf07r92jzj","tag_id":"cjcsq4llt006dx4vf6o39fitv","_id":"cjcsqinuk00070gvfe301pcoj"},{"post_id":"cjcsqinui00060gvf8mg3ds2b","tag_id":"cjcsq4lg5001fx4vfqgu0k74h","_id":"cjcsqinun00090gvfy7tdgh4h"},{"post_id":"cjcsqintz00010gvflqn2794j","tag_id":"cjcsqinu700040gvfctqnud3b","_id":"cjcsqinup000b0gvfq1sg81vu"}],"Tag":[{"name":"javascript","_id":"cjcsq4ldm0005x4vfd7gc48aw"},{"name":"生活","_id":"cjcsq4lf7000ex4vfkztn2n9e"},{"name":"北京","_id":"cjcsq4lfd000jx4vfxp3xwpxc"},{"name":"游玩","_id":"cjcsq4lfl000ox4vfmewpdq6q"},{"name":"大数据","_id":"cjcsq4lg00017x4vfcs5errjf"},{"name":"linux","_id":"cjcsq4lg5001fx4vfqgu0k74h"},{"name":"centos7","_id":"cjcsq4lg7001ix4vfbqk2ryom"},{"name":"linux命令","_id":"cjcsq4lgd001sx4vfxhe0tzqp"},{"name":"zookeeper","_id":"cjcsq4lh90033x4vfo6qg90ez"},{"name":"java","_id":"cjcsq4lji003nx4vfaqmeaior"},{"name":"JMS","_id":"cjcsq4ljt003vx4vfj2dqzvpt"},{"name":"activeMQ","_id":"cjcsq4lk00042x4vfmhh3eume"},{"name":"反射","_id":"cjcsq4lke004jx4vf2qyymlqd"},{"name":"socket","_id":"cjcsq4lkj004rx4vfytmnray9"},{"name":"JVM","_id":"cjcsq4lkr004zx4vf8pzwekxd"},{"name":"微服务","_id":"cjcsq4lkz0056x4vf4j0kltlg"},{"name":"rpc","_id":"cjcsq4ll8005ex4vfw6pylkvd"},{"name":"vpn","_id":"cjcsq4llb005kx4vff8xcicg3"},{"name":"aws","_id":"cjcsq4lld005ox4vfvdcwsqfv"},{"name":"动态代理","_id":"cjcsq4lle005rx4vfvp7ul15x"},{"name":"mysql","_id":"cjcsq4llm0064x4vfi5mxe8x6"},{"name":"hexo","_id":"cjcsq4llp0067x4vfatjjj3a9"},{"name":"idea","_id":"cjcsq4llt006dx4vf6o39fitv"},{"name":"快捷键","_id":"cjcsq4llv006gx4vf8hxdbuaq"},{"name":"vagrant","_id":"cjcsq4llx006hx4vffz3axsyn"},{"name":"vscode","_id":"cjcsq4lm0006kx4vfscbyo97w"},{"name":"git","_id":"cjcsq4lm6006nx4vfrbu0af7l"},{"name":"opencv","_id":"cjcsqinu700040gvfctqnud3b"}]}}